<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | MasteringUnrealScriptBaptismByFire    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">MasteringUnrealScriptBaptismByFire  </b></div>
<div id="tooltext">
<a href="MasteringUnrealScriptBaptismByFireJP.html" class="twikiLink">日本語訳</a><br><a href="MasteringUnrealScriptBaptismByFireCH.html" class="twikiLink">中国翻译</a><br><a href="MasteringUnrealScriptBaptismByFireKR.html" class="twikiLink">한국어</a><br>

<!-- Three/MasteringUnrealScriptBaptismByFire -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div class="twikiToc"> <ul>
<li> <a href="MasteringUnrealScriptBaptismByFire.html#CHAPTER 2: UNREALSCRIPT BAPTISM BY FIRE"><b>CHAPTER 2: UNREALSCRIPT BAPTISM BY FIRE</b></a> <ul>
<li> <a href="MasteringUnrealScriptBaptismByFire.html#2.1 BASIC SYNTAX">2.1 BASIC SYNTAX</a> <ul>
<li> <a href="MasteringUnrealScriptBaptismByFire.html#IDENTIFIERS AND KEYWORDS">IDENTIFIERS AND KEYWORDS</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#EXPRESSIONS AND OPERATORS">EXPRESSIONS AND OPERATORS</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#COMMENTS">COMMENTS</a>
</li></ul>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#2.2 THE REGENERATION MUTATOR">2.2 THE REGENERATION MUTATOR</a> <ul>
<li> <a href="MasteringUnrealScriptBaptismByFire.html#PLANNING FOR THE CLASS">PLANNING FOR THE CLASS</a>
</li></ul>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#TUTORIAL 2.1 – RESEARCHING THE REGENERATION MUTATOR">TUTORIAL 2.1 – RESEARCHING THE REGENERATION MUTATOR</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#TUTORIAL 2.2 – INITIAL PAWN CLASS SETUP">TUTORIAL 2.2 – INITIAL PAWN CLASS SETUP</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#TUTORIAL 2.3 – SETTING UP THE REGENERATION TIMER">TUTORIAL 2.3 – SETTING UP THE REGENERATION TIMER</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#TUTORIAL 2.4 – THE MUTATOR SCRIPT">TUTORIAL 2.4 – THE MUTATOR SCRIPT</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#TUTORIAL 2.5 - COMPILING THE SCRIPTS">TUTORIAL 2.5 - COMPILING THE SCRIPTS</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#TUTORIAL 2.6 – PUBLISHING AND TESTING THE MUTATOR">TUTORIAL 2.6 – PUBLISHING AND TESTING THE MUTATOR</a>
</li> <li> <a href="MasteringUnrealScriptBaptismByFire.html#SUPPLEMENTAL FILES">SUPPLEMENTAL FILES</a>
</li></ul>
</li></ul>
</div>
<p />
<h1><a name="CHAPTER 2: UNREALSCRIPT BAPTISM BY FIRE"></a> <b>CHAPTER 2: UNREALSCRIPT BAPTISM BY FIRE</b> </h1>
<p />
Whether you are learning to program for the first time or simply learning a new language, the idea of beginning a new journey can be quite daunting.  Programming with UnrealScript requires knowledge of many concepts, several of which are quite complex. Before we dive into the depths of UnrealScript, we are going to get our feet wet by creating a fairly simple script. There will be no in-depth explanations of the concepts used in the creation of the script. Instead, this chapter should serve as an opportunity for you to familiarize yourself with the process of creating a script from planning to implementation to execution while demonstrating the power of UnrealScript to bring ideas to life. Although no knowledge of the UnrealScript language is necessary to complete this exercise, there are some fundamental concepts we will be encountering which we should touch on before we jump right in.
<p />
<h2><a name="2.1 BASIC SYNTAX"></a> 2.1 BASIC SYNTAX </h2>
<p />
The developers of UnrealScript wanted a language that would be familiar with C++ and Java programmers so when designing the language they created it as a c-style language. All that basically means is that it has similar semantics to those languages like terminating statements (basically a line of code) with a semicolon (;) and enclosing groups of statements within curly braces ({ }).
<p />
When we go about typing code we are essentially repeating sets of identifiers, keywords, operators, and comments over and over again to create the functionality that we want. Let’s take a brief look at each of these concepts.
<p />
<h3><a name="IDENTIFIERS AND KEYWORDS"></a> IDENTIFIERS AND KEYWORDS </h3>
<p />
Identifiers are the names that programmers give to items that they wish to refer to such as class, variable, and function names. In UnrealScript, all identifiers are case-insensitive meaning that RegenPerSecond, REGENperSECOND, and ReGeNpErSeCoNd are all considered the same identifier.
<p />
When coming up with identifier names there are a few rules to be aware of:
<p />
<strong>1.</strong>	All identifiers must start with a letter or an underscore (_)
<p />
<strong>2.</strong>	Any combination of letters, numbers, or underscores may follow
<p />
<strong>3.</strong>	An identifier cannot include a space
<p />
<strong>4.</strong>	The identifier cannot be the same as a keyword
<p />
Some examples of valid identifiers are:
<p />
<i>
<pre>
&#95;&#95;&#95;ValidIdentifier
Valid&#95;Identifier
Valid123Identifier456
</pre>
</i>
<p />
Some invalid identifiers are:
<p />
<i>
<pre>
3&#95;Invalid
Inv&#64;lid
Invalid Identifier
class
</pre>
</i>
<p />
Keywords are special words that are reserved by the compiler that correspond to specific functionality. In our sample script we saw a few different keywords: class function var defaultproperties. Like identifiers, keywords are also case-insensitive.
<p />
<h3><a name="EXPRESSIONS AND OPERATORS"></a> EXPRESSIONS AND OPERATORS </h3>
<p />
An expression is a group of values, operators, and grouping symbols that form an entity which when evaluated will result in some meaningful value that can be stored. Here is a list of some example expressions:
<p />
<i>
<pre>
100
8 + (3 – 2) &#42; 7
2 &#42; PI
</pre>
</i>
<p />
Operators are special functions that manipulate the values of items, called operands; they are an integral part of expressions as all interesting expressions make use of them. We saw some operators in the above sample expressions: + () *.
<p />
Operators and expressions are an essential part of any program. As such, they will be covered in greater detail in a later chapter. For now, this should provide you with sufficient understanding to help you as you progress through the remainder of this chapter.
<p />
<h3><a name="COMMENTS"></a> COMMENTS </h3>
<p />
Comments are used to provide documentation to your source code and are completely ignored by the compiler. Often times they are used to describe what a function and its arguments are to be used for. Comments are especially important when collaborating on a project so other programmers will be able to read and understand the code with ease. Code can easily appear as gibberish to another person or even to its author after an extended period away from the code without proper documentation and explanation.
<p />
Another use for commenting is during testing and debugging. A section of code can be “commented out”, meaning that it will no longer be acknowledged and executed. This method can be used to find a troublesome section of code or to see the difference between two similar sections of code. Using comments for this purpose saves the trouble of deleting and retyping the code, making the entire process easier and more efficient.
<p />
UnrealScript supports two types of comment structures:
<p />
<i>
<pre>
// A line comment
/&#42; A block comment &#42;/
</pre>
</i>
<p />
A line comment is just that, a comment that starts from the beginning of the forward slash pair (//) and goes until the end of the line is reached. A block comment tells the compiler to ignore any content between the opening (/*) and closing (*/) comment tags.
<p />
Here is what part of our example script might look like when comments are added.
<p />
<i>
<pre>
/&#42; This class provides the ability for the player to regenerate his
   health every second. &#42;/
class UTMutator&#95;SuperRegen extends UTMutator;

// The number of hit points that should be restored every second.
var() float RegenPerSecond;

function InitMutator(string Options, out string ErrorMessage)
{
   SetTimer( 1.0, true /&#42; This timer should be called repeatedly &#42;/ );
   Super.InitMutator( Options, ErrorMessage );
}
</pre>
</i>
<p />
<h2><a name="2.2 THE REGENERATION MUTATOR"></a> 2.2 THE REGENERATION MUTATOR </h2>
<p />
Over the course of the next few sections, you will be creating a new mutator. A mutator in Unreal is a script that alters the way the standard game functions in some way. This could be something as simple as replacing all the weapons in a map with rocket launchers or it could be much more involved such as changing the player’s view from a first- to third-person perspective. In our example, we are going to be using the mutator to cause the player’s health the regenerate a specified amount every second during play.
<p />
As stated in the previous chapter, ConTEXT will be the text editor used for all the examples and tutorials throughout this book. If you plan to use ConTEXT, make sure you have it set up according to Appendix B: Setting up ConTEXT for Unreal Engine 3. If you plan to use WOTGreal, refer to Appendix C: Setting up WOTGreal for Unreal Engine 3.
<p />
<h3><a name="PLANNING FOR THE CLASS"></a> PLANNING FOR THE CLASS </h3>
<p />
Before we begin writing any code, it is important that we create a specific plan of what exactly the script should do. We have already stated that the mutator should regenerate the player’s health every second. This is a good start, but we can ask some questions that will help fully flesh out the functionality.
<p /> <ul>
<li> How do we go about regenerating the health?
</li> <li> Should all players’ health regenerate? Bots?
</li> <li> How much should health regenerate each second?
</li> <li> Should this amount be configurable?
</li> <li> Up to what point should the health continue to regenerate?
</li> <li> Are there circumstances when health should not regenerate?
</li></ul>
<p />
For this example, we are going to have the mutator regenerate the health of all player-controlled characters, but not bots. The simplest method to achieve this is to replace the Pawns in the game with our own Pawn class that has regenerating functionality. The amount of regeneration will be 10 units per second and will not be configurable. The player’s health will continue to regenerate up to the absolute maximum health allowed. Regeneration should not occur when the player is located within a volume which is set to cause pain so this situation will have to be accounted for when designing the mutator.
<p />
<h2><a name="TUTORIAL 2.1 – RESEARCHING THE REGENERATION MUTATOR"></a> TUTORIAL 2.1 – RESEARCHING THE REGENERATION MUTATOR </h2>
<p />
At this point, a little research would serve us well. There are a few issues that must be resolved before any actual coding can be done. First, we need some way to replace all the players in the game with our own class that will handle the regeneration. Second, we need to find either the value of the maximum health allowed a player under any condition or a variable representing this value. Finally, some method of determining when the player is inside of a pain-causing volume is necessary.
<p />
Knowing where to look when trying to find a specific piece of information can often be a difficult proposition. You’ll find that the more familiar you become with Unreal’s classes, the easier it becomes to find what you are looking for.
<p />
<strong>1.</strong>	The GameInfo class handles the functionality with regards to game types. This would be a good place to start looking for a way to replace the default pawn class used in the game with our own. Find the GameInfo.uc script located within the ../Engine/Classes directory and open it.
<p />
<strong>2.</strong>	Using the search functionality built in to the text editor to locate certain keywords is a great way to find what you are looking for in most cases. Since we are looking to set the class to be used for all Pawns in the game, PawnClass would be a good term to search for. It is important to make sure you are searching from the top of the document so nothing is overlooked.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-001.jpg"/><br/> <strong><font color=blue>FIGURE 2.1 – Find Text dialog searching the GameInfo class for the term “PawnClass”</font></strong>
<p />
<strong>3.</strong>	Perform a search of the Actor class for the keyword PawnClass by first pressing Ctrl + F. Enter the term “PawnClass” in the Find What field of the Find Text dialog that appears. Also, be sure to check the From the top option. Finally, click Find.
<p />
The first match should be:
<p />
<i>
var   class<Pawn>			  DefaultPawnClass;
</i>
<p />
This appears to be a just what we were looking for. By overriding the value of this variable within the mutator, we should be able to cause the game to use our regenerating Pawn class. With this first issue solved, we can turn out attention to finding the remaining information.
<p />
<strong>4.</strong>	When dealing with the player, the first location to start looking for answers is in the script for the UTPawn class. This is the class for player- and AI-controlled characters in Unreal Tournament 3. Find the UTPawn.uc script located within the ../UTGame/Classes directory and open it.
<p />
<strong>5.</strong>	Begin by pressing Ctrl + F to perform a search. Enter the term “Health” in the Find what field and choose the From the top option. Press Find to start the search.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-002.jpg"/><br/> <strong><font color=blue>FIGURE 2.2 – Find Text dialog searching the UTPawn class for the term “Health”</font></strong>
<p />
The first item the search should find will be:
<p />
<i>
var int  SuperHealthMax;		/** Maximum allowable boosted health */
</i>
<p />
Bingo! This is exactly what we were looking for. With this piece of information in hand, we can now move on to searching for the final piece of information needed for the script.
<p />
<strong>6.</strong>	If you don’t have any experience with Unreal, either through level design or scripting, knowing what to look for in this final search could be difficult. Volumes are a method used in Unreal to define an area of space. Some of these volumes, specifically PhysicsVolumes, can affect the physical properties of the space they enclose as well as inflicting pain on any players located within them through the use of the bPainCausing property. With this bit of knowledge, we can devise a search for the keyword bPainCausing. Searching in the UTPawn class would make sense to begin with, but our search would not result in anything useful. Moving on to the parent Pawn class would be the next logical choice
<p />
Open the Pawn.uc script located within the ../Engine/Classes directory.
<p />
<strong>7.</strong>	Again, press Ctrl + F to perform a search. Enter the term “bPainCausing” in the Find what field and choose the From the top option. Press Find to start the search.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-003.jpg"/><br/> <strong><font color=blue>FIGURE 2.3 – Find Text dialog searching the Actor class for the term “PhysicsVolume”</font></strong>
<p />
<strong>8.</strong>	The first match for this search reveals the following:
<p />
<i>
<pre>
//Pain timer just expired.
//Check what zone I&#39;m in (and which parts are)
//based on that cause damage, and reset BreathTime

function bool IsInPain()
{
   local PhysicsVolume V;

   ForEach TouchingActors(class&#39;PhysicsVolume&#39;,V)
      if ( V.bPainCausing &#38;&#38; (V.DamagePerSec &#62; 0) )
         return true;
   return false;
}
</pre>
</i>
<p />
Again, we have found exactly what we were looking for.
<p />
With a solid plan in place and all the necessary information in hand, we can begin writing the code for our regeneration mutator.
<p />
<h2><a name="TUTORIAL 2.2 – INITIAL PAWN CLASS SETUP"></a> TUTORIAL 2.2 – INITIAL PAWN CLASS SETUP </h2>
<p />
<strong>1.</strong>	Open ConTEXT if it is not already open.
<p />
<strong>2.</strong>	The first thing we need in order to start writing the code for the custom Pawn class is a new script file. From the File menu, choose New or press the New File button in the toolbar.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-004.jpg"/><br/> <strong><font color=blue>FIGURE 2.4 – The New File button</font></strong>
<p />
<strong>3.</strong>	Use the Select Active Highlighter dropdown to choose the UnrealEd or UnrealScript highlighter for this new file. The highlighter you choose will depend on which one you have installed and personal preference.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-005.jpg"/><br/> <strong><font color=blue>FIGURE 2.5 – The Select Active Highlighter dropdown</font></strong>
<p />
<strong>4.</strong>	We can now begin writing the code. The first part of any new script will be the class declaration. This is where we give a name to the script and determine what its parent class will be. On the first line, type the following:
<p />
class UTPawn_SuperRegen extends UTPawn;
<p />
With this line of code, we are naming our class UTPawn_SuperRegen. We have also specified that it will be inheriting from the UTPawn class. This essentially means our class will contain all the functionality of the UTPawn class as well as any functionality we add.
<p />
<strong>5.</strong>	We will use one variable to represent the amount to regenerate the health of the player each second. Press Enter twice and type the following code on line 3.
<p />
var int RegenPerSecond;
<p />
This variable will be given an initial value in the next step, but will not actually be used further until later on when modifying the health.
<p />
<strong>6.</strong>	The final part of the initial class setup involves creating the defaultproperties block. This will hold values for the properties of our class. Press Enter several times and type the following:
<p />
<i>
<pre>
defaultproperties
{
   RegenPerSecond &#61; 10
}
</pre>
</i>
<p />
Here, we have specified the name of the group for this mutator as well as given an initial value to the RegenPerSec variable.
<p />
<strong>7.</strong>	That will conclude the initial setup of the class. The code up to this point should look like the following:
<p />
<i>
<pre>
class UTPawn&#95;SuperRegen extends UTPawn;

var int RegenPerSecond;



defaultproperties
{
   RegenPerSecond&#61;10
}
</pre>
</i>
<p />
<strong>8.</strong>	As is always a good idea, we will now save the script so that our progress is not lost. From the File menu, choose Save as… In the dialog that opens navigate to one of these directories:
<p />
For Windows XP:
<p />
<i>
C:\Documents and Settings\[User Name]\My Documents\My Games\Unreal Tournament 3\UTGame\Src
</i>
<p />
For Windows Vista:
<p />
<i>
C:\Users\[User Name]\Documents\My Games\Unreal Tournament 3\UTGame\Src
</i>
<p />
<strong>9.</strong>	Create a new Folder inside the Src directory.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-006.jpg"/><br/> <strong><font color=blue>FIGURE 2.6 – The Create New Folder button in the Save As dialog.</font></strong>
<p />
Name this new folder MasteringUnrealScript.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-007.jpg"/><br/> <strong><font color=blue>FIGURE 2.7 – A new folder has been created named MasteringUnrealScript.</font></strong>
<p />
<strong>10.</strong>	Open this directory and create another new folder. Name this folder Classes and open it as well.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-008.jpg"/><br/> <strong><font color=blue>FIGURE 2.8 – A new folder has been created named Classes.</font></strong>
<p />
<strong>11.</strong>	Finally, enter UTPawn_SuperRegen as the name of the script making sure that UnrealScript (*.uc) is selected in the Save as type field and click Save.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-009.jpg"/><br/> <strong><font color=blue>FIGURE 2.9 – The Pawn script has been named and is ready to be saved.</font></strong>
<p />
Of course, at this point the class has no added functionality. We will be adding that in the next tutorial.
<p />
<h2><a name="TUTORIAL 2.3 – SETTING UP THE REGENERATION TIMER"></a> TUTORIAL 2.3 – SETTING UP THE REGENERATION TIMER </h2>
<p />
With our new Pawn class created, it is time to add in the functionality that will set it apart from the standard UTPawn class. This will include setting up a Timer function which will increase the Health of the player each time it is executed as well as a method for making sure this Timer gets executed every second.
<p />
<strong>1.</strong>	Continuing from the previous tutorial, open the UTPawn_SuperRegen.uc file in ConTEXT.
<p />
<strong>2.</strong>	After the declaration of the RegenPerSecond variable, declare the Timer function by typing the following:
<p />
<i>
<pre>
function Timer()
{
}
</pre>
</i>
<p />
Timers are a special type of function that will be called after a specified amount of time and can be forced to repeat as well. This makes them ideally suited for our purposes.
<p />
<strong>3.</strong>	Now, let us begin adding some functionality to the Timer function. Place the cursor after the opening curly brace ({) and press Enter. Then press Tab to indent this section of code. Type in the following code:
<p />
<i>
<pre>
if (Controller.IsA(&#39;PlayerController&#39;) &#38;&#38; !IsInPain() &#38;&#38; Health&#60;SuperHealthMax)
{
}
</pre>
</i>
<p />
This piece of code may appear complex at first glance, but it is fairly simple in actuality. It may be easier to digest when broken apart into pieces.
<p />
<i>
<pre>
if ()
{
}
</pre>
</i>
<p />
This begins an If statement. It essentially says that if the expression within the parentheses is true, the code that will be placed within the curly braces ({}) will be executed.
<p />
<i>
Controller.IsA('PlayerController')
</i>
<p />
This bit of code is checking to see if this Pawn is player-controlled. If so, we move on to the next piece of code.
<p />
<i>
IsInPain()
</i>
<p />
This expression is checking to see if this Pawn is inside a pain-causing volume. If it is not (notice the ! symbol), we move on to the next piece of code.
<p />
<i>
Health &lt; SuperHealthMax
</i>
<p />
This expression is checking to see if the Health of this Pawn is less than the absolute maximum allowed health. If it is, then the code between the curly braces ({}) can be performed.
<p />
<strong>4.</strong>	Place the cursor after the opening curly brace ({) of the If statement and press Enter. Then press Tab to indent this section of code. Type the following:
<p />
<i>
Health = Min(Health+RegenPerSecond, SuperHealthMax);
</i>
<p />
Here we are taking the current value of the Health and adding the regeneration amount to it. This value is then compared against the maximum allowed health and the lower of the two is assigned to the Health of the Pawn. In essence, this will perform the regeneration while capping the resulting health value at the maximum allowed.
<p />
<strong>5.</strong>	The Timer function itself is now complete and should appear like so:
<p />
<i>
<pre>
function Timer()
{
   if (Controller.IsA(&#39;PlayerController&#39;) &#38;&#38; !IsInPain() &#38;&#38; Health&#60;SuperHealthMax)
   {
      Health &#61; Min(Health+RegenPerSecond, SuperHealthMax);
   }
}
</pre>
</i>
<p />
<strong>6.</strong>	We still need a way to assure that this Timer is executed every second so the regeneration is actually performed. Earlier we discussed that timers are a special type of function. In order to start a timer, another function called SetTimer must be executed. The only real issue is where do we place the call to this SetTimer function so that it will be executed when play begins? It just so happens there is a function in all Actors called PostBeginPlay which, appropriately enough, is executed immediately after play begins.
<p />
Below the declaration of the RegenPerSecond variable and above the Timer function, type the following:
<p />
<i>
<pre>
simulated function PostBeginPlay()
{
}
</pre>
</i>
<p />
You may notice the new keyword Simulated being used. Don’t worry about that for now. It has to do with networking which is a complex topic that we will get into much later on.
<p />
<strong>7.</strong>	Place the cursor after the opening curly brace of the PostBeginPlay function and press Enter. Then press Tab to indent this section of code. Type in the following:
<p />
<i>
<pre>
Super.PostBeginPlay();

SetTimer(1.0,true);
</pre>
</i>
<p />
The first line in this function says that the PostBeginPlay function should be executed in the parent class. This means the UTPawn’s version of PostBeginPlay will be called at this point. Then, the second line starts the Timer. It will be executed every 1.0 seconds and it is set to loop.
<p />
<strong>8.</strong>	With that bit of code finished, the custom Pawn class should be complete as well. The entire Pawn class should look like the following:
<p />
<i>
<pre>
class UTPawn&#95;SuperRegen extends UTPawn;

var Int RegenPerSecond;

simulated function PostBeginPlay()
{
   Super.PostBeginPlay();

   SetTimer(1.0,true);
}

function Timer()
{
   if (Controller.IsA(&#39;PlayerController&#39;) &#38;&#38; !IsInPain() &#38;&#38; Health&#60;SuperHealthMax)
   {
      Health &#61; Min(Health+RegenPerSecond, SuperHealthMax);
   }
}

defaultproperties
{
   RegenPerSecond&#61;10
}
</pre>
</i>
<p />
<strong>9.</strong>	Save the UTPawn_SuperRegen.uc file in ConTEXT to preserve your progress.
<p />
Now that the custom Pawn class is complete, the next step is to begin writing the code for the mutator class itself. We will tackle this in the next tutorial.
<p />
<h2><a name="TUTORIAL 2.4 – THE MUTATOR SCRIPT"></a> TUTORIAL 2.4 – THE MUTATOR SCRIPT </h2>
<p />
<strong>1.</strong>	Open ConTEXT if it is not already.
<p />
<strong>2.</strong>	From the File menu, choose New or press the New File button in the toolbar.
<p />
<strong>3.</strong>	Use the Select Active Highlighter dropdown in the toolbar to select the UnrealScript highlighter of your choice.
<p />
<strong>4.</strong>	On the first line of the new script, type the following code:
<p />
<i>
class UTMutator_SuperRegen extends UTMutator;
</i>
<p />
In a similar fashion to the Pawn class, this line names this class UTMutator_SuperRegen and specifies that it will be a mutator with all of the functionality built into the UTMutator class as well as any functionality we may add.
<p />
<strong>5.</strong>	Press Enter a couple of times and add the following code to the script.
<p />
<i>
<pre>
simulated function PostBeginPlay()
{
}
</pre>
</i>
<p />
As we saw in the custom Pawn class, the PostBeginPlay function will be executed very early on. Inside this function is where the code that replaces the GameInfo’s DefaultPawnClass with our own custom Pawn class.
<p />
<strong>6.</strong>	Now, place the cursor after the opening curly brace and press Enter. then press Tab to indent this section of code and type the following:
<p />
<i>
<pre>
Super.PostBeginPlay();

WorldInfo.Game.DefaultPawnClass &#61; class&#39;MasteringUnrealScript.UTPawn&#95;SuperRegen&#39;;
</pre>
</i>
<p />
The first line of this code will cause the PostBeginPlay function of the parent class to be executed. This ensures that any underlying actions located within the PostBeginPlay function will be performed. The second line contains the meat of our mutator class. WorldInfo.Game is simply a reference to the current GameInfo. We are accessing its DefaultPawnClass variable and setting it to use our custom Pawn class.
<p />
<strong>7.</strong>	All that is left to finish coding the mutator class is to add the defaultproperties block. After the PostBeginPlay function, add the following code.
<p />
<i>
<pre>
defaultproperties
{
   GroupNames&#91;0] &#61; &#34;PLAYERMOD&#34;
}
</pre>
</i>
<p />
The GroupNames array is simply a way to label mutators and keep mutators which might potentially conflict with one another from being loaded at the same time. This is important as it is possible that another mutator might replace the Pawns with its own custom Pawn. This would override the effect of our mutator making it useless. Since no two mutators with a matching group name may be loaded simultaneously, this keeps one mutator from overriding another. We have chosen the label PLAYERMOD since that is essentially what this mutator does.
<p />
<strong>8.</strong>	The mutator class should now be completed. The entire mutator class should look like the following:
<p />
<i>
<pre>
class UTMutator&#95;SuperRegen extends UTMutator;

simulated function PostBeginPlay()
{
   Super.PostBeginPlay();

   WorldInfo.Game.DefaultPawnClass &#61; class&#39;MasteringUnrealScript.UTPawn&#95;SuperRegen&#39;;

}

defaultproperties
{
   GroupNames&#91;0] &#61; &#34;PLAYERMOD&#34;
}
</pre>
</i>
<p />
<strong>9.</strong>	Save the new script in the MasteringUnrealScript/Classes directory with the UTPawn_SuperRegen.uc script. Name this script UTMutator_SuperRegen.uc.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-010.jpg"/><br/> <strong><font color=blue>FIGURE 2.10 – The Mutator script has been named and is ready to be saved</font></strong>
<p />
<h2><a name="TUTORIAL 2.5 - COMPILING THE SCRIPTS"></a> TUTORIAL 2.5 - COMPILING THE SCRIPTS </h2>
<p />
With the coding for the mutator out of the way, the next step in the process is to compile the scripts. This will involve setting up the UTEditor.ini file as well as running the compiler. If there are any errors, those will need to be corrected and the compiling process will need to be performed again.
<p />
<strong>1.</strong>	The first step in the compiling process is to add the MasteringUnrealScript package to the list of ModPackages in the UTEditor.ini file. Without performing this step, the compiler will not know to look for our new scripts and they will not be compiled.
<p />
Navigate to the following directory:
<p />
<i>
..\My Games\Unreal Tournament 3\UTGame\Config
</i>
<p />
<strong>2.</strong>	Locate the UTEditor.ini file and open it in Notepad or some other text editor so that it can be edited.
<p />
<strong>3.</strong>	Find the section of the .ini file with the [ModPackages] heading. A simple way to find this section is to search the file for ModPackages.
<p />
<strong>4.</strong>	Place the cursor at the end of the following line and press Enter.
<p />
<i>
ModOutputDir=..\UTGame\Unpublished\CookedPC\Script
</i>
<p />
<strong>5.</strong>	Add this line to add the MasteringUnrealScript package to the list of packages to be compiled.
<p />
<i>
ModPackages=MasteringUnrealScript
</i>
<p />
<strong>6.</strong>	Save the UTEditor.ini file and close it.
<p />
<strong>7.</strong>	As was mentioned in the previous chapter, there are several ways to run the compiler, or the Make commandlet to be more precise. Throughout the remainder of the book you will simply be instructed to compile scripts and it will be up to you to decide how to go about that. For now, choose one of the following:
<p /> <ul>
<li> If you set up ConTEXT according to the instruction in Appendix B, you can simply press F9 within ConTEXT to begin the compiling process.
</li> <li> If you have created a shortcut to the UT3.exe with the make switch, run that now.
</li> <li> Run the game or editor and choose to compile the scripts when prompted.
</li> <li> Navigate to the Binaries directory of your UT3 installation and run the following command: UT3.exe make
</li></ul>
<p />
<strong>8.</strong>	Assuming there were no errors, the compiling process should complete successfully and result in the creation of the MasteringUnrealScript.u file within the ..\UTGame\Unpulished\CookedPC\Script directory.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-011.jpg"/><br/> <strong><font color=blue>FIGURE 2.11 – The successful output of the Make commandlet.</font></strong>
<p />
<h2><a name="TUTORIAL 2.6 – PUBLISHING AND TESTING THE MUTATOR"></a> TUTORIAL 2.6 – PUBLISHING AND TESTING THE MUTATOR </h2>
<p />
It is now time to see if everything up to this point has indeed been successful. Theo only way to know if our mutator works is to test it out inside of Unreal Tournament 3. The script package created in the previous tutorial is located within the Unpublished directory. The game, by default, only acknowledges content located within the Published directory. This leaves us with two choices.
<p /> <ul>
<li> Copy the MasteringUnrealScript.u package to the Published directory
</li> <li> Run Unreal Tournament 3 using the –useunpublished flag
</li></ul>
<p />
For this example, we are going to use the first option and place the script package in the Published directory. Since the scripts do not rely on any other content, such as textures, meshes, sounds, etc. located within content packages that may be located within the Unpublished directory, there is no reason not to go ahead and publish the script package. If this were not the case, it would be a good idea to go ahead and test using the –useunpublished flag.
<p />
<strong>1.</strong>	Navigate to the ..My Games\Unreal Tournament 3\UTGame\ directory. Assuming no Published folder exists in this location presently, create a new folder named Published.
<p />
<strong>2.</strong>	Inside the Published directory, create another new folder and name it CookedPC.
<p />
<strong>3.</strong>	Open the CookedPC directory and create one final folder named Script.
<p />
<strong>4.</strong>	Copy the MasteringUnrealScript.u script package from the ..\Unpublished\CookedPC\Script folder to the newly created ..\Published\CookedPC\Script directory.
<p />
<strong>5.</strong>	Run Unreal Tournament 3 and choose an Instant Action game.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-012.jpg"/><br/> <strong><font color=blue>FIGURE 2.12 – The Unreal Tournament 3 main menu.</font></strong>
<p />
<strong>6.</strong>	Select the Deathmatch gametype on the next screen.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-013.jpg"/><br/> <strong><font color=blue>FIGURE 2.13 – Unreal Tournament 3’s Gametype selection screen.</font></strong>
<p />
<strong>7.</strong>	Choose any map you wish from the list and then select Settings from the menu at the top of the screen.
<p />
<strong>8.</strong>	The Mutator selection screen can be accessed by selecting Mutators from the bottom of the Settings screen.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-014.jpg"/><br/> <strong><font color=blue>FIGURE 2.14 – The Mutator selection screen is accessed from the Gametype Settings screen.</font></strong>
<p />
<strong>9.</strong>	Once you have opened the Mutator select screen, select the UTMutator_SuperRegen mutator from the list on the left and then choose Add from the bottom of the screen.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-015.jpg"/><br/> <strong><font color=blue>FIGURE 2.15 – Adding the SuperRegen mutator to the Enabled Mutators list.</font></strong>
<p />
<strong>10.</strong>	Finally, click Accept on the Mutator selection screen followed by choosing Start Game from the next screen. Once the game begins, you will notice your health will immediately begin to regenerate until it hits the maximum allowed of 199.
<p />
<img src="rsrc/Three/MasteringUnrealScriptBaptismByFire/2-016.jpg"/><br/> <strong><font color=blue>FIGURE 2.16 – The player’s health has regenerated to 199.</font></strong>
<p />
<h2><a name="SUPPLEMENTAL FILES"></a> SUPPLEMENTAL FILES </h2>
<p /> <ul>
<li> <a href="rsrc/Three/MasteringUnrealScriptBaptismByFire/Chapter2_CompleteSource.rar" target="_top">Chapter2_CompleteSource.rar</a>: Completed Scripts
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
