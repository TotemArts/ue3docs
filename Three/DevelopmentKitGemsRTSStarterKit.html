<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | DevelopmentKitGemsRTSStarterKit    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">DevelopmentKitGemsRTSStarterKit  </b></div>
<div id="tooltext">
<a href="DevelopmentKitGemsRTSStarterKitJP.html" class="twikiLink">日本語訳</a><br><a href="DevelopmentKitGemsRTSStarterKitCH.html" class="twikiLink">中国翻译</a><br><a href="DevelopmentKitGemsRTSStarterKitKR.html" class="twikiLink">한국어</a><br>

<!-- Three/DevelopmentKitGemsRTSStarterKit -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="DevelopmentKitGems.html" class="twikiLink">Unreal Development Kit Gems</a></b> &gt; RTS Starter Kit <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="GettingStartedProgramming.html" class="twikiLink">Getting Started: Programming</a> </b> &gt; RTS Starter Kit
</div>
<hr size="1" noshade="noshade">
<p />
<h1><a name="RTS Starter Kit"></a> RTS Starter Kit </h1>
<hr size="1" noshade="noshade">
<p />
<strong><em>Last tested against UDK Nov, 2011</em></strong>
<p />
<div class="twikiToc"> <ul>
<li> <a href="DevelopmentKitGemsRTSStarterKit.html#RTS Starter Kit"> RTS Starter Kit</a> <ul>
<li> <a href="DevelopmentKitGemsRTSStarterKit.html#Overview"> Overview</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#What's included?"> What's included?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#Code structure"> Code structure</a> <ul>
<li> <a href="DevelopmentKitGemsRTSStarterKit.html#How to detect what is &quot;underneath&quot; the mouse/finger?"> How to detect what is "underneath" the mouse/finger?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How do the buttons appear on the HUD when selecting a structure/unit?"> How do the buttons appear on the HUD when selecting a structure/unit?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How do the HUD actions do anything when they are pressed?"> How do the HUD actions do anything when they are pressed?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How is resources handled?"> How is resources handled?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How does the game handle the creation of units?"> How does the game handle the creation of units?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How does the game handle the creation of structures?"> How does the game handle the creation of structures?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How does the AI work?"> How does the AI work?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How does the upgrade system work?"> How does the upgrade system work?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How does the weapon system work?"> How does the weapon system work?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How does the commander voice over system work?"> How does the commander voice over system work?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How is music played back?"> How is music played back?</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How to create a game using this starter kit?"> How to create a game using this starter kit?</a> <ul>
<li> <a href="DevelopmentKitGemsRTSStarterKit.html#How to create a new structure"> How to create a new structure</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How to create a new unit (Pawn)"> How to create a new unit (Pawn)</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How to create a new weapon"> How to create a new weapon</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#How to use this starter kit?"> How to use this starter kit?</a>
</li> <li> <a href="DevelopmentKitGemsRTSStarterKit.html#Downloads"> Downloads</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<hr size="1" noshade="noshade">
This starter kit has example code which you can use as a starting point to develop a real time strategy game such as <a href="http://hostile-worlds.com/">Hostile Worlds</a> which is under development and made with UDK.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/RTSKit_HostileWorlds.jpg" alt="RTSKit_HostileWorlds.jpg" width='800' height='566' />
<p />
<h2><a name="What's included?"></a> What's included? </h2>
<hr size="1" noshade="noshade">
Unlike the <a href="DevelopmentKitGemsPlatformerStarterKit.html" class="twikiLink">Platformer Starter Kit</a> or the <a href="DevelopmentKitGemsRacerStarterKit.html" class="twikiLink">Racer Starter Kit</a>; there is a lot of code and content in this Starter Kit. It also has a few advanced features that are not really related to real time strategy games, but could help with other areas of development as well.
<p /> <ul>
<li> <strong>Platform abstraction</strong> - The RTS Starter Kit is able to distinguish which platform the player is playing on. Depending on which platform the player is using, different player controllers and HUD classes are used. However, the PC and Console platform classes have only been stubbed out. Currently, only the mobile platform is fully supported.
</li> <li> <strong>Camera</strong> - The RTS Starter Kit has an example of how you would create a camera to act like an birds eye view camera. It supports panning, touch panning and zooming.
</li> <li> <strong>Structures</strong> - The RTS Starter Kit has example code which handles structures that the player can build.
</li> <li> <strong>Units</strong> - The RTS Starter Kit has example code which handles units that the player can issue commands to.
</li> <li> <strong>Skills</strong> - The RTS Starter Kit has example code which handles skills for units.
</li> <li> <strong>Resource Management</strong> - The RTS Starter Kit has example code which handles resources for players.
</li> <li> <strong>AI</strong> - The RTS Starter Kit has example code which demonstrates how you can create an enemy AI player that is capable of building structures, units and fight against you.
</li> <li> <strong>Upgrades</strong> - The RTS Starter Kit has example code which shows you how to create upgrades for your units.
</li> <li> <strong>Structure Upgrades</strong> - The RTS Starter Kit has example code which shows you how to create structures which can upgrade themselves into more advanced forms.
</li> <li> <strong>Networking</strong> - The RTS Starter Kit has been built with networking in mind, and thus has replication set up for you.
</li> <li> <strong>Documentation</strong> - The RTS Starter Kit is fully documented using a style similar to <a href="http://en.wikipedia.org/wiki/Javadoc">Javadocs</a>.
</li> <li> <strong>UI</strong> - The RTS Starter Kit has a small custom UI code base which deals with simple buttons.
</li></ul>
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> Only the Mobile version of the RTS Starter Kit is included.
<p />
<h2><a name="Code structure"></a> Code structure </h2>
<hr size="1" noshade="noshade">
The RTS Starter Kit is a large, complex project and thus understanding all portions is important before you begin extending and or modifying the Starter Kit to create your game.
<p />
<h3><a name="How to detect what is &quot;underneath&quot; the mouse/finger?"></a> How to detect what is "underneath" the mouse/finger? </h3>
The mouse interface code works differently compared to the <a href="DevelopmentKitGemsCreatingAMouseInterface.html" class="twikiLink">Mouse Interface Development Kit Gem</a>. In the case of an RTS game, you don't really want far away units to be difficult to select, or you may want to prioritize different things to be selected at any given time. For example, you may want to make units more important than structures, which are more important than resource points. The RTS Starter Kit resolves these problems by creating screen space boxes representing dimensions of the units on screen. To solve the problem of far away units having a too small a screen box, artificial padding can be added to the box dimensions (however, during development this problem did not really occur because of the camera style). To solve the priority problem, the units were iterated over first, and then structures and then resources. Since touches are already captured in screen space, from there point within box comparisons were done to find out what the mouse/finger was on top of. If the mouse/finger did not touch anything, then it is assumed that it must have touched the world.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/RTSKit_BoundingBoxes.jpg" alt="RTSKit_BoundingBoxes.jpg" width='800' height='412' />
<p />
In this code snippet, the code iterates through all of the resources in the world and calculates the screen bounding box for them.
<div class="codetitlebar">
UDKRTSMobileHUD.uc
</div>
<div class="codesnippet">
<pre>
// Calculate the screen bounding boxes for all of the resources
for (i &#61; 0; i &#60; UDKRTSGameReplicationInfo.Resources.Length; ++i)
{
  if (UDKRTSGameReplicationInfo.Resources&#91;i] !&#61; None)
  {
    UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox &#61; CalculateScreenBoundingBox(Self, UDKRTSGameReplicationInfo.Resources&#91;i], UDKRTSGameReplicationInfo.Resources&#91;i].CollisionCylinder);

    // Render the debug bounding box
    if (ShouldDisplayDebug(&#39;BoundingBoxes&#39;))
    {
      Canvas.SetPos(UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox.Min.X, UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox.Min.Y);
      Canvas.DrawColor &#61; UDKRTSGameReplicationInfo.Resources&#91;i].BoundingBoxColor;
      Canvas.DrawBox(UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox.Max.X - UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox.Min.X, UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox.Max.Y - UDKRTSGameReplicationInfo.Resources&#91;i].ScreenBoundingBox.Min.Y);
    }
  }
}
</pre>
</div>
<p />
In this code snippet, the code calculates the screen bounding box. This is similar to the <a href="DevelopmentKitGemsCreatingActorSelectionBoxesOrBrackets.html" class="twikiLink">Actor Selection Brackets Development Kit Gem</a>.
<div class="codetitlebar">
UDKRTSHUD.uc
</div>
<div class="codesnippet">
<pre>
function Box CalculateScreenBoundingBox(HUD HUD, Actor Actor, PrimitiveComponent PrimitiveComponent)
{
  local Box ComponentsBoundingBox, OutBox;
  local Vector BoundingBoxCoordinates&#91;8];
  local int i;

  if (HUD &#61;&#61; None &#124;&#124; PrimitiveComponent &#61;&#61; None &#124;&#124; Actor &#61;&#61; None &#124;&#124; WorldInfo.TimeSeconds - Actor.LastRenderTime &#62;&#61; 0.1f)
  {
    OutBox.Min.X &#61; -1.f;
    OutBox.Min.Y &#61; -1.f;
    OutBox.Max.X &#61; -1.f;
    OutBox.Max.Y &#61; -1.f;

    return OutBox;
  }

  ComponentsBoundingBox.Min &#61; PrimitiveComponent.Bounds.Origin - PrimitiveComponent.Bounds.BoxExtent;
  ComponentsBoundingBox.Max &#61; PrimitiveComponent.Bounds.Origin + PrimitiveComponent.Bounds.BoxExtent;

  // Z1
  // X1, Y1
  BoundingBoxCoordinates&#91;0].X &#61; ComponentsBoundingBox.Min.X;
  BoundingBoxCoordinates&#91;0].Y &#61; ComponentsBoundingBox.Min.Y;
  BoundingBoxCoordinates&#91;0].Z &#61; ComponentsBoundingBox.Min.Z;
  BoundingBoxCoordinates&#91;0] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;0]);
  // X2, Y1
  BoundingBoxCoordinates&#91;1].X &#61; ComponentsBoundingBox.Max.X;
  BoundingBoxCoordinates&#91;1].Y &#61; ComponentsBoundingBox.Min.Y;
  BoundingBoxCoordinates&#91;1].Z &#61; ComponentsBoundingBox.Min.Z;
  BoundingBoxCoordinates&#91;1] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;1]);
  // X1, Y2
  BoundingBoxCoordinates&#91;2].X &#61; ComponentsBoundingBox.Min.X;
  BoundingBoxCoordinates&#91;2].Y &#61; ComponentsBoundingBox.Max.Y;
  BoundingBoxCoordinates&#91;2].Z &#61; ComponentsBoundingBox.Min.Z;
  BoundingBoxCoordinates&#91;2] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;2]);
  // X2, Y2
  BoundingBoxCoordinates&#91;3].X &#61; ComponentsBoundingBox.Max.X;
  BoundingBoxCoordinates&#91;3].Y &#61; ComponentsBoundingBox.Max.Y;
  BoundingBoxCoordinates&#91;3].Z &#61; ComponentsBoundingBox.Min.Z;
  BoundingBoxCoordinates&#91;3] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;3]);

  // Z2
  // X1, Y1
  BoundingBoxCoordinates&#91;4].X &#61; ComponentsBoundingBox.Min.X;
  BoundingBoxCoordinates&#91;4].Y &#61; ComponentsBoundingBox.Min.Y;
  BoundingBoxCoordinates&#91;4].Z &#61; ComponentsBoundingBox.Max.Z;
  BoundingBoxCoordinates&#91;4] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;4]);
  // X2, Y1
  BoundingBoxCoordinates&#91;5].X &#61; ComponentsBoundingBox.Max.X;
  BoundingBoxCoordinates&#91;5].Y &#61; ComponentsBoundingBox.Min.Y;
  BoundingBoxCoordinates&#91;5].Z &#61; ComponentsBoundingBox.Max.Z;
  BoundingBoxCoordinates&#91;5] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;5]);
  // X1, Y2
  BoundingBoxCoordinates&#91;6].X &#61; ComponentsBoundingBox.Min.X;
  BoundingBoxCoordinates&#91;6].Y &#61; ComponentsBoundingBox.Max.Y;
  BoundingBoxCoordinates&#91;6].Z &#61; ComponentsBoundingBox.Max.Z;
  BoundingBoxCoordinates&#91;6] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;6]);
  // X2, Y2
  BoundingBoxCoordinates&#91;7].X &#61; ComponentsBoundingBox.Max.X;
  BoundingBoxCoordinates&#91;7].Y &#61; ComponentsBoundingBox.Max.Y;
  BoundingBoxCoordinates&#91;7].Z &#61; ComponentsBoundingBox.Max.Z;
  BoundingBoxCoordinates&#91;7] &#61; HUD.Canvas.Project(BoundingBoxCoordinates&#91;7]);

  // Find the left, top, right and bottom coordinates
  OutBox.Min.X &#61; HUD.Canvas.ClipX;
  OutBox.Min.Y &#61; HUD.Canvas.ClipY;
  OutBox.Max.X &#61; 0;
  OutBox.Max.Y &#61; 0;

  // Iterate though the bounding box coordinates
  for (i &#61; 0; i &#60; ArrayCount(BoundingBoxCoordinates); ++i)
  {
    // Detect the smallest X coordinate
    if (OutBox.Min.X &#62; BoundingBoxCoordinates&#91;i].X)
    {
      OutBox.Min.X &#61; BoundingBoxCoordinates&#91;i].X;
    }

    // Detect the smallest Y coordinate
    if (OutBox.Min.Y &#62; BoundingBoxCoordinates&#91;i].Y)
    {
      OutBox.Min.Y &#61; BoundingBoxCoordinates&#91;i].Y;
    }

    // Detect the largest X coordinate
    if (OutBox.Max.X &#60; BoundingBoxCoordinates&#91;i].X)
    {
      OutBox.Max.X &#61; BoundingBoxCoordinates&#91;i].X;
    }

    // Detect the largest Y coordinate
    if (OutBox.Max.Y &#60; BoundingBoxCoordinates&#91;i].Y)
    {
      OutBox.Max.Y &#61; BoundingBoxCoordinates&#91;i].Y;
    }
  }

  // Check if the bounding box is within the screen
  if ((OutBox.Min.X &#60; 0 &#38;&#38; OutBox.Max.X &#60; 0) &#124;&#124; (OutBox.Min.X &#62; HUD.Canvas.ClipX &#38;&#38; OutBox.Max.X &#62; HUD.Canvas.ClipX) &#124;&#124; (OutBox.Min.Y &#60; 0 &#38;&#38; OutBox.Max.Y &#60; 0) &#124;&#124; (OutBox.Min.Y &#62; HUD.Canvas.ClipY &#38;&#38; OutBox.Max.Y &#62; HUD.Canvas.ClipY))
  {
    OutBox.Min.X &#61; -1.f;
    OutBox.Min.Y &#61; -1.f;
    OutBox.Max.X &#61; -1.f;
    OutBox.Max.Y &#61; -1.f;
  }
  else
  {
    // Clamp the bounding box coordinates
    OutBox.Min.X &#61; FClamp(OutBox.Min.X, 0.f, HUD.Canvas.ClipX);
    OutBox.Max.X &#61; FClamp(OutBox.Max.X, 0.f, HUD.Canvas.ClipX);
    OutBox.Min.Y &#61; FClamp(OutBox.Min.Y, 0.f, HUD.Canvas.ClipY);
    OutBox.Max.Y &#61; FClamp(OutBox.Max.Y, 0.f, HUD.Canvas.ClipY);
  }

  return OutBox;
}
</pre>
</div>
<p />
In this code snippet, when a touch event is detected. The code iterates through the unit (pawn) array and the structures array. If the touch location is within the unit's or structure's screen bounding box, then it is selected and its HUD actions are registered.
<p />
<div class="codetitlebar">
UDKRTSMobilePlayerController.uc
</div>
<div class="codesnippet">
<pre>
// Check if we touch any game play relevant objects
if (PlayerReplicationInfo !&#61; None)
{
  UDKRTSTeamInfo &#61; UDKRTSTeamInfo(PlayerReplicationInfo.Team);
  if (UDKRTSTeamInfo !&#61; None)
  {
    UDKRTSMobileHUD &#61; UDKRTSMobileHUD(MyHUD);
    if (UDKRTSMobileHUD !&#61; None)
    {
      // Are we touching a pawn?
      if (TouchEvent.Response &#61;&#61; ETR&#95;None &#38;&#38; UDKRTSTeamInfo.Pawns.Length &#62; 0)
      {
        for (i &#61; 0; i &#60; UDKRTSTeamInfo.Pawns.Length; ++i)
        {
          if (UDKRTSTeamInfo.Pawns&#91;i] !&#61; None &#38;&#38; class&#39;UDKRTSMobileHUD&#39;.static.IsPointWithinBox(TouchLocation, UDKRTSTeamInfo.Pawns&#91;i].ScreenBoundingBox) &#38;&#38; TouchEvents.Find(&#39;AssociatedActor&#39;, UDKRTSTeamInfo.Pawns&#91;i]) &#61;&#61; INDEX&#95;NONE)
          {
            UDKRTSTeamInfo.Pawns&#91;i].Selected();
            UDKRTSTeamInfo.Pawns&#91;i].RegisterHUDActions(UDKRTSMobileHUD);

            TouchEvent.AssociatedActor &#61; UDKRTSTeamInfo.Pawns&#91;i];
            TouchEvent.Response &#61; ETR&#95;Pawn;
            break;
          }
        }
      }

      // Are we touching a structure
      if (TouchEvent.Response &#61;&#61; ETR&#95;None &#38;&#38; UDKRTSTeamInfo.Structures.Length &#62; 0)
      {
        for (i &#61; 0; i &#60; UDKRTSTeamInfo.Structures.Length; ++i)
        {
          if (class&#39;UDKRTSMobileHUD&#39;.static.IsPointWithinBox(TouchLocation, UDKRTSTeamInfo.Structures&#91;i].ScreenBoundingBox) &#38;&#38; TouchEvents.Find(&#39;AssociatedActor&#39;, UDKRTSTeamInfo.Structures&#91;i]) &#61;&#61; INDEX&#95;NONE)
          {
            UDKRTSTeamInfo.Structures&#91;i].Selected();
            UDKRTSTeamInfo.Structures&#91;i].RegisterHUDActions(UDKRTSMobileHUD);

            TouchEvent.AssociatedActor &#61; UDKRTSTeamInfo.Structures&#91;i];
            TouchEvent.Response &#61; ETR&#95;Structure;
            break;
          }
        }
      }
    }
  }
}
</pre>
</div>
<p />
<p />
<h3><a name="How do the buttons appear on the HUD when selecting a structure/unit?"></a> How do the buttons appear on the HUD when selecting a structure/unit? </h3>
In the RTS Starter Kit, buttons are called HUD actions. A HUD action is a struct which is defined in UDKRTSHUD.uc.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/RTSKit_HUDActionsAndHealthBar.jpg" alt="RTSKit_HUDActionsAndHealthBar.jpg" width='800' height='412' />
<p />
In this code snippet, you can see that HUD actions simply define a texture and a set of texture UV coordinates. These variables are exposed to Unreal Editor, to allow the game developer set these values. The other four variables are used in game to perform other functions and will be explained a little later.
<div class="codetitlebar">
UDKRTSHUD.uc
</div>
<div class="codesnippet">
<pre>
// HUD actions on the HUD
struct SHUDAction
{
  var() Texture2D Texture;
  var() float U;
  var() float V;
  var() float UL;
  var() float VL;
  var EHUDActionReference Reference;
  var int Index;
  var bool PostRender;
  var delegate&#60;IsHUDActionActive&#62; IsHUDActionActiveDelegate;
};
</pre>
</div>
<p />
The HUD action struct is then used inside another struct called SAssociatedHUDAction. These associate an array of HUD actions with an actor.
<div class="codetitlebar">
UDKRTSHUD.uc
</div>
<div class="codesnippet">
<pre>
// HUD actions that are associated to an actor on the HUD
struct SAssociatedHUDAction
{
  var Actor AssociatedActor;
  var array&#60;SHUDAction&#62; HUDActions;
};
</pre>
</div>
<p />
When a user selects a structure/unit (by touching the structure/unit in the mobile version), the function RegisterHUDActions() is called on the structure/unit. This function will then register relevant HUD actions to the HUD. In this code snippet, the Portrait variable is a SHUDAction which defines the portrait for the character commonly seen in many RTS games. From here the code then sets the reference variable which tells the rest of the game what to do with this HUD action, an index variable which stores some meta data and the post render boolean (more on that later). Once the HUD action has been set up, it is then registered.
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
simulated function RegisterHUDActions(UDKRTSMobileHUD HUD)
{
  local int i;
  local SHUDAction SendHUDAction;

  if (HUD &#61;&#61; None &#124;&#124; OwnerReplicationInfo &#61;&#61; None &#124;&#124; HUD.AssociatedHUDActions.Find(&#39;AssociatedActor&#39;, Self) !&#61; INDEX&#95;NONE &#124;&#124; Health &#60;&#61; 0)
  {
    return;
  }

  // Register the camera center HUD action
  if (Portrait.Texture !&#61; None)
  {
    SendHUDAction &#61; Portrait;
    SendHUDAction.Reference &#61; EHAR&#95;Center;
    SendHUDAction.Index &#61; -1;
    SendHUDAction.PostRender &#61; true;

    HUD.RegisterHUDAction(Self, SendHUDAction);
  }
}
</pre>
</div>
<p />
This code snippet describes what happens when a HUD action is registered. It searches within the AssociatedHUDActions array to see if it should insert it in, this is done to prevent duplicate HUD actions from being registered. If the checks are passed, then the HUD action is added.
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
function RegisterHUDAction(Actor AssociatedActor, SHUDAction HUDAction)
{
  local SAssociatedHUDAction AssociatedHUDAction;
  local int IndexA, IndexB;

  // Get index A
  IndexA &#61; AssociatedHUDActions.Find(&#39;AssociatedActor&#39;, AssociatedActor);
  if (IndexA !&#61; INDEX&#95;NONE)
  {
    // Get index B
    IndexB &#61; AssociatedHUDActions&#91;IndexA].HUDActions.Find(&#39;Reference&#39;, HUDAction.Reference);
    if (IndexB !&#61; INDEX&#95;NONE &#38;&#38; AssociatedHUDActions&#91;IndexA].HUDActions&#91;IndexB].Index &#61;&#61; HUDAction.Index)
    {
      return;
    }
  }

  if (IndexA !&#61; INDEX&#95;NONE)
  {
    // Add the associated HUD action
    AssociatedHUDActions&#91;IndexA].HUDActions.AddItem(HUDAction);
  }
  else
  {
    // Add the associated HUD action
    AssociatedHUDAction.AssociatedActor &#61; AssociatedActor;
    AssociatedHUDAction.HUDActions.AddItem(HUDAction);
    AssociatedHUDActions.AddItem(AssociatedHUDAction);
  }
}
</pre>
</div>
<p />
This code snippet shows how the HUD renders the HUD actions. It iterates over the AssociatedHUDActions array, and for each item in the AssociatedHUDActions array it creates a new row. For each row, each HUD action is drawn across the screen. This allows multiple actors to register their HUD actions on the screen and have them accessible to the player.
<div class="codetitlebar">
UDKRTSHUD.uc
</div>
<div class="codesnippet">
<pre>
event PostRender()
{
  Super.PostRender();

  if (AssociatedHUDActions.Length &#62; 0)
  {
    Offset.X &#61; PlayableSpaceLeft;
    Offset.Y &#61; 0;
    Size.X &#61; SizeX &#42; 0.0625f;
    Size.Y &#61; Size.X;

    for (i &#61; 0; i &#60; AssociatedHUDActions.Length; ++i)
    {
      if (AssociatedHUDActions&#91;i].AssociatedActor !&#61; None &#38;&#38; AssociatedHUDActions&#91;i].HUDActions.Length &#62; 0)
      {
        Offset.X &#61; HUDProperties.ScrollWidth;

        for (j &#61; 0; j &#60; AssociatedHUDActions&#91;i].HUDActions.Length; ++j)
        {
          if (AssociatedHUDActions&#91;i].HUDActions&#91;j].IsHUDActionActiveDelegate !&#61; None)
          {
            IsHUDActionActive &#61; AssociatedHUDActions&#91;i].HUDActions&#91;j].IsHUDActionActiveDelegate;

            if (!IsHUDActionActive(AssociatedHUDActions&#91;i].HUDActions&#91;j].Reference, AssociatedHUDActions&#91;i].HUDActions&#91;j].Index, false))
            {
              Canvas.SetDrawColor(191, 191, 191, 191);
            }
            else
            {
              Canvas.SetDrawColor(255, 255, 255);
            }

            IsHUDActionActive &#61; None;
          }
          else
          {
            Canvas.SetDrawColor(255, 255, 255);
          }

          Canvas.SetPos(Offset.X, Offset.Y);
          Canvas.DrawTile(AssociatedHUDActions&#91;i].HUDActions&#91;j].Texture, Size.X, Size.Y, AssociatedHUDActions&#91;i].HUDActions&#91;j].U, AssociatedHUDActions&#91;i].HUDActions&#91;j].V, AssociatedHUDActions&#91;i].HUDActions&#91;j].UL, AssociatedHUDActions&#91;i].HUDActions&#91;j].VL);

          if (AssociatedHUDActions&#91;i].HUDActions&#91;j].PostRender)
          {
            UDKRTSHUDActionInterface &#61; UDKRTSHUDActionInterface(AssociatedHUDActions&#91;i].AssociatedActor);
            if (UDKRTSHUDActionInterface !&#61; None)
            {
              UDKRTSHUDActionInterface.PostRenderHUDAction(Self, AssociatedHUDActions&#91;i].HUDActions&#91;j].Reference, AssociatedHUDActions&#91;i].HUDActions&#91;j].Index, Offset.X, Offset.Y, Size.X, Size.Y);
            }
          }

          Offset.X +&#61; Size.X;
        }
      }

      Offset.Y +&#61; Size.Y;
    }
  }
}
</pre>
</div>
<p />
You will notice that in this function, the <a href="UnrealScriptDelegates.html" class="twikiLink">delegate</a> variable IsHUDActionActiveDelegate() is being used here. What this is doing is that HUD actions themselves also store a delegate reference so that the HUD can assign it to its own delegate. This allows the HUD to then execute the delegate without specifically knowing which object owns that function. This was used here to get the HUD to check if the HUD action is active or not; that is whether the HUD action could be performed by the player or not.
<p />
If the PostRender variable is true, then the associated actor is cast to the UDKRTSHUDActionInterface <a href="UnrealScriptInterfaces.html" class="twikiLink">interface</a>. Classes may implement any number of interfaces, and it is useful here since the HUD does not specifically know what kind of Actor the AssociatedActor is. Rather than changing the base Actor class, an interface implementation here helps keep the code specific to this project. From there, the PostRenderHUDAction function is called which allows the associated actor to render onto the HUD.
<p />
This was used specifically for rendering the health bar for structures/units.
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
simulated function PostRenderHUDAction(HUD HUD, EHUDActionReference Reference, int Index, int PosX, int PosY, int SizeX, int SizeY)
{
  local float HealthPercentage;
  local float HealthBarWidth, HealthBarHeight;

  if (HUD &#61;&#61; None &#124;&#124; HUD.Canvas &#61;&#61; None &#124;&#124; Health &#60;&#61; 0)
  {
    return;
  }

  if (Reference &#61;&#61; EHAR&#95;Center)
  {
    // Get the health bar percentage
    HealthPercentage &#61; float(Health) / float(HealthMax);

    // Render the health bar border
    HealthBarWidth &#61; SizeX - 2;
    HealthBarHeight &#61; 8;
    HUD.Canvas.SetPos(PosX + 1, PosY + SizeY - HealthBarHeight - 1);
    HUD.Canvas.SetDrawColor(0, 0, 0, 191);
    HUD.Canvas.DrawBox(HealthBarWidth, HealthBarHeight);

    HealthBarWidth -&#61; 4;
    HealthBarHeight -&#61; 4;

    // Render the missing health
    HUD.Canvas.SetPos(PosX + 3, PosY + SizeY - HealthBarHeight - 3);
    HUD.Canvas.SetDrawColor(0, 0, 0, 127);
    HUD.Canvas.DrawRect(HealthBarWidth, HealthBarHeight);

    // Render the health bar
    HUD.Canvas.SetPos(PosX + 3, PosY + SizeY - HealthBarHeight - 3);
    HUD.Canvas.SetDrawColor(255 &#42; (1.f - HealthPercentage), 255 &#42; HealthPercentage, 0, 191);
    HUD.Canvas.DrawRect(HealthBarWidth &#42; HealthPercentage, HealthBarHeight);
  }
}
</pre>
</div>
<p />
<h3><a name="How do the HUD actions do anything when they are pressed?"></a> How do the HUD actions do anything when they are pressed? </h3>
When a touch input is received by UDKRTSMobilePlayerController, it first passes this to the HUD to check whether the touch location is within any the HUD action's bounds. If it is, then it will first call the HUD action active delegate. This delegate allows any actor to bind to it, to influence whether the HUD action will do anything or not. If the HUD action is allowed to be activated, then it calls StartHUDAction within UDKRTSPlayerController. This is done so that the HUD action is wrapped up in a remote procedure call from the client to the server. The actor that is associated with the HUD action is then cast as a UDKRTSHUDActionInterface. If the cast succeeds, then HandleHUDAction is called to get the actor to do something.
<p />
<div class="codetitlebar">
UDKRTSMobileHUD.uc
</div>
<div class="codesnippet">
<pre>
function ETouchResponse InputTouch(Vector2D ScreenTouchLocation)
{
  // Check the HUD action controls
  if (AssociatedHUDActions.Length &#62; 0)
  {
    Offset.X &#61; PlayableSpaceLeft;
    Offset.Y &#61; 0;
    Size.X &#61; SizeX &#42; 0.0625f;
    Size.Y &#61; Size.X;

    for (i &#61; 0; i &#60; AssociatedHUDActions.Length; ++i)
    {
      if (AssociatedHUDActions&#91;i].AssociatedActor !&#61; None &#38;&#38; AssociatedHUDActions&#91;i].HUDActions.Length &#62; 0)
      {
        Offset.X &#61; HUDProperties.ScrollWidth;

        for (j &#61; 0; j &#60; AssociatedHUDActions&#91;i].HUDActions.Length; ++j)
        {
          if (ScreenTouchLocation.X &#62;&#61; Offset.X &#38;&#38; ScreenTouchLocation.Y &#62;&#61; Offset.Y &#38;&#38; ScreenTouchLocation.X &#60;&#61; Offset.X + Size.X &#38;&#38; ScreenTouchLocation.Y &#60;&#61; Offset.Y + Size.Y)
          {
            if (AssociatedHUDActions&#91;i].HUDActions&#91;j].IsHUDActionActiveDelegate !&#61; None)
            {
              IsHUDActionActive &#61; AssociatedHUDActions&#91;i].HUDActions&#91;j].IsHUDActionActiveDelegate;

              if (!IsHUDActionActive(AssociatedHUDActions&#91;i].HUDActions&#91;j].Reference, AssociatedHUDActions&#91;i].HUDActions&#91;j].Index, true))
              {
                IsHUDActionActive &#61; None;
                return ETR&#95;HUDAction;
              }
              else
              {
                IsHUDActionActive &#61; None;
              }
            }

            // Start the HUD action
            UDKRTSMobilePlayerController.StartHUDAction(AssociatedHUDActions&#91;i].HUDActions&#91;j].Reference, AssociatedHUDActions&#91;i].HUDActions&#91;j].Index, AssociatedHUDActions&#91;i].AssociatedActor);
            return ETR&#95;HUDAction;
          }

          Offset.X +&#61; Size.X;
        }

        Offset.Y +&#61; Size.Y;
      }
    }
  }
}
</pre>
</div>
<p />
<div class="codetitlebar">
UDKRTSPlayerController.uc
</div>
<div class="codesnippet">
<pre>
/&#42;&#42;
 &#42; Send an action command to an actor
 &#42;
 &#42; &#64;param    Reference    HUD action reference
 &#42; &#64;param    Index      HUD action index
 &#42; &#64;param    Actor      Associated actor
 &#42;/
simulated function StartHUDAction(EHUDActionReference Reference, int Index, Actor Actor)
{
  // Sync with the server
  if (Role &#60; Role&#95;Authority &#38;&#38; class&#39;UDKRTSUtility&#39;.static.HUDActionNeedsToSyncWithServer(Reference) &#38;&#38; UDKRTSHUDActionInterface(Actor) !&#61; None)
  {
    ServerHUDAction(Reference, Index, Actor);
  }

  BeginHUDAction(Reference, Index, Actor);
}

/&#42;&#42;
 &#42; Sync the action command for an actor
 &#42;
 &#42; &#64;param    Reference    HUD action reference
 &#42; &#64;param    Index      HUD action index
 &#42; &#64;param    Actor      Associated actor
 &#42;/
reliable server function ServerHUDAction(EHUDActionReference Reference, int Index, Actor Actor)
{
  BeginHUDAction(Reference, Index, Actor);
}

/&#42;&#42;
 &#42; Begin an action command to an actor
 &#42;/
simulated function BeginHUDAction(EHUDActionReference Reference, int Index, Actor Actor)
{
  local UDKRTSHUDActionInterface UDKRTSHUDActionInterface;

  UDKRTSHUDActionInterface &#61; UDKRTSHUDActionInterface(Actor);
  if (UDKRTSHUDActionInterface !&#61; None)
  {
    UDKRTSHUDActionInterface.HandleHUDAction(Reference, Index);
  }
}
</pre>
</div>
<p />
<p />
<h3><a name="How is resources handled?"></a> How is resources handled? </h3>
By default, there are three resources in the starter kit. These are all defined in UDKRTSPlayerReplicationInfo as replication notified integer variables. The replication block defines that these three variables are only to be replicated to the client, if the variables are "dirty" (different between the client and the server) and that the replication is one way (only the server replicates this variable to the client, clients cannot replicated these variables to the server).
<p />
<div class="codetitlebar">
UDKRTSPlayerReplicationInfo.uc
</div>
<div class="codesnippet">
<pre>
// How much resources the player has
var RepNotify int Resources;
// How much power the player has
var RepNotify int Power;
// Players current population cap
var RepNotify int PopulationCap;

// Replication block
replication
{
  if (bNetDirty &#38;&#38; Role &#61;&#61; Role&#95;Authority)
    Resources, Power, PopulationCap;
}
</pre>
</div>
<p />
RepNotify will call the ReplicatedEvent() function, which is defined in Actor.uc, whenever any of those variables change on the client. However, this was not required for the starter kit and was not used. However if you wish to use it, you can use it like this.
<p />
<div class="codetitlebar">
UDKRTSPlayerReplicationInfo.uc
</div>
<div class="codesnippet">
<pre>
/&#42;&#42;
 &#42; Called when a variable with the property flag &#34;RepNotify&#34; is replicated
 &#42;
 &#42; &#64;param  VarName  Name of the variable that was replicated
 &#42;/
simulated event ReplicatedEvent(name VarName)
{
  if (VarName &#61;&#61; &#39;Resources&#39;)
  {
    // Resources variable has changed
  }
  else if (VarName &#61;&#61; &#39;Power&#39;)
  {
    // Power variable has changed
  }
  else if (VarName &#61;&#61; &#39;PopulationCap&#39;)
  {
    // PopulationCap variable has changed
  }
  else
  {
    Super.ReplicatedEvent(VarName);
  }
}
</pre>
</div>
<p />
<h3><a name="How does the game handle the creation of units?"></a> How does the game handle the creation of units? </h3>
For players, this is done through remote procedure calls through the player controller. This is the most direct route of communication from the player to the server.
<p />
The example code below demonstrates how structures form queues of constructing units, which in the end will cause the server to spawn a new unit for the player. This code snippet is found within HandleHUDAction. This function executes on both the server and client simultaneously, since the player controller synchronizes the client and server call to HandleHUDAction (see UDKRTSPlayerController.StartHUDAction(), UDKRTSPlayerController.ServerHUDAction() and UDKRTSPlayerController.BeginHUDAction()). The first thing checked is if the requested unit index is within the array bounds, and if the player is capable of constructing the unit (checks if the player has enough available resources, available population, etc). If those pass, then a sound is played back to inform the player that construction of this unit has started. Resources are then taken away for the construction of this unit. This is done on the client as a simulation to reduce latency response; since the server also executes the code, the server will replicate the correct resources value if they differ to the resources value on the client. From here, a new HUD action is created and added to the player's HUD. This is done because at this stage the player will still have his/her finger over the structure and the structure's HUD actions will still be visible. The purchased unit archetype is then added the unit production queue. If the unit building timer has not started, then start it now.
<p />
<div class="codetitlebar">
UDKRTSStructure.uc
</div>
<div class="codesnippet">
<pre>
if (Index &#62;&#61; 0 &#38;&#38; Index &#60; BuildablePawnArchetypes.Length &#38;&#38; class&#39;UDKRTSPawn&#39;.static.CanBuildPawn(BuildablePawnArchetypes&#91;Index], OwnerReplicationInfo, false))
{
  // Play the building sound
  class&#39;UDKRTSCommanderVoiceOver&#39;.static.PlayBuildingSoundCue(OwnerReplicationInfo);

  // Take resources away
  OwnerReplicationInfo.Resources -&#61; BuildablePawnArchetypes&#91;Index].ResourcesCost;
  OwnerReplicationInfo.Power -&#61; BuildablePawnArchetypes&#91;Index].PowerCost;

  // Update the player controller&#39;s HUD actions
  PlayerController &#61; PlayerController(OwnerReplicationInfo.Owner);
  if (PlayerController !&#61; None)
  {
    UDKRTSMobileHUD &#61; UDKRTSMobileHUD(PlayerController.MyHUD);
    if (UDKRTSMobileHUD !&#61; None)
    {
      SendHUDAction &#61; BuildablePawnArchetypes&#91;Index].BuildHUDAction;
      SendHUDAction.Reference &#61; EHAR&#95;Building;
      SendHUDAction.Index &#61; QueuedUnitArchetypes.Length;
      SendHUDAction.PostRender &#61; true;

      UDKRTSMobileHUD.RegisterHUDAction(Self, SendHUDAction);
    }
  }

  // Add the unit to the queue
  QueuedUnitArchetypes.AddItem(BuildablePawnArchetypes&#91;Index]);

  // Start the building unit timer if it isn&#39;t activated
  if (!IsTimerActive(NameOf(BuildingUnit)))
  {
    SetTimer(BuildablePawnArchetypes&#91;Index].BuildTime, false, NameOf(BuildingUnit));
  }
}
</pre>
</div>
<p />
UDKRTSStructure.BuildingUnit() is called via the timer set up in the function prior. A timer is used to handle the time it takes to "construct" the unit. After checking that BuildingUnit() was called under the correct circumstances, the HUD action list is first updated. Afterwards, the server then requests a pawn. This is where the actual creation of the unit is handled (more on that later). Finally, the first entry in the production queue is removed, and if there are more queued units restart the process by restarting the timer.
<p />
<div class="codetitlebar">
UDKRTSStructure.uc
</div>
<div class="codesnippet">
<pre>
simulated function BuildingUnit()
{
  local Vector SpawnLocation;
  local Rotator R;
  local UDKRTSMobileHUD UDKRTSMobileHUD;
  local PlayerController PlayerController;
  local int i;
  local SHUDAction SendHUDAction;

  // Check if the structure is able to build a unit
  if (!IsConstructed &#124;&#124; QueuedUnitArchetypes.Length &#60;&#61; 0)
  {
    return;
  }

  // Update the HUD action list
  PlayerController &#61; PlayerController(OwnerReplicationInfo.Owner);
  if (PlayerController !&#61; None)
  {
    UDKRTSMobileHUD &#61; UDKRTSMobileHUD(PlayerController.MyHUD);
    if (UDKRTSMobileHUD !&#61; None &#38;&#38; UDKRTSMobileHUD.AssociatedHUDActions.Find(&#39;AssociatedActor&#39;, Self) !&#61; INDEX&#95;NONE)
    {
      UDKRTSMobileHUD.UnregisterHUDActionByReference(Self, EHAR&#95;Building);

      if (QueuedUnitArchetypes.Length &#62; 0)
      {
        for (i &#61; 0; i &#60; QueuedUnitArchetypes.Length; ++i)
   {
     if (QueuedUnitArchetypes&#91;i] !&#61; None)
     {
       SendHUDAction &#61; QueuedUnitArchetypes&#91;i].BuildHUDAction;
       SendHUDAction.Reference &#61; EHAR&#95;Building;
       SendHUDAction.Index &#61; i;
       SendHUDAction.PostRender &#61; true;

       UDKRTSMobileHUD.RegisterHUDAction(Self, SendHUDAction);
     }
   }
      }
    }
  }

  // Get the appropriate spawn location
  if (Role &#61;&#61; Role&#95;Authority)
  {
    if (RallyPointLocation &#61;&#61; Location)
    {
      R.Yaw &#61; Rand(65536);
      SpawnLocation &#61; Location + Vector(R) &#42; (QueuedUnitArchetypes&#91;0].CylinderComponent.CollisionRadius + UnitSpawnRadius);
    }
    else
    {
      SpawnLocation &#61; Location + Normal(RallyPointLocation - Location) &#42; (QueuedUnitArchetypes&#91;0].CylinderComponent.CollisionRadius + UnitSpawnRadius);
    }

    SpawnLocation.Z -&#61; CollisionCylinder.CollisionHeight;
    // Request the pawn
    RequestPawn(QueuedUnitArchetypes&#91;0], SpawnLocation);
  }

  // Remove the unit from the queue
  QueuedUnitArchetypes.Remove(0, 1);

  // If there are still units left in the queue then start the building unit timer again
  if (QueuedUnitArchetypes.Length &#62; 0)
  {
    SetTimer(QueuedUnitArchetypes&#91;0].BuildTime, false, NameOf(BuildingUnit));
  }
}
</pre>
</div>
<p />
UDKRTSStructure.RequestPawn() spawns the actual unit. If the function is run on the client, it will automatically synchronize with the server. In the end, it will call UDKRTSStructure.HandleRequestForPawn(). UDKRTSStructure.HandleRequestForPawn() then finally calls UDKRTSGameInfo.RequestPawn(). UDKRTSGameInfo.RequestPawn() spawns the pawn and initializes it. If the request was asked with a rally point, the pawn will be asked to move to the rally point.
<p />
<div class="codetitlebar">
UDKRTSGameInfo.uc
</div>
<div class="codesnippet">
<pre>
function RequestPawn(UDKRTSPawn RequestedPawnArchetype, UDKRTSPlayerReplicationInfo RequestingReplicationInfo, Vector SpawnLocation, bool InRallyPointValid, Vector RallyPoint, Actor RallyPointActorReference)
{
  local UDKRTSPawn UDKRTSPawn;
  local UDKRTSAIController UDKRTSAIController;
  local UDKRTSResource UDKRTSResource;

  if (RequestedPawnArchetype &#61;&#61; None &#124;&#124; RequestingReplicationInfo &#61;&#61; None)
  {
    return;
  }

  UDKRTSPawn &#61; Spawn(RequestedPawnArchetype.Class,,, SpawnLocation + Vect(0.f, 0.f, 1.f) &#42; RequestedPawnArchetype.CylinderComponent.CollisionHeight,, RequestedPawnArchetype);
  if (UDKRTSPawn !&#61; None)
  {
    if (UDKRTSPawn.bDeleteMe)
    {
      `Warn(Self$&#34;:: RequestPawn:: Deleted newly spawned pawn, refund player his money?&#34;);
    }
    else
    {
      UDKRTSPawn.SetOwnerReplicationInfo(RequestingReplicationInfo);
      UDKRTSPawn.SpawnDefaultController();

      UDKRTSAIController &#61; UDKRTSAIController(UDKRTSPawn.Controller);
      if (UDKRTSAIController !&#61; None)
      {
        if (RallyPointActorReference !&#61; None)
        {
          UDKRTSResource &#61; UDKRTSResource(RallyPointActorReference);
          if (UDKRTSResource !&#61; None &#38;&#38; UDKRTSPawn.HarvestResourceInterval &#62; 0)
          {
            UDKRTSAIController.HarvestResource(UDKRTSResource);
          }
        }
        else if (InRallyPointValid)
        {
          UDKRTSAIController.MoveToPoint(RallyPoint);
        }
      }
    }
  }
}
</pre>
</div>
<p />
So how does the spawned pawn wind up being on the player's team? This is done by setting the pawn's owner replication info. When this is called on the server, the OwnerReplicationInfo is set. OwnerReplicationInfo itself is a replication notified variable, so when it gets replicated to clients, ReplicatedEvent() will call SetOwnerReplicationInfo(). If the pawn's materials were not able to be updated because the owner replication info has not had it's TeamInfo replicated yet, then a loop is set up to poll for the team info. When the owner replication info's TeamInfo variable is replicated, then the looping timer is disabled and the team colors are then set for the pawn. For pawns that are on the server, the weapons are instanced and attached. Finally, the client is sent a message that the pawn now belongs to him or her. And as shown above, pawns that are on the player's team will automatically have the on screen bounding boxes calculated so that you can do what you want with them.
<p />
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
simulated function SetOwnerReplicationInfo(UDKRTSPlayerReplicationInfo NewOwnerReplicationInfo)
{
  local UDKRTSTeamInfo UDKRTSTeamInfo;

  if (NewOwnerReplicationInfo &#61;&#61; None)
  {
    return;
  }

  // Unit is possibly being converted to another team
  if (OwnerReplicationInfo !&#61; None &#38;&#38; OwnerReplicationInfo !&#61; NewOwnerReplicationInfo)
  {
    UDKRTSTeamInfo &#61; UDKRTSTeamInfo(OwnerReplicationInfo.Team);
    if (UDKRTSTeamInfo !&#61; None)
    {
      UDKRTSTeamInfo.RemovePawn(Self);
    }
  }

  // Assign the team
  OwnerReplicationInfo &#61; NewOwnerReplicationInfo;
  if (!UpdateTeamMaterials())
  {
    SetTimer(0.1f, true, NameOf(CheckTeamInfoForOwnerReplicationInfo));
  }

  // Give the pawn its default weapon, if it doesn&#39;t have one right now
  if (Role &#61;&#61; Role&#95;Authority &#38;&#38; WeaponArchetype !&#61; None &#38;&#38; UDKRTSWeapon &#61;&#61; None)
  {
    UDKRTSWeapon &#61; Spawn(WeaponArchetype.Class, Self,, Location, Rotation, WeaponArchetype);
    if (UDKRTSWeapon !&#61; None)
    {
      UDKRTSWeapon.SetOwner(Self);
      UDKRTSWeapon.UDKRTSWeaponOwnerInterface &#61; UDKRTSWeaponOwnerInterface(Self);
      UDKRTSWeapon.Initialize();
      UDKRTSWeapon.AttachToSkeletalMeshComponent(Mesh, LightEnvironment, WeaponSocketName);
    }
  }

  // Send the client a world message that the pawn was trained
  OwnerReplicationInfo.ReceiveWorldMessage(FriendlyName&#64;&#34;trained.&#34;, class&#39;HUD&#39;.default.WhiteColor, Location, Portrait.Texture, Portrait.U, Portrait.V, Portrait.UL, Portrait.VL);
  class&#39;UDKRTSCommanderVoiceOver&#39;.static.PlayUnitReadySoundCue(OwnerReplicationInfo);
}
</pre>
</div>
<p />
<p />
<h3><a name="How does the game handle the creation of structures?"></a> How does the game handle the creation of structures? </h3>
In this starter kit, only pawns are able to create structures. Normally, when a player wants a pawn to do something a "command" mesh is shown. This is visible as a white hollow circle for movement. Thus when the player presses one of the structure icons, it will just change this command mesh into a translucent version of the structure the player wants to build.
<p />
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
simulated function HandleHUDAction(EHUDActionReference Reference, int Index)
{
  // Snip
  // Build commands
  case EHAR&#95;Build:
    if (Index &#62;&#61; 0 &#38;&#38; Index &#60; BuildableStructureArchetypes.Length)
    {
      CommandMesh.SetSkeletalMesh(BuildableStructureArchetypes&#91;Index].PreviewSkeletalMesh);
      CommandMode &#61; ECM&#95;BuildStructure;
    }
    break;

  // Snip
}
</pre>
</div>
<p />
As the player is moving his or her finger on the touch screen, the command mesh's location is updated. Structures need to change color to represent whether the player is able to build there or not. This is done in the UDKRTSPawn.SetCommandMeshTranslation() function which is called per HUD update.
<p />
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
simulated function SetCommandMeshTranslation(Vector NewTranslation, bool NewHide)
{
  // Snip
  case ECM&#95;BuildStructure:
    // Check if any buildings are within radius, if so, turn it red to signify that we cannot build here
    if (CommandIndex &#62;&#61; 0 &#38;&#38; CommandIndex &#60; BuildableStructureArchetypes.Length)
    {
      CanBuildStructure &#61; true;

      ForEach VisibleCollidingActors(class&#39;Actor&#39;, Actor, BuildableStructureArchetypes&#91;CommandIndex].PlacementClearanceRadius, NewTranslation, true,, true)
      {
        CanBuildStructure &#61; false;
        break;
      }

      Material &#61; (CanBuildStructure) ? BuildableStructureArchetypes&#91;CommandIndex].CanBuildMaterial : BuildableStructureArchetypes&#91;CommandIndex].CantBuildMaterial;
    }
    break;
  // Snip
}
</pre>
</div>
<p />
As the mobile version of this Starter Kit uses the HUD class for controlling actions, it is here where the code executes when the player releases his or her finger off touch screen to perform the desired action; in this case building the structure. The Starter Kit handles this by requesting the structure from UDKRTSMobilePlayerController and then moving the pawn to make it look like the pawn is moving there to construct the structure. UDKRTSMobilePlayerController is set up to automatically sync with the server if required, and will call UDKRTSGameInfo.RequestStructure() in the end.
<p />
<div class="codetitlebar">
UDKRTSMobileHUD.uc
</div>
<div class="codesnippet">
<pre>
event PostRender()
{
  // Snip
          case ECM&#95;BuildStructure:
            if (PlayerUDKRTSTeamInfo.Pawns&#91;i] !&#61; None)
            {
              PlayerUDKRTSTeamInfo.Pawns&#91;i].HasPendingCommand &#61; false;
              // Playback the pawn confirmation effects and sounds
              PlayerUDKRTSTeamInfo.Pawns&#91;i].ConfirmCommand();
              // Deproject the pending screen command location
              Canvas.Deproject(PlayerUDKRTSTeamInfo.Pawns&#91;i].PendingScreenCommandLocation, CurrentWorldLocation, CurrentWorldDirection);
              // Find the world location for the pending move location
              ForEach TraceActors(class&#39;UDKRTSCameraBlockingVolume&#39;, UDKRTSCameraBlockingVolume, HitCurrentWorldLocation, HitNormal, CurrentWorldLocation + CurrentWorldDirection &#42; 65536.f, CurrentWorldLocation)
              {
                // Request the structure
                UDKRTSMobilePlayerController.RequestStructure(PlayerUDKRTSTeamInfo.Pawns&#91;i].BuildableStructureArchetypes&#91;PlayerUDKRTSTeamInfo.Pawns&#91;i].CommandIndex], HitCurrentWorldLocation);
                // Move the pawn there
                UDKRTSMobilePlayerController.GiveMoveOrder(HitCurrentWorldLocation + Normal(PlayerUDKRTSTeamInfo.Pawns&#91;i].Location - HitCurrentWorldLocation) &#42; PlayerUDKRTSTeamInfo.Pawns&#91;i].BuildableStructureArchetypes&#91;PlayerUDKRTSTeamInfo.Pawns&#91;i].CommandIndex].CollisionCylinder.CollisionRadius &#42; 1.5f, PlayerUDKRTSTeamInfo.Pawns&#91;i]);
                break;
              }
            }
            break;
  // Snip
}
</pre>
</div>
<p />
UDKRTSGameInfo.RequestStructure() first checks that the structure can be placed there. This is done again on the server, as it was only done on the client side as an early out. However, as it is always a bad idea to make clients authoritive, it is done here again to prevent cheating. The structure is then spawned, and its owner replication info set to whoever built the structure.
<p />
<div class="codetitlebar">
UDKRTSGameInfo.uc
</div>
<div class="codesnippet">
<pre>
function UDKRTSStructure RequestStructure(UDKRTSStructure RequstedStructureArchetype, UDKRTSPlayerReplicationInfo RequestingReplicationInfo, Vector SpawnLocation)
{
  local UDKRTSStructure UDKRTSStructure;
  local Actor Actor;
  local UDKRTSMobilePlayerController UDKRTSMobilePlayerController;

  // Check object variables
  if (RequstedStructureArchetype &#61;&#61; None &#124;&#124; RequestingReplicationInfo &#61;&#61; None)
  {
    return None;
  }

  // Check that there are no nearby actors blocking construction
  ForEach VisibleCollidingActors(class&#39;Actor&#39;, Actor, RequstedStructureArchetype.PlacementClearanceRadius, SpawnLocation, true,, true)
  {
    class&#39;UDKRTSCommanderVoiceOver&#39;.static.PlayCannotDeployHereSoundCue(RequestingReplicationInfo);

    UDKRTSMobilePlayerController &#61; UDKRTSMobilePlayerController(RequestingReplicationInfo.Owner);
    if (UDKRTSMobilePlayerController !&#61; None)
    {
      UDKRTSMobilePlayerController.ReceiveMessage(&#34;Cannot deploy here.&#34;);
    }
    return None;
  }

  // Check that the player is able to build this structure
  if (!class&#39;UDKRTSStructure&#39;.static.CanBuildStructure(RequstedStructureArchetype, RequestingReplicationInfo, true))
  {
    return None;
  }

  // Spawn the structure
  UDKRTSStructure &#61; Spawn(RequstedStructureArchetype.Class,,, SpawnLocation + Vect(0.f, 0.f, 1.f) &#42; RequstedStructureArchetype.CollisionCylinder.CollisionHeight,, RequstedStructureArchetype, true);
  if (UDKRTSStructure !&#61; None)
  {
    RequestingReplicationInfo.Resources -&#61; RequstedStructureArchetype.ResourcesCost;
    RequestingReplicationInfo.Power -&#61; RequstedStructureArchetype.PowerCost;

    UDKRTSStructure.SetOwnerReplicationInfo(RequestingReplicationInfo);
  }

  return UDKRTSStructure;
}
</pre>
</div>
<p />
When the structure is spawned by the server, it is then replicated to the client. Structures by default start as invisible actors that are not visible to the player. When an owning player unit is within range of the structure, it then begins to build itself. This is to emulate the situation where a unit goes to where it wants to construct the building. To start the construction process, a timer called CompleteConstruction() is started.
<p />
<div class="codetitlebar">
UDKRTSStructure.uc
</div>
<div class="codesnippet">
<pre>
simulated function Tick(float DeltaTime)
{
  // Snip
    // Check if the building is waiting for a pawn to start construction
    else if (WaitingForPawnToStartConstruction)
    {
      // Scan for near by pawns
      ForEach VisibleCollidingActors(class&#39;UDKRTSPawn&#39;, UDKRTSPawn, CollisionCylinder.CollisionRadius &#42; 1.5f, Location, true,, true)
      {
        // Check that the pawn is on our team
        if (UDKRTSPawn !&#61; None &#38;&#38; OwnerReplicationInfo !&#61; None &#38;&#38; UDKRTSPawn.OwnerReplicationInfo !&#61; None &#38;&#38; UDKRTSPawn.OwnerReplicationInfo.Team &#61;&#61; OwnerReplicationInfo.Team)
        {
          // Start building the structure
          CreateNavMeshObstacle();
          SetHidden(false);
          WaitingForPawnToStartConstruction &#61; false;
          SetDrawScale3D(Vect(1.f, 1.f, 0.01f));
          SetTimer(ConstructionTime, false, NameOf(CompleteConstruction));
          break;
        }
      }
    }
  // Snip
}
</pre>
</div>
<p />
<p />
<h3><a name="How does the AI work?"></a> How does the AI work? </h3>
The AI is an AIController which has a looping timer set up. It also has notification functions which pawns and structures can call to make the AI do something when something else happens. For example, if a structure is damaged, the structure will tell the AI that it was damaged, and this allows the AI to "react" to that situation as best that it can.
<p />
<div class="codetitlebar">
UDKRTSStructure.uc
</div>
<div class="codesnippet">
<pre>
event TakeDamage(int DamageAmount, Controller EventInstigator, vector HitLocation, vector Momentum, class&#60;DamageType&#62; DamageType, optional TraceHitInfo HitInfo, optional Actor DamageCauser)
{
  // Snip
      // If the owner is an AI, then notify the AI that its base is under attack
      UDKRTSTeamAIController &#61; UDKRTSTeamAIController(OwnerReplicationInfo.Owner);
      if (UDKRTSTeamAIController !&#61; None)
      {
        UDKRTSTeamAIController.NotifyStructureDamage(EventInstigator, Self);
      }
 // Snip
}
</pre>
</div>
<p />
When the notification gets sent to the owning TeamAIController, the TeamAIController will attempt to defend the structure if it has any nearby units to do so.
<p />
<div class="codetitlebar">
UDKRTSTeamAIController.uc
</div>
<div class="codesnippet">
<pre>
function NotifyStructureDamage(Controller EventInstigator, UDKRTSStructure Structure)
{
  local int i;
  local float Distance;
  local UDKRTSAIController UDKRTSAIController;
  local UDKRTSTargetInterface PotentialTarget;

  // Check parameters
  if (CachedUDKRTSTeamInfo &#61;&#61; None &#124;&#124; EventInstigator &#61;&#61; None &#124;&#124; EventInstigator.Pawn &#61;&#61; None)
  {
    return;
  }

  if (CachedUDKRTSTeamInfo.Pawns.Length &#62; 0)
  {
    // Find the potential target
    PotentialTarget &#61; UDKRTSTargetInterface(EventInstigator.Pawn);
    if (PotentialTarget !&#61; None)
    {
      for (i &#61; 0; i &#60; CachedUDKRTSTeamInfo.Pawns.Length; ++i)
      {
        // For all healthy pawns under my control within a range of 1024 uu&#39;s away, engage the attacker!
        if (CachedUDKRTSTeamInfo.Pawns&#91;i] !&#61; None &#38;&#38; CachedUDKRTSTeamInfo.Pawns&#91;i].Health &#62; 0)
        {
          Distance &#61; VSize(CachedUDKRTSTeamInfo.Pawns&#91;i].Location - Structure.Location);
          if (Distance &#60;&#61; 1024.f)
          {
            UDKRTSAIController &#61; UDKRTSAIController(CachedUDKRTSTeamInfo.Pawns&#91;i].Controller);
            if (UDKRTSAIController !&#61; None &#38;&#38; UDKRTSAIController.EnemyTargetInterface &#61;&#61; None)
            {
              UDKRTSAIController.EngageTarget(EventInstigator.Pawn);
            }
          }
        }
      }
    }
  }
}
</pre>
</div>
<p />
Otherwise the looping timer simply allows the AI to reassess its current state and will control whether to build more pawns and or structures, whether it should attack the player and so on. The RTS Starter Kit also uses an archetype object which contains some variables that the game designer can tweak in order to get the AI to do something. This archetype object contains information such as the build order for structures so that the AI can evaluate whether it should build the next structure in the order; or replace one that it has lost, or whether it should build more harvesters, or a larger military. This can be useful for creating different kinds of AI which prioritize different things in order to keep the player on his or her toes.
<p />
<p />
<h3><a name="How does the upgrade system work?"></a> How does the upgrade system work? </h3>
The upgrade system works by simply having a replicated actor that exists on the server and the client. The base upgrade class, UDKRTSUpgrade, simply stores the boosts the upgrade gives rather than anything in particular. When things such as weapon firing, pawns or structures taking damage or movement speed are calculated, the server checks for existing upgrade actors and applies their effects. For example, take a look at what happens if the player has researched an armor upgrade and one of his or her pawns takes a hit.
<p />
<div class="codetitlebar">
UDKRTSPawn.uc
</div>
<div class="codesnippet">
<pre>
function AdjustDamage(out int InDamage, out vector Momentum, Controller InstigatedBy, vector HitLocation, class&#60;DamageType&#62; DamageType, TraceHitInfo HitInfo, Actor DamageCauser)
{
  local UDKRTSTeamInfo UDKRTSTeamInfo;
  local int i;

  Super.AdjustDamage(InDamage, Momentum, InstigatedBy, HitLocation, DamageType, HitInfo, DamageCauser);

  // Check if the unit has any defensive bonuses
  if (DefensiveBonus &#62; 0.f)
  {
    InDamage &#61; FClamp(1.f - DefensiveBonus, 0.f, 1.f) &#42; InDamage;
  }

  // Check if the owning team has any unit armor bonuses
  if (OwnerReplicationInfo !&#61; None)
  {
    UDKRTSTeamInfo &#61; UDKRTSTeamInfo(OwnerReplicationInfo.Team);
    if (UDKRTSTeamInfo !&#61; None)
    {
      for (i &#61; 0; i &#60; UDKRTSTeamInfo.Upgrades.Length; ++i)
      {
        if (UDKRTSTeamInfo.Upgrades&#91;i] !&#61; None &#38;&#38; UDKRTSTeamInfo.Upgrades&#91;i].UnitArmourBoost &#62; 0.f)
        {
          InDamage &#61; InDamage &#42; (1.f - UDKRTSTeamInfo.Upgrades&#91;i].UnitArmourBoost);
        }
      }
    }
  }
}
</pre>
</div>
<p />
As you can see, the upgrade is applied by modifying the damage taken. Of course, this can be made more complex by being more object orientated to allow for some interesting upgrades, but a more simple method was decided upon for this RTS Starter Kit.
<p />
<p />
<h3><a name="How does the weapon system work?"></a> How does the weapon system work? </h3>
Weapons are a simplified actor which contain fire modes. Weapon was not used as a base class here as a lot of the functionality within Weapon was not required at all.
<p />
Weapons themselves do not control how they fire, but rather they act as a gate way to control when it should be fired and if it can be fired. A WeaponFireMode object is created in Unreal Editor which itself controls how something fires. This allows designers to customize new weapons by modifying existing archetypes and parameters within the WeaponFireMode, and it also provides flexibility to extend the system for programmers by allow programmers to simply subclassing WeaponFireMode. In this starter kit, two WeaponFireMode's are present, UDKRTSInstantHitWeaponFire which uses a trace to perform damage on an actor and UDKRTSProjectileWeaponFire which spawns a projectile which then performs damage on an actor on collision.
<p />
<p />
<h3><a name="How does the commander voice over system work?"></a> How does the commander voice over system work? </h3>
The commander voice over system is a static object called UDKRTSCommanderVoiceOver. It links to an archetype stored in the content package, this is so the game designer can alter the archetype dynamically and have changes applied at run time. When the starter kit wants to play back a commander voice, it will call one of the Play*SoundSlot*SoundCue functions. This in turn will call PlaySoundCue within UDKRTSCommanderVoiceOver. The PlaySoundCue function checks if the sound should be played back, and finally called PlaySound on the controller that owns the PlayerReplicationInfo. The booleans ensure that the sound is not replicated to other clients.
<p />
<div class="codetitlebar">
UDKRTSCommanderVoiceOver.uc
</div>
<div class="codesnippet">
<pre>
/&#42;&#42;
 &#42; Plays the building sound
 &#42;
 &#42; &#64;param      PlayerReplicationInfo      Who to play the sound for
 &#42;/
final static function PlayBuildingSoundCue(PlayerReplicationInfo PlayerReplicationInfo)
{
  PlaySoundCue(PlayerReplicationInfo, default.CommanderVoiceOverArchetype.Building);
}

/&#42;&#42;
 &#42; Plays the sound cue
 &#42;
 &#42; &#64;param      PlayerReplicationInfo      Who to play the sound for
 &#42; &#64;param      SoundCue               Sound cue to play
 &#42;/
final static function PlaySoundCue(PlayerReplicationInfo PlayerReplicationInfo, SoundCue SoundCue)
{
  local AIController AIController;
  local WorldInfo WorldInfo;

  // Check if we&#39;re on the dedicated server
  WorldInfo &#61; class&#39;WorldInfo&#39;.static.GetWorldInfo();
  if (WorldInfo !&#61; None &#38;&#38; WorldInfo.NetMode &#61;&#61; NM&#95;DedicatedServer)
  {
    return;
  }

  // Check object references
  if (PlayerReplicationInfo &#61;&#61; None &#124;&#124; SoundCue &#61;&#61; None &#124;&#124; PlayerReplicationInfo.Owner &#61;&#61; None)
  {
    return;
  }

  // If the player replication info belongs to an AI controller, then abort
  AIController &#61; AIController(PlayerReplicationInfo.Owner);
  if (AIController !&#61; None)
  {
    return;
  }

  PlayerReplicationInfo.Owner.PlaySound(SoundCue, true, true, true,, true);
}
</pre>
</div>
<p />
Adding new sounds is as simple as adding a new field within UDKRTSCommanderVoiceOver and creating a new static function. You can of course use an indexed based system if you wish to "reduce" the number of functions within the class, but full function names were done for clarity within code.
<p />
The sound can then be played back by calling the static function anywhere you like, as long as you have a PlayerReplicationInfo reference.
<p />
<div class="codetitlebar">
UDKRTSStructure.uc
</div>
<div class="codesnippet">
<pre>
// Play the building sound
class&#39;UDKRTSCommanderVoiceOver&#39;.static.PlayBuildingSoundCue(OwnerReplicationInfo);
</pre>
</div>
<p />
<h3><a name="How is music played back?"></a> How is music played back? </h3>
As this starter kit was focused on the iOS devices such as the iPad2, the music is played back using <a href="MobileAudioSystem.html#PlayingMusic" class="twikiAnchorLink">MP3</a>. The PlayMusicTrack Kismet node is used in the starter kit example map to start the music. The music can still be heard on the PC platform as the music is also stored as a <a href="AudioHome.html" class="twikiLink">SoundCue</a>.
<p />
<p />
<h2><a name="How to create a game using this starter kit?"></a> How to create a game using this starter kit? </h2>
<hr size="1" noshade="noshade">
As this starter kit comes with a game built in already, you can start creating new structures, units and weapons straight away. To create new game play logic will require modifications to the starter kit however. Structures, units and weapons are mostly data driven, and thus use <a href="UsingArchetypes.html" class="twikiLink">archetypes</a> to define a lot of their <a href="ArchetypesTechnicalGuide.html" class="twikiLink">properties</a>.
<p />
<h3><a name="How to create a new structure"></a> How to create a new structure </h3>
Start by going to the Actor Classes tab within the Content Browser. Search for UDKRTSStructure within the actor classes tree. Right click and click on Create New Archetype.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateStructure_CreateArchetype_01.png" alt="UDKRTS_CreateStructure_CreateArchetype_01.png" width='387' height='315' />
<p />
Find your new structure archetype within the Content Browser, and then double click on it to open up its properties.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateStructure_FindArchetypeInContentBrowser_02.png" alt="UDKRTS_CreateStructure_FindArchetypeInContentBrowser_02.png" width='800' height='635' />
<p />
From here, explore the variables that are open to you as a game designer. The majority of the variables have been commented, so hover over the names of them if you are unsure what they do. For examples, take a look at the other structure archetypes in UDKRTSGameContent.Archetypes package.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateStructure_StructureArchetypeProperties_03.png" alt="UDKRTS_CreateStructure_StructureArchetypeProperties_03.png" width='390' height='530' />
<p />
After you have finished experimenting with the various structure properties, you need to instance the structure in the map, add the structure archetype into the buildable structures array within a unit archetype (so that the unit can construct the building) and or add it to the build order for the AI.
<p />
To instance it within your map, simply select the structure archetype in the Content Browser, right click in the world viewport and click on Add Archetype: <em>&lt;Your archetype name&gt;</em>. Remember to modify the Starting Team Index variable within the instance structure to set who owns this structure when the map starts.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateStructure_InstanceArchetype_04.png" alt="UDKRTS_CreateStructure_InstanceArchetype_04.png" width='660' height='394' />
<p />
To add it into the buildable structures array in your unit archetype, find your unit archetype within the Content Browser. Double click on it to bring up the archetype properties window. Expand the Ability category, and add a new entry into the Buildable Structure Archetypes array by pressing on the Green Plus symbol. Select your structure archetype in the Content Browser and then click on the Green Arrow symbol within the Buildable Structure Archetypes array to assign it. Your new structure will now appear in the unit's HUD actions when selected.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateStructure_AddAsBuildableArchetype_05.png" alt="UDKRTS_CreateStructure_AddAsBuildableArchetype_05.png" width='390' height='530' />
<p />
If you would like the AI to be able to build your new structure, you will need to add it to the structure build order array that is stored within the AIProperties archetype found within UDKRTSGameContent.Archetypes package.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateStructure_AddInAIBuildOrder_06.png" alt="UDKRTS_CreateStructure_AddInAIBuildOrder_06.png" width='450' height='511' />
<p />
<p />
<h3><a name="How to create a new unit (Pawn)"></a> How to create a new unit (Pawn) </h3>
Start by going to the Actor Classes tab within the Content Browser. Search for UDKRTSPawn within the actor classes tree. Right click and click on Create New Archetype.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateUnit_CreateArchetype_01.png" alt="UDKRTS_CreateUnit_CreateArchetype_01.png" width='480' height='458' />
<p />
Find your new pawn archetype within the Content Browser, and then double click on it to open up its properties.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateUnit_FindArchetypeInContentBrowser_02.png" alt="UDKRTS_CreateUnit_FindArchetypeInContentBrowser_02.png" width='806' height='619' />
<p />
From here, explore the variables that are open to you as a game designer. The majority of the variables have been commented, so hover over the names of them if you are unsure what they do. For examples, take a look at the other pawn archetypes in the UDKRTSGameContent.Archetypes package.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateUnit_UnitArchetypeProperties_03.png" alt="UDKRTS_CreateUnit_UnitArchetypeProperties_03.png" width='390' height='530' />
<p />
To add a weapon to your unit, find an existing weapon archetype or create a new weapon archetype. Select it within the Content Browser. Set it in the Weapon Archetype field.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateUnit_SetWeapon_04.png" alt="UDKRTS_CreateUnit_SetWeapon_04.png" width='390' height='530' />
<p />
There are no hints as to what units AI should build, but the AI does search all of its currently built structures to find a unit type that matches its current needs. Set up various properties to make it more likely to build them such as whether the unit can harvest from resource points or has a high military ranking. It is a good idea to add your unit archetype to a structure's buildable pawns array; otherwise the player or AI will not have access to build the unit!
<p />
To do this, find an appropriate structure archetype. Expand the Structure category, and add a new entry into the Buildable Pawn Archetypes array by pressing on the Green Plus symbol. Select your pawn archetype in the Content Browser and then click on the Green Arrow symbol within the Buildable Pawn Archetypes array to assign it. Your new unit will now appear in the structure's HUD actions when selected.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateUnit_AddAsBuildableArchetype_05.png" alt="UDKRTS_CreateUnit_AddAsBuildableArchetype_05.png" width='479' height='530' />
<p />
<p />
<h3><a name="How to create a new weapon"></a> How to create a new weapon </h3>
Start by going to the Actor Classes tab within the Content Browser. Search for UDKRTSWeapon within the actor classes tree. Right click and click on Create New Archetype.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateWeapon_CreateArchetype_01.png" alt="UDKRTS_CreateWeapon_CreateArchetype_01.png" width='456' height='522' />
<p />
Find your new weapon archetype within the Content Browser, and then double click on it to open up its properties.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateWeapon_FindArchetypeInContentBrowser_02.png" alt="UDKRTS_CreateWeapon_FindArchetypeInContentBrowser_02.png" width='800' height='580' />
<p />
Create a new fire mode by expanding the Weapon category, and then pressing the Blue Arrow to open up a context menu. Create a UDKRTSInstantHitWeaponFire if you wish to have a hit scan based weapon or create an UDKRTSProjectileWeaponFire if you wish to have a projectile based weapon (You will need to create a UDKRTSProjectile archetype or find a UDKRTSProjectile to use this fire mode).
<p />
<img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_CreateWeapon_CreateWeaponFireMode_03.png" alt="UDKRTS_CreateWeapon_CreateWeaponFireMode_03.png" width='690' height='530' />
<p />
From here, explore the variables that are open to you as a game designer. The majority of the variables have been commented, so hover over the names of them if you are unsure what they do. For examples, take a look at the other pawn archetypes in the UDKRTSGameContent.Archetypes package.
<p />
If the weapon has been set to an unit, the unit will automatically spawn with the weapon attached and ready to go.
<p />
<p />
<h2><a name="How to use this starter kit?"></a> How to use this starter kit? </h2>
<hr size="1" noshade="noshade">
<p /> <ol>
<li> <a href="http://www.udk.com/download">Download</a> UDK.
</li> <li> Install UDK.
</li> <li> Download the zip file(s).
</li> <li> Unzip the contents into your UDK base directory. (<em>e.g</em> C:\Projects\UDK-2011-11\) Windows may inform you that you may be overwriting existing files or folders. Click Ok on all of them. <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_Unzipping_01.png" alt="UDKRTS_Install_Unzipping_01.png" width='490' height='302' /> <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_OverrideAllConflicts_02.png" alt="UDKRTS_Install_OverrideAllConflicts_02.png" width='610' height='419' /> <br/>
</li> <li> Open up <strong>DefaultEngine.ini</strong> inside the <strong>UDKGame\Config</strong> directory with Notepad. (<em>e.g</em> C:\Projects\UDK-2011-10\UDKGame\Config\DefaultEngine.ini) <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_FindDefaultEngine_03.png" alt="UDKRTS_Install_FindDefaultEngine_03.png" width='800' height='603' /> <br/>
</li> <li> Search for <strong>EditPackages</strong>. <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_FindEditPackages_04.png" alt="UDKRTS_Install_FindEditPackages_04.png" width='800' height='432' /> <br/>
</li> <li> Add <strong>+EditPackages=UDKRTSGame</strong> <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_AddEditPackage_05.png" alt="UDKRTS_Install_AddEditPackage_05.png" width='800' height='432' /> <br/>
</li> <li> Launch the <strong>Unreal Frontend Application</strong> inside the <strong>Binaries</strong> directory. (<em>e.g</em> C:\Projects\UDK-2011-11\Binaries\UnrealFrontend.exe) <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_FindUnrealFrontEnd_06.png" alt="UDKRTS_Install_FindUnrealFrontEnd_06.png" width='800' height='603' /> <br/>
</li> <li> Click on <strong>Script</strong>, then <strong>Full Recompile</strong>. <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_CompileScripts_07.png" alt="UDKRTS_Install_CompileScripts_07.png" width='800' height='566' /> <br/>
</li> <li> You should see the UDKRTSGame package get compiled last. <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_ScriptsCompiled_08.png" alt="UDKRTS_Install_ScriptsCompiled_08.png" width='800' height='568' />
</li> <li> Click on <strong>UnrealEd</strong> to open up Unreal Editor. <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_RunUnrealEd_09.png" alt="UDKRTS_Install_RunUnrealEd_09.png" width='800' height='568' />
</li> <li> Click on the <strong>Open</strong> button, and open up <strong>RTSExampleMap.udk</strong>. <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_OpenMap_10.png" alt="UDKRTS_Install_OpenMap_10.png" width='713' height='510' /> <br/>
</li> <li> Ensure that you're in top down camera mode and then click on the <strong>Play In Editor</strong> button to play the RTS Starter Kit. (Remember to enable mobile emulation, keys zero to nine are used to perform HUD actions)<br/>
</li> <li> You can also export out to your iDevice and play the RTS Starter Kit on it as well. (Remember that you need to set up your <a href="AppleiOSProvisioning.html" class="twikiLink">development provision</a>). <br/>     <img src="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTS_Install_Run_11.png" alt="UDKRTS_Install_Run_11.png" width='800' height='396' />
</li></ol>
<p />
With the starter RTS kit setup, you can now start modifying it towards the game you want to create. The Unrealscript code is located within <b>Development\Src\UDKRTSGame\Classes\*.uc</b>, and all of the content is contained within <strong>UDKGame\Content\UDKRTS\Content\UDKRTSGameContent.upk</strong>.
<p />
<h2><a name="Downloads"></a> Downloads </h2>
<hr size="1" noshade="noshade">
<p /> <ul>
<li> <a href="http://download.udk.com/UDKRTSStarterKit-2012-01-19.zip">Download</a> the code and content for this starter kit.
</li> <li> <a href="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTSPatch_1.zip" target="_top">Download</a> Unrealscript patch for UDK-2012-01 <ul>
<li> Patch which replaces UDKRTSMobilePlayerController.uc which fixes the change to the enum EZoneTouchEvent to ETouchType.
</li></ul>
</li> <li> <a href="rsrc/Three/DevelopmentKitGemsRTSStarterKit/UDKRTSPatch_2.zip" target="_top">Download</a> Unrealscript patch for UDK-2012-05 <ul>
<li> Patch which replaces UDKRTSMobilePlayerController.uc which fixes a bug where only the initial touch simulation is handled.
</li></ul>
</li></ul>
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
