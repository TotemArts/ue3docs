<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | UnrealScriptGameFlow    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">UnrealScriptGameFlow  </b></div>
<div id="tooltext">
<a href="UnrealScriptGameFlowJP.html" class="twikiLink">日本語訳</a><br><a href="UnrealScriptGameFlowCH.html" class="twikiLink">中国翻译</a><br><a href="UnrealScriptGameFlowKR.html" class="twikiLink">한국어</a><br>

<!-- Three/UnrealScriptGameFlow -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="UnrealScriptHome.html" class="twikiLink">UnrealScript</a></b> &gt; UnrealScript Game Flow <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="GameplayProgrammingHome.html" class="twikiLink">Gameplay Programming</a></b> &gt; UnrealScript Game Flow
</div>
<hr size="1" noshade="noshade">
<h1><a name="UnrealScript Game Flow"></a> UnrealScript Game Flow </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="UnrealScriptGameFlow.html#UnrealScript Game Flow"> UnrealScript Game Flow</a> <ul>
<li> <a href="UnrealScriptGameFlow.html#Overview"> Overview</a>
</li> <li> <a href="UnrealScriptGameFlow.html#Startup Movies"> Startup Movies</a>
</li> <li> <a href="UnrealScriptGameFlow.html#Map Load"> Map Load</a> <ul>
<li> <a href="UnrealScriptGameFlow.html#Entry Map"> Entry Map</a> <ul>
<li> <a href="UnrealScriptGameFlow.html#Main Menu"> Main Menu</a>
</li></ul>
</li> <li> <a href="UnrealScriptGameFlow.html#Loading screen"> Loading screen</a>
</li></ul>
</li> <li> <a href="UnrealScriptGameFlow.html#Game Startup"> Game Startup</a>
</li> <li> <a href="UnrealScriptGameFlow.html#Game Init"> Game Init</a> <ul>
<li> <a href="UnrealScriptGameFlow.html#PreBeginPlay"> PreBeginPlay</a>
</li> <li> <a href="UnrealScriptGameFlow.html#PostBeginPlay"> PostBeginPlay</a>
</li> <li> <a href="UnrealScriptGameFlow.html#Player Creation"> Player Creation</a>
</li> <li> <a href="UnrealScriptGameFlow.html#Match Start"> Match Start</a>
</li></ul>
</li> <li> <a href="UnrealScriptGameFlow.html#End Game"> End Game</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The flow of a game in Unreal Engine 3 may be unfamiliar to programmers coming from other disciplines or simply not familiar with how Unreal Engine 3 works. The goal of this document is to outline the flow within the game and point out the important functions that are used to facilitate that flow, and which are useful for customizing the game to fit your needs.
<p />
The general flow of events is:
<p />
<pre>
+ The engine is initialized
&#124;--+ The engine loads a map
   &#124;--- The gametype is set
   &#124;--+ Gameplay is initialized
   &#124;  &#124;--- GameInfo:InitGame() is called to initialize the gametype
   &#124;  &#124;--- Actor::PreBeginPlay() is called to initialize all Actors
   &#124;  &#124;--- Actor::PostBeginPlay() is called to initialize all Actors
   &#124;--+ A Player joins
      &#124;--- GameInfo::Login() is called on the gametype to handle spawning the player
      &#124;--- GameInfo::PostLogin() is called on the gametype to handle the new player
</pre>
<p />
<img src="rsrc/Three/UnrealScriptGameFlow/gameflow.jpg" alt="gameflow.jpg" width="700" height="650" />
<p />
<h2><a name="Startup Movies"></a> Startup Movies </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
When the engine starts up, it displays a series of startup movies. These generally include the "Powered by Unreal" movie, the "Epic Games" movie, etc., and additional movies can be added as well. The startup movies are fullscreen videos (.bik) specified by the <code>StartupMovies</code> array specified in the <code>FullScreenMovie]</code> section of the <code>DefaultEngine.ini</code> file.
<p />
<div class="codesnippet">
<pre>
&#91;FullScreenMovie]
+StartupMovies&#61;UDKFrontEnd.udk&#95;loading
</pre>
</div>
<p />
<h2><a name="Map Load"></a> Map Load </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
All gameplay and interaction in Unreal Engine 3 takes place within a map. When the engine starts up, it always loads a map. The process of loading a map kicks off a series of events that not only opens a new map, but also loads and initializes a new gametype and then starts the match.
<p />
<h3><a name="Entry Map"></a> Entry Map </h3>
<p />
The map that loads up when the game starts can be specified on the command line or, if no map is specified, a default map is loaded. In general, no map will be specified, allowing the default map, or entry map, to load.
<p />
The default map is specified in the <code>DefaultEngine.ini</code> file in the <code>[URL]</code> section.
<p />
<div class="codesnippet">
<pre>
&#91;URL]
Map&#61;UDKFrontEndMap.udk
</pre>
</div>
<p />
This is generally a very simple map with a player start that is not meant to host gameplay, but to load the main menu for the game. The entirety of the <code>UDKFrontEndMap.udk</code> map is shown below:
<p />
<img src="rsrc/Three/UnrealScriptGameFlow/entrymap.jpg" alt="entrymap.jpg" width="729" height="465" />
<p />
<h4><a name="Main Menu"></a> Main Menu </h4>
<p />
There is no special functionality that forces the game to force a specific menu to be used as the main menu or to force the game startup into a main menu. As was mentioned briefly above, it is the job of the map that is loaded at startup to load the main menu.
<p />
This allows for great flexibility and control over how the game starts up. For example, one game may simply startup and show the main menu immediately, while another game could startup showing a cinematic that transitions into the main menu, and yet another game may allow a brief bit of gameplay preceding the displaying of the menu. In fact, the game could even skip the idea of a main menu altogether if that was desired.
<p />
The menu is opened using Kismet. An example of Kismet for loading the main menu from the <code>UDKFrontEndMap.udk</code> map is show here:
<p />
<img src="rsrc/Three/UnrealScriptGameFlow/mainmenu_kismet.jpg" alt="mainmenu_kismet.jpg" width="900" height="567" />
<p />
<h3><a name="Loading screen"></a> Loading screen </h3>
<p />
Any transition from one map to another causes a loading screen to be displayed. The loading screen is actually a fullscreen video (.bik) chosen at random from the <code>LoadMapMovies</code> array specified in the <code>FullScreenMovie]</code> section of the <code>DefaultEngine.ini</code> file.
<p />
<div class="codesnippet">
<pre>
&#91;FullScreenMovie]
+LoadMapMovies&#61;UDKFrontEnd.udk&#95;loading
</pre>
</div>
<p />
<h2><a name="Game Startup"></a> Game Startup </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
In Unreal, the term "game" gets used a lot to mean different things. In this instance, game refers to the gameplay and events that occur after the loading of a new map.
<p />
<h2><a name="Game Init"></a> Game Init </h2>
<p />
The <code>InitGame()</code> event of the current <code>GameInfo</code> is called before any other scripts are executed, including all Actors' <code>PreBeginplay()</code> events. This is mainly for the gametype to set up its own parameters and spawn any helper classes needed.
<p />
<div class="codesnippet">
<pre>
event InitGame( string Options, out string ErrorMessage )
</pre>
</div>
<p />
<h3><a name="PreBeginPlay"></a> PreBeginPlay </h3>
<p />
The <code>PreBeginPlay()</code> event is the first script function called on the Actor after execution of the Actor's script has begin. Its name implies it is called before gameplay begins, which is the case if the Actor exists when the game starts up. If the Actor is spawned during play, this event is still called even though gameplay has already begun. Very specialized initialization could be performed here, but keep in mind that the Actor's components have not been initialized at this point and there is no reliable way to ensure that any external object has been initialized either.
<p />
<div class="codesnippet">
<pre>
event PreBeginPlay()
</pre>
</div>
<p />
<h3><a name="PostBeginPlay"></a> PostBeginPlay </h3>
<p />
The <code>PostBeginPlay()</code> event is called after all other Actors have been initialized, via their <code>PreBeginPlay()</code> events. This event is generally used to initialize properties, find references to other Actors in the world, and perform any other general initialization. It is fair to consider this event the script equivalent of a constructor for Actors.  Even so, there are still some things that require using specialized events available in the Actor to initialize. For instance, initialization having to do with animations and the AnimTree would best be performed in the <code>PostInitAnimTree()</code> event as that is called after the AnimTree is created and initialized. There are many such events provided for doing this type of specialized initialization. It is best to search for these first before adding specific initialization functionality to the <code>PostBeginPlay()</code> event.
<p />
<div class="codesnippet">
<pre>
event PostBeginPlay()
</pre>
</div>
<p />
<h3><a name="Player Creation"></a> Player Creation </h3>
<p />
Player creation is handled inside the gametype (e.g., the <code>GameInfo</code> class) through the process of logging in. In the context of networked online multiplayer games, this concept should make perfect sense. Unreal utilizes the same basic process regardless of whether the game is online, offline, multiplayer, or single-player, though obviously there are additional actions being carried out in an online situation.
<p />
The login process is broken up into several stages:
<p /> <ul>
<li> PreLogin
</li> <li> Login
</li> <li> PostLogin
</li></ul>
<p />
The <code>PreLogin()</code> event is called from native code and is responsible for determining whether the player is allowed to join the game. It uses the <code>AccessControl</code> object of the gametype to determine whether the player can join by calling its <code>PreLogin()</code> function.
<p />
<div class="codesnippet">
<pre>
event PreLogin(string Options, string Address, out string ErrorMessage)
</pre>
</div>
<p />
The <code>Login()</code> event is called from native code and is responsible for spawning the player. Any specialized functionality needed for creating new players should be added here.
<p />
<div class="codesnippet">
<pre>
event PlayerController Login(string Portal, string Options, const UniqueNetID UniqueID, out string ErrorMessage)
</pre>
</div>
<p />
The <code>PostLogin()</code> event is called from native code after the player has successfully joined the game. This is a good place to do player initialization and is a safe place to call replicated functions on the <code>PlayerController</code>.
<p />
<div class="codesnippet">
<pre>
event PostLogin( PlayerController NewPlayer )
</pre>
</div>
<p />
<h3><a name="Match Start"></a> Match Start </h3>
<p />
The actual game, as in the gameplay that happens from the time the player is spawned until the game ends, is often referred to as a match. This is just a term and has no bearing on the type of games that can be created with Unreal Engine 3.
<p />
The match is begun when the <code>StartMatch()</code> function of the gametype is called from the <code>PostLogin()</code> event (also called from <code>StartMatch()</code> and <code>StartArbitratedMatch()</code> in the <code>PendingMatch</code> state). This function is responsible for spawning the player's <code>Pawns</code> and notifying all of the players that the match has begun.
<p />
<div class="codesnippet">
<pre>
function StartMatch()
</pre>
</div>
<p />
The actual spawning of the players' <code>Pawns</code> occurs in the <code>RestartPlayer()</code> function. This is called from the <code>StartHumans()</code> and <code>StartBots()</code> functions, which are in turn called from the <code>StartMatch()</code> function. In addition to spawning the <code>Pawns</code>, this function locates a starting spot, e.g. a <code>PlayerStart</code> Actor, to start the player from.
<p />
<div class="codesnippet">
<pre>
function RestartPlayer(Controller NewPlayer)
</pre>
</div>
<p />
<h2><a name="End Game"></a> End Game </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The gametype is responsible for determining if the game has ended. This is not some automatic check that happens at set intervals or is initiated by the engine, though. It is the responsibility of the game-relevant Actors to notify the gametype when important events occur so that it can check to see if that event should result in the game ending. These checks are usually performed in specialized functions added to subclasses of <code>GameInfo</code>. For example, the <code>UTGame</code> gametype has a <code>CheckScore()</code> function which gets called anytime a player gets killed to check to see if that kill should end the game. When one of these functions determines the game should end, that function then calls the <code>EndGame()</code> function, which in turn calls <code>CheckEndGame()</code>. These functions make sure the game can end and then perform the actions associated with ending the current gametype.
<p />
In the example of an adventure role-playing game, when the player is in a dungeon and the boss is defeated or the objective is completed, the boss or the objective would notify the gametype it had been killed or completed, respectively. The gametype would then check to be sure that all end gamed conditions had been completed. If the end game condition have indeed been completed, the gametype calls <code>EndGame()</code> to perform the appropriate actions for ending the game: sending the player back to the main world and recording that the dungeon had been completed in one manner or another. In the main world, the gametype would load the player's progress, which might be the dungeons completed by the player, and then check to see if all end game conditions have been met. If the conditions have been met, that gametype would then call its <code>EndGame()</code> to initiate the appropriate actions for the game being over.
<p />
Obviously, this is just an example and every game will have different rules, flow, and conditions for ending the game, but the idea should be clear.
<p />
<noautolink>
<p />
<style type="text/css">
<!--
div.codesnippet
{
	margin:0px 10px;
	padding:0px 10px;
	background:#f0f0f0;
	font:12px Courier;
	max-height:500px;
	overflow:auto;
	border:1px inset #989898;
}
-->
</style>
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
