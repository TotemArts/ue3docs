<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | ModulatedShadows    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">ModulatedShadows  </b></div>
<div id="tooltext">
<a href="ModulatedShadowsJP.html" class="twikiLink">日本語訳</a><br><a href="ModulatedShadowsCH.html" class="twikiLink">中国翻译</a><br><a href="ModulatedShadowsKR.html" class="twikiLink">한국어</a><br>

<!-- Three/ModulatedShadows -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="LightingAndShadowsHome.html" class="twikiLink">Lighting &amp; Shadows</a></b> &gt; Modulated Shadows <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="LightingArtistHome.html" class="twikiLink">Lighting Artist</a></b> &gt; Modulated Shadows
</div>
<hr size="1" noshade="noshade">
<h1><a name="Modulated Shadows"></a> Modulated Shadows </h1>
<hr size="1" noshade="noshade">
<p />
<em>Document Changelog: Created by <a href="https://udn.epicgames.com/Main/DanielWright" class="restricted" class="restricted" class="twikiLink">Daniel Wright</a>.</em>
<p />
<div class="twikiToc"> <ul>
<li> <a href="ModulatedShadows.html#Modulated Shadows"> Modulated Shadows</a> <ul>
<li> <a href="ModulatedShadows.html#Overview"> Overview</a>
</li> <li> <a href="ModulatedShadows.html#Versions"> Versions</a>
</li> <li> <a href="ModulatedShadows.html#Relevant Settings"> Relevant Settings</a> <ul>
<li> <a href="ModulatedShadows.html#LightShadowMode"> LightShadowMode</a>
</li> <li> <a href="ModulatedShadows.html#ModShadowColor"> ModShadowColor</a>
</li> <li> <a href="ModulatedShadows.html#ShadowFalloffExponent"> ShadowFalloffExponent</a>
</li> <li> <a href="ModulatedShadows.html#ModShadowFadeoutExponent"> ModShadowFadeoutExponent</a>
</li> <li> <a href="ModulatedShadows.html#ModShadowFadeoutTime"> ModShadowFadeoutTime </a>
</li></ul>
</li> <li> <a href="ModulatedShadows.html#Why use modulated shadows"> Why use modulated shadows </a>
</li> <li> <a href="ModulatedShadows.html#How modulated shadows work"> How modulated shadows work</a>
</li> <li> <a href="ModulatedShadows.html#Limitations"> Limitations</a> <ul>
<li> <a href="ModulatedShadows.html#Double shadowing"> Double shadowing</a>
</li> <li> <a href="ModulatedShadows.html#Emissive artifacts"> Emissive artifacts</a>
</li> <li> <a href="ModulatedShadows.html#Casting through geometry"> Casting through geometry</a>
</li> <li> <a href="ModulatedShadows.html#Shadow buffer filtering"> Shadow buffer filtering</a>
</li></ul>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Modulated shadows were introduced to solve some of the performance problems with normal shadows, and to give artists more control over shadow appearances.  Throughout this doc, 'normal shadows' simply means non-modulated shadows, and does not imply anything about the filtering technique.
<p />
Note that modulated shadows work with both projected shadow buffers as well as shadow volumes.
<p />
<h2><a name="Versions"></a> Versions </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
ModShadowFadeoutTime functionality was introduced in QA_APPROVED_BUILD_JUNE_2007, but shadows didn't fade in as well until QA_APPROVED_BUILD_AUGUST_2007.  The Modulate-Better shadow mode was added in QA_APPROVED_BUILD_JAN_2008.
<p />
<h2><a name="Relevant Settings"></a> Relevant Settings </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<img alt="ModShadowOptions.jpg" src="rsrc/Three/ModulatedShadows/ModShadowOptions.jpg" />
<br><br>
<p />
<h3><a name="LightShadowMode"></a> LightShadowMode </h3>
<p />
Controls the type of shadowing used for this light source.
<p /> <ul>
<li> LightShadow_Normal - the default behavior and <strong>requires a mesh to be dynamically lit by the shadow casting light in order to receive shadows from that light</strong>.  This is a very important implication because it means lightmapped geometry cannot receive normal shadows if the lightmap contains the contribution from the shadow casting light.  Normal shadows are very expensive on Xbox 360 as they require extra render target space which requires other render targets to be saved out and restored afterwards.
</li> <li> LightShadow_Modulate - enables modulated shadows from this light source, which cast on any opaque or masked object.  This is the cheapest mode.  Modulated shadows operate by multiplying scene color instead of masking out a certain light.
</li></ul>
<!-- <ul>
<li> LightShadow_ModulateBetter - operates the same as Modulate, except modulated shadows will be masked out on backfaces and pixels whose emissive is &gt; 1 for any component.  ModulateBetter shadows add an extra rendering pass for the caster and all receivers to calculate the mask.
</li></ul>
-->
<p />
<h3><a name="ModShadowColor"></a> ModShadowColor </h3>
<p />
This controls the color of modulated shadows.
<p />
<h3><a name="ShadowFalloffExponent"></a> ShadowFalloffExponent </h3>
<p />
Rate at which the shadows falloff based on distance for spot lights and point lights.  A higher value means that the falloff will occur more quickly.  A value of 1.0 equals linear falloff.
<p />
<h3><a name="ModShadowFadeoutExponent"></a> ModShadowFadeoutExponent </h3>
<p />
This controls the fade-out and fade-in curves when ModShadowFadeoutTime is greater than zero.
<p />
<h3><a name="ModShadowFadeoutTime"></a> ModShadowFadeoutTime </h3>
<p />
If this is greater than zero, then the modulated shadow will fadeout based on the time that the caster was last visible.  It will also fade in based on the time that the caster first became visible.  This can be used to fade out shadows on characters in other rooms, whose shadows would otherwise be seen through the wall.  Make sure you have realtime update on in the editor or it will not work correctly.  The fade is framerate dependent so hitches may cause undesired artifacts.
<p />
<h2><a name="Why use modulated shadows"></a> Why use modulated shadows </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
An object's dynamic shadows are drawn for each light that uses Normal Shadows.  Shadows in this sense are the absence of light coming from the current light source.  This is a more physically correct model, however it has some serious implications.  A typical scene will have several lights in the same area, but only one of these lights casting dynamic shadows for performance reasons.  In this case, shadow color is totally dependent on the lights affecting the shadowed surface.  The shadow will be very dim because the shadow-casting light source only contributes a fraction of the total light on the surface, and the shadow is simply the absence of that light.  It would be very difficult for an artist to tweak the shadow color and make it darker in this case, because that would require making the shadow-casting light brighter (or closer, less attenuation etc), which may ruin the lighting in the scene.
<br><br>
Normal shadows do not cast onto static geometry once its lightmap has been built.  Modulated shadows cast on the entire scene and so solve this problem.
<br><br>
A scene with 3 lights affecting the character, only one of them casting normal shadows.  Note that the shadow is very dim.<br>
<img alt="ThreeNormal.jpg" src="rsrc/Three/ModulatedShadows/ThreeNormal.jpg" />
<p />
<h2><a name="How modulated shadows work"></a> How modulated shadows work </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
This is where modulated shadows come into the picture.  In short, modulated shadows allow the artist to have only one shadow per dynamic object and control that shadow color without changing the lighting properties of the shadow-casting light source.  <br><br>
<p />
Modulated shadows are much less physically correct than normal shadows, however in most cases this is offset by the performance and user control benefits.  In each lighting pass the shadows have ModShadowColor applied, and then they are rendered to an attenuation buffer, instead of being used to mask out the current light.  When all the lights have been rendered, the attenuation buffer is multiplied with the scene color.  The result is that shadows will be darker no matter how many lights are affecting a surface, because shadows from one light source affect the light from all light sources, instead of just the shadow-casting light source.
<br><br>
The same scene with 3 lights affecting the character, only one of them casting modulated shadows.  Note that the shadow is still strong.<br>
<img alt="ThreeMod.jpg" src="rsrc/Three/ModulatedShadows/ThreeMod.jpg" />
<p />
Modulated shadows for point lights have a radial attenuation based on the light's radius.  This is also true for spot lights except that the falloff is also affected by the inner and outer cones.  For directional lights there is no distance attenuation.
<p />
<h2><a name="Limitations"></a> Limitations </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<h3><a name="Double shadowing"></a> Double shadowing </h3>
<p />
Since modulated shadows simply modulate against scene color, areas where shadows overlap will be double shadowed.  The workaround for this is to shadow parent nearby primitives.  For example, in Gears of War 1 all weapons are shadow parented to their pawns to avoid double shadowing there.  See <a href="AttachingActors.html#b_ShadowParented" class="twikiAnchorLink">AttachingActors#b_ShadowParented</a> for how to shadow parent in content.  To shadow parent in code use the PrimitiveComponent's SetShadowParent method.
<p />
<h3><a name="Emissive artifacts"></a> Emissive artifacts </h3>
<p />
Modulative shadows are multiplied against the scene color, including emissive light, which should not be shadowed.  The workaround is to use the Modulate-Better shadow mode, which will prevent modulated shadows from affecting pixels whose emissive component is &gt; 1 for any channel.
<p />
<h3><a name="Casting through geometry"></a> Casting through geometry </h3>
<p />
In the current implementation, mod shadows cast through geometry.  The most obvious cases of this will have to be avoided through careful light placement.  Avoiding these situations through manual light tweaking can be very difficult, but can be made significantly easier by using <a href="LightEnvironments.html" class="twikiLink">LightEnvironments</a>.  In some cases this can be alleviated through the use of ModShadowFadeoutTime.  Shadows on backfaces can be avoided with the Modulate-Better shadow mode.<br><br>
<p />
The only way to really avoid these projection artifacts is to use normal shadows.  However, normal shadows are considerably more expensive than modulated shadows for the most part.  There's one exception to this: <a href="DominantLights.html" class="twikiLink">DominantLights</a>.  Dominant lights allow you to have one light casting normal shadows for cheap.
<p />
<h3><a name="Shadow buffer filtering"></a> Shadow buffer filtering </h3>
<p />
One implication of modulated shadows is that backface color from a certain light will no longer be the same as the shadow casted from that light source.  This means that shadows must cover the backfaces accurately, or the difference will be obvious.  This is a problem for some shadow buffer filtering techniques, such as VSM, which introduce a depth offset.  See <a href="https://udn.epicgames.com/Three/ShadowBufferFilteringOptions" class="restricted" class="restricted" class="twikiLink">ShadowBufferFilteringOptions</a> and <a href="https://udn.epicgames.com/Three/ShadowBufferFilteringTech" class="restricted" class="restricted" class="twikiLink">ShadowBufferFilteringTech</a> for more info.
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
