<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | MasteringUnrealScriptPreProcessor    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">MasteringUnrealScriptPreProcessor  </b></div>
<div id="tooltext">
<a href="MasteringUnrealScriptPreProcessorJP.html" class="twikiLink">日本語訳</a><br><a href="MasteringUnrealScriptPreProcessorCH.html" class="twikiLink">中国翻译</a><br><a href="MasteringUnrealScriptPreProcessorKR.html" class="twikiLink">한국어</a><br>

<!-- Three/MasteringUnrealScriptPreProcessor -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div class="twikiToc"> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#CHAPTER 9 – UNREALSCRIPT PREPROCESSOR"><b>CHAPTER 9 – UNREALSCRIPT PREPROCESSOR</b></a> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#9.1 OVERVIEW">9.1 OVERVIEW</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#9.2 MACRO BASICS">9.2 MACRO BASICS</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.1 – YOUR FIRST MACRO">TUTORIAL 9.1 – YOUR FIRST MACRO</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#9.3 MACROS WITH PARAMETERS">9.3 MACROS WITH PARAMETERS</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.2 – MACRO PARAMETERS">TUTORIAL 9.2 – MACRO PARAMETERS</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#9.4 BUILT-IN MACROS">9.4 BUILT-IN MACROS</a> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#DEFINE">DEFINE</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#IF/ELSE/ENDIF">IF/ELSE/ENDIF</a> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#EXAMPLE: USAGE OF IF/ELSE/ENDIF">EXAMPLE: USAGE OF IF/ELSE/ENDIF</a>
</li></ul>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#INCLUDE">INCLUDE</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#ISDEFINED/NOTDEFINED">ISDEFINED/NOTDEFINED</a> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#EXAMPLE: COMBINING IF/ELSE/ENDIF AND ISDEFINED/NOTDEFINED">EXAMPLE: COMBINING IF/ELSE/ENDIF AND ISDEFINED/NOTDEFINED</a>
</li></ul>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#UNDEFINE">UNDEFINE</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#LOG/WARN">LOG/WARN</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#LOGD">LOGD</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#ASSERT">ASSERT</a> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#EXAMPLE: VALIDATING A CONDTION">EXAMPLE: VALIDATING A CONDTION</a>
</li></ul>
</li></ul>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.3 – USING AN INCLUDE FILE">TUTORIAL 9.3 – USING AN INCLUDE FILE</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#9.5 COMMAND-LINE SWITCHES">9.5 COMMAND-LINE SWITCHES</a> <ul>
<li> <a href="MasteringUnrealScriptPreProcessor.html#DEBUG">DEBUG</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#FINAL_RELEASE">FINAL_RELEASE</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#NOPREPROCESS">NOPREPROCESS</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#INTERMEDIATE">INTERMEDIATE</a>
</li></ul>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.4 – VISUAL DEBUG MODE, PART I: SETTING UP INCLUDE FILE">TUTORIAL 9.4 – VISUAL DEBUG MODE, PART I: SETTING UP INCLUDE FILE</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.5 – VISUAL DEBUG MODE, PART II: CONDITIONAL INCLUDE STATEMENT">TUTORIAL 9.5 – VISUAL DEBUG MODE, PART II: CONDITIONAL INCLUDE STATEMENT</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.6 – VISUAL DEBUG MODE, PART III: GLOBAL BSHOWDEBUG AND CREATURE VARIABLE INITIALIZATION">TUTORIAL 9.6 – VISUAL DEBUG MODE, PART III: GLOBAL BSHOWDEBUG AND CREATURE VARIABLE INITIALIZATION</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.7 - VISUAL DEBUG MODE, PART IV: HIDING MESHES">TUTORIAL 9.7 - VISUAL DEBUG MODE, PART IV: HIDING MESHES</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.8 - VISUAL DEBUG MODE, PART V: DRAWING LEADER INDICATORS">TUTORIAL 9.8 - VISUAL DEBUG MODE, PART V: DRAWING LEADER INDICATORS</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.9 - VISUAL DEBUG MODE, PART VI: FLOCK VISUAL INDICATORS">TUTORIAL 9.9 - VISUAL DEBUG MODE, PART VI: FLOCK VISUAL INDICATORS</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#TUTORIAL 9.10 - VISUAL DEBUG MODE, PART VII: TESTING">TUTORIAL 9.10 - VISUAL DEBUG MODE, PART VII: TESTING</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#9.5 SUMMARY">9.5 SUMMARY</a>
</li> <li> <a href="MasteringUnrealScriptPreProcessor.html#SUPPLEMENTAL FILES">SUPPLEMENTAL FILES</a>
</li></ul>
</li></ul>
</div>
<p />
<h1><a name="CHAPTER 9 – UNREALSCRIPT PREPROCESSOR"></a> <b>CHAPTER 9 – UNREALSCRIPT PREPROCESSOR</b> </h1>
<p />
One of the new editions to Unreal Engine 3 is the UnrealScript preprocessor. If you are familiar with the preprocessor in C++ then you’ll likely become quite comfortable with UnrealScript’s new preprocessor. If you have no clue what a preprocessor is, then don’t worry; we’ll be covering all of the details shortly.
<p />
<h2><a name="9.1 OVERVIEW"></a> 9.1 OVERVIEW </h2>
<p />
In its simplest form a preprocessor is little more than a glorified replacement tool that alters text. A preprocessor is used to replace text, referred to as a macro, with other text within your source files. It is also used to include certain code within a file based on particular compiler directives; this is known as conditional compilation and it very useful when code has to be written differently on multiple platforms.
<p />
It is very important to remember that the preprocessor is invoked before any of the compilation of the scripts happens.
<p />
<h2><a name="9.2 MACRO BASICS"></a> 9.2 MACRO BASICS </h2>
<p />
In order to actually use a macro within our scripts we must define some macro and to do that we use the built in macro define. We’ll talk in depth about the built-in macros shortly, but the basic definition of a macro looks like this:
<p />
<font face=consolas>
<pre>
`define    MyFirstMacro    “This is really my first macro.”
</pre>
</font>
<p />
If we take a look you’ll notice that the macro starts with a ` (a back tick) followed by some whitespace (this can be a tab, a space, or any combination of those characters). Next is the name of the macro. This is what we will use when we refer to it later in our scripts. Notice that the name of the macro must not contain any spaces. Finally is the definition of the macro body. This body definition is optional. You can define a macro with no body. Such a macro could be used for replacement purposes in certain circumstances, but it can also be quite useful when used in a preprocessor If statement.
<p />
Note:  Omitting the body definition of a macro can cause problems within the context of an include file. This will be covered in more depth later in the chapter.
<p />
We follow the same rules when making use of our macro. If we want to use the macro we made above in a source file we’d type:
<p />
<font face=consolas>
<pre>
`MyFirstMacro
</pre>
</font>
<p />
This will expand `MyFirstMacro and replace it with “This is really my first macro.” including the quotes.
<p />
Alternatively, we can also expand the macro by writing:
<p />
<font face=consolas>
<pre>
`{MyFirstMacro}
</pre>
</font>
<p />
This is useful if we want to expand our macro within the body of some other text that doesn’t have conveniently positioned whitespace. Other times we use this format as it provides clarity within our scripts as it is easy to miss the back tick character.
<p />
<font face=consolas>
<pre>
some`{MyFirstMacro}code
</pre>
</font>
<p />
The preprocessor turns that into:
<p />
<font face=consolas>
<pre>
some“This is really my first macro.”code
</pre>
</font>
<p />
When the preprocessor expands macros, it then rescans the expanded text to see if any resultant macros should be expanded. Because of this, you should be very careful how you use this feature as you could end up in an infinite recursive loop of macro expansions. Note the example below:
<p />
<font face=consolas>
<pre>
`define  hello  This macro will infinitely recurse because of the `hello usage.
`hello
</pre>
</font>
<p />
<h2><a name="TUTORIAL 9.1 – YOUR FIRST MACRO"></a> TUTORIAL 9.1 – YOUR FIRST MACRO </h2>
<p />
In this tutorial, you will define a simple macro that will then be used within an existing class to show the basic replacement behavior of a macro. Specifically, a macro will be defined before the class declaration whose body will contain one or more class specifiers. This macro will then be used within the class declaration to add the specifiers defined in the macro to the declaration.
<p />
<strong>1.</strong>	Open ConTEXT and the AmbientCreature.uc script.
<p />
<strong>2.</strong>	With the cursor at the beginning of the script, press the Enter key a few times to move the entire contents of the class down a few lines.
<p />
<strong>3.</strong>	Back on the first line of the script, define a new macro named ClassSpecs.
<p />
<font face=consolas>
<pre>
`define ClassSpecs
</pre>
</font>
<p />
There is now a macro named ClassSpecs, but it has no body at this point.
<p />
<strong>4.</strong>	Leave a space after ClassSpecs and then add the Placeable class specifier so the final definition appears like so:
<p />
<font face=consolas>
<pre>
`define ClassSpecs placeable
</pre>
</font>
<p />
This will cause the term placeable to be inserted anywhere the macro is used.
<p />
<strong>5.</strong>	Inside the class declaration after the term Actor and before the ; terminator, add a space and then place the ClassSpecs macro to add the specifier to the declaration.
<p />
<font face=consolas>
<pre>
class AmbientCreature extends Actor `{ClassSpecs};
</pre>
</font>
<p />
Notice that curly braces were used to ensure the whitespace surrounding the macro is respected. Otherwise, it would be possible that the declaration could end up looking like the following:
<p />
<font face=consolas>
<pre>
class AmbientCreature extends Actorplaceable;
</pre>
</font>
<p />
<strong>6.</strong>	Compile the scripts and then open UnrealEd. You should now see not only the AmbientCreature class listed in the Actor Browser as a placeable class, but you should also see the AmbientCreature_Fish class listed as it inherits the placeable specifier from the AmbientCreature class. Close UnrealEd.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_001.jpg"/><br/> <strong><font color=blue>Figure 9.1 – Both the AmbientCreature and AmbientCreature_Fish classes are placeable.</font></strong>
<p />
<strong>7.</strong>	Now, inside the definition of the ClassSpecs macro, add the abstract specifier just before the placeable specifier. The definition should appear as follows:
<p />
<font face=consolas>
<pre>
`define ClassSpecs abstract placeable
</pre>
</font>
<p />
<strong>8.</strong>	Compile the scripts again and Open UnrealEd up once again. In the Actor Browser, you should still see both classes listed, but this time the AmbientCreature class should be greyed out signifying it is not a placeable class since it has now been declared as abstract. You can see that whatever code is placed in the body of the macro is being inserted in place of the macro in the class declaration.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_002.jpg"/><br/> <strong><font color=blue>Figure 9.2 – Only the AmbientCreature_Fish class is placeable now.</font></strong>
<p />
<strong>9.</strong>	Save the file with the new macro as we will be using it in the next tutorial..
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="9.3 MACROS WITH PARAMETERS"></a> 9.3 MACROS WITH PARAMETERS </h2>
<p />
It is also possible to create macro definitions that accept parameters as input. This is essentially like a function, in many cases, but instead of being evaluated it is expanded. Because of this, some types of macros can have better performance that functions that do the same thing.
<p />
Formally the definition of the macro looks like this:
<p />
<font face=consolas>
<pre>
`define &#60;macro&#95;name&#62;&#91;(&#60;param1&#62;&#91;,&#60;param2&#62;...])] &#91;macro&#95;definition]
</pre>
</font>
<p />
If that definition looks intimidating, no problem, let’s take a look at a few examples.
<p />
EXAMPLE: CREATING A MACRO TO CUBE A NUMBER
<p />
The definition of the macro looks like this:
<p />
<font face=consolas>
<pre>
`define Cube(x) `x &#42; `x &#42; `x
</pre>
</font>
<p />
This says to create a macro named Cube that takes in one parameter named x. The expansion then expands to x * x * x replacing x with whatever was passed in. Note that when referencing the name of the parameter, you must preface it with a ` (back tick).
<p />
To use this macro we might do something like this:
<p />
<font face=consolas>
<pre>
var int myVal &#61; `Cube(3);
</pre>
</font>
<p />
It is very important to note that when invoking the macro the ( (opening parenthesis) must come directly after the name of the macro; no whitespace can be present.
<p />
EXAMPLE: CREATING A MACRO TO SQUARE THE SUM OF TWO NUMBERS
<p />
This macro will sum two numbers and then square that result.
<p />
<font face=consolas>
<pre>
`define SumSquare(x, y) (`x + `y) &#42; (`x + `y)
</pre>
</font>
<p />
In order to use this we do the following:
<p />
<font face=consolas>
<pre>
var int myVal &#61; `SumSquare(5, 3);
</pre>
</font>
<p />
Like functions, commas are used to separate the parameters. However, unlike functions, macro parameters provide absolutely no type safety. For example, we could do the following and the macro would expand just as it thinks it should:
<p />
<font face=consolas>
<pre>
var int badVal &#61; `SumSquare(p1, p2);
</pre>
</font>
<p />
The expansion would result in the following:
<p />
<font face=consolas>
<pre>
var int badValue &#61; (p1+ p2) &#42; (p1+ p2);
</pre>
</font>
<p />
Now, if p1 and p2 were actually defined as some integer variable this would work as expected. However, the preprocessor does not do any of this type of validation thus you could end up with some code that won’t even compile.
<p />
Note that the Unreal preprocessor likes to eat the whitespace characters between the macro evaluations. If you wanted your output to look like this (note the space after p1):
<p />
<font face=consolas>
<pre>
var int badValue &#61; (p1 + p2) &#42; (p1 + p2);
</pre>
</font>
<p />
You’d need to surround your macros in the define with {} (curly braces) like this:
<p />
<font face=consolas>
<pre>
`define SumSquare(x, y) (`{x} + `{y}) &#42; (`{x} + `{y})
</pre>
</font>
<p />
This doesn’t matter in this particular example, but it could potentially be an issue so please be sure to remember this fact.
<p />
<h2><a name="TUTORIAL 9.2 – MACRO PARAMETERS"></a> TUTORIAL 9.2 – MACRO PARAMETERS </h2>
<p />
This tutorial will expand on the knowledge gained in the last tutorial to create a new macro making use of parameters. This macro will essentially act as a function that will allow us to declare new variables.
<p />
<strong>1.</strong>	Open ConTEXT and the AmbientCreature.uf script containing the changes made in the previous tutorial.
<p />
<strong>2.</strong>	Below the ClassSpecs macro definition, define a new macro named NewEditvar with the parameters shown below:
<p />
<font face=consolas>
<pre>
`define NewEditVar(varCat,varType,varName)
</pre>
</font>
<p />
<strong>3.</strong>	Now, we will add the body of the macro. The purpose of this macro is to declare a new editable variable so the body will take the form of a variable declaration using the parameters of the macro. Add the body shon here:
<p />
<font face=consolas>
<pre>
var(`varCat) `{varitype} `{varName}
</pre>
</font>
<p />
The full macro definition should now appear as follows:
<p />
<font face=consolas>
<pre>
`define NewEditVar(varCat,varType,varName) var(`varCat) `{varitype} `{varName}
</pre>
</font>
<p />
Again, we have used curly braces to make sure spacing stays consistent.
<p />
<strong>4.</strong>	Now, we can use this macro to declare a new editable variable in the AmbientCreature class. After the class declaration, declare a new bool variable named bMacro to be located in the Macro category by adding the code below:
<p />
<font face=consolas>
<pre>
`NewEditVar(Macro,Bool,bMacro)
</pre>
</font>
<p />
<strong>5.</strong>	Compile the scripts and open UnrealEd. The AmbientCreature_Fish class should still be placeable based on the changes made in the previous tutorial. Add an instance of this class to a map by selecting it in the Actor Browser, right-clicking in the viewport, and choosing Add AmbientCreature_Fish Here.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_003.jpg"/><br/> <strong><font color=blue>Figure 9.3 – A new AmbientCreature_Fish actors is placed in the map.</font></strong>
<p />
<strong>6.</strong>	Double-click the new actor to open the properties window. There should be a Macro category present. Expand this category and you should see the bMacro property listed. The macro was used to insert the proper code to declare a new variable.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_004.jpg"/><br/> <strong><font color=blue>Figure 9.4 – The bMacro property was added through the use of a macro.</font></strong>
<p />
In this case the macro code isn’t really any more efficient than typing the declaration out by hand, but situations may arise in the development of your mod where you find yourself performing repetitive tasks that could be greatly enhanced by making use of a macro in this fashion.
<p />
<strong>7.</strong>	Save the file with the new macro and variable declaration intact. These will be used in the next tutorial.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="9.4 BUILT-IN MACROS"></a> 9.4 BUILT-IN MACROS </h2>
<p />
The UnrealScript preprocessor has some built-in macros defined for us already. This section will go over each of those macros and provides some examples on how to use them.
<p />
<h3><a name="DEFINE"></a> DEFINE </h3>
<p />
This macro is used to define other macros that we wish to make use of. The named macro will expand to the given definition; if there is no definition provided then it will expand to the empty string.
<p />
The formal definition is:
<p />
<font face=consolas>
<pre>
`define &#60;macro&#95;name&#62;&#91;(&#60;param1&#62;&#91;,&#60;param2&#62;...])] &#91;macro&#95;definition]
</pre>
</font>
<p />
Remember that when using a named macro with parameters the ( (opening parenthesis) must come directly after the name of the macro and that all parameters are listed as a typeless, comma separated list.
<p />
There is a special macro for define: `#. This macro represents the number of parameters specified and can only be used within the definition of the macro. For example:
<p />
<font face=consolas>
<pre>
`define MyMacro(p1, p2, p3, p4) “This macro contains `# parameters.”

var string myString &#61; `MyMacro(1, 2, 3, 4);
</pre>
</font>
<p />
The expansion of the above use of MyMacro would be:
<p />
<font face=consolas>
<pre>
var string myString &#61; “This macro contains 4 parameters.”;
</pre>
</font>
<p />
<h3><a name="IF/ELSE/ENDIF"></a> IF/ELSE/ENDIF </h3>
<p />
The if, else, and endif macros are used to support conditional compilation; that is, at compile time, including or excluding certain blocks of code. This is very useful when needing to provide specific implementations for particular platforms.
<p />
The formal definition is:
<p />
<font face=consolas>
<pre>
`if(&#60;value&#62;)
`else
`endif
</pre>
</font>
<p />
The value within the if-clause is evaluated to true if it is expanded to a non-empty string, otherwise it is considered to be false. When the value is evaluated to true, then all of the text between the if and else macros is placed within the file. Otherwise the text between the else and the endif macros will be used.
<p />
It is good to note that the else macro is an optional piece of the structure; that is, it is valid to only have a block made up of the if and endif macros.
<p />
<h4><a name="EXAMPLE: USAGE OF IF/ELSE/ENDIF"></a> EXAMPLE: USAGE OF IF/ELSE/ENDIF </h4>
<p />
In this example we will define a macro and include a block of code based on whether or not that macro evaluated to an empty string.
<p />
<font face=consolas>
<pre>
`define MyIfCheck “Yes”

var int myValue;

`if(`MyIfCheck)
myValue &#61; 10;
`else
myValue &#61; 20;
`endif
</pre>
</font>
<p />
Of course, this example would be much more useful if MyIfCheck didn’t always evaluate to “Yes”, but we’ll learn how to do that later through command line options.
<p />
EXAMPLE: NESTING IF/ELSE/ENDIF MACROS
<p />
It is sometimes desirable to be able to check for more than one condition. There are a couple of ways in which we can do this; I’ll let you decide which method you prefer.
<p />
Both methods will assume that one of the following macros is defined to a non-empty string: PC, XBOX360, or PS3.
<p />
Method 1:
<p />
<font face=consolas>
<pre>
`if(`PC)
// The code to execute for the PC would go here
`else `if(`XBOX360)
// The code to execute for the Xbox 360 would go here
`else `if(`PS3)
// The code to execute for the PS3 would go here
`endif
</pre>
</font>
<p />
Method 2:
<p />
<font face=consolas>
<pre>
`if(`PC)
// The code to execute for the PC would go here
`endif
`if(`XBOX360)
// The code to execute for the Xbox 360 would go here
`endif
`if(`PS3)
// The code to execute for the PS3 would go here
`endif
</pre>
</font>
<p />
Both of the methods used above will ensure that only certain blocks of code are executed depending on the platform that is being run, but one is slightly more concise that the other.
<p />
<h3><a name="INCLUDE"></a> INCLUDE </h3>
<p />
The include macro is used to include the contents of another file at the current location. The include macro looks like this:
<p />
<font face=consolas>
<pre>
`include(&#60;filename&#62;)
</pre>
</font>
<p />
By default, the filename is considered to be relative to the directory specified by the EditPackagesInPath setting within the Editor.EditorEngine section of the game’s INI file. When the filename does not contain a directory path, the compiler will first look for the file in the UTGame/Src directory and then in the base directory for the packaged currently being compiled.
<p />
Include files can contain any code a normal .uc UnrealScript file can contain. The code within the file will be inserted into any script that includes it. Although they can potentially have any extension you choose, .uci (for UC Include) is a fairly common extension to be used. This is the extension that will be used for all include files through this book.
<p />
One important issue to be aware of is that defining a macro without a body inside of an included file can potentially cause compiling errors, specifically if this definition is the last line of the file. Placing some other code after such a definition, even as little as a comment, should clear up this problem.
<p />
<h3><a name="ISDEFINED/NOTDEFINED"></a> ISDEFINED/NOTDEFINED </h3>
<p />
The isdefined macro is used to determine if the specified macro has been defined or not; if the macro is defined, then the macro evaluates to “1”. The isdefined macro looks like this:
<p />
<font face=consolas>
<pre>
`isdefined(&#60;macro&#95;name&#62;)
</pre>
</font>
<p />
The notdefined macro is  just like the isdefined macro except that it is used to determine if the specified macro has been not been defined; if the macro is not defined, then the macro evaluates to “1”. The notdefined macro looks like this:
<p />
<font face=consolas>
<pre>
`notdefined(&#60;macro&#95;name&#62;)
</pre>
</font>
<p />
Both of these macros are used mostly in the context of conditional compilation.
<p />
<h4><a name="EXAMPLE: COMBINING IF/ELSE/ENDIF AND ISDEFINED/NOTDEFINED"></a> EXAMPLE: COMBINING IF/ELSE/ENDIF AND ISDEFINED/NOTDEFINED </h4>
<p />
In the previous examples of checking for platform specific macro definitions we always assumed that those macros evaluated to some non-empty string. However, this is not always the case and we’d really like a more robust way to check for those conditions. This is where the isdefined and notdefined macros truly shine.
<p />
<font face=consolas>
<pre>
`define MyCode

`if(`isdefined(MyCode))
// This block will be included because MyCode has been defined
`endif

`if(`notdefined(MyCodeNotDefined))
// The block will also be included because MyCodeNotDefined has NOT been defined
`endif
</pre>
</font>
<p />
The example above might look a lot like the previous if/else/endif macro examples, but remember that the if macro only evaluates to true for non-empty strings. If the example above MyCode evaluates to an empty string so if we didn’t use the isdefined macro as well, the if macro would have evaluated to false and that block would not have been included.
<p />
<h3><a name="UNDEFINE"></a> UNDEFINE </h3>
<p />
The undefine macro is used to remove the current definition of a named macro. It looks like:
<p />
<font face=consolas>
<pre>
`undefine(&#60;macro&#95;name&#62;)
</pre>
</font>
<p />
It is important to note that you cannot undefine parameter names, such as `#.
<p />
<h3><a name="LOG/WARN"></a> LOG/WARN </h3>
<p />
Both the log and the warn macros are wrappers for the LogInternal and the WarnInternal functions declared in Object.uc and are very useful for debugging your scripts. The definitions of the macros follow.
<p />
<font face=consolas>
<pre>
`log(string OutputString, optional bool bRequiredCondition, optional name LogTag);
`warn(string OutputString, optional bool bRequiredCondition);
</pre>
</font>
<p />
If the bRequiredCondition is specified, the condition will be evaluated during the execution of the script to determine if the message should be logged or not.
<p />
Both of the macros are disabled if the scripts are compiled with the –final_release switch.
<p />
<h3><a name="LOGD"></a> LOGD </h3>
<p />
The logd macro is exactly like the log macro except that it is only evaluated when your scripts are compiled in debug mode.
<p />
<font face=consolas>
<pre>
`logd(string OutputString, optional bool bRequiredCondition, optional name LogTag);
</pre>
</font>
<p />
This macro is disabled if the script is compiled with the –final_release switch.
<p />
<h3><a name="ASSERT"></a> ASSERT </h3>
<p />
This macro is a wrapper for the Assert intrinsic expression. It is used for asserting, or validating, that particular conditions are met, especially when debugging.
<p />
The assert macro is defined as:
<p />
<font face=consolas>
<pre>
`assert(bool bCondition);
</pre>
</font>
<p />
Note that this macro is disabled when the script is compiled with the –final_release switch.
<p />
<h4><a name="EXAMPLE: VALIDATING A CONDTION"></a> EXAMPLE: VALIDATING A CONDTION </h4>
<p />
This example will add two numbers and perform an assert check the sum.
<p />
<font face=consolas>
<pre>
var int x &#61; 1;
var int y &#61; 4;
var int sum &#61; x + y;
`assert(sum &#61;&#61; 4);
</pre>
</font>
<p />
<h2><a name="TUTORIAL 9.3 – USING AN INCLUDE FILE"></a> TUTORIAL 9.3 – USING AN INCLUDE FILE </h2>
<p />
In this tutorial, you will be introduced to the use of an include file.  The NewEditVar macro defined in the previous tutorial will be moved into a separate file and then made available to the AmbientCreature class through the use of the `include macro.
<p />
<strong>1.</strong>	Open ConTEXT as well as the AmbientCreature.uc file.
<p />
<strong>2.</strong>	Create a new file and set the UnrealScript highlighter if you wish.
<p />
<strong>3.</strong>	Select the NewEditVar macro definition in the AmbientCreature.uc file and cut it by pressing Ctrl+X. In the new file, press Ctrl+V to paste the macro definition here.
<p />
<strong>4.</strong>	If we saved the AmbientCreature.uc file and compiled the scripts at this point, we would get an error as the NewEditVar macro is still being used but it has not been defined in the script. Try it out and see for yourself. The compiler should present you with an error saying the macro doesn’t exist.
<p />
<strong>5.</strong>	Save the new file with the macro definition in it by choosing Save As from the File menu. Navigate up one directory to the MasteringUnrealScript folder and enter AmbientCreature_Debug.uci as the name for the file. You must enter the extension manually as ConTEXT will attempt to save it with the .uc extension based on the use of the UnrealScript highlighter.
<p />
<strong>6.</strong>	Now, where the NewEditVar macro had been defined in the AmbientCreature.uc file previously, add the statement below to include the new file in this script.
<p />
<font face=consolas>
<pre>
`include(AmbientCreature&#95;Debug.uci)
</pre>
</font>
<p />
<strong>7.</strong>	Save the AmbientCreature.uc file and compile the scripts again. There should be no errors regarding the macro this time.
<p />
<strong>8.</strong>	Open UnrealEd and place an AmbientCreature_Fish actor in a map. Open its properties and check to make sure the Macro category and bMacro property are both still present. The code from the AmbientCreature_Debug.uci file was successfully inserted into the AmbientCreature.uc file by using an include statement. In this case, weonly included preprocessor statements in the included file, but any UnrealScript code could have been placed in this file and included in any other file. This can be really useful if you have a function that needs to be used in several classes which don’t have the uxury of inheriting from each other. You can simply write the function once and use it anywhere by including the file which contains it.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_005.jpg"/><br/> <strong><font color=blue>Figure 9.5 – An AmbientCreature_Fish actor has been placed in the map.</font></strong>
<p />
<strong>9.</strong>	Open its properties and check to make sure the Macro category and bMacro property are both still present.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_006.jpg"/><br/> <strong><font color=blue>Figure 9.6 – The bMacro property still appears in the Property Window.</font></strong>
<p />
The code from the AmbientCreature_Debug.uci file was successfully inserted into the AmbientCreature.uc file by using an include statement. In this case, we only included preprocessor statements in the included file, but any UnrealScript code could have been placed in this file and included in any other file. This can be really useful if you have a function that needs to be used in several classes which don’t have the luxury of inheriting from each other. You can simply write the function once and use it anywhere by including the file which contains it.
<p />
<strong>10.</strong>	Before we move on, let’s remove the additions that have been made to the AmbientCreature class as they were for demonstration purposes and are no longer needed. These additions include:
<p /> <ul>
<li> Definition of ClassSpecs macro
</li> <li> Use of ClassSpecs macro in class declaration
</li> <li> Include for AmbientCreature.uci file
</li> <li> Use of NewEditVar macro to declare bMacro variable
</li></ul>
<p />
<strong>11.</strong>	Once everything has been removed, save the AmbientCreature.uc file.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="9.5 COMMAND-LINE SWITCHES"></a> 9.5 COMMAND-LINE SWITCHES </h2>
<p />
It is possible to provide command-line switches when compiling your scripts. These switches are used to change the behavior of how the preprocessor works.
<p />
<h3><a name="DEBUG"></a> DEBUG </h3>
<p />
When scripts are compiled with this switch the debug macro is defined. This is especially useful when you wish to include specific functionality, such as debug information, in scripts but only want them there during the testing stages of your development.
<p />
Usage: ut3.exe make –debug
<p />
<h3><a name="FINAL_RELEASE"></a> FINAL_RELEASE </h3>
<p />
This switch is used to signal that the scripts will be compiled for final release. This defines the final_release macro and disables the wrapper macros: log, logd, warn, assert.
<p />
Usage: ut3.exe make –final_release
<p />
<h3><a name="NOPREPROCESS"></a> NOPREPROCESS </h3>
<p />
This disables all macro and comment preprocessing; that is, no macros will be evaluated during the compiling of the script. This is not a terribly useful command-line switch for us, but if you ever have a file that uses the macro invitation character (the back tick), then you could use this command-line switch.
<p />
Usage: ut3.exe make –nopreprocess
<p />
<h3><a name="INTERMEDIATE"></a> INTERMEDIATE </h3>
<p />
This switch is used to provide the intermediate preprocessed files. This is extremely useful in tracking down hard to find preprocessor issues. It can be time consuming and uses up extra disk space, but it can be well worth it at times.
<p />
The files are located at: ..\UTGame\PreProcessedFiles\<Mod Name>
<p />
Note that ..\UTGame is also the root of where you save your mods.
<p />
Usage: ut3.exe make –intermediate
<p />
<h2><a name="TUTORIAL 9.4 – VISUAL DEBUG MODE, PART I: SETTING UP INCLUDE FILE"></a> TUTORIAL 9.4 – VISUAL DEBUG MODE, PART I: SETTING UP INCLUDE FILE </h2>
<p />
Throughout this series of tutorials, we will be creating a visual debugging system for the ambient creatures that is only compiled into the scripts when the –debug switch is used. This system will provide the ability to draw paths showing the creatures’ movements as well as other visual indicators such as boxes designating each creature’s location. This kind of feedback can be very useful when designing new classes, but it probably is not too useful to the designer when setting up the actors within a map. Add to that the fact that the methods that will be used will severely hinder performance and you may be able to see why we are choosing to make this conditional upon whether the –debug switch is used when compiling the scripts. As programmers, we have the ability to get immediate and clear feedback by compiling in –debug mode and, at the same time, we can compile out anything unnecessary to the designer to keep the setup process as easy and uncluttered as possible.
<p />
In this first tutorial, we will focus on setting up an include file that will contain a declaration of a new struct that will be used in both the AmbientCreature and AmbientCreatureInfo classes. In the AmbientCreatureInfo class, each CreatureInfo will have its own instance of this struct so visual feedback can be setup individually. The AmbientCreature class will have an instance of the struct to hold the properties passed from the AmbientCreatureInfo.
<p />
<strong>1.</strong>	Open ConTEXT and the AmbientCreature_Debug.uci file.
<p />
<strong>2.</strong>	The AmbienCreature_Debug.uci file currently contains the definition of the NewEditVar macro. It is perfectly fine if you want to leave this definition in the file, but you can feel free to remove it if you don’t want it to be in your way. It won’t be used anymore in this chapter.
<p />
Let’s start by setting up a declaration of a new struct named DebuggingInfo by adding these lines to the script:
<p />
<font face=consolas>
<pre>
struct DebuggingInfo
{
};
</pre>
</font>
<p />
<strong>3.</strong>	In order to declare the struct, we need to know what variables this struct will contain. For the most part, the variables in the struct will be Bool variables that will determine whether a specific visual indicator will be drawn. These variables are as follows:
<p /> <ul>
<li> bShowDebug – global toggle for all visual indicators
</li> <li> bShowFollowPaths – toggle for drawing paths of creatures in a flock
</li></ul>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_007.jpg"/><br/> <strong><font color=blue>Figure 9.7 – The paths of each creature in the flock are drawn.</font></strong>
<p /> <ul>
<li> bShowLeaderPaths – toggle for drawing paths of creatures leading a flock
</li></ul>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_008.jpg"/><br/> <strong><font color=blue>Figure 9.8 – The path of the creature leading the flock is drawn.</font></strong>
<p /> <ul>
<li> bShowFlockPaths – toggle for drawing links from creatures in a flock to their leader
</li></ul>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_009.jpg"/><br/> <strong><font color=blue>Figure 9.9 – A path is drawn from each creature in the flock to the leader.</font></strong>
<p /> <ul>
<li> bShowFlockBoxes – toggle for drawing boxes at locations of creatures in a flock
</li></ul>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_010.jpg"/><br/> <strong><font color=blue>Figure 9.10 – A box is drawn at the location of each creature in the flock.</font></strong>
<p /> <ul>
<li> bShowLeaderBoxes - toggle for drawing boxes at locations of creatures leading a flock
</li></ul>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_011.jpg"/><br/> <strong><font color=blue>Figure 9.11 – A box is drawn at the location of the leader if it is a creature.</font></strong>
<p /> <ul>
<li> bShowMesh – toggle for visibility of creatures
</li></ul>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_012.jpg"/><br/> <strong><font color=blue>Figure 9.12 – On the left the bShowMesh is True, on the right it is False.</font></strong>
<p />
Now we can simply add declarations for each of these variables inside the struct definition as shown below. Note that each of these variables should be declared as editable.
<p />
<font face=consolas>
<pre>
var() Bool bShowDebug;
var() Bool bShowFollowPaths;
var() Bool bShowFlockPaths;
var() Bool bShowLeaderPaths;
var() Bool bShowFlockBoxes;
var() Bool bShowLeaderBoxes;
var() Bool bShowMesh;
</pre>
</font>
<p />
<strong>4.</strong>	Before we move on, there are two more variables that will be necessary. Creatures within a flock store a series of locations defining the path of the leader. We could simply choose to draw a path only to the current location the creature is moving towards or we could draw the path using all of the locations. However, a more flexible solution would be to allow the length of the path, or the number of locations to be used when drawing the path, to be set using a property inside of the editor. An Int variable which we will name FollowPathSegments will be used to determine this value. Add the declaration for this variable now.
<p />
<font face=consolas>
<pre>
var() Int FollowPathSegments;
</pre>
</font>
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_013.jpg"/><br/> <strong><font color=blue>Figure 9.13 – Paths drawn with various values for the FollowPathSegments property.</font></strong>
<p />
<strong>5.</strong>	A color must be specified when drawing these paths as well. Since it is possible that there will be multiple flocks of creatures in a scene at one time, you can imagine how confusing it would get if the paths were all drawn with the same color. We can add a Color variable named FollowPathColor to allow each flock of creatures to have their own custom set color for the paths of the creatures belonging to that flock.
<p />
<font face=consolas>
<pre>
var() Color FollowPathColor;
</pre>
</font>
<p />
<strong>6.</strong>	The final part of the struct definition will be to set default values for the last two variables that were declared. A value of 6 for the FollowPathSegments property should be a good starting point and we will have paths be drawn using a teal color by default. Add the structdefaultproperties block with these default values as shown:
<p />
<font face=consolas>
<pre>
structdefaultproperties
{
   FollowPathSegments&#61;6
   FollowPathColor&#61;(R&#61;0,G&#61;255,B&#61;255)
}
</pre>
</font>
<p />
<strong>7.</strong>	Save the AmbientCreature_Debug.uci file.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="TUTORIAL 9.5 – VISUAL DEBUG MODE, PART II: CONDITIONAL INCLUDE STATEMENT"></a> TUTORIAL 9.5 – VISUAL DEBUG MODE, PART II: CONDITIONAL INCLUDE STATEMENT </h2>
<p />
In this tutorial, the file that was set up in the previous tutorial will be included in the AmbientCreature and AmbientCreatureInfo classes based on whether the –debug switch is used when compiling. Also, we will declare an instance of the DebuggingInfo struct in each class.
<p />
<strong>1.</strong>	Open ConTEXT as well as the AmbientCreature.uc and AmbientCreatureInfo.uc files.
<p />
<strong>2.</strong>	In the AmbientCreature class after the class declaration, we can include the AmbientCreature_Debug.uci file which will essentially declare the DebuggingInfo struct in the class. First, we need to make sure the include only happens when the –debug switch is used during the compiling process. As we learned earlier in the chapter, when the –debug switch is used, the debug macro is defined. We can use an `if macro along with the `isdefined macro to check for the debug macro being defined and then place the include statement inside of the `if statement.
<p />
Set up the `if statement to check for the –debug switch as follows:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
`endif
</pre>
</font>
<p />
Now, after the `if line and before the `endif line, place the include statement:
<p />
<font face=consolas>
<pre>
`include(AmbientCreature&#95;Debug.uci)
</pre>
</font>
<p />
The final section of code should now appear like so:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
`include(AmbientCreature&#95;Debug.uci)
</pre>
</font>
`endif
<p />
<strong>3.</strong>	We also need to declare an instance of the DebuggingInfo struct which we will name DebugInfo. This will be conditional as well so we may as well place the declaration inside the same `if statement. Add the declaration now.
<p />
<font face=consolas>
<pre>
var DebuggingInfo DebugInfo;
</pre>
</font>
<p />
The `if statement should now appear as shown:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
`include(AmbientCreature&#95;Debug.uci)
var DebuggingInfo DebugInfo;
`endif
</pre>
</font>
<p />
<strong>4.</strong>	Copy this block of code by pressing Ctrl+C.
<p />
<strong>5.</strong>	In the AmbientCreatureInfo class after the class declaration, paste the block of code by pressing Ctrl+V.
<p />
<strong>6.</strong>	It was mentioned earlier that the instance of the DebuggerInfo in the AmbientCreatureInfo class would be placed inside the CreatureInfo struct so each group of creatures has its own instance. Select the declaration of the DebugInfo variable and cut it by pressing Ctrl+X.
<p />
<strong>7.</strong>	In the definition of the CreatureInfo struct after the last variable declaration (probably FlockInfo), paste the DebugInfo declaration and enclose it with the same `if statement used for the include statement. Make sure to make this DebugInfo variable editable as well. The new block of code should appear as shown below:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
var() DebuggingInfo DebugInfo;
`endif
</pre>
</font>
<p />
The CreatureInfo should appear similar to the following:
<p />
<font face=consolas>
<pre>
struct CreatureInfo
{
   var array&#60;AmbientCreature&#62; MyCreatures;
   var() class&#60;AmbientCreature&#62; CreatureClass;
   var() array&#60;AmbientCreatureNode&#62; CreatureNodes;
   var() Int NumCreatures;
   var() Float MinTravelTime,MaxTravelTime;
   var() Float Speed;
   var() DisplayInfo DisplayInfo;
   var() FlockInfo FlockInfo;
   `if(`isdefined(debug))
   var() DebuggingInfo DebugInfo;
   `endif

   structdefaultproperties
   {
      MinTravelTime&#61;0.25
      MaxTravelTime&#61;4.0
      Speed&#61;70
      NumCreatures&#61;1
   }
};
</pre>
</font>
<p />
<strong>8.</strong>	Save both of the files. In order to see if the new code is working properly, we need to compile the scripts. To make it easier to see the results, though, we can make use of the –intermediate switch when compiling in addition to the –debug switch that will obviously be needed. To use these switches, you must use a method of compiling that allows switches to be set. These methods include:
<p /> <ul>
<li> Using the command line
</li> <li> Using a shortcut with a custom Target
</li> <li> Setting up an Exec key in ConTEXT
</li></ul>
<p />
Whichever method you choose to use, you must add both the –debug and –intermediate switches. This might look like the following:
<p />
<font face=consolas>
<pre>
C:\Program Files\Unreal Tournament 3\Binaries&#62; UT3.exe make –debug -intermediate
</pre>
</font>
<p />
<strong>9.</strong>	Once the scripts finish compiling, navigate to the PreProcessedFiles directory which is now present in your ..\My Games\Unreal Tournament 3\UTGame directory. In this folder, you will find the intermediate versions of the scripts. Open the AmbientCreature.UC and AmbientCreatureInfo.UC files. The DebuggingInfo struct definition and the DebugInfo variable declaration should appear in the script signifying the process worked as expected.
<p />
<strong>10.</strong>	Just to be sure, compile the scripts again without the –debug switch this time. Reopen the intermediate files and note that the DebuggingInfo definition and DebugInfo declaration are not present this time.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="TUTORIAL 9.6 – VISUAL DEBUG MODE, PART III: GLOBAL BSHOWDEBUG AND CREATURE VARIABLE INITIALIZATION"></a> TUTORIAL 9.6 – VISUAL DEBUG MODE, PART III: GLOBAL BSHOWDEBUG AND CREATURE VARIABLE INITIALIZATION </h2>
<p />
<strong>1.</strong>	Open ConTEXT and the AmbientCreatureInfo.uc file.
<p />
<strong>2.</strong>	Find the line where the MyCreatureInfos array is declared. Just before this line, we are going to declare a Bool variable named bShowDebug that will act as a global toggle for all the visual indicators for all CreatureInfos within the MyCreatureInfos array. As before, this will be conditional upon whether the –debug switch is used. Declare this variable now as shown:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
var() Bool bShowDebug;
`endif
</pre>
</font>
<p />
<strong>3.</strong>	Now we can begin initializing the values of the creatures’ variables based on the values set in the CreatureInfo. In the PostBeginPlay() function after the FollowType switch statement, set up the `if statement to make this code condition upon the –debugswitch being used.
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
`endif
</pre>
</font>
<p />
<strong>4.</strong>	The variable initialization will only take place if the global bShowDebug variable is set to true. Create an If statement inside the preprocessor `if statement checking the value of this variable.
<p />
<font face=consolas>
<pre>
if(bShowDebug)
{
}
</pre>
</font>
<p />
<strong>5.</strong>	Inside this If statement, set the values of the creatures’ variables as shown below.
<p />
<font face=consolas>
<pre>
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowDebug&#61;MyCreatureInfos&#91;i].DebugInfo.bShowDebug;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowFollowPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowFollowPaths;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowFlockPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowFlockPaths;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowLeaderPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowLeaderPaths;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowFlockBoxes&#61;MyCreatureInfos&#91;i].DebugInfo.bShowFlockBoxes;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowLeaderPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowLeaderPaths;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowMesh&#61;MyCreatureInfos&#91;i].DebugInfo.bShowMesh;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.FollowPathSegments&#61;MyCreatureInfos&#91;i].DebugInfo.FollowPathSegments;;
MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.FollowPathColor&#61;MyCreatureInfos&#91;i].DebugInfo.FollowPathColor;
</pre>
</font>
<p />
The complete block of code should now appear like so:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(bShowDebug)
{
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowDebug&#61;MyCreatureInfos&#91;i].DebugInfo.bShowDebug;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowFollowPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowFollowPaths;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowFlockPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowFlockPaths;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowLeaderPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowLeaderPaths;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowFlockBoxes&#61;MyCreatureInfos&#91;i].DebugInfo.bShowFlockBoxes;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowLeaderPaths&#61;MyCreatureInfos&#91;i].DebugInfo.bShowLeaderPaths;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.bShowMesh&#61;MyCreatureInfos&#91;i].DebugInfo.bShowMesh;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.FollowPathSegments&#61;MyCreatureInfos&#91;i].DebugInfo.FollowPathSegments;;
   MyCreatureInfos&#91;i].MyCreatures&#91;j].DebugInfo.FollowPathColor&#61;MyCreatureInfos&#91;i].DebugInfo.FollowPathColor;
}
`endif
</pre>
</font>
<p />
<strong>6.</strong>	Save the file to preserve your progress.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="TUTORIAL 9.7 - VISUAL DEBUG MODE, PART IV: HIDING MESHES"></a> TUTORIAL 9.7 - VISUAL DEBUG MODE, PART IV: HIDING MESHES </h2>
<p />
<strong>1.</strong>	Open ConTEXT as well as the AmbientCreature.uc and AmbientCreature_Fish.uc files.
<p />
<strong>2.</strong>	At the end of the Initialize() function of the AmbientCreature class, add the standard `if statement to check for the –debug switch.
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
`endif
</pre>
</font>
<p />
<strong>3.</strong>	Inside this statement, we need to check that the creature’s bShowDebug value is True and that the bShowMesh value is false, meaning we should hide the mesh. Create an If statement performing this check now.
<p />
<font face=consolas>
<pre>
if(DebugInfo.bShowDebug &#38;&#38; !DebugInfo.bShowMesh)
{
}
</pre>
</font>
<p />
<strong>4.</strong>	Set the creature to be hidden inside the If statement by adding the following function call:
<p />
<font face=consolas>
<pre>
SetHidden(true);
</pre>
</font>
<p />
This function call is used because the bHidden variable cannot be set directly.
<p />
The final block of code should now appear like so:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(DebugInfo.bShowDebug &#38;&#38; !DebugInfo.bShowMesh)
{
   SetHidden(true);
}
`endif
</pre>
</font>
<p />
<strong>5.</strong>	We have set the mesh to be hidden when needed, but this only applies to the base AmbientCreature class. We need to copy this block of code to the AmbientCreature_Fish class as well. Select the block of code and copy it by pressing Ctrl+C.
<p />
<strong>6.</strong>	In the Initialize() function of the AmbientCreature_Fish class, paste the block of code at the end of the function by pressing Ctrl+V.
<p />
<strong>7.</strong>	Save the files to preserve your progress.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="TUTORIAL 9.8 - VISUAL DEBUG MODE, PART V: DRAWING LEADER INDICATORS"></a> TUTORIAL 9.8 - VISUAL DEBUG MODE, PART V: DRAWING LEADER INDICATORS </h2>
<p />
<strong>1.</strong>	Open ConTEXT and the AmbientCreature.uc file.
<p />
<strong>2.</strong>	Inside the main If block of the Tick() function after the Velocity is set, add the `if statement to check for the –debug switch as well as an If statement to check that the bShowDebug value of the creature is True.
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(DebugInfo.bShowDebug)
{
}
`endif
</pre>
</font>
<p />
<strong>3.</strong>	In order to draw the paths for a creature leading a flock, we first need to check to make sure the bShowLeaderPaths variable is set to True.
<p />
<font face=consolas>
<pre>
if(DebugInfo.bShowLeaderPaths)
</pre>
</font>
<p />
Once that is done, we can make use of the DrawDebugLine() function, one of several debug drawing functions found in the Actor class, to draw a line designating the current path of the creature. This function requires the following information: a starting point, an end point, a color, and whether the line should be persistent or only last the current frame. Add the function call as shown below:
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_014.jpg"/><br/> <strong><font color=blue>Figure 9.14 – The resulting line from using the DrawDebugLine() function.</font></strong>
<p />
Add the function call as shown below:
<p />
<font face=consolas>
<pre>
DrawDebugLine(Location,MoveLocation,0,255,0,false);
</pre>
</font>
<p />
the full block of code should now appear as follows:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(DebugInfo.bShowDebug)
{
   if(DebugInfo.bShowLeaderPaths)
      DrawDebugLine(Location,MoveLocation,0,255,0,false);
}
`endif
</pre>
</font>
<p />
<strong>4.</strong>	You may notice something. MoveLocation does not currently exist in the AmbientCreature class. This is because there is no variable holding the current destination of the creature when they are not using flocking behavior. We need to make a small change to the class itself to make this information available. Add a Vector variable named MoveLocation to the class by adding this declaration to the class variable declarations.
<p />
<font face=consolas>
<pre>
var Vector MoveLocation;
</pre>
</font>
<p />
<strong>5.</strong>	Now, in the SetDest() function, find the line shown below:
<p />
<font face=consolas>
<pre>
MoveOffset &#61; Normal(VRand()) &#42; inNode.Radius;
</pre>
</font>
<p />
After this line, add the following line to set the MoveLocation variable:
<p />
<font face=consolas>
<pre>
MoveLocation &#61; inNode.Location + MoveOffset;
</pre>
</font>
<p />
<strong>6.</strong>	Back in the Tick() function, we will now draw the boxes showing the location of the creature. After the last If statement that was added, create a new If statement checking the value of the bShowLeaderBoxes, like so:
<p />
<font face=consolas>
<pre>
if(DebugInfo.bShowLeaderBoxes)
</pre>
</font>
<p />
<strong>7.</strong>	This time, we will use another function, DrawDebugBox() to draw the visual indicator. This function requires an origin, an extent, a color, and whether the box is persistent or not. We could set up hard-coded values for the origin and extent if we wished, but the StaticMeshComponent already contains these values within its Bounds variable and using them will give us an accurate representation of the creature regardless of its size or orientation. Add the function call as shown below:
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_015.jpg"/><br/> <strong><font color=blue>Figure 9.15 – A wireframe box as drawn by the DrawDebugBox() function.</font></strong>
<p />
We could set up hard-coded values for the origin and extent if we wished, but the StaticMeshComponent already contains these values within its Bounds variable and using them will give us an accurate representation of the creature regardless of its size or orientation. Add the function call as shown below:
<p />
<font face=consolas>
<pre>
DrawDebugBox(DisplayMesh.Bounds.Origin,DisplayMesh.Bounds.BoxExtent,255,0,0,false);
</pre>
</font>
<p />
The full block of code drawing the leader visual indicators should now appear as shown below:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(DebugInfo.bShowDebug)
{
   if(DebugInfo.bShowLeaderPaths)
      DrawDebugLine(Location,MoveLocation,0,255,0,false);

   if(DebugInfo.bShowLeaderBoxes)
      DrawDebugBox(DisplayMesh.Bounds.Origin,DisplayMesh.Bounds.BoxExtent,255,0,0,false);
}
`endif
</pre>
</font>
<p />
<strong>8.</strong>	Save the file to preserve your progress.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="TUTORIAL 9.9 - VISUAL DEBUG MODE, PART VI: FLOCK VISUAL INDICATORS"></a> TUTORIAL 9.9 - VISUAL DEBUG MODE, PART VI: FLOCK VISUAL INDICATORS </h2>
<p />
<strong>1.</strong>	Open ConTEXT and the AmbientCreature.uc file.
<p />
<strong>2.</strong>	Inside the main else block of the Tick() function before any of the other code contained within that block, add the `if statement to check for the –debug switch as well as an If statement to check that the bShowDebug value of the creature is True.
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(DebugInfo.bShowDebug)
{
}
`endif
</pre>
</font>
<p />
<strong>3.</strong>	Drawing the follow paths is a little more complicated than the leader paths as there can be multiple segments. We will do this in two parts. The first part will be to draw a line from the creature to the first location in the LastLocation array. The second part will be to draw the remaining segments within a loop.
<p />
Create an If statement checking to see if the bShowFollowPaths variable is set to true.
<p />
<font face=consolas>
<pre>
if(DebugInfo.bShowFollowPaths)
{
}
</pre>
</font>
<p />
<strong>4.</strong>	Inside the If statement, draw the first segment of the follow path by adding the following code:
<p />
<font face=consolas>
<pre>
DrawDebugLine(Location,
      LastLocation&#91;0] + DistOffset,
      DebugInfo.FollowPathColor.R,
      DebugInfo.FollowPathColor.G,
      DebugInfo.FollowPathColor.B,
      false);
</pre>
</font>
<p />
<strong>5.</strong>	Now we will loop through the LastLocation array and draw segments between the locations stored within the array, but we will limit it to the amount of segments specified by the FollowPathSegments variable. Add this loop now:
<p />
<font face=consolas>
<pre>
for(i&#61;1;i&#60;Min(LastLocation.Length,DebugInfo.FollowPathSegments);i++)
{
   DrawDebugLine(LastLocation&#91;i-1] + DistOffset,
         LastLocation&#91;i] + DistOffset,
         DebugInfo.FollowPathColor.R,
         DebugInfo.FollowPathColor.G,
         DebugInfo.FollowPathColor.B,
         false);
</pre>
</font>
}
<p />
<strong>6.</strong>	We are using a variable, i, that does not currently exist. At the beginning of the Tick() function add a local variable declaration for this variable within an `if statement that checks for the –debug switch, like so:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
local int i;
`endif
</pre>
</font>
<p />
<strong>7.</strong>	Now, check to see if the bShowFlockPaths variable is True and draw a line from the creature’s location to its Leader’s Location.
<p />
<font face=consolas>
<pre>
if(DebugInfo.bShowFlockPaths)
   DrawDebugLine(Location,Leader.Location,0,0,0,false);
</pre>
</font>
<p />
<strong>8.</strong>	Finally, check to see if the bShowFlockBoxes variable is True anddraw a box at the creature’s Location.
<p />
<font face=consolas>
<pre>
if(DebugInfo.bShowFlockBoxes)
{
   DrawDebugBox(DisplayMesh.Bounds.Origin,
         DisplayMesh.Bounds.BoxExtent,
         255,
         160,
         0,
         false);
</pre>
</font>
}
<p />
<strong>9.</strong>	The final block of code for drawing the flock visual indicators should appear as follows:
<p />
<font face=consolas>
<pre>
`if(`isdefined(debug))
if(DebugInfo.bShowDebug)
{
   if(DebugInfo.bShowFollowPaths)
   {
      DrawDebugLine(Location,
            LastLocation&#91;0] + DistOffset,
            DebugInfo.FollowPathColor.R,
            DebugInfo.FollowPathColor.G,
            DebugInfo.FollowPathColor.B,
            false);
      for(i&#61;1;i&#60;Min(LastLocation.Length,DebugInfo.FollowPathSegments);i++)
      {
         DrawDebugLine(LastLocation&#91;i-1] + DistOffset,
               LastLocation&#91;i] + DistOffset,
               DebugInfo.FollowPathColor.R,
               DebugInfo.FollowPathColor.G,
               DebugInfo.FollowPathColor.B,
               false);
      }
   }

   if(DebugInfo.bShowFlockPaths)
      DrawDebugLine(Location,Leader.Location,0,0,0,false);

   if(DebugInfo.bShowFlockBoxes)
   {
      DrawDebugBox(DisplayMesh.Bounds.Origin,
            DisplayMesh.Bounds.BoxExtent,
            255,
            160,
            0,
            false);
   }
}
`endif
</pre>
</font>
<p />
<strong>10.</strong>	Save the file to preserve your progress.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="TUTORIAL 9.10 - VISUAL DEBUG MODE, PART VII: TESTING"></a> TUTORIAL 9.10 - VISUAL DEBUG MODE, PART VII: TESTING </h2>
<p />
<strong>1.</strong>	Compile the scripts using the –debug switch.
<p />
<strong>2.</strong>	Open UnrealEd and open the DM-CH_09_Debug.ut3 map.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_016.jpg"/><br/> <strong><font color=blue>Figure 9.16 – The DM-CH_09_Debug.ut3 map.</font></strong>
<p />
<strong>3.</strong>	Add an AmbientCreatureInfo actor to the map and add at least one item to the MyCreatureInfos array.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_017.jpg"/><br/> <strong><font color=blue>Figure 9.17 – The new AmbientCreatureInfo actor is added.</font></strong>
<p />
<strong>4.</strong>	Set up the creatures to your liking. Then, set the global bShowDebug variable and the bShowDebug variable in the DebugInfo section of each item in the array to True.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_018.jpg"/><br/> <strong><font color=blue>Figure 9.18 – Both bShowDebug properties are set to True.</font></strong>
<p />
<strong>5.</strong>	Play with the various settings in the DebugInfo section and then play the map in the editor to see the results. You should see the visual indicators created throughout the chapter.
<p />
<img src="rsrc/Three/MasteringUnrealScriptPreProcessor/CH_09_FIGURE_019.jpg"/><br/> <strong><font color=blue>Figure 9.19 – An example of a flock showing the indicators added in this chapter.</font></strong>
<p />
It should be obvious how these could be extremely helpful when doing the initial coding for a system such as this. Logging data to the Log file is extremely useful as well, but sometimes visual feedback is needed to really see what is going on.
<p />
<strong><font color="orange">&lt;&lt;&lt;&lt; End of Tutorial &gt;&gt;&gt;&gt;</font></strong>
<p />
<h2><a name="9.5 SUMMARY"></a> 9.5 SUMMARY </h2>
<p />
The ability to use preprocessor commands in UnrealScript may not be the most widely used feature of the language, but it provides an added dimension that can be immensely useful in certain circumstances. Many of its uses are limited to licensees building games, such as the ability to conditionally include code based on the platform the game is currently being compiled for or the type of release (i.e., debug, final_release, etc.). This does not mean that it doesn’t have its uses in the mod world as we have demonstrated in this chapter. Being able to define macros and include files can make repetitive tasks much easier and more efficient.
<p />
<h2><a name="SUPPLEMENTAL FILES"></a> SUPPLEMENTAL FILES </h2>
<p /> <ul>
<li> <a href="rsrc/Three/MasteringUnrealScriptPreProcessor/Chapter9_CompleteSource.rar" target="_top">Chapter9_CompleteSource.rar</a>: Complete Source Files
</li></ul>
<p /> <ul>
<li> <a href="rsrc/Three/MasteringUnrealScriptPreProcessor/DM-CH_09_Debug.rar" target="_top">DM-CH_09_Debug.rar</a>: DM-CH_09_Debug.ut3 map
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
