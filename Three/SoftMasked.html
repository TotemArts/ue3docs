<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | SoftMasked    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">SoftMasked  </b></div>
<div id="tooltext">
<a href="SoftMaskedJP.html" class="twikiLink">日本語訳</a><br><a href="SoftMaskedCH.html" class="twikiLink">中国翻译</a><br><a href="SoftMaskedKR.html" class="twikiLink">한국어</a><br>

<!-- Three/SoftMasked -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="MaterialsAndTexturesHome.html" class="twikiLink">Materials &amp; Textures</a></b> &gt; SoftMasked Blend Mode
</div>
<hr size="1" noshade="noshade">
<h1><a name="SoftMasked Blend Mode"></a> SoftMasked Blend Mode </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="SoftMasked.html#SoftMasked Blend Mode"> SoftMasked Blend Mode</a> <ul>
<li> <a href="SoftMasked.html#Overview"> Overview</a>
</li> <li> <a href="SoftMasked.html#How to activate and tweak"> How to activate and tweak</a>
</li> <li> <a href="SoftMasked.html#Good content"> Good content</a>
</li> <li> <a href="SoftMasked.html#Performance"> Performance </a> <ul>
<li> <a href="SoftMasked.html#GPU"> GPU</a>
</li> <li> <a href="SoftMasked.html#CPU"> CPU</a>
</li></ul>
</li> <li> <a href="SoftMasked.html#Limitations"> Limitations</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
This page explains the <strong>SoftMasked</strong> material blending mode. It can be used instead of <strong>Masked</strong> to limit aliasing that is caused by the hard comparison done there (A pixel is either fully opaque or translucent). It solves the anti-aliasing problem of masked content is many cases. In some cases it falls back to a result similar to <strong>Masked</strong>. When used with care it can greatly improve the rendering quality of vegetation.
<p />
Transparent rendering allows to render the same content much softer but has other limitations (Doesn't affect depth of field, fog and no correct z occlusion). SoftMasked tries to combine the two methods keeping most of the benefits of both of them. The difference is less noticeable in screen-shots but more in motion as aliasing of <strong>Masked</strong> content appears to change depending on the viewer position and with animated content.
<p />
Here is how <strong>SoftMasked</strong> looks like when used on vegetation:<br>
<img src="rsrc/Three/SoftMasked/SoftMaskedGras.jpg" alt="SoftMaskedGras.jpg" width='640' height='422' />
<p />
Notice the soft grass and how the leafs appear anti-aliased where the texture defines the border. Additionally ambient occlusion appears to be nicer as further grass contributes less to the depth buffer and therefore has less noisy SSAO artifacts.
<p />
This is the same content with the classic <strong>Masked</strong> material blend mode:<br>
<img src="rsrc/Three/SoftMasked/MaskedGras.jpg" alt="MaskedGras.jpg" width='640' height='422' />
<p />
<h2><a name="How to activate and tweak"></a> How to activate and tweak </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<img src="rsrc/Three/SoftMasked/MaterialEditor.jpg" alt="MaterialEditor.jpg" width='716' height='266' />
<p />
The method can be activated simply by setting the <strong>Blend Mode</strong> in the Material Editor to <strong>Blend_SoftMasked</strong>. For good results, it is best to change the <strong>Opacity Mask Clip Value</strong> to a value near <strong>0.7</strong> (useful range is from 0.4 to 0.9). Higher values allow to use more of the soft transition but it also reduces the amount that is rendered in the classic <strong>Masked</strong> way (with the correct pixel depth for fog and Depth of Field).
<p />
<h2><a name="Good content"></a> Good content </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Magnification of the texture means the texture resolution is lower than the pixel size on the screen. This should be avoided as the border of the object becomes bigger and sorting issues and fogging problems might become bigger than a pixel on the screen and therefore more noticeable.
<p />
<img src="rsrc/Three/SoftMasked/MagMiniFied.jpg" alt="MagMiniFied.jpg" width='640' height='360' />
<p />
The texture of the leafs on the left are magnified and the right ones not. Here Mipmapping together with a good black and white mask results in good anti-aliasing on the borders (This image doesn't show the problems).
<p />
Even without magnification the border can be big if the texture content has bigger areas with gray-scale content. This can often be avoided. Masked content anyway was resulting in a binary mask so the content can be altered to avoid big transition areas without affecting the result much (compared to Masked). This modification can be done in Photoshop. We use the following example of a bad texture mask:
<p />
     <img src="rsrc/Three/SoftMasked/BadLeafMask.jpg" alt="BadLeafMask.jpg" width='356' height='270' />
<p />
In <strong>Masked</strong> this texture would be ok as all brighter than the threshold is opaque. In <strong>SoftMasked</strong> the grey parts would partly shine through and some might suffer from wrong sorting and fogging. The background of the content isn't even black which means all triangles appear to be partially occluding even in areas where they shouldn't. A good  mask would look like that (Here the grey areas are minimized and the results are as good as possible):
<p />
     <img src="rsrc/Three/SoftMasked/GoodLeafMask.jpg" alt="GoodLeafMask.jpg" width='356' height='270' />
<p />
To repair a texture quickly a few steps in Photoshop can be performed:
<p /> <ul>
<li> Make sure the mask is visible (RGB or alpha channel)
</li> <li> Change <strong>Image Size</strong> to 400% (horizontal and vertical). Make sure <strong>Resample image</strong> is set to <strong>bilinear</strong>.
</li> <li> Optionally blur the image a bit (e.g. Gaussian blur 2.5 pixel)
</li> <li> Apply <strong>Adjustments</strong> <strong>Threshold</strong>, tweak depending on content (In Masked this was tweaked with the <strong>Opacity Clip Mask</strong> value.)
</li> <li> Change <strong>Image Size</strong> to 25% (horizontal and vertical). Make sure <strong>Resample image</strong> is set to <strong>bilinear</strong>.
</li></ul>
<p />
This is how the resulting image looks like:
<p />
     <img src="rsrc/Three/SoftMasked/BadLeafRepairedMask.jpg" alt="BadLeafRepairedMask.jpg" width='356' height='270' />
<p />
<p />
<h2><a name="Performance"></a> Performance </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The method has good performance but is slower in CPU and GPU performance compared to <strong>Masked</strong>. It's also slower than Transparent because if required two passes.
<p />
<h3><a name="GPU"></a> GPU </h3>
<p />
Very little extra pixel shader instructions are required. The geometry needs to be rendered twice (EarlyZ and Base pass, possibly shadowmaps). The blending operation with the frame buffer should be neglectable on Xbox360 but might be noticeable on other hardware when using short shaders. For the base pass the objects needs to be rendered sorted from back to front.
<p />
<h3><a name="CPU"></a> CPU </h3>
The required sorting adds additional overhead to the CPU rendering cost (sorting function, more state changes). This is view dependent and is worse when multiple different materials needs to be rendered interleaved.
<p />
<h2><a name="Limitations"></a> Limitations </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p /> <ul>
<li> The current implementation is at an early stage to evaluable the potential and to be able to use it on Xbox360. Further improvements can solve some of the limitations but the additional cost might be a noticeable performance drop. A Xbox360 like preview for PC would be useful and could be one of next improvements.
</li> <li> The current implementation only works well on Xbox360 and there only for ambient lighting and one dominant light (sun)!
</li> <li> On PC it only works for the ambient lighting. Overlapping soft masked borders affected by the dominant light appear to be too bright. This is very noticeable on grass and less on less occluding objects.
</li> <li> It's currently considered unsupported for Playstation 3 and shader model 4.
</li> <li> <strong>SoftMasked</strong> rendering doesn't support more lights than ambient and one directional light<br>     (All <strong>SoftMasked</strong> objects need to be rendered in single pass otherwise the border appear to be too bright, as it can be seen on PC).
</li> <li> Shadows are only supported on XBox360 and only from the single dominant light.
</li> <li> Fog<br>     <strong>SoftMasked</strong> only affects the depth buffer only in areas of maximum opacity. As the fog rendering is based on the depth buffer some pixels become fogged too much. Tweaking the <strong>Opacity Mask Clip</strong> value to be smaller helps but then the result appears to be less soft. This problem can be seen in the following image (first is <strong>SoftMasked</strong>, second is <strong>Masked</strong>).
</li></ul>
<p />
     <img src="rsrc/Three/SoftMasked/SoftMakskedTree.jpg" alt="SoftMakskedTree.jpg" width='291' height='362' />
     <img src="rsrc/Three/SoftMasked/MaskedTree.jpg" alt="MaskedTree.jpg" width='291' height='362' />
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
