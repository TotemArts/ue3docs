<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | DevelopmentKitGemsCreatingAMouseInterface    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">DevelopmentKitGemsCreatingAMouseInterface  </b></div>
<div id="tooltext">
<a href="DevelopmentKitGemsCreatingAMouseInterfaceJP.html" class="twikiLink">日本語訳</a><br><a href="DevelopmentKitGemsCreatingAMouseInterfaceCH.html" class="twikiLink">中国翻译</a><br><a href="DevelopmentKitGemsCreatingAMouseInterfaceKR.html" class="twikiLink">한국어</a><br>

<!-- Three/DevelopmentKitGemsCreatingAMouseInterface -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="DevelopmentKitGems.html" class="twikiLink">Unreal Development Kit Gems</a></b> &gt; Creating a mouse interface <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="UIAndHUDHome.html" class="twikiLink">User Interfaces &amp; HUDs</a></b> &gt; Creating a mouse interface
</div>
<hr size="1" noshade="noshade">
<h1><a name="Creating a mouse interface"></a> Creating a mouse interface </h1>
<hr size="1" noshade="noshade">
<p />
<strong><em>Last tested against UDK Apr, 2011</em></strong>
<br>
<strong><em>PC compatible</em></strong>
<p />
<div class="twikiToc"> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Creating a mouse interface"> Creating a mouse interface</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Overview"> Overview</a>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Getting a cursor on the screen"> Getting a cursor on the screen</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Unrealscript"> Unrealscript</a>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#ScaleForm"> ScaleForm</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Related Topics"> Related Topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#I just want the mouse 2D coordinates!"> I just want the mouse 2D coordinates!</a>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Adding the mouse interaction interface"> Adding the mouse interaction interface</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Using the _PlayerController and HUD to provide the mouse interaction"> Using the PlayerController and HUD to provide the mouse interaction</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#I just want to get the mouse 3D coordinates!"> I just want to get the mouse 3D coordinates!</a>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Adding the Kismet Mouse Input Event"> Adding the Kismet Mouse Input Event</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Adding a subclassed KActor as an example"> Adding a subclassed KActor as an example</a>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Using the Kismet Mouse Input Event"> Using the Kismet Mouse Input Event</a> <ul>
<li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsCreatingAMouseInterface.html#Downloads"> Downloads</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
By default Unreal Engine is designed as a first person shooter engine. However, with the right code it is entirely possible to create many other game genres with it as well, such as real time strategy games.
<p />
<h2><a name="Getting a cursor on the screen"></a> Getting a cursor on the screen </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
Adding a cursor onto the screen involves adding a few new scripts. Because UIScene was removed, the old methods for extracting the mouse position are now invalid. There are two methods that you could do this; Unrealscript and ScaleForm.
<p />
<h3><a name="Unrealscript"></a> Unrealscript </h3>
It is possible to create your own mouse positioning code. This is done by adding a custom player input which polls <strong>aMouseX</strong> and <strong>aMouseY</strong> to see if there has been any changes. If there has been a change, it is appended to the <strong>MousePosition</strong> variable and then clamped to keep the mouse cursor within the screen bounds.
<p />
This is the new game info. It is a simple GameInfo which defines the HUD class and PlayerController class to use.
<p />
<div class="codetitlebar">
MouseInterfaceGameInfo.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfaceGameInfo extends GameInfo;

defaultproperties
{
  // Set the HUD type to the mouse interface HUD
  HUDType&#61;class&#39;MouseInterfaceHUD&#39;
  // Set the player controller to the mouse interface Player Controller
  PlayerControllerClass&#61;class&#39;MouseInterfacePlayerController&#39;
}
</pre>
</div>
<p />
This is the new hud which will be used to render the mouse cursor on the screen. You could use a material if you wanted to as well.
<p />
<div class="codetitlebar">
MouseInterfaceHUD.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfaceHUD extends HUD;

// The texture which represents the cursor on the screen
var const Texture2D CursorTexture;
// The color of the cursor
var const Color CursorColor;

event PostRender()
{
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;

  // Ensure that we have a valid PlayerOwner and CursorTexture
  if (PlayerOwner !&#61; None &#38;&#38; CursorTexture !&#61; None)
  {
    // Cast to get the MouseInterfacePlayerInput
    MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

    if (MouseInterfacePlayerInput !&#61; None)
    {
      // Set the canvas position to the mouse position
      Canvas.SetPos(MouseInterfacePlayerInput.MousePosition.X, MouseInterfacePlayerInput.MousePosition.Y);
      // Set the cursor color
      Canvas.DrawColor &#61; CursorColor;
      // Draw the texture on the screen
      Canvas.DrawTile(CursorTexture, CursorTexture.SizeX, CursorTexture.SizeY, 0.f, 0.f, CursorTexture.SizeX, CursorTexture.SizeY,, true);
    }
  }

  Super.PostRender();
}

defaultproperties
{
  CursorColor&#61;(R&#61;255,G&#61;255,B&#61;255,A&#61;255)
  CursorTexture&#61;Texture2D&#39;EngineResources.Cursors.Arrow&#39;
}
</pre>
</div>
<p />
The logic behind the code is as follows: <ul>
<li> When PostRender is executed we get the new PlayerInput from the PlayerOwner, which is a PlayerController.
</li> <li> If we have our new PlayerInput, we then set the Canvas position to the MousePosition stored inside our new PlayerInput.
</li> <li> We then set the color to the cursor color defined in the default properties.
</li> <li> Finally, we draw the texture which represents the mouse cursor.
</li></ul>
<p />
This is the new player controller that defines the new PlayerInput to use. UpdateRotation is stubbed as the original function is not required for this gem.
<p />
<div class="codetitlebar">
MouseInterfacePlayerController.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfacePlayerController extends PlayerController;

// Null this function
function UpdateRotation(float DeltaTime);

defaultproperties
{
  // Set the input class to the mouse interface player input
  InputClass&#61;class&#39;MouseInterfacePlayerInput&#39;
}
</pre>
</div>
<p />
This is the new player input.
<p />
<div class="codetitlebar">
MouseInterfacePlayerInput.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfacePlayerInput extends PlayerInput;

// Stored mouse position. Set to private write as we don&#39;t want other classes to modify it, but still allow other classes to access it.
var PrivateWrite IntPoint MousePosition;

event PlayerInput(float DeltaTime)
{
  // Handle mouse
  // Ensure we have a valid HUD
  if (myHUD !&#61; None)
  {
    // Add the aMouseX to the mouse position and clamp it within the viewport width
    MousePosition.X &#61; Clamp(MousePosition.X + aMouseX, 0, myHUD.SizeX);
    // Add the aMouseY to the mouse position and clamp it within the viewport height
    MousePosition.Y &#61; Clamp(MousePosition.Y - aMouseY, 0, myHUD.SizeY);
  }

  Super.PlayerInput(DeltaTime);
}

defaultproperties
{
}
</pre>
</div>
<p />
The logic behind the code is as follows: <ul>
<li> When PlayerInput is executed, we handle adjust the mouse position.
</li> <li> The HUD is required to clamp the mouse position within the viewport. As the PlayerInput is an object within the PlayerController, we can access the variable within the PlayerController directly.
</li> <li> Using aMouseX and aMouseY which is bound within the input config, we add those values to our MousePosition variable. We have to inverse the vertical calculations to produce the right results.
</li> <li> By clamping the results, we make sure that the mouse position always stays within the viewport.
</li></ul>
<p />
Compile. Create a new map, and set the PIE GameInfo to MouseInterfaceGameInfo and test. You should be able to see and move the cursor around. In the image below, the cursor is within the red circle.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/MouseInterfacePhaseOne.jpg" alt="MouseInterfacePhaseOne.jpg" width='900' height='672' />
<p />
<h3><a name="ScaleForm"></a> ScaleForm </h3>
ScaleForm can also be used to poll for the mouse position. In this particular gem, the majority of the scripts stay largely the same. The exception is, is if you use ScaleForm, the custom player input class created above no longer polls for mouse changes. Instead, when ScaleForm detects a change in the mouse position, it will pass the new mouse position to Unrealscript.
<p />
This is the action script written in Adobe Flash. When the mouse moves, action script sets the position of a layer called cursor to the ScaleForm's mouse position and it also sends Unrealscript ScaleForm's mouse position.
<p />
<div class="codetitlebar">
MouseInterfaceCursor.fla &gt; actions: Frame 1
</div>
<div class="codesnippet">
<pre>
import flash.external.ExternalInterface;

// Hide normal &#34;Windows&#34; pointer.
Mouse.hide();

var mouseListener:Object &#61; new Object();

mouseListener.onMouseMove &#61; function() {
  // Set the cursor instance position to the mouse position.
  cursor.&#95;x &#61; &#95;root.&#95;xmouse;
  cursor.&#95;y &#61; &#95;root.&#95;ymouse;

  // Pass Unrealscript the new mouse coordinates
  ExternalInterface.call(&#34;UpdateMousePosition&#34;, &#95;root.&#95;xmouse, &#95;root.&#95;ymouse);

  updateAfterEvent();
};

Mouse.addListener(mouseListener);
</pre>
</div>
<p />
This is the Unrealscript side of the ScaleForm movie. It contains the event which is what ScaleForm uses to send it's mouse position values.
<p />
<div class="codetitlebar">
MouseInterfaceGFx.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfaceGFx extends GFxMoviePlayer;

var MouseInterfaceHUD MouseInterfaceHUD;

function Init(optional LocalPlayer LocalPlayer)
{
  // Initialize the ScaleForm movie
  Super.Init(LocalPlayer);

  Start();
  Advance(0);
}

event UpdateMousePosition(float X, float Y)
{
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;

  if (MouseInterfaceHUD !&#61; None &#38;&#38; MouseInterfaceHUD.PlayerOwner !&#61; None)
  {
    MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(MouseInterfaceHUD.PlayerOwner.PlayerInput);

    if (MouseInterfacePlayerInput !&#61; None)
    {
      MouseInterfacePlayerInput.SetMousePosition(X, Y);
    }
  }
}

defaultproperties
{
  bDisplayWithHudOff&#61;false
  TimingMode&#61;TM&#95;Game
  MovieInfo&#61;SwfMovie&#39;MouseInterfaceContent.MouseInterfaceCursor&#39;
  bPauseGameWhileActive&#61;false
}
</pre>
</div>
<p />
The HUD is where ScaleForm is created and initialized. When the HUD is destroyed, it also makes sure to close any ScaleForm references it makes. <strong>PreCalcValues</strong> is a function which can detect if the resolution of the screen has changed. This is important to ensure that ScaleForm is informed of those changes, and thus it resets it's viewport, scale mode and alignment to match the resolution. Lastly, because ScaleForm is now rendering out cursor, the HUD is told not to render the cursor.
<p />
<div class="codetitlebar">
MouseInterfaceHUD.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfaceHUD extends HUD;

// The texture which represents the cursor on the screen
var const Texture2D CursorTexture;
// The color of the cursor
var const Color CursorColor;
// Use ScaleForm?
var bool UsingScaleForm;
// Scaleform mouse movie
var MouseInterfaceGFx MouseInterfaceGFx;

simulated event PostBeginPlay()
{
  Super.PostBeginPlay();

  // If we are using ScaleForm, then create the ScaleForm movie
  if (UsingScaleForm)
  {
    MouseInterfaceGFx &#61; new () class&#39;MouseInterfaceGFx&#39;;
    if (MouseInterfaceGFx !&#61; None)
    {
      MouseInterfaceGFx.MouseInterfaceHUD &#61; Self;
      MouseInterfaceGFx.SetTimingMode(TM&#95;Game);

      MouseInterfaceGFx.Init(class&#39;Engine&#39;.static.GetEngine().GamePlayers&#91;MouseInterfaceGFx.LocalPlayerOwnerIndex]);
    }
  }
}

simulated event Destroyed()
{
  Super.Destroyed();

  // If the ScaleForm movie exists, then destroy it
  if (MouseInterfaceGFx !&#61; None)
  {
    MouseInterfaceGFx.Close(true);
    MouseInterfaceGFx &#61; None;
  }
}

function PreCalcValues()
{
  Super.PreCalcValues();

  // If the ScaleForm movie exists, then reset it&#39;s viewport, scale mode and alignment to match the
  // screen resolution
  if (MouseInterfaceGFx !&#61; None)
  {
    MouseInterfaceGFx.SetViewport(0, 0, SizeX, SizeY);
    MouseInterfaceGFx.SetViewScaleMode(SM&#95;NoScale);
    MouseInterfaceGFx.SetAlignment(Align&#95;TopLeft);
  }
}

event PostRender()
{
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local MouseInterfaceInteractionInterface MouseInteractionInterface;
  local Vector HitLocation, HitNormal;

  Super.PostRender();

  // Ensure that we aren&#39;t using ScaleForm and that we have a valid cursor
  if (!UsingScaleForm &#38;&#38; CursorTexture !&#61; None)
  {
    // Ensure that we have a valid PlayerOwner
    if (PlayerOwner !&#61; None)
    {
      // Cast to get the MouseInterfacePlayerInput
      MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

      // If we&#39;re not using scale form and we have a valid cursor texture, render it
      if (MouseInterfacePlayerInput !&#61; None)
      {
        // Set the canvas position to the mouse position
        Canvas.SetPos(MouseInterfacePlayerInput.MousePosition.X, MouseInterfacePlayerInput.MousePosition.Y);
        // Set the cursor color
        Canvas.DrawColor &#61; CursorColor;
        // Draw the texture on the screen
        Canvas.DrawTile(CursorTexture, CursorTexture.SizeX, CursorTexture.SizeY, 0.f, 0.f, CursorTexture.SizeX, CursorTexture.SizeY,, true);
      }
    }
  }

  Super.PostRender();
}
</pre>
</div>
<p />
Lastly, a new function is added to MouseInterfacePlayerInput which allows other classes to write to the <strong>MousePosition</strong> variable. This is done intentionally to ensure that the mouse position is always within the rendering bounds of the Canvas.
<p />
<div class="codetitlebar">
MouseInterfacePlayerInput.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfacePlayerInput extends PlayerInput;

var PrivateWrite IntPoint MousePosition;

event PlayerInput(float DeltaTime)
{
  local MouseInterfaceHUD MouseInterfaceHUD;

  // Handle mouse movement
  // Check that we have the appropriate HUD class
  MouseInterfaceHUD &#61; MouseInterfaceHUD(MyHUD);
  if (MouseInterfaceHUD !&#61; None)
  {
    if (!MouseInterfaceHUD.UsingScaleForm)
    {
      // If we are not using ScaleForm, then read the mouse input directly
      // Add the aMouseX to the mouse position and clamp it within the viewport width
      MousePosition.X &#61; Clamp(MousePosition.X + aMouseX, 0, MouseInterfaceHUD.SizeX);
      // Add the aMouseY to the mouse position and clamp it within the viewport height
      MousePosition.Y &#61; Clamp(MousePosition.Y - aMouseY, 0, MouseInterfaceHUD.SizeY);
    }
  }

  Super.PlayerInput(DeltaTime);
}

function SetMousePosition(int X, int Y)
{
  if (MyHUD !&#61; None)
  {
    MousePosition.X &#61; Clamp(X, 0, MyHUD.SizeX);
    MousePosition.Y &#61; Clamp(Y, 0, MyHUD.SizeY);
  }
}

defaultproperties
{
}
</pre>
</div>
<p />
So, ScaleForm doesn't change the logic too much here. The main change here is what is used to detect where the current position of the mouse is.
<p />
<h4><a name="Related Topics"></a> Related Topics </h4> <ul>
<li> <a href="Scaleform.html" class="twikiLink">Scaleform</a>
</li> <li> <a href="ScaleformTechnicalGuide.html" class="twikiLink">Scaleform Technical Guide</a>
</li> <li> <a href="ScaleformBestPractices.html" class="twikiLink">Scaleform Best Practices</a>
</li> <li> <a href="ScaleformWorkflow.html" class="twikiLink">Scaleform Workflow</a>
</li></ul>
<p />
<h3><a name="I just want the mouse 2D coordinates!"></a> I just want the mouse 2D coordinates! </h3>
To retrieve the mouse 2D coordinates, you just need access to the MouseInterfacePlayerInput.
<p />
To retrieve it from within the HUD.
<p />
<div class="codetitlebar">
MouseInterfaceHUD.uc
</div>
<div class="codesnippet">
<pre>
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local IntPoint MousePosition;

  // Ensure that we have a valid PlayerOwner
  if (PlayerOwner !&#61; None)
  {
    // Cast to get the MouseInterfacePlayerInput
    MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

    if (MouseInterfacePlayerInput !&#61; None)
    {
      // To retrieve/use the mouse X position
      MousePosition.X &#61; MouseInterfacePlayerInput.MousePosition.X;
      // To retrieve/use the mouse Y position
      MousePosition.Y &#61; MouseInterfacePlayerInput.MousePosition.Y;
    }
  }
</pre>
</div>
<p />
To retrieve it within the PlayerController.
<p />
<div class="codetitlebar">
MouseInterfacePlayerController.uc
</div>
<div class="codesnippet">
<pre>
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local IntPoint MousePosition;

  // Cast to get the MouseInterfacePlayerInput
  MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerInput);

  if (MouseInterfacePlayerInput !&#61; None)
  {
    // To retrieve/use the mouse X position
    MousePosition.X &#61; MouseInterfacePlayerInput.MousePosition.X;
    // To retrieve/use the mouse Y position
    MousePosition.Y &#61; MouseInterfacePlayerInput.MousePosition.Y;
  }
</pre>
</div>
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="GettingStartedGameplay.html" class="twikiLink">Getting Started Gameplay</a>
</li> <li> <a href="DevelopmentKitFirstScriptProject.html" class="twikiLink">First Script Project</a>
</li> <li> <a href="HUDTechnicalGuide.html" class="twikiLink">HUD Technical Guide</a>
</li></ul>
<p />
<h2><a name="Adding the mouse interaction interface"></a> Adding the mouse interaction interface </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
This is the interface that mouse interactable actors will implement. Add this interface to your package. If you wish to implement more mouse functions such as extra buttons or mouse axial movement, append it to this interface so that every mouse interactable actor will inherit it.
<p />
<div class="codetitlebar">
MouseInterfaceInteractionInterface.uc
</div>
<div class="codesnippet">
<pre>
interface MouseInterfaceInteractionInterface;

// Called when the left mouse button is pressed
function MouseLeftPressed(Vector MouseWorldOrigin, Vector MouseWorldDirection, Vector HitLocation, Vector HitNormal);

// Called when the left mouse button is released
function MouseLeftReleased(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Called when the right mouse button is pressed
function MouseRightPressed(Vector MouseWorldOrigin, Vector MouseWorldDirection, Vector HitLocation, Vector HitNormal);

// Called when the right mouse button is released
function MouseRightReleased(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Called when the middle mouse button is pressed
function MouseMiddlePressed(Vector MouseWorldOrigin, Vector MouseWorldDirection, Vector HitLocation, Vector HitNormal);

// Called when the middle mouse button is released
function MouseMiddleReleased(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Called when the middle mouse button is scrolled up
function MouseScrollUp(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Called when the middle mouse button is scrolled down
function MouseScrollDown(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Called when the mouse is moved over the actor
function MouseOver(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Called when the mouse is moved out from the actor (when it was previously over it)
function MouseOut(Vector MouseWorldOrigin, Vector MouseWorldDirection);

// Returns the hit location of the mouse trace
function Vector GetHitLocation();

// Returns the hit normal of the mouse trace
function Vector GetHitNormal();

// Returns the mouse world origin calculated by the deprojection within the canvas
function Vector GetMouseWorldOrigin();

// Returns the mouse world direction calculated by the deprojection within the canvas
function Vector GetMouseWorldDirection();
</pre>
</div>
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="MasteringUnrealScriptInterfaces.html" class="twikiLink">Mastering UnrealScript Interfaces</a>
</li> <li> <a href="UnrealScriptInterfaces.html" class="twikiLink">UnrealScript Interfaces</a>
</li></ul>
<p />
<h2><a name="Using the _PlayerController and HUD to provide the mouse interaction"></a> Using the PlayerController and HUD to provide the mouse interaction </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Mouse input is handled by using pending booleans within the HUD. The reason why this was done was because the deprojection requires access to the canvas. The canvas is reassigned per frame, so it is not possible to retain a reference to it over several frames. Therefore, when the mouse buttons or the mouse wheel is used, we defer those input actions to the HUD.
<p />
<div class="codetitlebar">
MouseInterfacePlayerController.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfacePlayerController extends PlayerController;

// Mouse event enum
enum EMouseEvent
{
  LeftMouseButton,
  RightMouseButton,
  MiddleMouseButton,
  ScrollWheelUp,
  ScrollWheelDown,
};

// Handle mouse inputs
function HandleMouseInput(EMouseEvent MouseEvent, EInputEvent InputEvent)
{
  local MouseInterfaceHUD MouseInterfaceHUD;

  // Type cast to get our HUD
  MouseInterfaceHUD &#61; MouseInterfaceHUD(myHUD);

  if (MouseInterfaceHUD !&#61; None)
  {
    // Detect what kind of input this is
    if (InputEvent &#61;&#61; IE&#95;Pressed)
    {
      // Handle pressed event
      switch (MouseEvent)
      {
        case LeftMouseButton:
     MouseInterfaceHUD.PendingLeftPressed &#61; true;
     break;

   case RightMouseButton:
     MouseInterfaceHUD.PendingRightPressed &#61; true;
     break;

   case MiddleMouseButton:
     MouseInterfaceHUD.PendingMiddlePressed &#61; true;
     break;

   case ScrollWheelUp:
     MouseInterfaceHUD.PendingScrollUp &#61; true;
     break;

   case ScrollWheelDown:
     MouseInterfaceHUD.PendingScrollDown &#61; true;
     break;

   default:
     break;
      }
    }
    else if (InputEvent &#61;&#61; IE&#95;Released)
    {
      // Handle released event
      switch (MouseEvent)
      {
        case LeftMouseButton:
     MouseInterfaceHUD.PendingLeftReleased &#61; true;
     break;

   case RightMouseButton:
     MouseInterfaceHUD.PendingRightReleased &#61; true;
     break;

   case MiddleMouseButton:
     MouseInterfaceHUD.PendingMiddleReleased &#61; true;
     break;

   default:
     break;
      }
    }
  }
}

// Hook used for the left and right mouse button when pressed
exec function StartFire(optional byte FireModeNum)
{
  HandleMouseInput((FireModeNum &#61;&#61; 0) ? LeftMouseButton : RightMouseButton, IE&#95;Pressed);
  Super.StartFire(FireModeNum);
}

// Hook used for the left and right mouse button when released
exec function StopFire(optional byte FireModeNum)
{
  HandleMouseInput((FireModeNum &#61;&#61; 0) ? LeftMouseButton : RightMouseButton, IE&#95;Released);
  Super.StopFire(FireModeNum);
}

// Called when the middle mouse button is pressed
exec function MiddleMousePressed()
{
  HandleMouseInput(MiddleMouseButton, IE&#95;Pressed);
}

// Called when the middle mouse button is released
exec function MiddleMouseReleased()
{
  HandleMouseInput(MiddleMouseButton, IE&#95;Released);
}

// Called when the middle mouse wheel is scrolled up
exec function MiddleMouseScrollUp()
{
  HandleMouseInput(ScrollWheelUp, IE&#95;Pressed);
}

// Called when the middle mouse wheel is scrolled down
exec function MiddleMouseScrollDown()
{
  HandleMouseInput(ScrollWheelDown, IE&#95;Pressed);
}

// Null this function
function UpdateRotation(float DeltaTime);

// Override this state because StartFire isn&#39;t called globally when in this function
auto state PlayerWaiting
{
  exec function StartFire(optional byte FireModeNum)
  {
    Global.StartFire(FireModeNum);
  }
}

defaultproperties
{
  // Set the input class to the mouse interface player input
  InputClass&#61;class&#39;MouseInterfacePlayerInput&#39;
}
</pre>
</div>
<p />
The logic of the player controller is as follows: <ul>
<li> Exec functions are called via key binds.
</li> <li> If any of the exec functions are called, they then call HandleMouseInput which then defers the action to the HUD.
</li></ul>
<p />
As we've added new exec functions, we need to modify the DefaultInput.ini to bind to them. Modifying DefaultInput.ini ensures that subsequent configuration files are updated with the change; but you can also modify UDKInput.ini.
<p />
<div class="codetitlebar">
DefaultInput.ini
</div>
<div class="codesnippet">
<pre>
; Remove the previous mouse scroll up and scroll down key binds
-Bindings&#61;(Name&#61;&#34;MouseScrollUp&#34;,Command&#61;&#34;PrevWeapon&#34;)
-Bindings&#61;(Name&#61;&#34;MouseScrollDown&#34;,Command&#61;&#34;NextWeapon&#34;)
; Add the middle mouse button and new scroll wheel key binds
.Bindings&#61;(Name&#61;&#34;MiddleMouseButton&#34;,Command&#61;&#34;MiddleMousePressed &#124; OnRelease MiddleMouseReleased&#34;)
.Bindings&#61;(Name&#61;&#34;MouseScrollUp&#34;,Command&#61;&#34;GBA&#95;PrevWeapon &#124; MiddleMouseScrollUp&#34;)
.Bindings&#61;(Name&#61;&#34;MouseScrollDown&#34;,Command&#61;&#34;GBA&#95;NextWeapon &#124; MiddleMouseScrollDown&#34;)
</pre>
</div>
<p />
When the mouse input is deferred to the HUD, the HUD handles these per frame within the PostRender function. Per frame, the HUD gets the current mouse interaction interface by performing a trace which represents the mouse within the world.
<p />
To further clarify, in the image below the green plane represents the world, the red frustum represents the world view frustum, the blue spot represents the 2D mouse position and the blue line represents the trace. The flat top of the frustum represents the screen (in this case, viewing the world over the top). The canvas deprojection function converts a 2D position into the world.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/FrustrumExplanation.jpg" alt="FrustrumExplanation.jpg"  />
<p />
<div class="codetitlebar">
MouseInterfaceHUD.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfaceHUD extends HUD;

// The texture which represents the cursor on the screen
var const Texture2D CursorTexture;
// The color of the cursor
var const Color CursorColor;
// Pending left mouse button pressed event
var bool PendingLeftPressed;
// Pending left mouse button released event
var bool PendingLeftReleased;
// Pending right mouse button pressed event
var bool PendingRightPressed;
// Pending right mouse button released event
var bool PendingRightReleased;
// Pending middle mouse button pressed event
var bool PendingMiddlePressed;
// Pending middle mouse button released event
var bool PendingMiddleReleased;
// Pending mouse wheel scroll up event
var bool PendingScrollUp;
// Pending mouse wheel scroll down event
var bool PendingScrollDown;
// Cached mouse world origin
var Vector CachedMouseWorldOrigin;
// Cached mouse world direction
var Vector CachedMouseWorldDirection;
// Last mouse interaction interface
var MouseInterfaceInteractionInterface LastMouseInteractionInterface;
// Use ScaleForm?
var bool UsingScaleForm;
// Scaleform mouse movie
var MouseInterfaceGFx MouseInterfaceGFx;

simulated event PostBeginPlay()
{
  Super.PostBeginPlay();

  // If we are using ScaleForm, then create the ScaleForm movie
  if (UsingScaleForm)
  {
    MouseInterfaceGFx &#61; new () class&#39;MouseInterfaceGFx&#39;;
    if (MouseInterfaceGFx !&#61; None)
    {
      MouseInterfaceGFx.MouseInterfaceHUD &#61; Self;
      MouseInterfaceGFx.SetTimingMode(TM&#95;Game);

      MouseInterfaceGFx.Init(class&#39;Engine&#39;.static.GetEngine().GamePlayers&#91;MouseInterfaceGFx.LocalPlayerOwnerIndex]);
    }
  }
}

simulated event Destroyed()
{
  Super.Destroyed();

  // If the ScaleForm movie exists, then destroy it
  if (MouseInterfaceGFx !&#61; None)
  {
    MouseInterfaceGFx.Close(true);
    MouseInterfaceGFx &#61; None;
  }
}

function PreCalcValues()
{
  Super.PreCalcValues();

  // If the ScaleForm movie exists, then reset it&#39;s viewport, scale mode and alignment to match the
  // screen resolution
  if (MouseInterfaceGFx !&#61; None)
  {
    MouseInterfaceGFx.SetViewport(0, 0, SizeX, SizeY);
    MouseInterfaceGFx.SetViewScaleMode(SM&#95;NoScale);
    MouseInterfaceGFx.SetAlignment(Align&#95;TopLeft);
  }
}

event PostRender()
{
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local MouseInterfaceInteractionInterface MouseInteractionInterface;
  local Vector HitLocation, HitNormal;

  Super.PostRender();

  // Ensure that we aren&#39;t using ScaleForm and that we have a valid cursor
  if (!UsingScaleForm &#38;&#38; CursorTexture !&#61; None)
  {
    // Ensure that we have a valid PlayerOwner
    if (PlayerOwner !&#61; None)
    {
      // Cast to get the MouseInterfacePlayerInput
      MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

      // If we&#39;re not using scale form and we have a valid cursor texture, render it
      if (MouseInterfacePlayerInput !&#61; None)
      {
        // Set the canvas position to the mouse position
        Canvas.SetPos(MouseInterfacePlayerInput.MousePosition.X, MouseInterfacePlayerInput.MousePosition.Y);
        // Set the cursor color
        Canvas.DrawColor &#61; CursorColor;
        // Draw the texture on the screen
        Canvas.DrawTile(CursorTexture, CursorTexture.SizeX, CursorTexture.SizeY, 0.f, 0.f, CursorTexture.SizeX, CursorTexture.SizeY,, true);
      }
    }
  }

  // Get the current mouse interaction interface
  MouseInteractionInterface &#61; GetMouseActor(HitLocation, HitNormal);

  // Handle mouse over and mouse out
  // Did we previously had a mouse interaction interface?
  if (LastMouseInteractionInterface !&#61; None)
  {
    // If the last mouse interaction interface differs to the current mouse interaction
    if (LastMouseInteractionInterface !&#61; MouseInteractionInterface)
    {
      // Call the mouse out function
      LastMouseInteractionInterface.MouseOut(CachedMouseWorldOrigin, CachedMouseWorldDirection);
      // Assign the new mouse interaction interface
      LastMouseInteractionInterface &#61; MouseInteractionInterface;

      // If the last mouse interaction interface is not none
      if (LastMouseInteractionInterface !&#61; None)
      {
        // Call the mouse over function
        LastMouseInteractionInterface.MouseOver(CachedMouseWorldOrigin, CachedMouseWorldDirection); // Call mouse over
      }
    }
  }
  else if (MouseInteractionInterface !&#61; None)
  {
    // Assign the new mouse interaction interface
    LastMouseInteractionInterface &#61; MouseInteractionInterface;
    // Call the mouse over function
    LastMouseInteractionInterface.MouseOver(CachedMouseWorldOrigin, CachedMouseWorldDirection);
  }

  if (LastMouseInteractionInterface !&#61; None)
  {
    // Handle left mouse button
    if (PendingLeftPressed)
    {
      if (PendingLeftReleased)
      {
        // This is a left click, so discard
        PendingLeftPressed &#61; false;
        PendingLeftReleased &#61; false;
      }
      else
      {
        // Left is pressed
        PendingLeftPressed &#61; false;
        LastMouseInteractionInterface.MouseLeftPressed(CachedMouseWorldOrigin, CachedMouseWorldDirection, HitLocation, HitNormal);
      }
    }
    else if (PendingLeftReleased)
    {
      // Left is released
      PendingLeftReleased &#61; false;
      LastMouseInteractionInterface.MouseLeftReleased(CachedMouseWorldOrigin, CachedMouseWorldDirection);
    }

    // Handle right mouse button
    if (PendingRightPressed)
    {
      if (PendingRightReleased)
      {
        // This is a right click, so discard
        PendingRightPressed &#61; false;
        PendingRightReleased &#61; false;
      }
      else
      {
        // Right is pressed
        PendingRightPressed &#61; false;
        LastMouseInteractionInterface.MouseRightPressed(CachedMouseWorldOrigin, CachedMouseWorldDirection, HitLocation, HitNormal);
      }
    }
    else if (PendingRightReleased)
    {
      // Right is released
      PendingRightReleased &#61; false;
      LastMouseInteractionInterface.MouseRightReleased(CachedMouseWorldOrigin, CachedMouseWorldDirection);
    }

    // Handle middle mouse button
    if (PendingMiddlePressed)
    {
      if (PendingMiddleReleased)
      {
        // This is a middle click, so discard
        PendingMiddlePressed &#61; false;
        PendingMiddleReleased &#61; false;
      }
      else
      {
        // Middle is pressed
        PendingMiddlePressed &#61; false;
        LastMouseInteractionInterface.MouseMiddlePressed(CachedMouseWorldOrigin, CachedMouseWorldDirection, HitLocation, HitNormal);
      }
    }
    else if (PendingMiddleReleased)
    {
      PendingMiddleReleased &#61; false;
      LastMouseInteractionInterface.MouseMiddleReleased(CachedMouseWorldOrigin, CachedMouseWorldDirection);
    }

    // Handle middle mouse button scroll up
    if (PendingScrollUp)
    {
      PendingScrollUp &#61; false;
      LastMouseInteractionInterface.MouseScrollUp(CachedMouseWorldOrigin, CachedMouseWorldDirection);
    }

    // Handle middle mouse button scroll down
    if (PendingScrollDown)
    {
      PendingScrollDown &#61; false;
      LastMouseInteractionInterface.MouseScrollDown(CachedMouseWorldOrigin, CachedMouseWorldDirection);
    }
  }
}

function MouseInterfaceInteractionInterface GetMouseActor(optional out Vector HitLocation, optional out Vector HitNormal)
{
  local MouseInterfaceInteractionInterface MouseInteractionInterface;
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local Vector2D MousePosition;
  local Actor HitActor;

  // Ensure that we have a valid canvas and player owner
  if (Canvas &#61;&#61; None &#124;&#124; PlayerOwner &#61;&#61; None)
  {
    return None;
  }

  // Type cast to get the new player input
  MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

  // Ensure that the player input is valid
  if (MouseInterfacePlayerInput &#61;&#61; None)
  {
    return None;
  }

  // We stored the mouse position as an IntPoint, but it&#39;s needed as a Vector2D
  MousePosition.X &#61; MouseInterfacePlayerInput.MousePosition.X;
  MousePosition.Y &#61; MouseInterfacePlayerInput.MousePosition.Y;
  // Deproject the mouse position and store it in the cached vectors
  Canvas.DeProject(MousePosition, CachedMouseWorldOrigin, CachedMouseWorldDirection);

  // Perform a trace actor interator. An interator is used so that we get the top most mouse interaction
  // interface. This covers cases when other traceable objects (such as static meshes) are above mouse
  // interaction interfaces.
  ForEach TraceActors(class&#39;Actor&#39;, HitActor, HitLocation, HitNormal, CachedMouseWorldOrigin + CachedMouseWorldDirection &#42; 65536.f, CachedMouseWorldOrigin,,, TRACEFLAG&#95;Bullet)
  {
    // Type cast to see if the HitActor implements that mouse interaction interface
    MouseInteractionInterface &#61; MouseInterfaceInteractionInterface(HitActor);
    if (MouseInteractionInterface !&#61; None)
    {
      return MouseInteractionInterface;
    }
  }

  return None;
}

function Vector GetMouseWorldLocation()
{
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local Vector2D MousePosition;
  local Vector MouseWorldOrigin, MouseWorldDirection, HitLocation, HitNormal;

  // Ensure that we have a valid canvas and player owner
  if (Canvas &#61;&#61; None &#124;&#124; PlayerOwner &#61;&#61; None)
  {
    return Vect(0, 0, 0);
  }

  // Type cast to get the new player input
  MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

  // Ensure that the player input is valid
  if (MouseInterfacePlayerInput &#61;&#61; None)
  {
    return Vect(0, 0, 0);
  }

  // We stored the mouse position as an IntPoint, but it&#39;s needed as a Vector2D
  MousePosition.X &#61; MouseInterfacePlayerInput.MousePosition.X;
  MousePosition.Y &#61; MouseInterfacePlayerInput.MousePosition.Y;
  // Deproject the mouse position and store it in the cached vectors
  Canvas.DeProject(MousePosition, MouseWorldOrigin, MouseWorldDirection);

  // Perform a trace to get the actual mouse world location.
  Trace(HitLocation, HitNormal, MouseWorldOrigin + MouseWorldDirection &#42; 65536.f, MouseWorldOrigin , true,,, TRACEFLAG&#95;Bullet);
  return HitLocation;
}

defaultproperties
{
  // Set to false if you wish to use Unreal&#39;s player input to retrieve the mouse coordinates
  UsingScaleForm&#61;true
  CursorColor&#61;(R&#61;255,G&#61;255,B&#61;255,A&#61;255)
  CursorTexture&#61;Texture2D&#39;EngineResources.Cursors.Arrow&#39;
}
</pre>
</div>
<p />
The logic of the HUD is as follows: <ul>
<li> For every frame that is rendered, we render the mouse cursor
</li> <li> Get the current mouse interaction interface by performing a trace within the world. If the current mouse interaction interface differs from the last one, call the mouse over and or mouse out functions appropriately.
</li> <li> If we have a valid mouse interaction interface, the HUD then handles the deferred mouse input
</li> <li> For each mouse input call the appropriate interface function and reset the boolean
</li></ul>
<p />
<h3><a name="I just want to get the mouse 3D coordinates!"></a> I just want to get the mouse 3D coordinates! </h3>
To get the mouse 3D coordinates based on the mouse 2D coordinates, you can use this function within your HUD class. The HUD class is required because the Deproject function is required.
<p />
<div class="codetitlebar">
MouseInterfaceHUD.uc
</div>
<div class="codesnippet">
<pre>
function Vector GetMouseWorldLocation()
{
  local MouseInterfacePlayerInput MouseInterfacePlayerInput;
  local Vector2D MousePosition;
  local Vector MouseWorldOrigin, MouseWorldDirection, HitLocation, HitNormal;

  // Ensure that we have a valid canvas and player owner
  if (Canvas &#61;&#61; None &#124;&#124; PlayerOwner &#61;&#61; None)
  {
    return Vect(0, 0, 0);
  }

  // Type cast to get the new player input
  MouseInterfacePlayerInput &#61; MouseInterfacePlayerInput(PlayerOwner.PlayerInput);

  // Ensure that the player input is valid
  if (MouseInterfacePlayerInput &#61;&#61; None)
  {
    return Vect(0, 0, 0);
  }

  // We stored the mouse position as an IntPoint, but it&#39;s needed as a Vector2D
  MousePosition.X &#61; MouseInterfacePlayerInput.MousePosition.X;
  MousePosition.Y &#61; MouseInterfacePlayerInput.MousePosition.Y;
  // Deproject the mouse position and store it in the cached vectors
  Canvas.DeProject(MousePosition, MouseWorldOrigin, MouseWorldDirection);

  // Perform a trace to get the actual mouse world location.
  Trace(HitLocation, HitNormal, MouseWorldOrigin + MouseWorldDirection &#42; 65536.f, MouseWorldOrigin , true,,, TRACEFLAG&#95;Bullet);
  return HitLocation;
}
</pre>
</div>
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="CanvasTechnicalGuide.html" class="twikiLink">Canvas Technical Guide</a>
</li></ul>
<p />
<h2><a name="Adding the Kismet Mouse Input Event"></a> Adding the Kismet Mouse Input Event </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
This is the custom Kismet event which allows Kismet to detect when an actor is interacted by the player.
<p />
<div class="codetitlebar">
SeqEvent_MouseInput.uc
</div>
<div class="codesnippet">
<pre>
class SeqEvent&#95;MouseInput extends SequenceEvent;

var Vector HitLocation;
var Vector HitNormal;
var Vector MouseWorldOrigin;
var Vector MouseWorldDirection;

event Activated()
{
  local MouseInterfaceInteractionInterface MouseInteractionInterface;

  // Type cast the originator to ensure that it is a mouse interaction interface
  MouseInteractionInterface &#61; MouseInterfaceInteractionInterface(Originator);

  if (MouseInteractionInterface !&#61; None)
  {
    // Get the appropriate values so we can push them out when the event is activated
    MouseWorldOrigin &#61; MouseInteractionInterface.GetMouseWorldOrigin();
    MouseWorldDirection &#61; MouseInteractionInterface.GetMouseWorldDirection();
    HitLocation &#61; MouseInteractionInterface.GetHitLocation();
    HitNormal &#61; MouseInteractionInterface.GetHitNormal();
  }
}

defaultproperties
{
  ObjName&#61;&#34;Mouse Input&#34;
  ObjCategory&#61;&#34;Input&#34;

  bPlayerOnly&#61;false
  MaxTriggerCount&#61;0

  OutputLinks(0)&#61;(LinkDesc&#61;&#34;Left Pressed&#34;)
  OutputLinks(1)&#61;(LinkDesc&#61;&#34;Left Released&#34;)
  OutputLinks(2)&#61;(LinkDesc&#61;&#34;Right Pressed&#34;)
  OutputLinks(3)&#61;(LinkDesc&#61;&#34;Right Released&#34;)
  OutputLinks(4)&#61;(LinkDesc&#61;&#34;Middle Pressed&#34;)
  OutputLinks(5)&#61;(LinkDesc&#61;&#34;Middle Released&#34;)
  OutputLinks(6)&#61;(LinkDesc&#61;&#34;Scroll Up&#34;)
  OutputLinks(7)&#61;(LinkDesc&#61;&#34;Scroll Down&#34;)
  OutputLinks(8)&#61;(LinkDesc&#61;&#34;Mouse Over&#34;)
  OutputLinks(9)&#61;(LinkDesc&#61;&#34;Mouse Out&#34;)

  VariableLinks(1)&#61;(ExpectedType&#61;class&#39;SeqVar&#95;Vector&#39;,LinkDesc&#61;&#34;HitLocation&#34;,bWriteable&#61;true,PropertyName&#61;HitLocation)
  VariableLinks(2)&#61;(ExpectedType&#61;class&#39;SeqVar&#95;Vector&#39;,LinkDesc&#61;&#34;HitNormal&#34;,bWriteable&#61;true,PropertyName&#61;HitNormal)
  VariableLinks(3)&#61;(ExpectedType&#61;class&#39;SeqVar&#95;Vector&#39;,LinkDesc&#61;&#34;MouseWorldOrigin&#34;,bWriteable&#61;true,PropertyName&#61;MouseWorldOrigin)
  VariableLinks(4)&#61;(ExpectedType&#61;class&#39;SeqVar&#95;Vector&#39;,LinkDesc&#61;&#34;MouseWorldDirection&#34;,bWriteable&#61;true,PropertyName&#61;MouseWorldDirection)
}
</pre>
</div>
<p />
There isn't much logic within the Kismet mouse input sequence. This Kismet event really acts as a gateway between Unrealscript and Kismet. It is also able to output some of the calculated values from the HUD. Actors should implement the interaction interface, and put this Kismet node within the SupportedEvents array.
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="KismetUserGuide.html" class="twikiLink">Kismet User Guide</a>
</li> <li> <a href="KismetReference.html" class="twikiLink">Kismet Reference</a>
</li> <li> <a href="KismetExamples.html" class="twikiLink">Kismet Examples</a>
</li></ul>
<p />
<h2><a name="Adding a subclassed KActor as an example"></a> Adding a subclassed KActor as an example </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
This is an example usage of the mouse interaction interface and the Kismet mouse input event node.
<p />
By implementing the mouse interaction interface, the mouse interface HUD is able to use it. This can be extended to a multitude of classes such as a Pawn, Projectile or Vehicles.
<p />
By supporting the mouse input Kismet sequence event, the level designer is able to take advantage of the code and create mouse interactions without having to write a line of code him/herself.
<p />
<div class="codetitlebar">
MouseInterfaceKActor.uc
</div>
<div class="codesnippet">
<pre>
class MouseInterfaceKActor extends KActor
  Implements(MouseInterfaceInteractionInterface);

var Vector CachedMouseHitLocation;
var Vector CachedMouseHitNormal;
var Vector CachedMouseWorldOrigin;
var Vector CachedMouseWorldDirection;

// &#61;&#61;&#61;
// MouseInterfaceInteractionInterface implementation
// &#61;&#61;&#61;
function MouseLeftPressed(Vector MouseWorldOrigin, Vector MouseWorldDirection, Vector HitLocation, Vector HitNormal)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; HitLocation;
  CachedMouseHitNormal &#61; HitNormal;
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 0);
}

function MouseLeftReleased(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 1);
}

function MouseRightPressed(Vector MouseWorldOrigin, Vector MouseWorldDirection, Vector HitLocation, Vector HitNormal)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; HitLocation;
  CachedMouseHitNormal &#61; HitNormal;
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 2);
}

function MouseRightReleased(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 3);
}

function MouseMiddlePressed(Vector MouseWorldOrigin, Vector MouseWorldDirection, Vector HitLocation, Vector HitNormal)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; HitLocation;
  CachedMouseHitNormal &#61; HitNormal;
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 4);
}

function MouseMiddleReleased(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 5);
}

function MouseScrollUp(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 6);
}

function MouseScrollDown(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 7);
}

function MouseOver(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 8);
}

function MouseOut(Vector MouseWorldOrigin, Vector MouseWorldDirection)
{
  CachedMouseWorldOrigin &#61; MouseWorldOrigin;
  CachedMouseWorldDirection &#61; MouseWorldDirection;
  CachedMouseHitLocation &#61; Vect(0.f, 0.f, 0.f);
  CachedMouseHitNormal &#61; Vect(0.f, 0.f, 0.f);
  TriggerEventClass(class&#39;SeqEvent&#95;MouseInput&#39;, Self, 9);
}

function Vector GetHitLocation()
{
  return CachedMouseHitLocation;
}

function Vector GetHitNormal()
{
  return CachedMouseHitNormal;
}

function Vector GetMouseWorldOrigin()
{
  return CachedMouseWorldOrigin;
}

function Vector GetMouseWorldDirection()
{
  return CachedMouseWorldDirection;
}

defaultproperties
{
  SupportedEvents(4)&#61;class&#39;SeqEvent&#95;MouseInput&#39;
}
</pre>
</div>
<p />
The logic behind the MouseInterfaceKActor is as follows: <ul>
<li> When any of the interface implementation functions are executed via the HUD, we trigger the attached Mouse Input Kismet node. The number at end of the trigger call is the output index.
</li></ul>
<p />
<h2><a name="Using the Kismet Mouse Input Event"></a> Using the Kismet Mouse Input Event </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Create a new map and open up the WorldInfo properties. To do this, click on the "View" menu and click on the "World Info Properties". Expand the "World Info" tab. Set the GameType for PIE to the MouseInterfaceGameInfo. By default it will use UTDeathmatch.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_00_AdjustWorldInfo.jpg" alt="Kismet_00_AdjustWorldInfo.jpg" width='357' height='531' />
<p />
Expand the "Lightmass" tab and uncheck the "Use Global Illumination" check box. There is no need to use light mass for the test map.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_01_AdjustWorldInfoLightmass.jpg" alt="Kismet_01_AdjustWorldInfoLightmass.jpg" width='357' height='508' />
<p />
Open up the "Content Browser" and select the "Actor Classes" tab. From there expand the class tree select the "MouseInterfaceKActor". This is so that when you open up the context menu within the world viewport, it will allow you to add it within the world.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_02_SelectMouseInterfaceKActor.jpg" alt="Kismet_02_SelectMouseInterfaceKActor.jpg" width='363' height='363' />
<p />
Right click within the world viewport to open the viewport context menu. Select and click "Add MouseInterfaceKActor Here" to add a MouseInterfaceKActor.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_03_AddMouseInterfaceKActor.jpg" alt="Kismet_03_AddMouseInterfaceKActor.jpg" width='246' height='366' />
<p />
Because the MouseInterfaceKActor doesn't have a visible static mesh, it will first appear as the selected transform widget (selection, movement, rotation or scaling widget). Press F4 to open up the actors property window. Click on the padlock icon at the top to set the selection.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_04_OpenTheKActorProperties.jpg" alt="Kismet_04_OpenTheKActorProperties.jpg" width='357' height='508' />
<p />
Find an interesting static mesh within the "Content Browser". Select it within the "Content Browser".
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_05_SelectAPhysicsStaticMesh.jpg" alt="Kismet_05_SelectAPhysicsStaticMesh.jpg" width='398' height='398' />
<p />
Expand the "Dynamic SMActor" tab, expand the "Static Mesh Component" object, then lastly the "Static Mesh Component" tab. Press the green arrow next to the "Static Mesh" field. This will set the static mesh you've selected in the "Content Browser". You should see the barrel appear within the world viewport.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_06_SetTheStaticMesh.jpg" alt="Kismet_06_SetTheStaticMesh.jpg" width='357' height='508' />
<p />
Add the necessary lighting within the level and compile the level.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_07_AddADominantDirectionalLight.jpg" alt="Kismet_07_AddADominantDirectionalLight.jpg" width='390' height='390' />
<p />
Open up the Kismet window by pressing <img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_08_OpenKismet.jpg" alt="Kismet_08_OpenKismet.jpg" width='21' height='21' /> within the Editor toolbar.
<p />
With the MouseInterfaceKActor still selected within the world viewport, right click within the empty space within the Kismet window to bring up a context menu. Add our new Mouse Input Event. This method ensures that our event is attached to the MouseInterfaceKActor that is in the world.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_09_CreateNewMouseInputEvent.jpg" alt="Kismet_09_CreateNewMouseInputEvent.jpg" width='472' height='398' />
<p />
This is our Mouse Input event. As you can see, all of the output links refer to the mouse input types that may occur. The event also outputs various variables that we can also use.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_10_TheMouseInputEvent.jpg" alt="Kismet_10_TheMouseInputEvent.jpg" width='648' height='634' />
<p />
To test our Mouse Input event, let's create a few log actions.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_11_AddLogAction.jpg" alt="Kismet_11_AddLogAction.jpg" width='900' height='495' />
<p />
Set the log action to output some text that is appropriate for the event output we want to test.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_12_SetLogAction.jpg" alt="Kismet_12_SetLogAction.jpg" width='791' height='1024' />
<p />
Create more log actions to test all of the event outputs. Connect them all up appropriately.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_13_DuplicateAndSetLogActions.jpg" alt="Kismet_13_DuplicateAndSetLogActions.jpg" width='900' height='705' />
<p />
Run the level within PIE and you should be able to test the mouse input Kismet interface. Remember that the mouse buttons and scrolling are only responsive when the mouse is over the MouseInterfaceKActor.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_14_Test.jpg" alt="Kismet_14_Test.jpg" width='900' height='672' />
<p />
Let's expand this example by creating a sequence which allows us to shoot at the MouseInterfaceKActor. Start by creating a new vector variable. This is so that we can store the mouse origin and the mouse hit location.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_15_AddVectorVariable.jpg" alt="Kismet_15_AddVectorVariable.jpg" width='547' height='715' />
<p />
Bind the vector variables to the event's variable outputs, "HitLocation" and "Mouse WorldOrigin".
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_16_BindVectorToEvent.jpg" alt="Kismet_16_BindVectorToEvent.jpg" width='547' height='687' />
<p />
Add a new "Spawn Projectile" action. This creates a projectile when the action is executed.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_17_CreateSpawnProjectileAction.jpg" alt="Kismet_17_CreateSpawnProjectileAction.jpg" width='900' height='484' />
<p />
This is the newly created "Spawn Projectile" action.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_18_SpawnProjectileAction.jpg" alt="Kismet_18_SpawnProjectileAction.jpg" width='900' height='626' />
<p />
Connect the "Spawn Projectile" action to the "Log" action which is activated when the left mouse button is pressed. Connect the "Mouse WorldOrigin" variable to the "Spawn Location" input on the "Spawn Projectile" event. Connect the "HitLocation" variable to the "Target Location" input on the "Spawn Projectile" event. This will cause the "Spawn Projectile" to spawn a projectile at the mouse world origin location that will travel towards the mouse hit location. Thus making it look like that we are shooting at the MouseInterfaceKActor in the world.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_19_ConnectSpawnProjectileAction.jpg" alt="Kismet_19_ConnectSpawnProjectileAction.jpg" width='900' height='626' />
<p />
Set what kind of projectile to spawn.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_20_SetSpawnProjectileAction.jpg" alt="Kismet_20_SetSpawnProjectileAction.jpg" width='900' height='989' />
<p />
Add an "All Players" variable. This is a required input of the "Spawn Projectile" action.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_21_AddPlayerVariable.jpg" alt="Kismet_21_AddPlayerVariable.jpg" width='900' height='484' />
<p />
Here is the newly created "All Players" variable.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_22_PlayerVariable.jpg" alt="Kismet_22_PlayerVariable.jpg" width='900' height='484' />
<p />
Connect the "All Players" variable to the "Spawn Projectile".
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_23_ConnectPlayerVariable.jpg" alt="Kismet_23_ConnectPlayerVariable.jpg" width='900' height='484' />
<p />
Run PIE and test the Kismet. You should now be able to fire at the MouseInterfaceKActor.
<p />
<img src="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/Kismet_24_Test.jpg" alt="Kismet_24_Test.jpg" width='900' height='672' />
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="KismetUserGuide.html" class="twikiLink">Kismet User Guide</a>
</li> <li> <a href="KismetExamples.html" class="twikiLink">Kisment Examples</a>
</li> <li> <a href="KismetReference.html" class="twikiLink">Kismet Reference</a>
</li> <li> <a href="UnrealEdUserGuide.html" class="twikiLink">Unreal Editor User Guide</a>
</li></ul>
<p />
<h2><a name="Downloads"></a> Downloads </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div> <ul>
<li> <a href="rsrc/Three/DevelopmentKitGemsCreatingAMouseInterface/MouseInterface.zip" target="_top">Download</a> the content used in this gem. (MouseInterface.zip)
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
