<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | GameCenter    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">GameCenter  </b></div>
<div id="tooltext">
<a href="GameCenterJP.html" class="twikiLink">日本語訳</a><br><a href="GameCenterCH.html" class="twikiLink">中国翻译</a><br><a href="GameCenterKR.html" class="twikiLink">한국어</a><br>

<!-- Three/GameCenter -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="MobileHome.html" class="twikiLink">Mobile Home</a></b> &gt; <b><a href="UnrealOnMobile.html" class="twikiLink">Unreal Engine 3: Mobile Overview</a></b> &gt; <b><a href="UnrealOniOS.html" class="twikiLink">Unreal Engine 3: Apple iOS Overview</a></b> &gt; Game Center <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="ReplicationHome.html" class="twikiLink">Networking &amp; Replication</a></b> &gt; Game Center
</div>
<hr size="1" noshade="noshade">
<h1><a name="Game Center"></a> Game Center </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="GameCenter.html#Game Center"> Game Center</a> <ul>
<li> <a href="GameCenter.html#Overview"> Overview</a>
</li> <li> <a href="GameCenter.html#Configuration setup"> Configuration setup</a>
</li> <li> <a href="GameCenter.html#Compiling _OnlineSubsystemGameCenter"> Compiling OnlineSubsystemGameCenter</a>
</li> <li> <a href="GameCenter.html#Achievements"> Achievements</a> <ul>
<li> <a href="GameCenter.html#Achievement technical details"> Achievement technical details</a>
</li> <li> <a href="GameCenter.html#Achievement example"> Achievement example</a>
</li></ul>
</li> <li> <a href="GameCenter.html#Leader boards"> Leader boards</a> <ul>
<li> <a href="GameCenter.html#Leaderboard technical details"> Leaderboard technical details</a>
</li></ul>
</li> <li> <a href="GameCenter.html#Multiplayer"> Multiplayer</a> <ul>
<li> <a href="GameCenter.html#Matchmaking"> Matchmaking</a>
</li> <li> <a href="GameCenter.html#Invitations"> Invitations</a>
</li> <li> <a href="GameCenter.html#Voice chat"> Voice chat</a>
</li></ul>
</li> <li> <a href="GameCenter.html#Garbage Collection"> Garbage Collection</a>
</li> <li> <a href="GameCenter.html#Related Topics"> Related Topics</a>
</li> <li> <a href="GameCenter.html#Downloads"> Downloads</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<hr size="1" noshade="noshade">
<p />
Game Center is Apple's online gaming network. It lets gamers use their iOS devices to connect, compare and compete against each other. Games developed for iOS devices using Unreal Engine 3 support the use of Game Center, allowing these games to take on a very social and community-driven experience.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> GC will be used in the following sections to refer to Game Center.
<br/>
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> It is important <strong>not</strong> to reference OnlineSubsystemGameCenter directly within Unrealscript as that will cause problems when you attempt to launch UDK on the PC. Always use the OnlineSubsystem reference, and depending on the platform, Unreal Engine 3 will automatically use the correct type of OnlineSubsystem.
<p />
<h2><a name="Configuration setup"></a> Configuration setup </h2>
<hr size="1" noshade="noshade">
<p />
GC is supported in Unreal Engine 3 on iOS via the OnlineSubsystemGameCenter interface. However, since it brings up the Game Center login/welcome back screen automatically during startup, GC can be enabled and disabled by a configuration file. This is to allow developers to turn this off during development where GC testing is not required, set this to true. Otherwise, set this to false.
<p />
<div class="codetitlebar">
.\UDKGame\Config\IPhone\IPhoneEngine.ini
</div>
<div class="codesnippet">
<pre>
&#91;OnlineSubsystemGameCenter.OnlineSubsystemGameCenter]
bDisableGameCenter&#61;false
</pre>
</div>
<p />
If you plan to use achievements or leader boards, you will need to set up the prefix used for all achievement and leader board identifiers. Apple uses globally unique achievement and leader board strings names to identify them, and so you should use your already unique App/Bundle identifier and use that as a basis:
<p />
<div class="codetitlebar">
UDKGame\Config\IPhone\IPhoneEngine.ini
</div>
<div class="codesnippet">
<pre>
&#91;OnlineSubsystemGameCenter.OnlineSubsystemGameCenter]
bDisableGameCenter&#61;false
UniqueAchievementPrefix&#61;com.epicgames.exploreue3.achievement&#95;
UniqueCategoryPrefix&#61;com.epicgames.exploreue3.leaderboard&#95;
EpicUniqueAchievementPrefix&#61;com.epicgames.exploreue3.achievement&#95;
EpicUniqueCategoryPrefix&#61;com.epicgames.exploreue3.leaderboard&#95;
</pre>
</div>
<p />
When you use iTunes Connect to create achievements and leader board categories, you must name them starting with whatever prefixes you've specified and then append 01, 02, 03, and so on for each one. (When you unlock achievement one, the code will append 01 to your UniqueAchievementPrefix). For UDK users, you must set both the Unique and Epic achievement prefix and category prefix.
<p />
<h2><a name="Compiling _OnlineSubsystemGameCenter"></a> Compiling OnlineSubsystemGameCenter </h2>
<hr size="1" noshade="noshade">
<p />
You may need to compile OnlineSubsystemGameCenter before using Game Center for your iOS game. To compile OnlineSubsystemGameCenter, you need to add it to the EditPackages array in DefaultEngine.ini.
<p />
<div class="codetitlebar">
UDKGame\Config\DefaultEngine.ini
</div>
<div class="codesnippet">
<pre>
&#91;UnrealEd.EditorEngine]
+EditPackages&#61;UTGame
+EditPackages&#61;UTGameContent
+EditPackages&#61;OnlineSubsystemGameCenter
</pre>
</div>
<p />
Once added to the EditPackages list, you will then need to recompile your Unrealscript source code. The OnlineSubsystemGameCenter package should now appear in the UDKGame\Script folder. <a href="BasicGameQuickStart.html#Compiling" class="twikiAnchorLink">Click here</a> for more information on compiling Unrealscript.
<p />
<h2><a name="Achievements"></a> Achievements </h2>
<hr size="1" noshade="noshade">
<p />
<img src="rsrc/Three/GameCenter/Achievement.png" alt="Achievement.png" width='553' height='326' />
<p />
Achievements work pretty similarly to other platforms, except that GC does not display an on-screen message when you unlock an achievement for the first time. When your game code attempts to unlock an achievement, it should first check to make sure it hasn't already been unlocked for the user. Here is the general flow you could use:
<p /> <ul>
<li> Game starts up (this only need to be done once, but doing it more is okay) <ul>
<li> Call <strong>OnlineSub.PlayerInterface.AddReadAchievementsCompleteDelegate()</strong> to be notified when reading the achievements data has been completed.
</li> <li> Call <strong>OnlineSub.PlayerInterface.ReadAchievements()</strong> to start reading achievements.
</li> <li> In your delegate, note the achievements that have been read, so you can now query their state.
</li></ul>
</li> <li> Player is playing game, achievement criteria is met. <ul>
<li> Call <strong>OnlineSub.PlayerInterface.GetAchievements()</strong> to get the state of all achievements.
</li> <li> Look in the returned array for the achievement whose ID matches. <ul>
<li> Do <strong>not</strong> use your achievement ID as an index into the achievement array! For one thing, achievement IDs use 1 as their array starting index (Unrealscript and many other languages use 0 for starting array indices).
</li></ul>
</li> <li> If <strong>bWasAchievedOnline</strong> is false; <ul>
<li> Show your UI, play a sound, etc
</li> <li> Call <strong>OnlineSub.PlayerInterface.UnlockAchievement()</strong> to tell GC the player has unlocked the achievement.
</li></ul>
</li></ul>
</li></ul>
<p />
To let the player see what achievements they have unlocked, you may either use your own UI (using the results of <strong>OnlineSub.PlayerInterface.GetAchievements()</strong>), or display the GC built-in screen. To do this, simply call <strong>OnlineSub.PlayerInterfaceEx.ShowAchievementsUI()</strong> and the GC UI will slide onto the screen.
<p />
<h3><a name="Achievement technical details"></a> Achievement technical details </h3>
When the GC code starts up, it will immediately start downloading achievements, so by the time your game code is running, they should already be downloaded. However, to be safe, use the <strong>OnlineSub.PlayerInterface.ReadAchievements()</strong> call with a delegate to make sure that the achievement download has completed, and that <strong>OnlineSub.PlayerInterface.GetAchievements()</strong> will return truly valid results.
<p />
Under the hood, there is much complexity happening for achievements, because if the user is off line when an achievement is unlocked, GC won't ever tell the server. So, we maintain a local achievement state, which is saved to the iOS flash disk. Whenever the user connects to GC at a later time, the engine will check for any differences between the remote achievement state and local achievement state, and merge the two, updating the remote side by unlocking achievements without showing a UI.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> If achievements ever have their IDs set to -1, then the achievement was not properly downloaded, UniqueAchievementPrefix and or the EpicUniqueAchievementPrefix were not set up correctly.
<p />
<h3><a name="Achievement example"></a> Achievement example </h3>
In this example, an achievement handler actor class is created to allow you to forward achievement calls to it. You can of course, shift this into another class such as your custom GameInfo class. The achievement handler works by storing a pending achievement list (in case several achievements are earned in rapid succession), then calling asynchronous functions which will loop between themselves until all of the pending achievements have been unlocked.
<p />
To unlock an achievement, YourAchievementHandler::UnlockAchievement() is called with the achievement id as a parameter. This achievement id must match the number at the end of the achievement id. For example, an achievement with the id of <strong>com.epicgames.exploreue3.achievement_01</strong> will have the achievement id of 1. Remember that achievement ids usually always start with 1 and not 0.
<p />
The first check is to ensure that the achievement id is within the pending achievements array. This prevents achievements from being unlocked multiple times. If the achievement handler is not currently processing any achievements, then start processing the pending achievements and set the ProcessingAchievements flag true. This is to start the asynchronous achievement processing loop.
<p />
From here a delegate which is called when achievements have been read from the server is finished is assign, and the asynchronous call to read the achievements is performed.
<p />
<div class="codetitlebar">
<strong><em>YourAchievementHandler.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
class YourAchievementHandler extends Actor;

// Pending achievements
var array&#60;int&#62; PendingAchievements;
// True if we&#39;re currently processing achievements
var bool ProcessingAchievements;

/&#42;&#42;
 &#42; Unlocks an achievement for the player
 &#42;
 &#42; &#64;param    AchievementId      Which achievement to unlock
 &#42; &#64;param    LocalUserNum      Local user index
 &#42;/
function UnlockAchievement(int AchievementId)
{
  local OnlineSubsystem OnlineSubsystem;
  local int PlayerControllerId;

  // This achievement is already pending, and is in progress so just wait
  if (PendingAchievements.Find(AchievementId) !&#61; INDEX&#95;NONE)
  {
    return;
  }

  // Add the achievement id to the pending list
  PendingAchievements.AddItem(AchievementId);

  // If we&#39;re not processing achievements right now, process one now
  if (!ProcessingAchievements)
  {
    // Connect to GameCenter and link up the achievement delegates
    OnlineSubsystem &#61; class&#39;GameEngine&#39;.static.GetOnlineSubsystem();
    if (OnlineSubsystem !&#61; None &#38;&#38; OnlineSubsystem.PlayerInterface !&#61; None)
    {
      // Grab the local player controller id
      PlayerControllerId &#61; GetALocalPlayerControllerId();

      // Assign the read achievements delegate
      OnlineSubsystem.PlayerInterface.AddReadAchievementsCompleteDelegate(PlayerControllerId, InternalOnReadAchievementsComplete);

      // Read all achievements
      OnlineSubsystem.PlayerInterface.ReadAchievements(PlayerControllerId);

      // set true, to prevent this from being fired off again
      ProcessingAchievements &#61; true;
    }
  }
}
</pre>
</div>
<p />
This function is a simple helper function which returns the local player controller id.
<p />
<div class="codetitlebar">
<strong><em>YourAchievementHandler.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
/&#42;&#42;
 &#42; Returns a local player controller id. Same rules apply to Actor::GetALocalPlayerController().
 &#42;
 &#42; &#64;return    Returns a local player controller id
 &#42;/
function int GetALocalPlayerControllerId()
{
  local PlayerController PlayerController;
  local LocalPlayer LocalPlayer;

  // Get the local player controller
  PlayerController &#61; GetALocalPlayerController();
  if (PlayerController &#61;&#61; None)
  {
    return INDEX&#95;NONE;
  }

  // Get the local player information
  LocalPlayer &#61; LocalPlayer(PlayerController.Player);
  if (LocalPlayer &#61;&#61; None)
  {
    return INDEX&#95;NONE;
  }

  return class&#39;UIInteraction&#39;.static.GetPlayerIndex(LocalPlayer.ControllerId);
}
</pre>
</div>
<p />
When the achievements data have been read from Game Center, YourAchievementHandler::InternalOnReadAchievementsComplete() is called. The DownloadedAchievements array is first cleared to ensure that there is no data there and PlayerInterface::GetAchievements() is the called to fill the DownloadedAchievements array with the recently downloaded achievement data.
<p />
From there we can perform a quick array index search using the first pending achievement id as the key. If the achievement was not achieved online, then the delegate which is called when an achievement is unlocked is set and PlayerInterface::UnlockAchievement() is then called. This starts the asynchronous request to unlock the achievement through Game Center. The read achievements delegate is then removed so that garbage collection can properly occur.
<p />
<div class="codetitlebar">
<strong><em>YourAchievementHandler.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
class YourAchievementHandler extends Actor;

// Array of all downloads achievements
var array&#60;AchievementDetails&#62; DownloadedAchievements;

/&#42;&#42;
 &#42; Called when the async achievements read has completed
 &#42;
 &#42; &#64;param    TitleId      The title id that the read was for (0 means current title)
 &#42;/
function InternalOnReadAchievementsComplete(int TitleId)
{
  local OnlineSubsystem OnlineSubsystem;
  local int AchievementIndex, PlayerControllerId;

  // Ensure we have an online subsystem, and an associated player interface
  OnlineSubsystem &#61; class&#39;GameEngine&#39;.static.GetOnlineSubsystem();
  if (OnlineSubsystem &#61;&#61; None &#124;&#124; OnlineSubsystem.PlayerInterface &#61;&#61; None)
  {
    return;
  }

  // Grab the local player controller id
  PlayerControllerId &#61; GetALocalPlayerControllerId();

  // Clear the currently downloaded achievements array as we&#39;re copying the fresh data
  DownloadedAchievements.Remove(0, DownloadedAchievements.Length);

  // Read the achievements into the downloaded achievements array
  OnlineSubsystem.PlayerInterface.GetAchievements(PlayerControllerId, DownloadedAchievements, TitleId);

  // Grab all of the achievements
  if (DownloadedAchievements.Length &#62; 0 &#38;&#38; PendingAchievements.Length &#62; 0)
  {
    // Grab the achievement index
    AchievementIndex &#61; DownloadedAchievements.Find(&#39;Id&#39;, PendingAchievements&#91;0]);

    // Unlock the achievement
    if (AchievementIndex !&#61; INDEX&#95;NONE &#38;&#38; !DownloadedAchievements&#91;AchievementIndex].bWasAchievedOnline)
    {
      // Assign the unlock achievement complete delegate
      OnlineSubsystem.PlayerInterface.AddUnlockAchievementCompleteDelegate(PlayerControllerId, InternalOnUnlockAchievementComplete);

      // Start the unlocking process
      OnlineSubsystem.PlayerInterface.UnlockAchievement(PlayerControllerId, PendingAchievements&#91;0]);
    }
  }

  // Remove the delegate reference so that garbage collection can occur
  OnlineSubsystem.PlayerInterface.ClearReadAchievementsCompleteDelegate(PlayerControllerId, InternalOnReadAchievementsComplete);
}
</pre>
</div>
<p />
When Game Center responds saying that the achievement has been unlocked, YourAchievementHandler::InternalOnUnlockAchievementComplete() will be called as it was assigned to the delegate earlier. This is where you would show something on the graphical user interface and or play a sound to indicate that an achievement had been unlocked. The achievement id is then popped off the PendingAchievements array. If the PendingAchievements array still has more achievement ids to be unlocked, then the process is looped again. Otherwise, the delegates used are cleaned up and the ProcessingAchievements flag is set back false.
<p />
<div class="codetitlebar">
<strong><em>YourAchievementHandler.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
class YourAchievementHandler extends Actor;

/&#42;&#42;
 &#42; Called when the achievement unlocking has completed
 &#42;
 &#42; &#64;param bWasSuccessful true if the async action completed without error, false if there was an error
 &#42;/
function InternalOnUnlockAchievementComplete(bool bWasSuccessful)
{
  local OnlineSubsystem OnlineSubsystem;
  local PlayerController PlayerController;
  local int AchievementIndex, PlayerControllerId;

  // Grab the local player controller id
  PlayerControllerId &#61; GetALocalPlayerControllerId();

  if (bWasSuccessful &#38;&#38; PendingAchievements.Length &#62; 0)
  {
    // Grab the local player controller
    PlayerController &#61; GetALocalPlayerController();
    if (PlayerController !&#61; None)
    {
      // Grab the achievement index
      AchievementIndex &#61; DownloadedAchievements.Find(&#39;Id&#39;, PendingAchievements&#91;0]);

      // Show the achievement on the user interface players
    }
  }

  // Pop the processed achievement regardless of whether it succeeded or not
  PendingAchievements.Remove(0, 1);

  // Ensure we have an online subsystem, and an associated player interface
  OnlineSubsystem &#61; class&#39;GameEngine&#39;.static.GetOnlineSubsystem();
  if (OnlineSubsystem &#61;&#61; None &#124;&#124; OnlineSubsystem.PlayerInterface &#61;&#61; None)
  {
    return;
  }

  // If we still have pending achievements left, process the next one
  if (PendingAchievements.Length &#62; 0)
  {
    // Connect to GameCenter and link up the achievement delegates
    // Assign the read achievements delegate
    OnlineSubsystem.PlayerInterface.AddReadAchievementsCompleteDelegate(PlayerControllerId, InternalOnReadAchievementsComplete);

    // Read all achievements
    OnlineSubsystem.PlayerInterface.ReadAchievements(PlayerControllerId);
  }
  else // Otherwise, we&#39;re finished so clean up
  {
    // Clear the delegate bind
    OnlineSubsystem.PlayerInterface.ClearUnlockAchievementCompleteDelegate(PlayerControllerId, InternalOnUnlockAchievementComplete);

    // Set the flag to state that we&#39;re no longer processing achievements
    ProcessingAchievements &#61; false;
  }
}
</pre>
</div>
<p />
Finally it is important to ensure that all delegate references have been cleared; otherwise garbage collection can occur correctly.
<p />
<div class="codetitlebar">
<strong><em>YourAchievementHandler.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
class YourAchievementHandler extends Actor;

/&#42;&#42;
 &#42; Called when the actor is destroyed
 &#42;/
event Destroyed()
{
  local OnlineSubsystem OnlineSubsystem;
  local int PlayerControllerId;

  Super.Destroyed();

  // Ensure we have an online subsystem, and an associated player interface
  OnlineSubsystem &#61; class&#39;GameEngine&#39;.static.GetOnlineSubsystem();
  if (OnlineSubsystem &#61;&#61; None &#124;&#124; OnlineSubsystem.PlayerInterface &#61;&#61; None)
  {
    return;
  }

  // If we&#39;re still processing achievements, delegates assigned must be clear so that garbage collection can occur
  if (ProcessingAchievements)
  {
    // Grab the local player controller id
    PlayerControllerId &#61; GetALocalPlayerControllerId();

    // Remove the delegate reference so that garbage collection can occur
    OnlineSubsystem.PlayerInterface.ClearReadAchievementsCompleteDelegate(PlayerControllerId, InternalOnReadAchievementsComplete);

    // Clear the delegate bind
    OnlineSubsystem.PlayerInterface.ClearUnlockAchievementCompleteDelegate(PlayerControllerId, InternalOnUnlockAchievementComplete);
  }
}
</pre>
</div>
<p />
<h2><a name="Leader boards"></a> Leader boards </h2>
<hr size="1" noshade="noshade">
<p />
<img src="rsrc/Three/GameCenter/Leaderboard.png" alt="Leaderboard.png" width='595' height='224' />
<p />
The other major non-multiplayer feature of GC is leader boards. Again, they tend to work in a similar fashion to other platforms, but there are some limitations to GC leader boards. GC actually only supports one "leader board" with multiple "categories". We treat the categories as columns in a table for the one leader board. However, all categories are displayed, with their UI, with the same format and label, so all categories could be time, or integer points, or integer kills, etc. Additionally they are all either ascending or descending. This will affect how you set up your scores.
<p />
To report scores, you create a subclass of <strong>OnlineStatsWrite</strong> and set up its properties (with 1 based IDs) in the defaultproperties block. From there, you create an instance of the object, set the values, and then report with <strong>OnlineSub.StatsInterface.WriteOnlineStats()</strong>.
<p />
<div class="codetitlebar">
<strong><em>YourOnlineStatsWrite.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
class YourOnlineStatsWrite extends OnlineStatsWrite;

const PROPERTY&#95;KILLS &#61; 1;
const PROPERTY&#95;LEVEL &#61; 2;
const PROPERTY&#95;GOLD &#61; 3;

defaultproperties
{
  Properties&#61;((PropertyId&#61;PROPERTY&#95;KILLS,Data&#61;(Type&#61;SDT&#95;Int32,Value1&#61;0)),(PropertyId&#61;PROPERTY&#95;LEVEL,Data&#61;(Type&#61;SDT&#95;Int32,Value1&#61;0)),(PropertyId&#61;PROPERTY&#95;GOLD,Data&#61;(Type&#61;SDT&#95;Int32,Value1&#61;0)))
}
</pre>
</div>
<p />
GC does not support incremental leader boards. If you want to increment a score, kills for instance, you will need to: <ul>
<li> Read a saved value of the player's kills (you could use a configuration value or BasicSaveObject/BasicLoadObject)
</li> <li> Increment the value accordingly
</li> <li> Write the scores to Game Center
</li></ul>
<p />
To display scores you can use GC's built-in UI by calling:
<p />
<div class="codesnippet">
<pre>
local OnlineSubsystem OnlineSubsystem;
local OnlineSuppliedUIInterface OnlineSuppliedUIInterface;
local array&#60;UniqueNetId&#62; PlayerIds;
local UniqueNetId PlayerId;
local YourOnlineStatsRead YourOnlineStatsRead;
local PlayerController PlayerController;
local LocalPlayer LocalPlayer;
local byte LocalUserNum;

// Get the online sub system
OnlineSubSystem &#61; class&#39;GameEngine&#39;.static.GetOnlineSubsystem();
// Check that the online subsystem is accessible
if (OnlineSubSystem !&#61; None)
{
  // Create the PlayerIds array from the local player controller
  PlayerController &#61; GetALocalPlayerController();
  if (PlayerController !&#61; None)
  {
    // Get the local player
    LocalPlayer &#61; LocalPlayer(PlayerController.Player);
    if (LocalPlayer !&#61; None)
    {
      // Get the local user num
      LocalUserNum &#61; class&#39;UIInteraction&#39;.static.GetPlayerIndex(LocalPlayer.ControllerId);
      // Get the unique player id from the local user num
      OnlineSubSystem.PlayerInterface.GetUniquePlayerId(LocalUserNum, PlayerId);
      // Add the unique player id to the player ids array
      PlayerIds.AddItem(PlayerId);

      // Get the online supplied UI interface
      OnlineSuppliedUIInterface &#61; OnlineSuppliedUIInterface(OnlineSubSystem.GetNamedInterface(&#39;SuppliedUI&#39;));
      if (OnlineSuppliedUIInterface !&#61; None)
      {
        // Instance the online stats read class
        YourOnlineStatsRead &#61; new () class&#39;YourOnlineStatsRead&#39;;
        if (YourOnlineStatsRead!&#61; None)
        {
          // Show the online stats UI
          OnlineSuppliedUIInterface.ShowOnlineStatsUI(PlayerIds, YourOnlineStatsRead);
        }
      }
    }
  }
}
</pre>
</div>
<p />
<div class="codetitlebar">
<strong><em>YourOnlineStatsRead.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
class YourOnlineStatsRead extends OnlineStatsRead;

const PROPERTY&#95;KILLS &#61; 1;
const PROPERTY&#95;LEVEL &#61; 2;
const PROPERTY&#95;GOLD &#61; 3;

defaultproperties
{
  ColumnIds&#61;(PROPERTY&#95;KILLS,PROPERTY&#95;LEVEL,PROPERTY&#95;GOLD)
}
</pre>
</div>
<p />
If you read multiple rows of multiple columns, then the rows will be sorted based on the first column (this may change later to use a ranking column).
<p />
<h3><a name="Leaderboard technical details"></a> Leaderboard technical details </h3>
Similar to the achievements, if a score is reported while the user is offline, GC won't automatically resubmit it. So, we do a lot under the hood to save the highest and lowest score reported to disk, and then we report them to the server next time the user signs in. We don't know if the leader board is ascending or descending, which is why it submits highest and lowest.
<p />
When reading stats, all the scores are reported as QWORDs / Int64s (64 bit integers, which have a range of − 9,223,372,036,854,775,808 to 9,223,372,036,854,775,807), which is how GC stores leader board values.
<p />
<h2><a name="Multiplayer"></a> Multiplayer </h2>
<hr size="1" noshade="noshade">
<p />
Multiplayer is supported, currently only as lobby-based-matchmaking with up to four players. Due to GC handling the network traffic via a <strong>GKMatch</strong> object, only players discovered via GC matchmaking can be communicated with for game networking. One of the four iOS devices will act as the server.
<p />
<!--  -->
<p />
<h3><a name="Matchmaking"></a> Matchmaking </h3>
Matchmaking is performed using GC's built-in interface:
<p />
<div class="codesnippet">
<pre>
   OnlineSuppliedUIInterface(OnlineSub.GetNamedInterface(&#39;SuppliedUI&#39;)).ShowMatchmakingUI();
</pre>
</div>
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> The GameSettings object that is passed to <strong>ShowMatchmakingUI()</strong> is currently unused and can be None.
<p />
Currently there is no way to choose who is the server - each player enters matchmaking mode, and then one is chosen as server, and the rest are clients (for a given set of players, the same player will always be the server - it uses the unique identifiers of each player to decide who is the server, this way each device knows if they are a client or server without additional communication).
<p />
Depending on if the player is chosen as server or client, one of two delegates will be called after matchmaking completes. For servers, the <strong>OnCreateOnlineGameComplete()</strong> delegate will be called. For clients, the <strong>OnJoinOnlineGameComplete()</strong> delegate will be called. You should register both of those delegates in your game to handle both cases.
<p />
In your Join (client-side) delegate, you can use <strong>OnlineSub.GameInterface.GetResolvedConnectString(SessionName,URL)</strong> to retrieve a URL that can be used to travel to the server (via <strong>ClientTravel(URL, TRAVEL_Absolute)</strong>).
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Important:</strong> When accepting an invitation (see below), <strong>PlayerController</strong> has code that will add a Join delegate and then travel to the URL. See <strong>OnInviteJoinComplete()</strong> in PlayerController.uc. Because of this you only need to register a Join delegate when the user has chosen to enter matchmaking mode.
<p />
In your Create (server-side) delegate, you would generally do something like <strong>ClientTravel(SomeURL, TRAVEL_Absolute)</strong> to load the map. Clients will have the server connection information, and will join the server by opening the connection URL. This delegate will be used if the user entered matchmaking or if they accepted an invite and was then chosen to be the server, so you should always have a Create delegate registered.
<p />
<h3><a name="Invitations"></a> Invitations </h3>
GC supports inviting players from its matchmaking UI. If the invited player is playing a different game, they will see an invitation message, and if they accept the invitation, it will launch your game, and when the game boots up, the GC matchmaking UI will slide up to show the player they are joining the match.
<p />
If the player is already in your game, the code in <strong>PlayerController</strong> (see <strong>OnGameInviteAccepted()</strong>) will tear down any current online game, and then bring up the GC matchmaking UI to show the player they are joining the match. Note that the invited player may actually become the server.
<p />
<h3><a name="Voice chat"></a> Voice chat </h3>
GC has a very basic, easy-to-use Voice Chat system. After you have entered a multi player game, you could call <strong>OnlineSub.VoiceInterface.StartNetworkedVoice()</strong> to have the players talk to each other. Muting and querying for who is talking works as well, using the standard functions <strong>MuteRemoteTalker()</strong>, <strong>IsRemotePlayerTalking()</strong>, etc.
<p />
<h2><a name="Garbage Collection"></a> Garbage Collection </h2>
<hr size="1" noshade="noshade">
Whenever you bind to any of the Online Subsystem delegates, it is important to ensure that they are always cleared whenever the level is scheduled for garbage collection. This is important, as otherwise, garbage collection will fail causing chunks of memory to never be released! The <a href="KismetOnlineSubsystem.html#GarbageCollection" class="twikiAnchorLink">Kismet Online Subsystem</a> development kit gem describes this in further detail.
<p />
<h2><a name="Related Topics"></a> Related Topics </h2>
<hr size="1" noshade="noshade"> <ul>
<li> <a href="KismetOnlineSubsystem.html" class="twikiLink">Kismet Online Subsystem</a> - This development kit gem demonstrates how to add Kismet nodes which interface with Game Center.
</li></ul>
<p />
<h2><a name="Downloads"></a> Downloads </h2>
<hr size="1" noshade="noshade"> <ul>
<li> <a href="rsrc/Three/GameCenter/YourAchievementHandler.uc" target="_top">YourAchievementHandler.uc</a> - Download the source code for the Achievement example.
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
