<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | CrowdSystem    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">CrowdSystem  </b></div>
<div id="tooltext">
<a href="CrowdSystemJP.html" class="twikiLink">日本語訳</a><br><a href="CrowdSystemCH.html" class="twikiLink">中国翻译</a><br><a href="CrowdSystemKR.html" class="twikiLink">한국어</a><br>

<!-- Three/CrowdSystem -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="AIAndNavigationHome.html" class="twikiLink">AI &amp; Navigation</a></b> &gt; Crowd System <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="LevelDesignerHome.html" class="twikiLink">Level Designer</a></b> &gt; Crowd System <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="CinematicArtistHome.html" class="twikiLink">Cinematic Artist</a></b> &gt; Crowd System
</div>
<hr size="1" noshade="noshade">
<p />
<h1><a name="Crowd System"></a> Crowd System </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="CrowdSystem.html#Crowd System"> Crowd System</a> <ul>
<li> <a href="CrowdSystem.html#Overview"> Overview</a>
</li> <li> <a href="CrowdSystem.html#How it works"> How it works</a>
</li> <li> <a href="CrowdSystem.html#Crowd population manager toggle Kismet sequence action"> Crowd population manager toggle Kismet sequence action</a>
</li> <li> <a href="CrowdSystem.html#Crowd Spawner Kismet Action"> Crowd Spawner Kismet Action</a>
</li> <li> <a href="CrowdSystem.html#GameCrowdAgent"> GameCrowdAgent</a>
</li> <li> <a href="CrowdSystem.html#GameCrowdAgentBehavior"> GameCrowdAgentBehavior</a>
</li> <li> <a href="CrowdSystem.html#GameCrowdInteractionPoint"> GameCrowdInteractionPoint</a>
</li> <li> <a href="CrowdSystem.html#SeqEvent_CrowdAgentReachedDestination"> SeqEvent_CrowdAgentReachedDestination</a>
</li> <li> <a href="CrowdSystem.html#SeqAct_PlayAgentAnimation"> SeqAct_PlayAgentAnimation</a>
</li> <li> <a href="CrowdSystem.html#Downloads"> Downloads</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This document describes the new crowd system implemented in the GameFramework package. It replaces the original Unreal Engine 3 crowd system described in <a href="https://udn.epicgames.com/Three/OldCrowdSystem" class="restricted" class="restricted" class="twikiLink">OldCrowdSystem</a>.
<p />
This crowd system is designed to allow level designers to add 'crowds' of animated characters to a map, and control their movement and animations through a network of crowd destinations and kismet interaction.  Agent types are defined using archetypes, and a "plug-in" behavior system allows level designers to control the interaction of crowd agents with players and other NPCs.
<p />
<img src="rsrc/Three/CrowdSystem/crowdpic.jpg"/>
<p />
There are currently no crowd-specific rendering optimizations in the engine. Each member of the crowd has a unique AnimTree and skeletal mesh instance. However, the system does avoid the most expensive part of character simulation which is Unreal walking physics and full AI. After walking physics, the next most expensive part of a crowd of meshes is skinning all the graphics vertices, so you should keep the SkeletalMesh used as low-poly and low-bone as possible (we use around 1000-1500 polys and 20 bones). You should probably also make aggressive use of LOD.
<p />
<p />
<h2><a name="How it works"></a> How it works </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
As mentioned above, crowd 'agents' are not Pawns, and do not use PHYS_Walking. Instead, they use a movement model that follows a set of simple rules. One important thing to remember is that they do <em>not</em> perform collision against level geometry. Instead they move along the navigation mesh to ensure they don't pass through the geometry of the map. They can however perform a cheaper zero-extent line trace to ensure they conform to uneven surfaces.
<p />
All game specific implementations will have at a minimum to include a non-abstract crowd spawner or population manager toggle and crowd agent class. For example, UTGame contains a very basic example implementation of the crowd system with the UT specific crowd spawner Kismet SeqAct_UTCrowdSpawner sequence action, and crowd agent class <strong>UTGameCrowdAgent</strong> which is used as the base class for UT agent archetypes.
<p />
<p />
<h2><a name="Crowd population manager toggle Kismet sequence action"></a> Crowd population manager toggle Kismet sequence action </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This Kismet action is used to toggle the crowd population manager on or off. There is only one population manager ever active. It attempts to fill the area around the player with agents by spawning new agents at nearby positions between <strong>GameCrowdDestinations</strong> not currently visible to the player, taking into account the predicted position of the player in a few seconds, and removing "stale" agents which are no longer visible or relevant to the player to maintain a consistent agent count.
<p />
<h3><a name="Input Links"></a> Input Links </h3> <ul>
<li> <strong>Start</strong> - Enable the population manager. Update its properties based on the editable properties of this toggle action.
</li> <li> <strong>Stop</strong> - Disable the population manager.
</li></ul>
<p />
<h3><a name="Specifying agents to spawn"></a> Specifying agents to spawn </h3>
A population manager can spawn multiple types of agents with varying frequencies for each agent type. The set of agent types to spawn is specified by a <strong>GameCrowd_ListOfAgents</strong> archetype, allowing the list to be easily re-used by different spawners or population managers. Within this list, the agent types are specified using archetypes, as described in the Agent Archetype section. The spawn frequency of each archetype is affected by the associated <strong>FrequencyModifier</strong>. The likelihood of a specific archetype being chosen is equal to his <strong>FrequencyModifier</strong> divided by the sum of all the <strong>FrequencyModifiers</strong>.
<p />
If an agent archetype entry has <strong>GroupMembers</strong> specified, agents based on these archetypes will be spawned and grouped with the primary agent. Grouped agents will move together, but will not queue (so destinations they use must have room for the entire group).
<p /> <ul>
<li> <strong>CrowdAgentList</strong> - List of archetypes of agents spawned by this population manager.
</li> <li> <strong>bClearOldArchetypes</strong> - If true, clear old population manager archetype list rather than adding to it with this toggle action's <strong>CrowdAgentList</strong>.
</li></ul>
<p />
<h3><a name="Spawning"></a> Spawning </h3>
You spawn agents in a similar manner to a particle system, but you specify the location to spawn agents using one or more actors in the level.  These are normally <strong>GameCrowdDestinations</strong>, but can be any type of actor (must be <strong>GameCrowdDestination</strong> for agent to move between destinations).
<p /> <ul>
<li> <strong>SpawnRate</strong> - How many agents per second will be spawned.
</li> <li> <strong>MaxAgents</strong> - The maximum number of agents alive at one time. If agents are destroyed, more will spawn to meet this number.
</li> <li> <strong>WarmupPct</strong> - Percentage of max population to immediately spawn when the population manager is toggled on (without respecting visibility checks).  Range is 0.0 to 1.0.
</li> <li> <strong>bKillAgentsInstantly</strong> - If true, destroy all crowd agents instantly when the population manager is disabled, instead of letting them die off slowly as they lose relevance.
</li> <li> <strong>MaxSimulationDistance</strong> - Max distance from camera relevant for population simulation.
</li></ul>
<p />
<p />
<h3><a name="Graphics and animation"></a> Graphics and animation </h3>
Crowd agents use the standard UE3 animation system. They use a LightEnvironment for lighting (like Pawns), but by default do not cast dynamic shadows for speed unless overridden by the crowd spawner. The mesh and animations used by agents are defined by their archetype, as described later.
<p /> <ul>
<li> <strong>bEnableCrowdLightEnvironment</strong> - Whether to enable the light environment on crowd members.
</li> <li> <strong>bCastShadows</strong> - Whether crowd members should cast shadows.
</li></ul>
<p />
<p />
<h2><a name="Crowd Spawner Kismet Action"></a> Crowd Spawner Kismet Action </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This latent Kismet action is used to spawn crowd agents. It contains the parameters for which agent archetypes to spawn.
<p />
<img src="rsrc/Three/CrowdSystem/GameCrowdSpawner.jpg"/>
<p />
<h3><a name="Input Links"></a> Input Links </h3> <ul>
<li> <strong>Start</strong> - Start crowd agents being spawned.
</li> <li> <strong>Stop</strong> - Stop spawning new agents.
</li> <li> <strong>Destroy All</strong> - Destroy all agents which have been spawned by this action. (will not play death animations)
</li> <li> <strong>Spawn Points</strong> - Where agents will be spawned. Normally a GameCrowdDestination, but can be any actor (must be <strong>GameCrowdDestination</strong> for agent to move between destinations).
</li></ul>
<p />
<h3><a name="Output Links"></a> Output Links </h3> <ul>
<li> <strong>Agent Spawned</strong> - Triggered when an agent is spawned.
</li> <li> <strong>Spawned Agent</strong> - Outputs the last spawned agent.
</li></ul>
<p />
<h3><a name="Specifying Agents to spawn"></a> Specifying Agents to spawn </h3>
A crowd spawner can spawn multiple types of agents with varying frequencies for each agent type. The set of agent types to spawn is specified by a <strong>GameCrowd_ListOfAgents</strong> archetype, allowing the list to be easily re-used by different spawners or population managers.  Within this list, the agent types are specified using archetypes, as described in the Agent Archetype section.  The spawn frequency of each archetype is affected by the associated <strong>FrequencyModifier</strong>. The likelihood of a specific archetype being chosen is equal to his <strong>FrequencyModifier</strong> divided by the sum of all the <strong>FrequencyModifiers</strong>.
<p />
If an agent archetype entry has <strong>GroupMembers</strong> specified, agents based on these archetypes will be spawned and grouped with the primary agent.  Grouped agents will move together, but will not queue (so destinations they use must have room for the entire group).
<p /> <ul>
<li> <strong>CrowdAgentList</strong> - List of archetypes of agents spawned by this crowd spawner.
</li></ul>
<p />
<h3><a name="Graphics And Animation"></a> Graphics And Animation </h3>
Crowd agents use the standard UE3 animation system. They use a LightEnvironment for lighting (like player Pawns), but by default do not cast dynamic shadows for speed unless overridden by the crowd spawner.  The mesh and animations used by agents are defined by their archetype, as described later.
<p /> <ul>
<li> <strong>AgentLightingChannel</strong> - Lighting channels to put the agents in.
</li> <li> <strong>bEnableCrowdLightEnvironment</strong> - Whether to enable the light environment on crowd members.
</li> <li> <strong>bCastShadows</strong> - Whether crowd members should cast shadows.
</li></ul>
<p />
<h3><a name="Spawning"></a> Spawning </h3>
You spawn agents in a similar manner to a particle system, but you specify the location to spawn agents using one or more actors in the level.  These are normally <strong>GameCrowdDestinations</strong>, but can be any type of actor (must be <strong>GameCrowdDestination</strong> for agent to move between destinations).
<p /> <ul>
<li> <strong>SpawnRate</strong> - How many agents per second will be spawned at the target actor(s).
</li> <li> <strong>SpawnNum</strong> - The maximum number of agents alive at one time. If agents are destroyed, more will spawn to meet this number.
</li> <li> <strong>SpawnRadius</strong> - Radius around target actor(s) to spawn agents.
</li> <li> <strong>bOnlySpawnHidden</strong> - If true, only spawn agents if player can't see spawn point.
</li> <li> <strong>AgentWarmupTime</strong> - Average time to "warm up" spawned agents before letting them sleep if not rendered.
</li> <li> <strong>bRespawnDeadAgents</strong> - If true, agents that are totally removed (ie blown up) are respawned.
</li> <li> <strong>SplitScreenNumReduction</strong> - How much to reduce number by in splitscreen.
</li> <li> <strong>bCycleSpawnLocs</strong> - If true, the spawner will cycle through the spawn locations instead of spawning from a randomly chosen one.
</li> <li> <strong>bWarmupPosition</strong> - If true, agent will try to find an starting position at a random spot between the initial spawn position and its initial destination that isn't in the player's line of sight.
</li></ul>
<p />
<h4><a name="Move To Destination"></a> Move To Destination </h4>
Newly spawned agents will pick a <strong>GameCrowdDestination</strong> to move toward.  This destination will chosen from the destination list in the <strong>GameCrowdDestination</strong> used as a spawn location, or from among the <strong>GameCrowdDestinations</strong> attached to the <strong>Destinations</strong> input of the crowd spawner. The crowd spawner can also override the agent archetype's base settings to force (more expensive) navigation mesh path finding and obstacle blocking to be used.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> Obstacle blocking currently has some issues, so its use is not recommended at this time. Without obstacle blocking, you may occasionally see agents pass through walls or fall off ledges even when using path finding.
<p /> <ul>
<li> <strong>bForceObstacleChecking</strong> - If true, force obstacle checking for all agents from this spawner.
</li> <li> <strong>bForceNavMeshPathing</strong> - If true, force nav mesh navigation for all agents from this spawner.
</li></ul>
<p />
<p />
<h2><a name="GameCrowdAgent"></a> GameCrowdAgent </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This is the base Actor class of crowd agents.  Agent archetypes, which can be created by artists and level designers,  will be based on a game specific subclass of <strong>GameCrowdAgent</strong>.  Agent archetypes have a number of editable properties.
<p />
<h3><a name="Graphics And Animation"></a> Graphics And Animation </h3>
The visual properties of agents are specified by their archetype.  Typical crowd members will used skeletal animated meshes with an archetype based on a <strong>GameCrowdAgentSkeletal</strong> subclass.
<p /> <ul>
<li> <strong>SkeletalMeshComponent</strong> - SkeletalMeshComponent used for crowd member mesh. The mesh, AnimTree template, and animation sets used by the agent will need to be set.
</li> <li> <strong>WalkAnimNames</strong> - The names of the animation loops to use when moving slowly.
</li> <li> <strong>RunAnimNames</strong> - The name of the animations to use when moving more quickly.
</li> <li> <strong>MeshMinScale3D, MeshMaxScale3D</strong> - Range of 3D drawscales to apply to the agent mesh.
</li> <li> <strong>AmbientSoundCue</strong> - Ambient Sound cue played by this agent.
</li></ul>
<p />
The following properties have an effect on agent animation only if root motion velocity (bUseRootMotionVelocity, described below) is not being used and the agent's AnimTree has a SpeedBlendNode.
<p /> <ul>
<li> <strong>SpeedBlendStart</strong> - Below this speed, the walking animation is used.
</li> <li> <strong>SpeedBlendEnd</strong> - Above this speed, the running animation is used. Between this and SpeedBlendStart the animations are blended.
</li> <li> <strong>AnimVelRate</strong> - This controls how the animation playback rate changes based on the speed of the agent.
</li> <li> <strong>MaxSpeedBlendChangeSpeed</strong> - Limits how quickly blending between running and walking can happen.
</li> <li> <strong>MoveSyncGroupName</strong> - Name of sync group for movement, whose rate is scaled.
</li></ul>
<p />
The agent animation code makes certain assumptions about how the agent AnimTree is set up.  It expects to find animation nodes with the following names <strong>SpeedBlendNode</strong>, <strong>ActionBlendNode</strong>, <strong>ActionSeqNode</strong>, <strong>WalkSeqNode</strong>, and <strong>RunSeqNode</strong>, as well as a <strong>bIsPanicked</strong> AnimNodeBlendByProperty node, to implement all supported functionality.
<p />
<img src="rsrc/Three/CrowdSystem/AgentAnimTree.jpg" />
<p />
<p />
<h3><a name="Agent attachments"></a> Agent attachments </h3>
Agent archetypes can also be specified to spawn with random attachments specified in the Attachments array.
<p /> <ul>
<li> <strong>Attachments</strong> - List of sets of meshes to attach to agent. <ul>
<li> <strong>SocketName</strong> - Name of socket to attach mesh to. <ul>
<li> <strong>List</strong> - List of possible meshes to attach to this socket. <ul>
<li> <strong>StaticMesh</strong> - Mesh to attach.
</li> <li> <strong>Chance</strong> - Chance of choosing this attachment.
</li> <li> <strong>Scale3D</strong> - Scaling applied to mesh when attached.
</li></ul>
</li></ul>
</li></ul>
</li></ul>
<p />
<h3><a name="Movement"></a> Movement </h3>
Here are the rules that a crowd agent will follow, with the settings within the agent archetype that relates to each. Each rule generates a force that is applied to the agent.  The current agent movement system treats agents as particles moving in a flock. In the future, agent movement may move to a system using reciprocal velocity obstacles (<a href="http://gamma.cs.unc.edu/RVO/icra2008.pdf" target="_top">http://gamma.cs.unc.edu/RVO/icra2008.pdf</a>).
<p />
<h4><a name="Obstacle avoidance"></a> Obstacle avoidance </h4>
Agents do not perform normal collision checking, and therefore may pass through level geometry.  There is an option for agents to perform obstacle checking using the navigation mesh, which will prevent agents from penetrating geometry or falling off ledges.  Even without obstacle checking, agents will typically behave well if they are using navigation mesh pathing.
<p /> <ul>
<li> <strong>bCheckForObstacles</strong> - Whether to have obstacle mesh block agents.
</li></ul>
<p />
<h4><a name="Velocity clamping"></a> Velocity clamping </h4>
Using root motion velocity will provide the best visual results. It requires the animations to have root motion in them. With this option, the agent's movement will generally match its animation, except in some cases where the agent must move more slowly because of obstacles or sharp turns.
<p /> <ul>
<li> <strong>bUseRootMotionVelocity</strong> - If true, clamp velocity based on root motion in movement animations.
</li></ul>
<p />
The following properties only have an effect if root motion velocity is not being used.
<p /> <ul>
<li> <strong>bClampMovementSpeed</strong> - Whether to clamp movement speed.
</li> <li> <strong>MaxWalkingSpeed</strong> - Max walking speed (if not using root motion velocity).
</li> <li> <strong>MaxRunningSpeed</strong> - Max running speed (if not using root motion velocity).
</li> <li> <strong>VelocityDamping</strong> - A force is applied to limit the maximum speed of an agent. Think of this as 'friction'.
</li></ul>
<p />
<h4><a name="Avoid neighbouring agents"></a> Avoid neighbouring agents </h4>
Agents avoid both neighboring agents and pawns. Currently, a simple spring force is used to avoid penetration between agents.  Players using a GamePlayerController derived player controller with <strong>bWarnCrowdMembers</strong> set to true will update crowd members with their position every tick for more accurate avoidance by agents.
<p /> <ul>
<li> <strong>AwareRadius</strong> - Controls how far around an agent the system looks when finding the average speed.
</li> <li> <strong>AvoidOtherStrength</strong> - How hard agents are pushed apart when they overlap.
</li> <li> <strong>AvoidPlayerStrength</strong> - How hard agents are pushed away from player.
</li> <li> <strong>AvoidOtherRadius</strong> - The radius used to check overlap between agents (basically how big an agent is).
</li> <li> <strong>AwareUpdateInterval</strong> - Every how many frames the agents 'awareness' is updated (attractors and other agents).
</li></ul>
<p />
<h4><a name="Move at speed of neighbors"></a> Move at speed of neighbors </h4>
Agents try and move with the average speed of the agents around them.
<p /> <ul>
<li> <strong>MatchVelStrength</strong> - How aggressively an agent matches the speed of its neighbors.
</li></ul>
<p />
<h4><a name="Stay in Group"></a> Stay in Group </h4>
Agents which are grouped (see <strong>GroupMembers</strong> in SeqAct_GameCrowdSpawner) will attempt to stay together, both with the following properties, and through the <strong>GroupWaitingBehaviors</strong> (see Custom Agent Behavior).
<p /> <ul>
<li> <strong>GroupAttractionStrength</strong> - How hard group members are pulled together when beyond <strong>DesiredGroupRadius</strong>.
</li> <li> <strong>DesiredGroupRadius</strong> - Try to keep group members this close together.
</li></ul>
<p />
<h4><a name="Agent path finding"></a> Agent path finding </h4>
Because crowd agents do not do collision checks against the level like players do, they rely on the path finding using the navigation mesh to avoid passing through level geometry. Path finding has some performance cost, so for agents that are only traveling between destinations they can reach directly, it will be more efficient to disable path finding.
<p /> <ul>
<li> <strong>bUseNavMeshPathing</strong> - If true, use navmesh for pathing.
</li> <li> <strong>FollowPathStrength</strong> - Agent acceleration along the path direction (towards  their target).
</li></ul>
<p />
<h4><a name="Agent Rotation"></a> Agent Rotation </h4>
The following properties control agent rotation while traveling.
<p /> <ul>
<li> <strong>MaxYawRate</strong> - Crowd agents rotate to face the direction they are traveling. This value limits how quickly they turn to do this, to avoid them spinning too quickly.
</li> <li> <strong>bAllowPitching</strong> - Whether agent is allowed to pitch as he rotates toward his current travel direction.
</li></ul>
<p />
The following properties control agent rotation when stopped at a <strong>GameCrowdDestination</strong>.
<p /> <ul>
<li> <strong>RotateToTargetSpeed</strong> - This controls how fast an agent will turn to face its target.
</li> <li> <strong>MaxTargetAcquireTime</strong> - Maximum time to try to rotate toward a target before playing animation.
</li></ul>
<p />
<h4><a name="Conforming To Ground"></a> Conforming To Ground </h4>
As mentioned earlier, agents can optionally conform to uneven surfaces using a vertical zero-extent line check. Note that this approach has no concept of 'max step height' and will not correctly handle very steep or vertical surfaces. By default, agents will conform to the surface of the navmesh. For certain special cases, they can be made to conform to world geometry instead.
<p /> <ul>
<li> <strong>ConformType</strong> - How agent conforms to surfaces.
</li> <li> <strong>GroundOffset</strong> - Distance from ground to agent center (used to adjust foot positioning).
</li> <li> <strong>ConformTraceDist</strong> - How far to trace to conform agent to the world geometry.
</li> <li> <strong>ConformTraceInterval</strong> - Every how many frames the 'conform' line check is done.
</li></ul>
<p />
<h3><a name="Crowd Simulation Level of Detail (LOD)"></a> Crowd Simulation Level of Detail (LOD) </h3>
Separately from visual LOD, crowd agents adjust their simulation based on distance from the player and visibility.  Currently six properties are exposed to allow simulation LOD tweaking for agent archetypes.
<p /> <ul>
<li> <strong>NotVisibleLifeSpan</strong> - How long to wait before killing this agent when it isn't visible.
</li> <li> <strong>NotVisibleTickScalingFactor</strong> - Scaling factor for agent ticking when not visible.
</li> <li> <strong>ProximityLODDist</strong> - Distance to LOD out proximity checks for non-visible agents.
</li> <li> <strong>VisibleProximityLODDist</strong> - Distance to LOD out proximity checks for visible agents.
</li> <li> <strong>MaxAnimationDistance</strong> - Maximum distance from camera at which this agent should be animated
</li> <li> <strong>MaxLOSLifeDistance</strong> - Max distance to keep agents around if they haven't been rendered in <strong>NotVisibleLifeSpan</strong>, but are still in player's potential line of sight.
</li></ul>
<p />
<h3><a name="Custom agent behavior"></a> Custom agent behavior </h3>
The default agent behavior is to move between <strong>GameCrowdDestinations</strong>. This default behavior can be overridden using the "plug-in" behavior system. Designers can assign behaviors to trigger based on various game events by creating Behavior Archetypes based on the <strong>GameCrowdAgentBehavior</strong> class (note that this is an Object sub-class, so uncheck "Actor classes only" in the class browser to find it). Several basic behavior classes are implemented in the base crowd system, and additional game specific behaviors can be created for a game project. These behaviors can then be customized by designers in the behavior archetypes. See the <strong>GameCrowdAgentBehavior</strong> entry below for more details.
<p />
When an agent behavior completes or is stopped and no other behavior is assigned to the agent, the agent will return to the default behavior of moving between <strong>GameCrowdDestinations</strong>.
<p />
Behavior archetypes are assigned to agent archetype <strong>BehaviorEntry</strong> arrays, or to the <strong>GameCrowdDestination ReachedBehavior BehaviorEntry</strong> array.  When the appropriate game event is triggered, the agent will be assigned a behavior from the list of possible behaviors for that event. Each <strong>BehaviorEntry</strong> has the following editable properties:
<p /> <ul>
<li> <strong>BehaviorArchetype</strong> - Archetype based on a <strong>GameCrowdAgentBehavior</strong> class.
</li> <li> <strong>BehaviorFrequency</strong> - How often this behavior is picked = BehaviorFrequency/(sum of BehaviorFrequencies).
</li> <li> <strong>bNeverRepeat</strong> - If true, agent will never repeat this behavior.
</li></ul>
<p />
The following editable properties control the behavior of an agent.
<p /> <ul>
<li> <strong>EncounterAgentBehaviors</strong> - Behaviors to choose from when encounter another agent (only if no current behavior). These behaviors are triggered when an agent encounters (within its <strong>AwareRadius</strong>) another agent, with both facing each other.
</li> <li> <strong>GroupWaitingBehaviors</strong> - Behaviors to choose from when waiting for other group members.
</li> <li> <strong>SeePlayerBehaviors</strong> - Behaviors to choose from when see player.
</li> <li> <strong>SeePlayerInterval</strong> - How often see player event can be triggered. If 0, never retriggers.
</li> <li> <strong>SpawnBehaviors</strong> - Behaviors to choose from when agent spawns.
</li> <li> <strong>PanicBehaviors</strong> - Behaviors to choose from when agent panics.
</li> <li> <strong>RandomBehaviors</strong> - Behaviors to choose from randomly at <strong>RandomBehaviorInterval</strong>.
</li> <li> <strong>RandomBehaviorInterval</strong> - Average time between random behavior attempt (only if visible to player and no current behavior).
</li> <li> <strong>Health</strong> - How much damage agent can sustain before dying.
</li> <li> <strong>DeathAnimNames</strong> - Set of possible animation names to play when agent dies.
</li> <li> <strong>DeadBodyDuration</strong> - How long dead body stays around.
</li> <li> <strong>bPreferVisibleDestination</strong> - If true, agent will prefer destinations with line of sight to player if starting from non-L.O.S. destination.
</li> <li> <strong>bPreferVisibleDestinationOnSpawn</strong> - If true, prefer visible destination for first destination chosen after spawn.
</li></ul>
<p />
In addition agent behavior can be controlled through Kismet (for example triggered by an agent reaching a <strong>GameCrowdDestination</strong>).
<p />
<h3><a name="Debugging agent behavior"></a> Debugging agent behavior </h3>
Assuming your game's PlayerController class is derived from <strong>GamePlayerController</strong>, the console command 'CrowdDebug 1' will turn on the display of agent information over nearby agents' heads. The console command 'ShowGameDebug' will display stats information about the crowd population manager, and 'stat crowd' will display crowd system performance statistics.
<p />
<h3><a name="Killing agents"></a> Killing agents </h3>
You can use any pain-causing volume to destroy crowd agents, or a <strong>GameCrowdDestination</strong> can be set to destroy agents which reach it. When killed, a <strong>GameCrowdAgentSkeletal</strong> will play an animation from its <strong>DeathAnimNames</strong> array.
<p />
<strong>GameCrowdAgents</strong> can also be damaged, and will die when their health becomes less than zero. To allow weapon collision they use the <strong>bEnableLineCheckWithBounds</strong> option, which performs line checks against the bounding box of the mesh. This is very approximate, but avoids the cost of an additional CylinderComponent, or doing more expensive per-bone hit tests.
<p />
<h2><a name="GameCrowdAgentBehavior"></a> GameCrowdAgentBehavior </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This is the base class of agent behaviors.  These behavior classes are the basis for creating designer customized behavior archetypes.  A small number of basic behaviors are included in the base crowd system, and additional game specific behaviors can easily be created by game play programmers.
<p />
Behavior archetypes are added to various <strong>BehaviorEntry</strong> arrays in agent archetypes or in <strong>GameCrowdDestinations</strong>. A behavior selected from the appropriate array will be applied to an agent when the required game event occurs.
<p /> <ul>
<li> <strong>bIdleBehavior</strong> - If true, agent should idle (not move between destinations).
</li> <li> <strong>MaxPlayerDistance</strong> - Agent must be within this distance of the player to perform this behavior.
</li> <li> <strong>bFaceActionTargetFirst</strong> - If true, must face action target before starting behavior.
</li> <li> <strong>bIsViralBehavior</strong> - If true, pass on to agents encountered.
</li></ul>
<p />
<h3><a name="GameCrowdBehavior_PlayAnimation"></a> GameCrowdBehavior_PlayAnimation </h3> <ul>
<li> <strong>AnimationList</strong> - List of animations to play.
</li> <li> <strong>BlendInTime</strong> - Time to blend into next animation.
</li> <li> <strong>BlendOutTime</strong> - Time to blend out of animation.
</li> <li> <strong>bUseRootMotion</strong> - Whether to use root motion.
</li> <li> <strong>bLookAtPlayer</strong> - If true, face player before starting animation.
</li> <li> <strong>bLooping</strong> - If true, loop the animation in the list specified by LoopIndex.
</li> <li> <strong>LoopIndex</strong> - Which animation to loop in AnimationList if bLooping is true.
</li> <li> <strong>LoopTime</strong> - How long to loop the animation if bLooping is true, -1.0 == infinite.
</li> <li> <strong>bBlendBetweenAnims</strong> - Whether should blend between animations in the list.  Set true if they don't match at start/end.
</li></ul>
<p />
<h3><a name="GameCrowdBehavior_RunFromPanic"></a> GameCrowdBehavior_RunFromPanic </h3>
This is a very simplistic implementation which causes agents to run from the source of their panic, virally infecting other agents they encountered. Intended as an example implementation for this type of functionality.
<p />
<h3><a name="GameCrowdBehavior_WaitInQueue"></a> GameCrowdBehavior_WaitInQueue </h3>
This behavior is not exposed for level designer use, as it is tied to destinations which have queue points.
<p />
<h3><a name="GameCrowdBehavior_WaitForGroup"></a> GameCrowdBehavior_WaitForGroup </h3>
This simple behavior is intended as a basis for an archetype to be added to an agent's <strong>GroupWaitingBehaviors</strong>.  Agents using this behavior will idle and turn toward the agent for whom they are waiting, until he gets close enough.
<p />
<h2><a name="GameCrowdInteractionPoint"></a> GameCrowdInteractionPoint </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
All the following crowd interaction point classes can be enabled or disabled.
<p /> <ul>
<li> <strong>bIsEnabled</strong> - If this interaction point is currently enabled.
</li></ul>
<p />
<h3><a name="GameCrowdDestination"></a> GameCrowdDestination </h3>
<strong>GameCrowdDestinations</strong> functions as destinations for crowd agents, and also can implement customized behavior for agents which reach the destination. <strong>GameCrowdDestinations</strong> selected in the editor will display lines to connected destinations (in the <strong>NextDestinations</strong> list). Selecting multiple <strong>GameCrowdDestinations</strong> and hitting ctrl-shift-L will connect them (adding themselves to each other's <strong>NextDestinations</strong> array). Selecting multiple <strong>GameCrowdDestinations</strong> and hitting ctrl-shift-U will disconnect them.
<p /> <ul>
<li> <strong>bKillWhenReached</strong> - If true, kill crowd members when they reach this destination.
</li> <li> <strong>NextDestinations</strong> - Randomly pick from this list of active destinations for agent's next destination.
</li> <li> <strong>bAllowAsPreviousDestination</strong> - Whether agents previous destination can be used as a destination if in list of <strong>NextDestinations</strong>.
</li> <li> <strong>Capacity</strong> - How many agents can simultaneously have this as a destination.
</li> <li> <strong>QueueHead</strong> - First position in queue for agents to wait if destination has limited capacity.  See below for editor short cut for setting this value.
</li> <li> <strong>Frequency</strong> - The likelihood of agents to select this destination from list at previous destination.
</li> <li> <strong>bAvoidWhenPanicked</strong> - Don't go to this destination if panicked.
</li> <li> <strong>bFleeDestination</strong> - Always run toward this destination.
</li> <li> <strong>bSkipBehaviorIfPanicked</strong> - Don't perform kismet or custom behavior at this destination if panicked.
</li> <li> <strong>bMustReachExactly</strong> - Must reach this destination's center exactly - will force movement when close.
</li> <li> <strong>bSoftPerimeter</strong> - Whether agent should stop on reach edge of destination radius (if not reach exactly), or have a "soft" perimeter.
</li> <li> <strong>InteractionTag</strong> - Type of interaction.
</li> <li> <strong>InteractionDelay</strong> - Time before an agent is allowed to attempt this sort of interaction again.
</li> <li> <strong>ReachedBehaviors</strong> - Agents reaching this destination will pick a behavior from this list.
</li></ul>
<p />
The following arrays can be used to restrict which agents can use a <strong>GameCrowdDestination</strong>. If none of these arrays have any entries, any agent can use this destination. If there is any entry in <strong>SupportedAgentClasses</strong> or <strong>SupportedAgentArchetypes</strong>, then an agent will only use the destination if it matches the requirement. If it passes the "supported" requirement (which it always will if there are no entries in either array), then it must not belong to a class or archetype in the <strong>RestrictedAgentClasses</strong> and <strong>RestrictedArchetypes</strong> arrays.
<p /> <ul>
<li> <strong>SupportedAgentClasses</strong> - If set, only agents of this class can use this destination.
</li> <li> <strong>SupportedArchetypes</strong> - If set, agents from this archetype can use this destination.
</li> <li> <strong>RestrictedAgentClasses</strong> - If set, agents of this class cannot use this destination.
</li> <li> <strong>RestrictedArchetypes</strong> - If set, agents from this archetype cannot use this destination.
</li></ul>
<p />
<strong>GameCrowdDestination</strong> also provides some custom functionality for specifying the spawn position of agents spawned at the destination.
<p /> <ul>
<li> <strong>bLineSpawner</strong> - Spawn in a line rather than in a circle.
</li> <li> <strong>SpawnRadius</strong> - Radius around spawn points location in which to spawn agents.
</li> <li> <strong>bSpawnAtEdge</strong> - Whether to spawn agents only at the edge of the circle, or at any point within the circle.
</li> <li> <strong>bAllowsSpawning</strong> - Whether spawning is at all permitted at this destination.
</li></ul>
<p />
<h3><a name="GameCrowdInteractionDestination"></a> GameCrowdInteractionDestination </h3>
<strong>GameCrowdInteractionDestinations</strong> don't have any unique functionality. They are simply a <strong>GameCrowdDestination</strong> subclass with the settings typically needed for a custom interaction destination, such as a capacity of one and being ignored by panicked agents.
<p />
<h3><a name="GameCrowdDestinationQueuePoint"></a> GameCrowdDestinationQueuePoint </h3>
<strong>GameCrowdDestinationQueuePoints</strong> are used to allow agents to queue at destinations with a limited capacity.
<p /> <ul>
<li> <strong>NextQueuePosition</strong> - Queue position behind this one in the line.  See below for editor short cut for setting.
</li> <li> <strong>AverageReactionTime</strong> - Average pause time before agent reacts to queue movement.
</li></ul>
<p />
Selecting multiple <strong>GameCrowdDestinationQueuePoints</strong> and one <strong>GameCrowdDestination</strong> and hitting ctrl-shift-L will connect them with the queue going from nearest to furthest queue point.
<p />
<h2><a name="SeqEvent_CrowdAgentReachedDestination"></a> SeqEvent_CrowdAgentReachedDestination </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This kismet event is associated with a specific <strong>GameCrowdDestination</strong> and fires when that destination is reached by an agent.
<p />
<h2><a name="SeqAct_PlayAgentAnimation"></a> SeqAct_PlayAgentAnimation </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This kismet action is used to make an agent play a series of animations while stopped. Agents will automatically return to their current behavior (by default, moving between destinations) when they complete this action.
<p />
<img src="rsrc/Three/CrowdSystem/PlayAgentAnimation.jpg" />
<p />
The play agent animation action has the following inputs.
<p /> <ul>
<li> <strong>Play</strong> - Starts the animation being played.
</li> <li> <strong>Stop</strong> - Stops the current animation.
</li> <li> <strong>Target</strong> - The agent on whom this action is being called.
</li> <li> <strong>Action Focus</strong> - The actor the agent should face while performing this action.
</li></ul>
<p />
The play agent animation action has the following outputs.
<p /> <ul>
<li> <strong>Finished</strong> - Event when the action completes.
</li> <li> <strong>Stopped</strong> - Event when the action is stopped.
</li> <li> <strong>Started</strong> - Event when the action is started.
</li> <li> <strong>Out Agent</strong> - The agent that was performing this action most recently.
</li></ul>
<p />
The play agent animation action has the following editable properties.
<p /> <ul>
<li> <strong>AnimationList</strong> - List of animations to play while at this node.
</li> <li> <strong>BlendInTime</strong> - Time to blend into next animation.
</li> <li> <strong>BlendOutTime</strong> - Time to blend out of animation.
</li> <li> <strong>bUseRootMotion</strong> - Whether to use root motion.
</li> <li> <strong>bFaceActionTargetFirst</strong> - If true, face action target before starting animation.
</li> <li> <strong>bLooping</strong> - If true, loop the animation in the list specified by LoopIndex.
</li> <li> <strong>LoopIndex</strong> - Which animation to loop in AnimationList if bLooping is true.
</li> <li> <strong>LoopTime</strong> - How long to loop the animation if bLooping is true, -1.0 == infinite.
</li> <li> <strong>bBlendBetweenAnims</strong> - Whether should blend between animations in the list.  Set true if they don't match at start/end.
</li></ul>
<p />
<h2><a name="Downloads"></a> Downloads </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div> <ul>
<li> <a href="rsrc/Three/CrowdSystem/CrowdSystemExample.zip" target="_top">Download</a> the example map.
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
