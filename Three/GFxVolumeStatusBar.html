<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | GFxVolumeStatusBar    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">GFxVolumeStatusBar  </b></div>
<div id="tooltext">
<a href="GFxVolumeStatusBarJP.html" class="twikiLink">日本語訳</a><br><a href="GFxVolumeStatusBarCH.html" class="twikiLink">中国翻译</a><br><a href="GFxVolumeStatusBarKR.html" class="twikiLink">한국어</a><br>

<!-- Three/GFxVolumeStatusBar -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="UIAndHUDHome.html" class="twikiLink">User Interfaces &amp; HUDs</a></b> &gt; <b><a href="Scaleform.html" class="twikiLink">Scaleform GFx</a></b> &gt; How to add a control volume with a status bar
</div>
<hr size="1" noshade="noshade">
<p />
<h1><a name="How to add a control volume with a status bar"></a> How to add a control volume with a status bar </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="GFxVolumeStatusBar.html#How to add a control volume with a status bar"> How to add a control volume with a status bar</a> <ul>
<li> <a href="GFxVolumeStatusBar.html#Overview"> Overview</a>
</li> <li> <a href="GFxVolumeStatusBar.html#Flash Setup"> Flash Setup</a>
</li> <li> <a href="GFxVolumeStatusBar.html#Status Bar Centered on HUD"> Status Bar Centered on HUD</a>
</li> <li> <a href="GFxVolumeStatusBar.html#Status Bar Floating in Game World"> Status Bar Floating in Game World</a>
</li> <li> <a href="GFxVolumeStatusBar.html#Status Bar on HUD at Relative Position"> Status Bar on HUD at Relative Position</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<hr size="1" noshade="noshade">
This tutorial will cover how to add a very basic control volume with working Status Bar. There are three versions to this tutorial. Version 1 must be completed before you can add the optional code of either version 2 or version 3.
<p /> <ul>
<li> The status bar will be drawn to the screen, centered on the HUD.
</li> <li> The status bar is displayed as a hovering bar at the center of the control volume. It is physically in the game world, and always faces the player.
</li> <li> The bar is again drawn on the HUD, this time at the relative position of the control volume, using Canvas.Project. The status bar moves around the HUD as the player moves, always positioned relative to the location of the control volume.
</li></ul>
<p />
This tutorial does not provide code for another player or team capturing an already captured volume, nor combined capture efforts of more than one player. You'll need to work that out for yourself.
<p />
When finished, you will be able to add a volume to your level in the Editor via: Brush-&gt;Add Volume-&gt;SFControlVolume
<p />
<h2><a name="Flash Setup"></a> Flash Setup </h2>
<hr size="1" noshade="noshade">
<p /> <ul>
<li> Create a new AS 2 document.
</li> <li> Set the Document dimensions to 512x256
</li> <li> <img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>IMPORTANT:</strong> Set the Document background to black.
</li> <li> Create a blue rectangle in the center of the document.
</li> <li> Convert it to a Movie Clip.
</li> <li> Give it an instance name of BlueStatusBar.
</li> <li> Save and Publish the SWF to your UDK install under /UDKGame/Flash/UDKSFTutorial/CVStatusBar.SWF.
</li> <li> Import the SWF into UDK.
</li></ul>
<p />
<img src="rsrc/Three/GFxVolumeStatusBar/Scaleform_Tutorial_01.jpg" alt="Scaleform_Tutorial_01.jpg" width='528' height='330' />
<p />
<h2><a name="Status Bar Centered on HUD"></a> Status Bar Centered on HUD </h2>
<hr size="1" noshade="noshade">
Create the actual placeable control volume that you can place anywhere in your map.
<p />
<div class="codetitlebar">
SFControlVolume.uc
</div>
<div class="codesnippet">
<pre>
class SFControlVolume extends Volume
  placeable;

var bool bControlled;
var int ElapsedTime;
var int PercentCaptured;

// Editable Properties
var(TimeToControl) int TimeToControl;
var(TimeToControl) float UpdateRate;
var() SwfMovie Movie;

var Info ControlTimer;
var SFControlVolumeMovie CVMovie;

event PostBeginPlay()
{
  Super.PostBeginPlay();
  ControlTimer &#61; Spawn(class&#39;SFVolumeControlTimer&#39;, self);
}

event Touch(Actor Other, PrimitiveComponent OtherComp, vector HitLocation, vector HitNormal)
{
  Super.Touch(Other,OtherComp,HitLocation,HitNormal);

  if(!bControlled)
  {
    // Turn on the timer, and have it tick every X seconds, where X &#61; UpdateRate.
    ControlTimer.SetTimer(UpdateRate,true);
  }

  // Only display the status bar when the player has touched/is in the volume.
  CreateControlVolumeMovie();
  UpdateStatusBar();
}

event UnTouch(Actor Other)
{
  Super.UnTouch(Other);

  // Reset capture timer.
  ControlTimer.ClearTimer();

  // Close the status bar when the player leaves the volume.
  CVMovie.Close(true);
  CVMovie &#61; none;

  if(!bControlled)
  {
    ElapsedTime &#61; 0;
  }
}

function StartControlling(SFVolumeControlTimer VC)
{
  local int PercentCaptured;

  if (VC &#61;&#61; ControlTimer)
  {
    ElapsedTime++;
    `log(&#34;Time to capture: &#34; &#64; TimeToControl - ElapsedTime);

    UpdateStatusBar();

    // Once we reach the total time to control, capture the volume and clear the timer.
    if(ElapsedTime &#62;&#61; TimeToControl)
    {
      `log(&#34;Captured!&#34;);
      bControlled &#61; true;
      ControlTimer.ClearTimer();
    }
  }
}

function UpdateStatusBar()
{
  PercentCaptured &#61; (100 &#42; float(ElapsedTime)) / float(TimeToControl);
  CVMovie.UpdateStatusBar(self, PercentCaptured);
}

function CreateControlVolumeMovie()
{
  CVMovie &#61; new class&#39;SFControlVolumeMovie&#39;;
  CVMovie.MovieInfo &#61; Movie;
  CVMovie.SetTimingMode(TM&#95;Real);
  CVMovie.Start();
}

defaultproperties
{
  TimeToControl&#61;100
  UpdateRate&#61;0.1
}
</pre>
</div>
<p />
Now create the timer class. This class simply executes the SFControlVolume::StartControlling() function every time it ticks.
<p />
<div class="codetitlebar">
SFVolumeControlTimer.uc
</div>
<div class="codesnippet">
<pre>
class SFVolumeControlTimer extends Info;

var SFControlVolume CV;

event PostBeginPlay()
{
  Super.PostBeginPlay();
  CV &#61; SFControlVolume(Owner);
}

event Timer()
{
  CV.StartControlling(self);
}

defaultproperties
{
  TickGroup&#61;TG&#95;PreAsyncWork
  bStatic&#61;false
  RemoteRole&#61;ROLE&#95;None
}
</pre>
</div>
<p />
And finally, create the Movie Player class for our status bar.
<p />
<div class="codetitlebar">
SFControlVolumeMovie.uc
</div>
<div class="codesnippet">
<pre>
class SFControlVolumeMovie extends GFxMoviePlayer;

var GFxObject StatusBarMC;

function bool Start(optional bool StartPaused &#61; false)
{
  Super.Start();
  Advance(0);

  StatusBarMC &#61; GetVariableObject(&#34;&#95;root.BlueStatusBar&#34;);

  return true;
}

function UpdateStatusBar(SFControlVolume CV, int PercentCaptured)
{
  local GFxObject.ASDisplayInfo DI;

  DI.hasXScale &#61; true;
  DI.hasAlpha &#61; true;

  DI.XScale &#61; PercentCaptured;
  DI.Alpha &#61; 100;

  if (DI.XScale &#62;&#61; 100)
  {
    DI.XScale &#61; 101;
  }
  else if (DI.XScale &#61;&#61; 0)
  {
    DI.XScale &#61; 1;
    DI.Alpha &#61; 0;
  }

  StatusBarMC.SetDisplayInfo(DI);
}

defaultproperties
{
    bDisplayWithHudOff &#61; false
}
</pre>
</div>
<p /> <ul>
<li> Now add the control volume to your level, using a BSP builder brush.
</li> <li> Go into the properties of the volume (F4).
</li> <li> Set the Time To Control. (Maximum number of ticks to capture)
</li> <li> Set the Update Rate. (How often you want the status bar to 'tick' in seconds; Lower numbers = faster tick time)
</li> <li> Set the Movie field to the SWF you imported earlier.
</li> <li> Save the level and test!
</li></ul>
<p />
<h2><a name="Status Bar Floating in Game World"></a> Status Bar Floating in Game World </h2>
<hr size="1" noshade="noshade">
If you want the status bar physically in the game world, at the center of the volume, first modify the SFControlVolume class.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>NOTE:</strong> You will be able to add multiple control volumes to your level, but you must create a unique Material and TextureRenderTarget2D for each volume.
<p />
Modifications to SFControlVolume:
<div class="codetitlebar">
SFControlVolume.uc
</div>
<div class="codesnippet">
<pre>
// Add these global vars to the top of the class
var() StaticMesh Mesh;
var() vector TranslationOffset;
var() array&#60;MaterialInterface&#62; Materials;
var() TextureRenderTarget2D RenderTexture;
var SFControlVolumeMesh CVMesh;

// Add this code to the event Touch() function, just after Super.Touch();
CVMesh &#61; Spawn(class&#39;SFControlVolumeMesh&#39;);
CVMesh.Mesh.SetStaticMesh(Mesh);
CVMesh.Mesh.SetMaterial(0,Materials&#91;0]);
CVMesh.SetLocation(self.Location + TranslationOffset);
CVMesh.PC &#61; Other;

// Add this line of code to the event UnTouch() function
CVMesh.Destroy();

// Add this line of code to the CreateControlVolumeMovie() function, after CVMovie.MovieInfo &#61; Movie;
CVMovie.RenderTexture &#61; RenderTexture;
</pre>
</div>
<p />
Now create a new class. This class will be used to display the status bar in the game world.
<p />
<div class="codetitlebar">
SFControlVolumeMesh.uc
</div>
<div class="codesnippet">
<pre>
class SFControlVolumeMesh extends StaticMeshActor
  placeable;

var vector PlayerLoc;
var actor PC;

var() editinline const StaticMeshComponent Mesh;

function Tick(float fDeltaTime)
{
  Super.Tick(fDeltaTime);

  // Always face the player
  PlayerLoc &#61; PC.Location;
  SetRotation(Rotator(PlayerLoc - self.Location));
}

defaultproperties
{
  bStatic &#61; false
  bMovable &#61; true

  Begin Object class&#61;StaticMeshComponent Name&#61;StaticMeshComp1
    CollideActors &#61; False
    BlockActors &#61; false
    BlockRigidBody &#61; False
  End Object
  Mesh &#61; StaticMeshComp1
  Components.Add(StaticMeshComp1)
}
</pre>
</div>
<p /> <ul>
<li> Now add the control volume to your level, using a BSP builder brush.
</li> <li> Go into the properties of the volume (F4).
</li> <li> Set the Time To Control. (Maximum number of ticks to capture)
</li> <li> Set the Update Rate. (How often you want the status bar to 'tick' in seconds; Lower numbers = faster tick time)
</li> <li> Set the Movie field to the SWF you imported earlier.
</li> <li> Open the Content Browser.
</li> <li> Create a new TextureRenderTarget2D, name it whatever you like, and set its resolution to 512x256 to match the SWF.
</li> <li> Create a new Material, and name it whatever you like.
</li> <li> In the Material, add a new TextureSample
</li> <li> Insert the TextureRenderTarget2D you created in the new TextureSample's Texture Field.
</li> <li> Connect the Diffuse Output (black square) of the TextureSample to the Diffuse input of the Material.
</li> <li> Set the Blend Mode of the Material to BLEND_AlphaComposite.
</li> <li> Add Color-&gt;New Desaturation.
</li> <li> Add Parameters-&gt;New ScalarParameter.
</li> <li> Set the Default Value of the Parameter to -20.
</li> <li> Wire the Diffuse Output (black square) of the TextureSample to A on Desaturation.
</li> <li> Wire the Param 'None' to B on Desaturation.
</li> <li> Wire the Output of Desaturation to Opacity and Emissive on the Material.
</li> <li> Close the Material window and save.
</li> <li> Save the package with your new material and render texture.     <br/>     <img src="rsrc/Three/GFxVolumeStatusBar/Scaleform_Tutorial_02.jpg" alt="Scaleform_Tutorial_02.jpg" width='800' height='522' />
</li> <li> Go into the properties of the volume (F4).
</li> <li> Set the Mesh field to a plane shaped mesh, such as found at: dwStaticMeshes.Plane
</li> <li> Set the Translation Offset. (This moves the status bar relative to the center of the control volume)
</li> <li> Add a new Material slot.
</li> <li> Assign the new material you created to Material slot 0.
</li> <li> Assign the TextureRenderTarget2D you created to the RenderTexture field.
</li> <li> Save the level and test!
</li></ul>
<p />
<h2><a name="Status Bar on HUD at Relative Position"></a> Status Bar on HUD at Relative Position </h2>
<hr size="1" noshade="noshade">
This version draws the status bar on the HUD at the relative position of the volume using Canvas Project. As you look around, the status bar will move on the HUD so that it is still in the same relative position.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>NOTE:</strong> If you have done the modifications above to your code, undo them.
<p />
You must revise the PostRender() function of your HUD Wrapper:
<p />
<div class="codetitlebar">
<strong><em>YourHUD</em></strong>.uc
</div>
<div class="codesnippet">
<pre>
event PostRender()
{
  local SFControlVolume SFCV;

  super.PostRender();

  // Find all control volumes in the level
  foreach WorldInfo.AllActors(class&#39;SFControlVolume&#39;,SFCV)
  {
    //Project 3D world position of control volume to 2D screen position
    if (SFCV.CVMovie !&#61; none)
    {
      SFCV.CVMovie.UpdatePosition(Canvas.Project(SFCV.Location));
    }
  }

  // Tick HUD
  if (HudMovie !&#61; none)
  {
    HudMovie.TickHud(0);
  }
}
</pre>
</div>
<p />
SFControlVolumeMovie.uc Modifications:
First, add two new global variables:
<p />
<div class="codetitlebar">
SFControlVolumeMovie.uc
</div>
<div class="codesnippet">
<pre>
var int Width, Height;
</pre>
</div>
<p />
Next, add these three lines of code to the Start() function:
<p />
<div class="codetitlebar">
SFControlVolumeMovie.uc
</div>
<div class="codesnippet">
<pre>
function bool Start(optional bool StartPaused &#61; false)
{
    local float x0, y0, x1, y1;

    super.Start();
    Advance(0.0);

    StatusBarMC &#61; GetVariableObject(&#34;&#95;root.BlueStatusBar&#34;);

    GetVisibleFrameRect(x0, y0, x1, y1);
    Width &#61; x1-x0;
    Height &#61; y1-y0;

    return true;
}
</pre>
</div>
<p />
Then add this function, right after the UpdateStatusBar() function.
<p />
<div class="codetitlebar">
SFControlVolumeMovie.uc
</div>
<div class="codesnippet">
<pre>
function UpdatePosition(Vector ScreenPos)
{
    self.SetViewPort(ScreenPos.X,ScreenPos.Y,Width,Height);
}
</pre>
</div>
<p />
<img src="rsrc/Three/GFxVolumeStatusBar/Scaleform_Tutorial_03.jpg" alt="Scaleform_Tutorial_03.jpg" width='648' height='382' />
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
