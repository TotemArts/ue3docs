<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | OnlineSubsystemSteamworks    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">OnlineSubsystemSteamworks  </b></div>
<div id="tooltext">
<a href="OnlineSubsystemSteamworksJP.html" class="twikiLink">日本語訳</a><br><a href="OnlineSubsystemSteamworksCH.html" class="twikiLink">中国翻译</a><br><a href="OnlineSubsystemSteamworksKR.html" class="twikiLink">한국어</a><br>

<!-- Three/OnlineSubsystemSteamworks -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="ReplicationHome.html" class="twikiLink">Networking &amp; Replication</a></b> &gt; Online Subsystem Steamworks
</div>
<hr size="1" noshade="noshade">
<p />
<h1><a name="Online Subsystem Steamworks"></a> Online Subsystem Steamworks </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Online Subsystem Steamworks"> Online Subsystem Steamworks</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Overview"> Overview</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Integration status"> Integration status</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#How to use and implement the Steam Integration in _UnrealEngine3"> How to use and implement the Steam Integration in UnrealEngine3</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Using the Steam client"> Using the Steam client</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#To get the initial game (after setting up the Content Server)"> To get the initial game (after setting up the Content Server)</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#To get an update (after setting up the Content Server)"> To get an update (after setting up the Content Server)</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Notes"> Notes</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Using the Steam Content Tool"> Using the Steam Content Tool</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Using the GUI to create an initial build with solution and project files"> Using the GUI to create an initial build with solution and project files</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Using Steam Script to create new versions"> Using Steam Script to create new versions</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Notes"> Notes</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Running the Steam Content Server"> Running the Steam Content Server</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#From a Command Prompt"> From a Command Prompt</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#As a Service"> As a Service</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Notes"> Notes </a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Using Steam in Game"> Using Steam in Game</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Stats"> Stats</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Backend setup"> Backend setup</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Gameplay integration"> Gameplay integration</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Debugging/Development"> Debugging/Development</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Achievements"> Achievements</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Backend setup"> Backend setup</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Online Subsystem setup"> Online Subsystem setup</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Gameplay integration"> Gameplay integration</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Debugging/Development"> Debugging/Development</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Leaderboards"> Leaderboards</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Backend setup"> Backend setup</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Online Subsystem setup"> Online Subsystem setup</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Gameplay integration"> Gameplay integration</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Extra functionality"> Extra functionality</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Server advertisement/querying"> Server advertisement/querying</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Online advertising/querying"> Online advertising/querying</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#ProductName"> ProductName</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#GameDir"> GameDir</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Advertising through UDK"> Advertising through UDK</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#LAN advertising/querying"> LAN advertising/querying</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Steam Lobby"> Steam Lobby</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Multiplayer Authentication"> Multiplayer Authentication</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Authentication and Stats"> Authentication and Stats</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Steam sockets"> Steam sockets</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Starting a server"> Starting a server</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Connecting to a server"> Connecting to a server</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Forcing Steam sockets"> Forcing Steam sockets</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Invites"> Invites</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Sending invites"> Sending invites</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Handling invites"> Handling invites</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Steam sockets"> Steam sockets</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Automatically launching Steam"> Automatically launching Steam</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Debugging"> Debugging</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Common problems"> Common problems</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#Stats not updating"> Stats not updating</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Leaderboards breaking"> Leaderboards breaking</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Server not showing on master server"> Server not showing on master server</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Steam Client issues"> Steam Client issues</a>
</li></ul>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Content Server"> Content Server</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#Changelists"> Changelists</a> <ul>
<li> <a href="OnlineSubsystemSteamworks.html#December 12th 2011"> December 12th 2011</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#December 8th 2011"> December 8th 2011</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#January 10th 2012"> January 10th 2012</a>
</li> <li> <a href="OnlineSubsystemSteamworks.html#January 18th 2012"> January 18th 2012</a>
</li></ul>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<hr size="1" noshade="noshade">
Please see the <a href="https://udn.epicgames.com/Three/OnlineSubsystemTechnicalGuide" class="restricted" class="restricted" class="twikiLink">Online Subsystem Technical Guide</a> for general and high-level information about the Online Subsystem.
<p />
To implement features such as Achievements, Leaderboards, client/server stats and other Steamworks dependent features, your game needs to have a Steam appid, and you need access to the Steamworks partner website.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> <em>The OnlineSubsystemSteamworks integration is constantly being updated, and this page documents features which may depend on the latest engine build.</em>
<p />
<h2><a name="Integration status"></a> Integration status </h2>
<hr size="1" noshade="noshade">
<p />
OnlineSubsystemSteamworks is undergoing regular changes, and as of October 2012, this is the key list of functional features: <ul>
<li> Achievements
</li> <li> Player stats
</li> <li> Player leaderboards
</li> <li> Server browser advertising
</li> <li> Server browser querying
</li> <li> Player invites
</li> <li> Voice over IP
</li> <li> Lobby management/advertising/querying
</li> <li> Steam sockets (network connections through Steam, automatic NAT traversal)
</li> <li> Multiplayer authentication <ul>
<li> Client authentication
</li> <li> Server authentication
</li></ul>
</li> <li> Host servers without Steam client
</li></ul>
<p />
Some caveats of the above features: <ul>
<li> Server browser filtering is not yet optimized to utilize the server tag field, requiring server queries to perform filtering (may not happen for UE3)
</li> <li> Server browser does not support NAT traversal; Steam lobbies must be used instead, if this is required
</li> <li> Achievements/stats/leaderboards are setup through *Engine.ini; this is not secured against .ini modifications by players
</li></ul>
<p />
General caveats when integrating these latest changes: <ul>
<li> Net compatibility in UE3 is broken, if updating from an engine build earlier than December 2011 QA
</li> <li> Implementations of OnlineSubsystemSteamworks previous to this, will require retesting and possibly some refactoring
</li></ul>
<p />
Important features yet to be implemented: <ul>
<li> PS3/Mac support
</li></ul>
<p />
<p />
<h2><a name="How to use and implement the Steam Integration in _UnrealEngine3"></a> How to use and implement the Steam Integration in UnrealEngine3 </h2>
<hr size="1" noshade="noshade">
<p />
<h3><a name="Using the Steam client"></a> Using the Steam client </h3>
<h4><a name="To get the initial game (after setting up the Content Server)"></a> To get the initial game (after setting up the Content Server) </h4> <ul>
<li> Get the latest Steam SDK, and copy sdk/client/Steam.exe and sdk/client/Steam.cfg to a local folder <ul>
<li> Licensees can copy it from '//depot/UnrealEngine3/Development/External/Steamworks/sdk/client/...'
</li> <li> UDK users can register and download from here <a href="https://partner.steamgames.com/home" target="_top">https://partner.steamgames.com/home</a>
</li></ul>
</li> <li> Make 'steam.cfg' writable and set the 'SdkContentServerAdrs' to the IP of where you are running your local content server
</li> <li> Run 'Steam.exe'
</li> <li> Right mouse click on your game (in our case 'Unreal Development Kit') on the 'My games' tab and install
</li> <li> After installation is complete, right mouse click and 'Launch game'
</li></ul>
<p />
<h4><a name="To get an update (after setting up the Content Server)"></a> To get an update (after setting up the Content Server) </h4> <ul>
<li> Updates are retrieved automatically as long as the Steam client is running <ul>
<li> Restart the Steam client if you do not wish to wait for the polling interval
</li></ul>
</li></ul>
<p />
<h4><a name="Notes"></a> Notes </h4> <ul>
<li> If you get an update, but the local content server has a fresh complete (non iterative) build, then the client will get confused. To fix this, delete all but 'Steam.exe' and 'Steam.cfg' in your local folder and start again. <ul>
<li> During initial development, this tends to happen a lot.
</li></ul>
</li></ul>
<p />
<h3><a name="Using the Steam Content Tool"></a> Using the Steam Content Tool </h3>
There are two methods, using the GUI and using Steam Script.
<p />
<h4><a name="Using the GUI to create an initial build with solution and project files"></a> Using the GUI to create an initial build with solution and project files </h4> <ul>
<li> Copy the build you wish to publish (e.g. 'C:\Builds\UnrealEngine3') locally
</li> <li> Run the content tool (part of the Steam SDK) 'sdk/tools/ContentTool.exe'
</li> <li> Click the 'New Solution' button
</li> <li> Click 'Next'
</li> <li> Solution Section: Type in the 'Solution Name' (UTGame) and the location to 'C:\SteamGame'
</li> <li> Click 'Next'
</li> <li> Application Section: Type in the 'Application Name' ('Unreal Development Kit' - this is what appears in the GUI), File Delivery is 'Loose Files' and 'Application ID' is 13260
</li> <li> Click 'Next'
</li> <li> Depot Section: Name is 'UTGame', Type is 'Content', 'Project Location' is 'C:\SteamGame', 'Depot Location' to 'C:\SteamGame\Depot', and 'Depot ID' to 13261
</li> <li> Click 'Next'
</li> <li> Click on the listbox entry to the right of <root> and type 'C:\Builds\UnrealEngine3'
</li> <li> Click 'Finish' (It will list files that it found to add to the project - click OK to synchronise the depot)
</li> <li> Click on the 'Solution Properties' button near the top left of the GUI; it's just below the text of 'Solution Explorer'
</li> <li> Expand out the tree views 'Launch Options -&gt; Label = Default -&gt; Command line = Unreal Development Kit'
</li> <li> Right mouse click and change the command line to 'Binaries\Win32\UDKGame.exe'
</li> <li> Close that window, save when prompted.
</li> <li> Click the 'Build' toolbar button (this will take some time)
</li> <li> 'C:\SteamGame\Depot' will now contain '13261_0.dat', '13261_0.blob' and 'UTGame.depot' (this is appid_version.dat and appid_version.blob)
</li> <li> From the Publish menu, select 'Publish to Local Testing Server', this will copy '13261_0.dat', '13261_0.blob' and 'ContentDescriptionDB.xml' to the local server.
</li> <li> Run the Content Server
</li></ul>
<p />
<h4><a name="Using Steam Script to create new versions"></a> Using Steam Script to create new versions </h4> <ul>
<li> Spawn a DOS box
</li> <li> Run '//depot/UnrealEngine3/Development/External/Steamworks/sdk/tools/ContentTool.com' /verbose /console /filename '//depot/UnrealEngine3/UDKGame/Build/Steam/SteamMakeVersion.smd'
</li> <li> Copy the new files from 'C:\SteamGame\Depot' to 'C:\Steam\DepotRoot'
</li> <li> Copy 'C:\SteamGame\ContentDescriptionDB.xml' to 'C:\Steam\DepotRoot'
</li> <li> Stop then start the content server so it detects the update.
</li></ul>
<p />
<h4><a name="Notes"></a> Notes </h4> <ul>
<li> The update process is automated in the build system; check //depot/UnrealEngine3/Development/Builder/Scripts/Build/SteamVersion.build for details
</li> <li> Be very careful when editing .sts and .spj files as seemingly innocuous changes can cause problems. Also, don't change the relative paths at all; this also causes problems.
</li></ul>
<p />
<h3><a name="Running the Steam Content Server"></a> Running the Steam Content Server </h3>
There are two methods to running the content server; from a command prompt or as a service.
<p />
<h4><a name="From a Command Prompt"></a> From a Command Prompt </h4> <ul>
<li> Spawn a DOS box
</li> <li> Run '//depot/UnrealEngine3/Development/External/Steamworks/sdk/tools/contentserver/contentserver.exe' /verbose /DepotPath 'C:\SteamGame\LocalTestServer'
</li> <li> Watch lots of debug spew fly by, but you should see mention of 13261_0 right at the end
</li> <li> Steam clients can now connect and download this build
</li></ul>
<p />
<h4><a name="As a Service"></a> As a Service </h4> <ul>
<li> Move 'C:\SteamGame\LocalTestServer' to 'C:\Steam\DepotRoot' (unless you're using ContentServerCfg.txt to set the depot path for the service; see below)
</li> <li> Spawn a DOS box
</li> <li> Run '//depot/UnrealEngine3/Development/External/Steamworks/sdk/tools/contentserver/contentserver.exe' /install (this automatically starts the service)
</li> <li> Steam clients can now connect and download this build
</li></ul>
<p />
<h4><a name="Notes"></a> Notes </h4> <ul>
<li> The content server generally works very well and seamlessly handles a lot of the typical network nightmares.
</li> <li> There are two notable exceptions: <ul>
<li> The content server does <strong>not</strong> detect new versions, to register a new version you need to restart the service.
</li> <li> The depot location when running as a service cannot be set from the command line.  When running as a service, it can only be set via a file named ContentServerCfg.txt located in the same directory as ContentServer.exe.  Otherwise the default value of \Steam\DepotRoot is used (the path is relative to the root of the volume). The syntax of this file is similar to UE3 .ini files; so for example, to change the depot location from "\Steam\DepotRoot" to "\LocalContentServer", ContentServerCfg.txt would need to contain the following two lines:
</li></ul>
</li></ul>
<p />
<div class="codetitlebar">
ContentServerCfg.txt
</div>
<div class="codesnippet">
<pre>
&#91;ClientContent]
DepotRootPath &#61; &#34;\LocalContentServer&#34;
</pre>
</div>
<p />
<h3><a name="Using Steam in Game"></a> Using Steam in Game </h3>
Simply having the Steam client running when launching the game will allow you to access all the Steam features. If the Steam client is not running, the networking layer will fall back internally to the common online subsystem (which basically has the functionality of OnlineSubsystemPC).
<p />
The authentication system is quite simple; if you don't 'own' the game, you can't play on a server. Ask Valve for your own app id to test network connectivity with your games; the 'Unreal Development Kit' app id is owned by everyone.
<p />
<p />
<h2><a name="Stats"></a> Stats </h2>
<hr size="1" noshade="noshade">
<p />
<h3><a name="Backend setup"></a> Backend setup </h3>
<img src="rsrc/Three/OnlineSubsystemSteamworks/BackendAchievementStats.png" alt="BackendAchievementStats.png " width='994' height='436' />
<p />
To setup stats, you first need to define them on the Steamworks backend; this is accessed through the Game Admin panel on the Steamworks partner website.
<p />
Stat entry API Name's <em>must</em> follow the format 'ViewId_ColumnId' (e.g. 2_0), where ViewId will be a unique number used to identify a particular stats table, and ColumnId is used to identify each entry in that stats table.
<p />
'Type' can be either INT/FLOAT (AVGRATE is untested/unsupported), and stats entries can be set either by the client or game server, <em>but not both</em>.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> Player stats set by game servers, can <em>only</em> be set if the player has been successfully authenticated with the game server through Steam (this is usually the case, as clients are rejected at login if they fail auth).
<p />
<p />
<h3><a name="Gameplay integration"></a> Gameplay integration </h3>
Stats data is managed using subclasses of the <strong>OnlineStatsRead</strong> and <strong>OnlineStatsWrite</strong> classes, which define the layout of the stats table, and are used as containers to read/write stats data.
<p />
<p />
<h4><a name="OnlineStatsRead/_OnlineStatsWrite setup"></a><a name=" _OnlineStatsRead/_OnlineStatsWrite setup"></a>  OnlineStatsRead/OnlineStatsWrite setup </h4>
To setup the stats table in your OnlineStatsRead subclass, you need to set its <strong>ViewId</strong> to match the <strong>ViewId</strong> of the backend stats table, and each stat entries <strong>ColumnId</strong> for that table, to the <strong>ColumnIds</strong> array.
<p />
For the OnlineStatsWrite subclass, the stats table <strong>ViewId</strong> should be added to the <strong>ViewIds</strong> array, and the <strong>Properties</strong> array must have an element setup for each stat entries ColumnId, with Data matching the backends stat value type, e.g:
<p />
<div class="codetitlebar">
YourOnlineStatsWrite.uc
</div>
<div class="codesnippet">
<pre>
class YourOnlineStatsWrite extends OnlineStatsWrite

defaultproperties
{
  Properties.Add((PropertyId&#61;2,Data&#61;(Type&#61;SDT&#95;Int32,Value1&#61;0)))
}
</pre>
</div>
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> It is recommended that all <strong>ViewId</strong> and <strong>PropertyId</strong> values, be specified using Enums, or macros (e.g. EStatsTable_Player, `STATSPROPERTY_SCORE), to make them easier to read.
<p />
<p />
<h4><a name="Reading stats"></a><a name=" Reading stats"></a>  Reading stats </h4>
To retrieve stats table values, setup a callback using <strong>AddReadOnlineStatsCompleteDelegate()</strong>, and call <strong>ReadOnlineStats()</strong>, passing in the <strong>UniqueIds</strong> of the players whose stats you want to read, and an instance of your OnlineStatsRead subclass.
<p />
Once the callback returns, all of the players stats have been read into the OnlineStatsRead object, and you should call <strong>ClearReadOnlineStatsCompleteDelegate()</strong> to clear the callback.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" />: <strong>Note:</strong> Not clearing these delegates may result in crashes when garbage collection attempts to remove the level from memory.
<p />
You can read stats entries from the OnlineStatsRead object, using functions such as <strong>GetIntStatValueForPlayer()</strong>; see OnlineStatsRead.uc for more information.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> As of Steamworks v1.12 (and earlier), when multiple UniqueId's are passed into ReadOnlineStats, it is slow to issue the callback, as it only retrieves stats for one UniqueId at a time; this is to temporarily workaround a crash in the Steamworks API (affects leaderboards especially).
<p />
<p />
<h4><a name="Writing stats"></a><a name=" Writing stats"></a>  Writing stats </h4>
To write stats values for a player, create an instance of your OnlineStatsWrite subclass, and use functions such as <strong>SetIntStat()</strong> to set stat values (see OnlineStatsWrite.uc); then use <strong>WriteOnlineStats()</strong> to cache the stats data, and <strong>FlushOnlineStats()</strong> to commit it to the backend.
<p />
If you want to receive a callback for when the commit is complete (or if it fails) use <strong>AddFlushOnlineStatsCompleteDelegate()</strong> and <strong>ClearFlushOnlineStatsCompleteDelegate()</strong> to set/clear the callback.
<p />
<p />
<h4><a name="Game server stats"></a><a name=" Game server stats"></a>  Game server stats </h4>
Game server stats, which are player stats which can only be written by game servers, must be setup using the <strong>GameServerStatsMappings</strong> array in *Engine.ini; this maps OnlineStatsWrite ViewId's to game server stats.
<p />
On the backend, the <strong>Set By</strong> field for the stat value must be set to GS for this to work.
<p />
<p />
<h3><a name="Debugging/Development"></a> Debugging/Development </h3>
To reset stats, use the <strong>ResetStats()</strong> function.
<p />
<p />
<h2><a name="Achievements"></a> Achievements </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<h3><a name="Backend setup"></a> Backend setup </h3>
<p />
<img src="rsrc/Three/OnlineSubsystemSteamworks/BackendAchievements.png" alt="BackendAchievements.png" width='1305' height='681' />
<p />
To setup achievements, you first need to enter them into the Steamworks backend; this is accessed through the Game Admin panel on the Steamworks partner website.
<p />
At a minimum, achievements <em>must</em> have their icons set, and must be set by the client; they need to be given unique API names (preferable), or you can sequentially name them 'Achievement_#' where # is a number starting from 0.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note</strong>: With the 'Achievement_#' naming convention, there must not be a gap between achievement numbers, e.g. Achievement_1, Achievement_3, as Unreal stops loading achievements when it fails to find one.
<p />
<h4><a name="Achievement stats"></a><a name=" Achievement stats"></a>  Achievement stats </h4>
<p />
It is best to also create stats entries for achievements, for tracking progress; these stats values will be updated through the Online Subsystem.
<p />
Stats must be of type INT, and their API name <em>must</em> follow the 'ViewId_ColumnId' naming convention (<em>see the Stats section above</em>), where ColumnId will map directly to AchievementId (described in the <em>Online Subsystem</em> section below).
<p />
You can link these stats entries to achievements, on the backend achievements page; set Min and Max to indicate the progress required for unlocking achievements.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note</strong>: <em>See page attachments for images of the backend stats and achievements for the UDK.</em>
<p />
<h3><a name="Online Subsystem setup"></a> Online Subsystem setup </h3>
<p />
Achievements are linked to the Steam backend through the <strong>AchievementMappings</strong> array in OnlineSubsytemSteamworks.uc, which is configured through DefaultEngine.ini or DefaultEngineUDK.ini.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Important</strong>: If you wish to increase the security of achievements, remove 'config' from AchievementMappings and specify the values in defaultproperties in OnlineSubsystemSteamworks.uc. You can also store achievement mappings as a static TArray in C++, for even greater security.
<p />
If you decide not to set this array up, achievements will use the 'Achievements_#' naming convention.
<p />
If you use AchievementMappings, you need to map a unique 'AchievementId' value (preferably sequential, starting from 0) to the backend achievement API Name, through 'AchievementName'; this <em>must</em> be done for every achievement.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note</strong>: 'AchievementId' corresponds to ColumnId if achievements are linked to stats.
<p />
<h3><a name="Gameplay integration"></a> Gameplay integration </h3>
<p />
There are two ways of handling achievements, one is to handle them manually through Online Subsystem functions, and the other is to let them function automatically through achievement stats updates (recommended, <em>see the 'Automatic Progress/Unlocks' and 'Tracking Progress' sections</em>).
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note</strong>: <em>See UTAchievementsBase.uc, UTAchievements.uc and DefaultEngineUDK.ini to see example code for UDK implementation of achievements.</em>
<p />
<h4><a name="Manual Progress/Unlocks"></a><a name=" Manual Progress/Unlocks"></a>  Manual Progress/Unlocks </h4>
To unlock achievements, you can use the UnlockAchievement() function, 'AchievementId' maps to the achievement API name specified for that id in the AchievementMappings array.
If AchievementMappings is not setup, then UnlockAchievement() assumes the API Name is: Achievement_# where # is replaced with AchievementId.
<p />
To receive notification of successful/failed achievement unlocks, use <strong>AddUnlockAchievementCompleteDelegate</strong> to setup a notification callback <em>before</em> calling UnlockAchievement, and <strong>ClearUnlockAchievementCompleteDelegate</strong> to clear the callback.
This should work for automatic achievement unlocks as well, but has not been tested.
<p />
To display achievement progress, call <strong>DisplayAchievementProgress()</strong>. The AchievementId parameter follows the same rules as UnlockAchievement().
<p />
<h4><a name="Automatic Progress/Unlocks"></a><a name=" Automatic Progress/Unlocks"></a>  Automatic Progress/Unlocks </h4>
<p />
If you want the Online Subsystem to automatically unlock achievements, or to automatically display achievement progress, you <em>must</em> have stats linked to achievements on the backend, and <em>must</em> setup the 'ViewId' and 'MaxProgress' values in AchievementMappings.
<p />
In 'AchievementMappings', 'ViewId' should match the ViewId of achievement stats on the backend, 'MaxProgress' indicates when the achievement should unlock, 'ProgressCount' determines the amount of progress required before displaying a progress update, and 'bAutoUnlock' controls automatic unlocks.
<p />
<h4><a name="Tracking progress"></a><a name=" Tracking progress"></a>  Tracking progress </h4>
<p />
If you have achievements linked to stats on the Steam backend, you can use the stats system to track achievement progress, and also to optionally unlock and display achievement progress automatically.
<em>See the Stats section above on how to setup and use the stats system; ColumnId should match AchievementId for achievement stats.</em>
<p />
If you have automatic achievement progress/unlocks enabled, these will be triggered by 'FlushOnlineStats', using the input achievement stats data.
<p />
<h3><a name="Debugging/Development"></a> Debugging/Development </h3>
<p />
To reset achievements, use the <strong>ResetStats</strong> function, passing in True to reset achievements. However <em>this will reset BOTH stats and achievements</em>.
<p />
<h2><a name="Leaderboards"></a> Leaderboards </h2>
<hr size="1" noshade="noshade">
<p />
<h3><a name="Backend setup"></a> Backend setup </h3>
Leaderboards can be setup through the Game Admin panel on the Steamworks partner website, or can be setup using the <strong>CreateLeaderboard()</strong> function (this function should not be used in release code, only for development purposes).
<p />
The specified leaderboard name, will be the human readable leaderboard name displayed on the Steam leaderboard page, and at the moment, that is hard coded by Valve and is not localized.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> <em>As of December 2011, leaderboards are no longer linked to stats on the backend, so the below sentence only applies to pre-December code.</em>
<p />
You <em>must</em> setup at least one stats entry (with a unique <strong>ViewId</strong>) for each leaderboard, with the API name following the <strong>ViewId_ColumnId</strong> naming convention.
The stats entry for the leaderboard must be of type INT, and must be set by the client; other stats entries in the same table/view do not have to be INT.
<p />
<p />
<h3><a name="Online Subsystem setup"></a> Online Subsystem setup </h3>
Leaderboards are linked to the backend by the <strong>LeaderboardNameMappings</strong> array. <strong>LeaderboardName</strong> identifies the leaderboard, and should match the human-readable leaderboard name on the backend; <strong>ViewId</strong> maps the leaderboard to a particular stats table.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Important:</strong> If you wish to increase the security of leaderboards, remove 'config' from LeaderboardNameMappings and specify the values in defaultproperties in OnlineSubsystemSteamworks.uc. <!--  -->
<p />
<p />
<h3><a name="Gameplay integration"></a> Gameplay integration </h3>
<em>See the Stats section above on how to setup and use the stats system.</em>
<p />
Leaderboards are read and written using the stats system, and can only be written by the client. OnlineStatsRead and OnlineStatsWrite subclasses are setup as normal, except a column must be chosen to contain the leaderboard score.
<p />
In the OnlineStatsWrite subclass, <strong>RatingId</strong> is used to identify the <strong>ColumnId</strong> used for the leaderboard score; the OnlineStatsRead subclass does not need to setup anything extra.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> <em>See GFxUILeaderboard.uc and <strong>ClientWriteLeaderboardStats()</strong> in UTPlayerController.uc to see example code for UDK implementation of leaderboards.</em>
<p />
<p />
<h4><a name="Reading"></a><a name=" Reading"></a>  Reading </h4>
To read leaderboard data, use <strong>ReadOnlineStatsByRank()</strong> and <strong>ReadOnlineStatsByRankAroundPlayer()</strong> instead of 'ReadOnlineStats()'; each players rank/name/UniqueId can be retrieved from the <strong>Rows</strong> array in the OnlineStatsRead object, and the leaderboard column contains the players score.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> <strong>ReadOnlineStatsForFriends</strong> is only functional with leaderboards as of July 2012 QA (or changelist 1271496); this will <em>not</em> work with previous builds.
<p />
<h4><a name="Writing"></a><a name=" Writing"></a>  Writing </h4>
To write leaderboard data, use <strong>WriteOnlineStats()</strong> and <strong>FlushOnlineStats()</strong> as you normally would, and it will update the leaderboard score based upon the chosen leaderboard column.
<p />
<p />
<h3><a name="Extra functionality"></a> Extra functionality </h3>
<p />
<h4><a name="Leaderboard Information"></a><a name=" Leaderboard Information"></a>  Leaderboard Information </h4>
To get extra information about a leaderboard (<strong>SortType</strong>, <strong>DisplayFormat</strong> and <strong>LeaderboardSize</strong>), you can access the <strong>LeaderboardList</strong> array, after performing a read/write on the leaderboard at least once. <strong>LeaderboardSize</strong> is updated every time the leaderboard is read from or written to.
<p />
<p />
<h4><a name="Forced updating"></a><a name=" Forced updating"></a>  Forced updating </h4>
By default, when writing leaderboard scores, the best value is kept; if you try to set a score of 5 when the current leaderboard score is 10, it will fail.
<p />
You can force it to update the leaderboard score, by setting 'UpdateType' to LUT_Force for the leaderboard in 'LeaderboardList'; if the leaderboard is not in 'LeaderboardList', it is safe to add an entry, specifying <em>only</em> 'LeaderboardName' and 'UpdateType'.
<p />
<p />
<h2><a name="Server advertisement/querying"></a> Server advertisement/querying </h2>
<hr size="1" noshade="noshade">
When advertising servers, ensure that <strong>ServerName</strong> is set under <strong>[Engine.GameReplicationInfo]</strong> in *Game.ini, otherwise the code will fallback to a default server name.
<p />
<h3><a name="Online advertising/querying"></a> Online advertising/querying </h3>
<hr size="1" noshade="noshade">
To advertise game servers on the Valve master server, you need to contact Valve so they can enable this for your games appid, and they will also provide you with a unique <strong>ProductName</strong> key for your game.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> See the <a href="OnlineSubsystemSteamworks.html#DebuggingAnchor" class="twikiAnchorLink">Debugging</a> and <a href="OnlineSubsystemSteamworks.html#CommonProblemsAnchor" class="twikiAnchorLink">Common problems</a> sections for information on fixing issues with advertising/querying.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> The playercount displayed on the server browser, is tied into the authentication code; the playercount is determined by the number of authenticated clients, so ensure <strong>bAuthenticateClients</strong> is true under <strong>[Engine.AccessControl]</strong> in &#42;Game.ini.
<p />
<h4><a name="ProductName"></a> ProductName </h4>
The ProductName value is used internally by Steam, to advertise game servers for your game<!-- %STOPPUBLISH -->, and for licensee's with source access it should be put in the <strong>STEAM_PRODUCT_NAME</strong> define in OnlineSubsystemSteamworks.h<!--  -->.
<p />
For licensee's using the UDK only, who have a unique appid, ProductName should be put in DefaultEngineUDK.ini, under <strong>[OnlineSubsystemSteamworks.OnlineSubsystemSteamworks]</strong>, like so:
<div class="codesnippet">
<pre>
ProductName&#61;unrealdk
</pre>
</div>
<p />
<h4><a name="GameDir"></a> GameDir </h4>
The other important value to setup for your game, is the <strong>GameDir</strong> value in *Engine.ini; this should be given a value unique to your game, and it is important, as it is the value used to filter your game on the Valve master server.
<p />
If you do not specify a GameDir value unique to your game, server browser queries will go through all servers, <em>from every game</em> on the Valve master server.
<p />
<h4><a name="Advertising through UDK"></a> Advertising through UDK </h4>
UDK developers without a unique appid, can advertise their servers through the UDK itself; the only important thing to do here, is to setup a GameDir value unique to your project, so that servers from other UDK-only projects are not returned in server browser queries.
<p />
Only non-commercial UDK developers should advertise through the UDK itself; commercial developers must contact Valve and get a unique appid and ProductName.
<p />
<h3><a name="LAN advertising/querying"></a> LAN advertising/querying </h3>
<hr size="1" noshade="noshade">
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> <em>This documentation section applies to LAN queries for all Online Subsystems.</em>
<p />
To properly advertise and query LAN servers with the online subsystem, you must ensure that you set the <strong>LanGameUniqueId</strong> and <strong>LanPacketPlatformMask</strong> values under <strong>[IpDrv.OnlineGameInterfaceImpl]</strong> in *Engine.ini.
<p />
These values are used to restrict the servers that show up in LAN query results, so that results for different UE3 games aren't shown (due to differing LanGameUniqueId values), and so that you can restrict PC servers from showing up on PS3 server browser queries (through LanPacketPlatformMask restrictions).
<p />
For <strong>LanGameUniqueId</strong>, you should generate a random 32bit integer value and set that in the ini file.
<p />
For <strong>LanPacketPlatformMask</strong>, you should set the mask value based upon the <strong>EPlatformType</strong> enum in UnFile.h (this can be specified using hexadecimal, e.g. 0x00000001); here is a table of values:
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><th bgcolor="#dadada" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=1;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Platform</font></a> </th><th bgcolor="#dadada"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=1;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Mask</font></a> </th></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Windows </td><td bgcolor="#ffffff"> 0x00000001 </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Windows dedicated server </td><td bgcolor="#eaeaea"> 0x00000002 </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Xbox360 </td><td bgcolor="#ffffff"> 0x00000004 </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> PS3 </td><td bgcolor="#eaeaea"> 0x00000008 </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Linux </td><td bgcolor="#ffffff"> 0x00000010 </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> MacOSx </td><td bgcolor="#eaeaea"> 0x00000020 </td></tr>
</table>
<p />
See EPlatformType in UnFile.h for the remainder of the platform masks.
<p />
As an example, to allow PC and PS3 servers/players to query each other, you would combine the masks 0x00000001 and 0x00000008 together, into the value 0x00000009. To allow all platforms, specify 0xFFFFFFFF.
<p />
<!-- %STOPPUBLISH -->
<h2><a name="Steam Lobby"></a> Steam Lobby </h2>
<hr size="1" noshade="noshade">
The lobby system is disabled by default, enable it in OnlineSubsystemSteamworks\Globals.uci (requires UScript and C++ recompile to enable)
see OnlineLobbyInterfaceSteamworks.uc\UOnlineLobbyInterfaceSteamworks.cpp for implementation details.
When you modify globals.uci, open and save a .uc file as well, as there is a make commandlet bug which does not check .uci files to see if recompilation is needed.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> The Steam lobby code is unsupported (hence why it is disabled by default), outside of fixing bugs or otherwise broken code. It is mostly just a wrapper around SteamAPI's isteammatchmaking.h lobby code, the majority of which has been implemented fully, but any additional features (introduced over time by the SteamAPI, or otherwise not currently implemented) will need to be added by licensees.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> The lobby system is <em>not</em> a replacement for the server browser (albeit it is good to implement anyway, since it resolves browser-based NAT issues for hosts), as it functions very differently (no inbuilt ability to ping servers before join for instance) and the <em>Steam Client must be open</em> to use lobbies, which means dedicated servers can not use them.
<p />
<!-- %STARTPUBLISH -->
<p />
<h2><a name="Multiplayer Authentication"></a> Multiplayer Authentication </h2>
<hr size="1" noshade="noshade">
Steam supports multiplayer authentication, for verifying client and server SteamId's, verifying that a client owns the game, is not VAC banned, and is not already authenticated on another server.
<p />
This is controlled through a generalized online subsystem interface, <strong>OnlineAuthInterface</strong>, with general authentication logic implemented in <strong>AccessControl</strong> (for controlling authentication and admission of clients to a server), and in <strong>LocalPlayer</strong> (for clientside handling of server authentication).
<p />
This is exposed for configuration in *Game.ini, under [Engine.AccessControl] with the following configuration settings: <ul>
<li> <strong>bAuthenticateClients</strong> - Whether or not game servers should authenticate joining clients (clients are blocked from joining at PreLogin, until auth completes, or kicked if it fails)
</li> <li> <strong>bAuthenticateServer</strong> - Whether or not clients should authenticate the game server (happens after client auth completes)
</li> <li> <strong>bAuthenticateListenHost</strong> - Whether or not players hosting a listen server should be authenticated with their own server
</li> <li> <strong>MaxAuthRetryCount</strong> - The maximum number of times to retry authentication for a player
</li> <li> <strong>AuthRetryDelay</strong> - The delay between auth retry attempts
</li></ul>
<p />
<p />
<h3><a name="Authentication and Stats"></a> Authentication and Stats </h3>
For stats entries which are set to <strong>GS</strong> (i.e. GameServer) on the backend, where only game servers can write these stats for players, it is essential that the player is authenticated on the server, or else GS stats cannot be written for that player.
<p />
<h2><a name="Steam sockets"></a> Steam sockets </h2>
<hr size="1" noshade="noshade">
Steamworks provides a networking interface for automatically handling NAT traversal, which allows you to connect to servers based upon SteamId.
<p />
This is implemented by OnlineSubsystemSteamworks, in the form of a custom net driver; to enable this, open DefaultEngine.ini, and under <strong>[Engine.Engine]</strong>, change:
<div class="codesnippet">
<pre>
NetworkDevice&#61;IpDrv.TcpNetDriver
</pre>
</div>
To:
<div class="codesnippet">
<pre>
NetworkDevice&#61;OnlineSubsystemSteamworks.IpNetDriverSteamworks
</pre>
</div>
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> <em>This must be done for both the client and server.</em>
<p />
<h3><a name="Starting a server"></a> Starting a server </h3>
When the Steam sockets net driver is set, servers must be started with <strong>?steamsockets</strong> in the commandline, in order to enable Steam sockets. If that is not put in the commandline, regular IP connections are used.
<p />
Every time a server is started with Steam sockets, it will generate a new SteamId, which is logged in the server logfile, and can be retrieved in UnrealScript through <strong>OnlineAuthInterface.GetServerUniqueId</strong>.
<p />
This is the UID that must be used to connect to a server, however, any clients attempting to connect to the server by regular IP, will be automatically redirected to the servers SteamId address.
<p />
When a server is started with Steam sockets, it will also advertise the servers SteamId in the server browser, with the key <strong>SteamServerId</strong>.
<p />
To access this in UScript, an OnlineGameSettings subclass must be given a databinding variable with the same name; see UTGameSettingsCommon for an example.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> To get the server SteamId through code, use <strong>GetServerUniqueId()</strong> in OnlineAuthInterface
<p />
<h3><a name="Connecting to a server"></a> Connecting to a server </h3>
To connect to a server using Steam sockets, the client must specify the server SteamId in the connection URL; SteamId URL's are specified in the format <strong>Steam.#</strong>, where # is the SteamId, e.g. Steam.90083795756409860.
<p />
For example, the console command to connect to a server would be:
open steam.90083795756409860
<p />
Clients that attempt to connect to the servers regular IP, will be redirected by the server (if there are no NAT problems with regular IP's), to the servers SteamId address.
<p />
<h3><a name="Forcing Steam sockets"></a> Forcing Steam sockets </h3>
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> This feature is currently not working correctly, requiring servers that are being joined to be queryable on the server browser.
<p />
A pending changelist for October 2012 UDK adds the <strong>bSteamSocketsOnly</strong> configuration option under [OnlineSubsystemSteamworks.IpNetDriverSteamworks] in &#42;Engine.ini, which (when enabled) forces servers to always use steam sockets (removing the need to specify ?steamsockets), and which forces clients using the online subsystems server browser, 'JoinOnlineGame' and invite functionality, to always connect to a servers steam sockets address (even if the server is not advertised as using steam sockets, and is not advertising a steam address, clients assume it does use steam sockets, and use the steam address given by the SteamAPI).
<p />
This helps maximize support for NAT traversal, and if it is enabled then it should be enabled for your <em>entire game</em> (preferably hard-coded, instead of just using bSteamSocketsOnly); this particularly helps to ensure that invites, and other game server joins initiated externally by Steam, will <em>always</em> be successful (even without full port forwarding).
<p />
Clients will still be able to use "open IP" to try and join servers (just like with ?steamsockets), but will be redirected by the server, to join the servers steam sockets address.
<p />
<h2><a name="Invites"></a> Invites </h2>
<hr size="1" noshade="noshade">
<p />
The OnlineSubsystemSteamworks integration provides thorough support for executing invites sent within the Steam Client and sent ingame, as well as supporting 'join friend' features and other server joins triggered within the Steam Client UI, including those that startup the game (all generically labelled 'invites' for this section).
<p />
All of these are handled through the online subsystems invite code, regardless of whether or not they were triggered by an invite.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> Your game <em>must</em> support server browser advertising, and the server <em>must</em> be listed on the master server (even if not directly queryable, i.e. does not need ports forwarded), in order for invites to work properly.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> There are pending changes for the October 2012 engine build, which significantly affect the functionality of invites; this sections documentation is based on that code.
<p />
<h3><a name="Sending invites"></a> Sending invites </h3>
There are two primary ways of sending invites, through the <strong>Steam UI</strong> (typically, on the friends list, right clicking a friend and inviting them) and through <strong>SendGameInviteToFriend</strong> in the online subsystem.
<p />
SendGameInviteToFriend is the recommended way, as this is most compatible with steam sockets, but both work.
<p />
<h3><a name="Joining friends or servers"></a><a name=" Joining friends or servers"></a>  Joining friends or servers </h3>
When you try to join a friend or server through the Steam UI (whether through friends list or Steam Community etc.), this is treated exactly like all other invites triggered through the Steam UI; there is no way to distinguish between actual invites, or server joins triggered locally in the Steam Client.
<p />
<h3><a name="Handling invites"></a> Handling invites </h3>
When an invite is received by UE3, it automatically kicks off an internal server browser search to find the server the invite is for (this works so long as the server is listed on the master server, even if it is not directly queryable).
Once this search returns, the result is passed through the <strong>OnGameInviteAccepted</strong> delegate in the online subsystem; when that is triggered, it's passed in a server search result containing information for the invite, and must call <strong>AcceptGameInvite</strong> in order to accept the invite.
<p />
AcceptGameInvite will automatically call JoinOnlineGame, which will trigger the <strong>OnJoinOnlineGameComplete</strong>; at this point, you should then join the server, at the URL specified by the <strong>GetResolvedConnectString</strong> function (using that function to get the join URL is important, as it will automatically know whether to use a Steam sockets address, or a regular IP address).
<p />
The base engine code in PlayerController.uc already handles all of this correctly, and can be used as a reference.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> When Steam sockets are in use, the <strong>SteamServerId</strong> value will be set within the search results game settings; see the Steam sockets section for more info.
<p />
<h4><a name="Startup invites"></a><a name=" Startup invites"></a>  Startup invites </h4>
Since invites and server joins can be triggered within the Steam Client, when the game is not open, Steam is able to startup the game automatically to handle these invites.
<p />
Due to this, it's very important to hook OnGameInviteAccepted as soon as possible at startup (again, the base engine code in PlayerController.uc handles this correctly), so that the invite is not missed.
<p />
To test this in dev builds that can't launch from Steam, you can specify on the commandline: <strong>-SteamConnectIP=127.0.0.1:7777</strong> (you must specify the servers public IP, for this to work)
<p />
<h3><a name="Steam sockets"></a> Steam sockets </h3>
The invite code ties in closely with steam sockets, and because there are several different types of invites, not all of these invites fully support steam sockets and thus do not all fully support 100% NAT traversal (due to limitations with info provided by Steam).
<p />
Invites triggered through the Steam UI do not typically have enough information to join by steam sockets, but will be able to get this information if there is a friend on the specified server; if there is not a friend on the server, these invites will try to join by IP instead.
<p />
Invites triggered through <strong>SendGameInviteToFriend</strong> should always have enough information to connect to steam sockets servers
<p />
<h4><a name="Force Steam sockets"></a><a name=" Force Steam sockets"></a>  Force Steam sockets </h4>
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> This feature is currently not working correctly, requiring servers that are being joined to be queryable on the server browser.
<p />
If <strong>bSteamSocketsOnly</strong> is set for a game (see the Steam sockets documentation section), then <em>all</em> invites are guaranteed to work with steam sockets, no matter what.
<p />
If your game will significantly depend upon NAT-friendly invites, it's highly advised that bSteamSocketsOnly is used, as it makes this a lot easier for users, and greatly simplifies configurations that need to be supported.
<p />
<h2><a name="Automatically launching Steam"></a> Automatically launching Steam </h2>
<hr size="1" noshade="noshade">
If you need to ensure that the Steam client is running when you launch your game, you can configure the game to detect when Steam isn't running, and to automatically launch the Steam client (closing the game in the process, which is then relaunched by Steam).
<p />
To set this up, edit &#42;Engine.ini, and under [OnlineSubsystemSteamworks.OnlineSubsystemSteamworks], set <strong>bRelaunchInSteam</strong> to true, and set <strong>RelaunchAppId</strong> to your games appid; <strong>you must then delete steam_appid.txt from the Win32/Win64 folders in Binaries</strong>.
<p />
It is also very important that your game is installed within the Steam folder (typically Steam\SteamApps\common\YourGame\), otherwise this will not work.
<p />
When you launch the game outside of Steam, the game will be closed and relaunched by Steam (automatically starting the Steam client if necessary).
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> The most common cause of problems here, is failing to delete steam_appid.txt, so double check that you have done that, if you have problems.
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> As of 16/7/12, there is a bug in steam_api64.dll which prevents relaunching from working in 64bit games; this requires a fix from Valve.
<p />
<h2><a name="Debugging"></a> Debugging </h2>
<hr size="1" noshade="noshade">
<a name="DebuggingAnchor"></a> When you encounter a problem with the Steam subsystem, the first thing to do is always remove <strong>Suppress=DevOnline</strong> in &#42;Engine.ini, under <strong>[Core.System]</strong>. This will greatly increase the amount of log info output about the online subsystem (alternatively, type <strong>unsuppress devonline</strong> in the console).
<p />
For problems which may be occuring within the Steamworks API itself, you should add <strong>-debug_steamapi</strong> to the games commandline, and this will output error information from the Steam SDK into the logfile. Adding <strong>-console</strong> to the <em>Steam client</em> commandline can also be helpful, as it adds a 'Console' tab to Steam, which provides some debug output.
<p />
<h3><a name="Steam sockets"></a><a name=" Steam sockets"></a>  Steam sockets </h3>
When debugging Steam sockets, in addition to the above, it also helps to unsuppress <strong>DevNet</strong> in Engine.ini in addition to DevOnline, and for when there are extremely hard to track down issues at the net-channel level, you can unsuppress <strong>DevNetTraffic</strong> and in <strong>UnBuild.h</strong>, force <strong>SUPPORT_SUPPRESSED_LOGGING</strong> to 1 (be warned that this will massively spam the logfile).
<p />
Additionally, if you want to debug internal Steam problems with steam sockets, such as difficulty making a connection, receiving timeouts and such, you can add <strong>-lognetapi</strong> to the commandline for Steam.exe itself, <strong>and also to the game commandline</strong> (which is required in order for the host to log information), then you can see detailed debug information about active sockets, in <strong>Steam\logs\netapi_log.txt</strong>.
<p />
<h3><a name="Server browser"></a><a name=" Server browser"></a>  Server browser </h3>
When debugging the server browser (usually when a server is not showing up), you should look for log entries which reference <strong>ServerListResponse</strong> and <strong>ServerRulesResponse</strong>.
<p />
ServerListResponse results are queries with the Valve master server, which will always return results no matter what; ServerRulesResponse results are queries with individual servers, which <em>may fail if there are NAT, port-forwarding or other networking issues</em>.
<p />
If you see your server IP listed in any ServerListResponse entries, the server is successfully listed on the Valve master server.
However, if your server IP is listed in any query failure messages, there is a very high chance that it is a misconfiguration (on the server) of a router/firewall with regards to port forwarding, or generally some other networking issue unrelated to UE3; such a misconfiguration will prevent ServerRulesResponse queries from taking place.
<p />
If you see your server IP listed in any (non-failure) ServerRulesResponse entries, it is likely not a networking issue, but an issue with data you are advertising, engine version mismatches, or some other problem originating within UE3 (which should have log output detailing the cause of the problem).
<p />
ServerListResponse log entries to look out for:
<div class="codesnippet">
<pre>
DevOnline: ServerListResponse: Got server details (index: x)
...
DevOnline: Querying rules data for Internet server x.x.x.x:xxxx
</pre>
</div>
<div class="codesnippet">
<pre>
DevOnline: ServerListResponse: Server &#39;x&#39; failed to respond
DevOnline: ServerListResponse: Server &#39;x&#39; Address: x.x.x.x:xxxx
</pre>
</div>
<p />
ServerRulesResponse log entries to look out for:
(individual rules can identify the server)
<div class="codesnippet">
<pre>
DevOnline: ServerRulesResponse: Retrieved server rule: x&#61;y
</pre>
</div>
<div class="codesnippet">
<pre>
DevOnline: This server is for a different engine version (x), rejecting.
</pre>
</div>
<div class="codesnippet">
<pre>
DevOnline: ServerRulesResponse: Rules response failed for server; IP: x.x.x.x:xxxx, UID: x
</pre>
</div>
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Note:</strong> See the 'Common problems' section below for more information on server browser/advertising issues.
<p />
<h4><a name="Rare issues"></a><a name=" Rare issues"></a>  Rare issues </h4>
<a name="RareIssuesAnchor"></a> <img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> <strong>Update</strong>: As of 21/9/12, this problem is also related to the Steam MasterServer2.vdf file containing bad data, which is <em>not</em> fixable by making Steam redownload itself (or any other steps below); instead, you must grab the MasterServer2.vdf from a working Steam install (if available). Valve are aware of this and due to fix it with a Steam Client update (so check for Steam Client betas also if you encounter this).
<p />
Sometimes people encounter more rare issues with server advertising/querying that are more difficult to track down, which are either caused by unusual networking configuration problems, or by Steam itself internally.
<p />
For these issues (which are hard to identify) it can help to run <a href="http://www.wireshark.org" target="_top">Wireshark</a> on clients/servers, to try and watch the query packets coming and going (these can be difficult to spot, but if you filter out all traffic other than the Steam ports in Wireshark, you can spot them).
If you don't see the query request packet reach the server (or if you don't see the response reach the client), then it is almost certainly a networking issue; very rarely though, you may see the packet reach the server/client, but it may get lost internally within Steam itself.
<p />
When such issues are encountered, you will need to contact Valve to get assistance investigating the issue (it may be a bug Valve will need to fix); such issues are extremely rare though, and can often be worked around (clientside at least) by deleting Steam and letting it redownload itself.
<p />
<h2><a name="Common problems"></a> Common problems </h2>
<hr size="1" noshade="noshade">
<p />
<a name="CommonProblemsAnchor"></a> Some problems that can be encountered with the Steam subsystem.
<p />
<h3><a name="Stats not updating"></a> Stats not updating </h3>
Common causes of stats writing failures
<p />
<h4><a name="Game server stats"></a><a name=" Game server stats"></a>  Game server stats </h4>
If you are writing game server stats for a player, you must ensure the client is correctly authenticated on the server; by default, the engine blocks players from joining a server if they fail auth, as controlled in AccessControl.uc.
<p />
<strong>GameServerStatsMappings</strong> (as described in the Stats section) must also be setup properly, in order for the game to recognize which stats should be written as game server stats.
<p />
Also, you must ensure that the server has setup its online session properly, which can be determined by seeing if it is listed on the master server.
<p />
<h3><a name="Leaderboards breaking"></a> Leaderboards breaking </h3>
The December 2011 Steam updates greatly modified the way leaderboards store data, breaking binary compatibility with the previous implementation of leaderboards.
<p />
<h3><a name="Server not showing on master server"></a> Server not showing on master server </h3>
Common causes of servers failing to show up on the server browser.
<p />
<h4><a name="ProductName and _GameDir"></a><a name=" _ProductName and _GameDir"></a>  ProductName and GameDir </h4>
As described in the Server advertisement/querying section above, you must set a valid <strong>ProductName</strong> and <strong>GameDir</strong> value for your game, to get servers to show up and be queryable on the master server.
<p />
<h4><a name="AppId"></a><a name=" _AppId"></a>  AppId </h4>
You must ensure you have a valid <strong>steam_appid.txt</strong> file in your Binaries/Win32 directory, which correctly lists your games AppId.
<p />
<h4><a name="Port forwarding and lack of NAT traversal"></a><a name=" Port forwarding and lack of NAT traversal"></a>  Port forwarding and lack of NAT traversal </h4>
Steam does not support NAT traversal for the server browser, so if you host a server, you need to make sure ports are open for the game/query ports, and for Steam itself; some more info:
<a href="https://support.steampowered.com/kb_article.php?ref=8571-GLVN-8711" target="_top">https://support.steampowered.com/kb_article.php?ref=8571-GLVN-8711</a>
<p />
<h4><a name="Dedicated server without Steam client"></a><a name=" Dedicated server without Steam client"></a>  Dedicated server without Steam client </h4>
If you run a dedicated server without the Steam client running, you must ensure that the files steamclient.dll, tier0_.dll, vstdlib_s.dll and steam.dll are present in the Binaries\Win32 folder.
<p />
<h4><a name="Hosting and querying from the same IP"></a><a name=" Hosting and querying from the same IP"></a>  Hosting and querying from the same IP </h4>
In the 'Internet' tab on the server browser, some bad router or firewall configurations can block you from querying locally hosted servers; this happens when trying to send a packet to your own external/public IP.
<p />
<h4><a name="Bad routers"></a><a name=" Bad routers"></a>  Bad routers </h4>
Some licensees have encountered problems with routers that appear to be configured correctly, yet have a fault which prevents server advertising from working correctly. There is not a list of routers which are known to have issues at the moment, so it is recommended that (when all else fails and everything appears to be configured correctly) you search for known problems with your particular router.
<p />
The information on using Wireshark to debug, in the <a href="OnlineSubsystemSteamworks.html#RareIssuesAnchor" class="twikiAnchorLink">Rare issues</a> part of the 'Debugging' section, can help narrow down whether or not your router is the issue (this debugging process is messy/complicated though).
<p />
<h3><a name="Steam Client issues"></a> Steam Client issues </h3>
Issues with the Steam Client may cause any range of problems, including with the server browser; here is an article which provides some information on this:<br />
<a href="https://support.steampowered.com/kb_article.php?ref=9828-SFLZ-9289" target="_top">Programs Which May interfere with Steam</a>
<p />
There have also been reported problems with the MasterServer2.vdf files with Steam itself (particularly with the server browser), which might have a resolution here for some people:<br />
<a href="https://support.steampowered.com/kb_article.php?ref=1452-HCVB-6984&amp;l=english" target="_top">https://support.steampowered.com/kb_article.php?ref=1452-HCVB-6984&amp;l=english</a>
<p />
Another method of trying to track down Steam issues is to backup and then delete <strong>ClientRegistry.blob</strong>, and then relaunch Steam and see if the issue is resolved; if not, you can backup the Steam folder, and then delete all of its contents except for Steam.exe, and then let Steam.exe redownload all necessary files again to see if that resolves the issue.
<p />
Some Steam Client issues are particularly difficult to track down however, so if none of the information in the 'Common Issues' or 'Debugging' section here helps, it is recommended to contact Valve.
<p />
<h2><a name="Content Server"></a> Content Server </h2>
<hr size="1" noshade="noshade">
See the <a href="Steam.html" class="twikiLink">Steam</a> page for steps on publishing/deploying your game and content
<p />
<h2><a name="Changelists"></a> Changelists </h2>
<hr size="1" noshade="noshade">
<p />
Some major OnlineSubsystemSteamworks changes are listed here.
<div class="codesnippet">
<h3><a name="December 12th 2011"></a> December 12th 2011 </h3>
<p />
<strong>Changelist number</strong>: 1101160
<p />
<strong>Changelist</strong>:
<pre>OnlineSubsystemSteamworks:
-------------------------
- Leaderboards now store stats data within the leaderboard, instead of in the backend stats system
- Game server stats ViewId&#39;s must now be explicitly specified in &#42;Engine.ini through &#39;GameServerStatsMappings&#39; under
   &#91;OnlineSubsystemSteamworks.OnlineSubsystemSteamworks]
   - Since game server stats are determined based upon ViewId, client and game server stats should be read/written separately
- Fixed a leaderboard error log throwing false positives
- Added some stats debug logging
- Improved existing stats debug logging
- Fixed an issue where the Steam game server would initialize, despite &#39;-nosteam&#39; in commandline, or bEnableSteam&#61;false
- Removed &#39;bIncrementStatValues&#39; from OnlineSubsystemSteamworks
- Fixed a crash with game server stats, when the server is run without Steam running
- Fixed an issue with authentication timers, when the game is paused
- Fixed an issue with mismatched native class sizes for OnlineAuthInterfaceImpl, due to duplicate delegates
- Fixed an issue where the code skipped ending of some auth sessions
- ReadOnlineStats can now be used to read leaderboard entries for lists of players (as determined by ViewId and LeaderboardNameMappings)</pre>
<p />
<h3><a name="December 8th 2011"></a> December 8th 2011 </h3>
<p />
<strong>Changelist number</strong>: 1097618
<p />
<strong>Build notes</strong>:
<pre>Things to note about recent UE3 Steam changes:
---------------------------------------------
- Net compatability is broken completely, through many additions/modications of the base UE3 netcode
   - Net-channel handshake code has been added to the base netcode
   - Steam authentication has been completely recoded
   - The login process has partially changed
   - Many base net control-channel messages have changed (and nearly all renumbered)

- OnlineSubsystemSteamworks has changed substantially, modifying functionality of achievements/stats/leaderboard and authentication
   (among many other things)
   - Any pre-existing use of OnlineSubsystemSteamworks code will require retesting and possibly some refactoring
   - For more info, see: https://udn.epicgames.com/Three/OnlineSubsystemSteamworks

- A generalized multiplayer authentication system has been implemented (currently only implemented by OnlineSubsystemSteamworks),
   which affects the AccessControl, GameInfo and LocalPlayer classes

- Achievements, stats and leaderboards in OnlineSubsystemSteamworks are configured through &#42;Engine.ini (primarily so UDK developers
   have easy access to changing settings); these lists are not secured against .ini modifications by players, so developers
   want better security, they should hard-code these lists in C++ (preferable) or UScript

- The server browser does not support NAT traversal; if you wish to have NAT traversal for server browser/advertising, you must
   implement it through Steam lobbies in OnlineLobbyInterface

- Server browser querying, with lots of servers, is currently very slow as the client must query all individual servers;
   the code is not yet optimized to use the &#39;server tags&#39;, which would reduce the need for individual queries

- PS3/Mac support is not yet implemented


Outline of UE3 Steam features/changes:
-------------------------------------
- Support for stats/leaderboards/achievements has been expanded
   - Setup of achievements has been modified to make it easier to setup with Steam backend
   - Game server stats are now supported and fully functional
   - Leaderboard support has been integrated

- Server browser advertising/querying has been fixed/improved
- Voice over IP has been fixed
- Basic support for Steam lobbies has been added, through OnlineLobbyInterface
- Game connection NAT traversal has been added, through Steam sockets (i.e. Steam peer to peer networking)
   - NOTE: This is only for game connections; server advertising/querying with the server browser is not NAT-friendly
- Multiplayer authentication has been fixed and expanded
- Game servers can now be run without Steam running at the same time
- Many other bugfixes and tweaks</pre>
<p />
<strong>Changelist</strong>:
<pre>Steam sockets:
-------------
- Added SteamId based networking, for connecting to servers by SteamId instead of IP; automatically handles NAT traversal
- To enable Steam sockets, edit &#42;Engine.ini, and under &#91;Engine.Engine], set: NetworkDevice&#61;OnlineSubsystemSteamworks.IpNetDriverSteamworks
- To connect to a server using steam sockets, use &#34;open Steam.#&#34;, where # is the server SteamId
- To use steam sockets on a server, start the server with &#34;?steamsockets&#34; in the URL
- Servers using steam sockets will automatically redirect IP connections to Steam socket connections
- NOTE: To get the server SteamId through code, use &#39;GetServerUniqueId&#39; in OnlineAuthInterface

Steam master server and server browser support:
----------------------------------------------
- UDK developers can now advertise their games servers on the Valve master server, and display the servers in the UDK server browser
- Non-commercial UDK devs can advertise their servers straight through the UDK, with no restrictions
- If devs want their mod to show up independantly of the UDK, change GameDir in DefaultEngineUDK.ini, to a unique value identifying the mod
- Commercial UDK devs MUST contact Valve, and get a unique appid/product-name, in order to advertise/list servers (don&#39;t use the UDK product name)
- ProductName can be set in DefaultEngineUDK.ini (non-commercial) and in OnlineSubsystemSteamworks.h (commercial)

Auth interface:
--------------
- Added new online subsystem interface, OnlineAuthInterface, for handling multiplayer authentication
- Completely rewrote auth system for OnlineSubsystemSteamworks, moving all internal engine code to OnlineAuthInterfaceSteamworks
- Implemented base multiplayer authentication logic in AccessControl (for serverside code) and LocalPlayer (for clientside code)
- Multiplayer authentication can be enabled/disabled under &#91;Engine.AccessControl] in &#42;Game.ini, with the following options:
   - bAuthenticateClients: Authentication of clients when connecting to server
   - bAuthenticateServer: Authentication of server with clients
   - MaxAuthRetryCount: Maximum number of times authentication can be retried
   - AuthRetryDelay: Delay between authentication retries

Steam lobby system:
------------------
- Implemented the Steamworks lobby system for licensees; see OnlineLobbyInterfaceSteamworks.uc\UOnlineLobbyInterfaceSteamworks.cpp
- The lobby system is disabled by default, enable it in OnlineSubsystemSteamworks\Globals.uci (requires UScript and C++ recompile to enable)
- At the moment, this is a Steamworks-specific interface, not a generalized interface compatible with other online subsystems;
   as a result, it&#39;s subject to considerable change and binary compatability breakage, since it may need to be generalized in the future


OnlineSubsystemSteamworks:
-------------------------
- Added code for managing a games unique Steam product name when advertising/querying servers (required for interacting with Valve master server)
- Fixed code to correctly filter by unique &#39;GameDir&#39; value, when querying servers (stops browser trying to list 20,000+ servers from other games)
- Added clientside filters for game server queries; necessary, as Steamworks supports very limited, hard-coded master-server filters
- Added &#39;bFilterEngineBuild&#39; config value to DefaultEngine.ini/DefaultEngineUDK.ini, for filtering out servers with a mismatched build number
- Added &#39;All Gametypes&#39; filter to server browser, to list servers from every gametype
- Added &#39;Unlisted Gametypes&#39; filter to server browser; lists servers not running stock UDK gametypes (see GFxUDKFrontEnd&#95;JoinGame::OnGameTypeChanged)
- Fixed issues with browser filter menu
- Added config FilterKeyToSteamKeyMap array to OnlineGameInterfaceSteamworks, to map OnlineGameSearch filters, to hard-coded master-server filters
- When a player is connecting, kick any other players with a matching IP and SteamId (fixes a rare auth issue preventing players from joining)
- Fixed an issue where the Steam Community profile page would show the IP used to connect to a server (e.g. 127.0.0.1), instead of the external IP
- Fixed issue with servers sending up to date query data, but not updating with the master server
- Fixed up some issues querying LAN servers
- Added code for cleaning up online game sessions, when exiting the game (fixes servers lingering on master server after shutdown)
- Fixed an issue with server browser string filters
- Added the functions &#39;UniqueNetIdToInt64&#39;/&#39;Int64ToUniqueNetId&#39;, for converting UID&#39;s to/from Int64 strings;
   for use with Steam sockets, specifically the &#39;open Steam.#&#39; command
- Fixed an issue where Steam sockets would be created for non-steam URL&#39;s
- Fixed an issue with Steam sockets, where if you tried to connect to a server with the same UID, it would trigger an endless send/receive loop
- Fixed an issue where Steam sockets would not close correctly
- Removed some redundant Steam sockets code, and fixed an issue with lingering sockets
- Integrated VOIP crash fix from Dayle &#64; Tripwire
- Migrated to Steamworks SDK v1.15
- Added &#39;GetCommandlineJoinURL&#39;, for retrieving the server URL/UID when the game is launched by a &#39;join friend&#39; request
- Added &#39;GetFriendJoinURL&#39;, for retrieving the URL/UID of a friends current game
- Implemented the &#39;SendGameInviteToFriend&#39; and &#39;SendGameInviteToFriends&#39; functions (sends invite directly, instead of through Steam UI)
- Fixed being unable to read client game server stats
- Multiple significant (and unlisted) wide-ranging changes/bugfixes for Steam sockets
- Fixed a rare listen server crash
- Servers using Steam sockets now advertise the join UID; to access in a GameSettings subclass, add a databinding string property &#39;SteamServerId&#39;
- Added code to disable relay servers with P2P networking (latency too high)
- Some Steamworks callbacks are now polled within OnlineSubsystemSteamworks (instead of within Steam SDK), fixing a number of SDK crashes
- Added &#39;ShowProfileUI&#39; function, for opening up a players Steam Community page, with an optional sub-url for leaderboards/stats etc.
- Adjusted OnlineSubsystemSteamworks, so it can host Steam game servers without Steam running (NOTE: Does not work with 64bit binaries)
- Added &#39;bRelaunchInSteam&#39; setting in &#42;Engine.ini; if true, and the game is launched outside of Steam, the game exits and is launched in Steam
   - NOTE: There must not be any steam&#95;appid.txt in the Binaries folder, in order for this to work;
      the &#39;RelaunchAppId&#39; setting should be set to the games appid in &#42;Engine.ini
   - NOTE: The game must be installed correctly within the Steam folder for this to work (will not work from any other location)

Server Browser:
--------------
- Stock UDK gametypes now filter by gameclass as well as gametype integer (stops mod gametypes showing under Deathmatch etc.)
- Fixed browser using wrong filter settings, if you change the gametype selection too fast

Networking:
----------
- Added a basic handshake to the control channel code, and blocked control channel commands until the handshake completes
- Added a script hook for the disconnect command, &#39;NotifyDisconnect&#39; in PlayerController, for cleaning up online game sessions
- Added some missing control channel implementation macros
- Modified control channel macros, to throw linker warnings upon missing implementation macros
- Added per-connection session UID&#39;s, which are sent with every packet (only with Steam sockets); necessary to stop connectionless Steam sockets
   from colliding data between different game sessions
   - NOTE: Also blocks most packet spoofing


Integrated OnlineSubsystemSteamworks changes from Ryan Gordon:
-------------------------------------------------------------
- Steamworks: Handle AvatarImageLoaded&#95;t callback, so we can process avatar downloads faster in some cases.
- Steamworks: Allow access to small, medium, or large avatars.
- Steamworks: Expose player&#39;s Clan information to script (Steamworks-specific functionality).
- Steamworks: Don&#39;t use P2P sockets by default. Some licensees will want these enabled, but not all.
- Steamworks: Move to new Steamworks SDK&#39;s Auth APIs. (NOTE: Disabled, as needs more implementation)
- Steamworks: Added some basic, generic uscript-callable interfaces to Steam Cloud.
   These would need to be more formal to be part of the higher-level OnlineSubsystem interface, since they aren&#39;t async, etc.
   Still, licensees that are exclusively targeting Steam might find them useful.
- Steamworks: Allow use of SDK&#39;s P2P sockets instead of raw WinSock for game data.
   This allows for NAT traversal; with this enabled, a client and server behind separate, restrictive NATs should be able to talk;
   Steam bounces data off a public relay server, if necessary.
- Steamworks: Update SDK library in Binaries/Win32
- Steamworks: server-side stats are always available now, remove the preprocessor checks
   (this was blocked out because older Steamworks SDK didn&#39;t support it).
- Steamworks: Implemented UOnlineSubsystemSteamworks::GetNATType().
- Steamworks: Actually enable Win64 support.
- Steamworks: add win64 support to the build scripts.
- Steamworks: normalize line endings in SDK headers, to make Visual Studio happy.
- Steamworks: remove conditional for older SDK release.

OnlineSubsystemSteamworks VOIP fixes:
------------------------------------
- Fixed an issue where VOIP decompression resulted in garbled data
- Added more checks against crashing due to VOIP AudioComponents pending GC
- Added a counter to delay VOIP sound node removal; reduces VOIP skipping
- Fixed an issue with XAudio2 inserting silence into the middle of procedural (VOIP) streams
- Tweaked VOIP buffering to smooth playback
- Fixed issue where the last half second of VOIP data would be cut off on releasing the transmit button
- Fixed bug where VOIP reads would not stop ticking, if Steam had compressed voice data available, but no raw data available (and vice versa)
- Worked around a Steam bug, where starting a new VOIP session before the old one finished, puts Steam in a &#39;recording&#39; state, but returning no data
- Added additional fixes for VOIP crashes, caused by invalid AudioComponent references
- Fixed an issue where AudioComponents would not receive calls to OnAudioFinished upon level change
- Fixed VOIP recording breaking, due to Steam bug
- Added config value &#39;VOIPVolumeMultiplier&#39; under &#91;OnlineSubsystemSteamworks.OnlineSubsystemSteamworks], for tweaking base VOIP playback volume
- Boosted Steamworks VOIP volume
- Fixed an issue where VOIP playback would skip over silence
- Fixed multiple issues with VOIP playback timing
- Fixed rare VOIP playback crash on seamless travel
- Fixed another rare VOIP crash during travel

XAudio2:
-------
- Fixed issues with some audio finish notifications
- Adjusted max volume clamping (necessary for Steam VOIP)

AccessControl:
-------------
- Fixed game/admin password checks being case-insensitive</pre>
<p />
<h3><a name="January 10th 2012"></a> January 10th 2012 </h3>
<p />
<strong>Changelist number</strong>: 1124321
<p />
<strong>Build notes</strong>:
<pre>Script compiler changes required for Steam:
---------------
- Fixed an issue with delegates in interfaces, where delegate properties were still being created for the delegates
- Added a compiler error, when trying to call delegates through interface references; this is not supported, and could trigger crashes</pre>
<p />
<h3><a name="January 18th 2012"></a> January 18th 2012 </h3>
<p />
<strong>Changelist number</strong>: 1132393
<p />
<strong>Build notes</strong>:
<pre>OnlineSubsystemSteamworks:
-------------------------
- Cleaned up and refactored significant portions of the new auth system
- Adjusted default VOIP volume to a better level
- Fixed an issue with the IP-to-SteamId redirect code, where if multiple players connected too early, not all of them would be redirected</pre>
</div>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
