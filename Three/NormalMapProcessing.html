<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | NormalMapProcessing    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">NormalMapProcessing  </b></div>
<div id="tooltext">
<a href="NormalMapProcessingJP.html" class="twikiLink">日本語訳</a><br><a href="NormalMapProcessingCH.html" class="twikiLink">中国翻译</a><br><a href="NormalMapProcessingKR.html" class="twikiLink">한국어</a><br>

<!-- Three/NormalMapProcessing -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="StaticMeshHome.html" class="twikiLink">Static Meshes</a></b> &gt; Normal Map Processing <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="EnvironmentArtistHome.html" class="twikiLink">Environment Artist</a></b> &gt; Normal Map Processing
</div>
<hr size="1" noshade="noshade">
<h1><a name="Normal Map Processing"></a> Normal Map Processing </h1>
<hr size="1" noshade="noshade">
<em>Document Changelog: Created by <a href="https://udn.epicgames.com/Main/JoshuaMarlow" class="restricted" class="restricted" class="twikiLink">Josh Marlow</a>; maintained by <a href="https://udn.epicgames.com/Main/PaulOliver" class="restricted" class="restricted" class="twikiLink">Paul Oliver</a>.</em>
<div class="twikiToc"> <ul>
<li> <a href="NormalMapProcessing.html#Normal Map Processing"> Normal Map Processing</a> <ul>
<li> <a href="NormalMapProcessing.html#On Processing Normal Maps"> On Processing Normal Maps</a>
</li> <li> <a href="NormalMapProcessing.html#Chamfered Smoothing groups"> Chamfered Smoothing groups</a>
</li> <li> <a href="NormalMapProcessing.html#Single Smoothing group"> Single Smoothing group</a>
</li> <li> <a href="NormalMapProcessing.html#Multiple Smoothing groups"> Multiple Smoothing groups</a>
</li> <li> <a href="NormalMapProcessing.html#Processing Examples"> Processing Examples</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="On Processing Normal Maps"></a> On Processing Normal Maps </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The problem with processing is that there are a number of ways to do it. Knowing this, it is sometimes difficult to know which method will create the best result for the design you are working on. It's useful to get in the habit of experimenting and failing a few times so you understand the pros and cons of each method.
<p />
I've attempted below to define the most common methods and what sort of designs they work best with.
<p />
<h2><a name="Chamfered Smoothing groups"></a> Chamfered Smoothing groups </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
        Sometimes  a single smoothing group is too loose and ranges too strongly from black to white. This is often the case with designs that are a combination of soft and hard designs. The majority of designs in games end up being like this so Chamfering is the most common method of processing.
<p />
        Chamfering controls how much a smoothing group tightens along that edge.  Often this is a straight forward enough workflow, match the forms as best you can while ensuring there's not too much dark to light in the smoothing group as they can indicate that it is not picking up on all the forms clearly.
<p />
<p /> <ul>
<li> <strong>PROS</strong> - Rich normal maps, few  no sharp edges in low-poly
</li> <li> <strong>CONS</strong> - Vert count, lack of reusability
</li></ul>
<p />
<h2><a name="Single Smoothing group"></a> Single Smoothing group </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
        Sometimes  a single smoothing group is used simply for the whole mesh, generally this applies well to rock models as they are designed to be viewed from all angles.  Rock models tend not to have variants created from them unless they have smaller outcropping or stalagmite type elements that are separate from the whole.
        This makes them more suited to a single smoothing group because the normal map only has to function in one situation. Rock variety in-game, generally comes from the inventive ways in which each mesh is rotated, scaled and merged with the other rocks
        So with designs such as this, having a surplus of extra left-to right and up to down normal map color is an advantage, it helps the rock normal map 'pop' more deeply from any angle
<p /> <ul>
<li> <strong>PROS</strong> - Cheap and full of pop
</li> <li> <strong>CONS</strong> - Not adaptable to other designs
</li></ul>
<p />
<p />
<h2><a name="Multiple Smoothing groups"></a> Multiple Smoothing groups </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
        A combination of different smoothing groups on one model is useful to increase the flatness of the normal map generated. It is most useful for mechanical designs such as iron girders where the edges of the design are hard rather than soft.
        This method is most suited to modular designs because the flatter your normal map is, the more additional shapes it can support. If a mechanical design is unwrapped to flat strips then those 'trim' sections of the normal map can be unwrapped and applied to a variety of other forms. Many designs are only a combination of strips of varying detail so this can work quite well.
        Thanks to its portability, this method is very useful for optimization cycles at the end of production where it becomes a necessity to strip textures out of a scene. If you have a normal map that is a series of metal strips, you can often support other custom designs almost exactly.
<p />
<p /> <ul>
<li> <strong>PROS</strong> - Very clean and reusable normal maps
</li> <li> <strong>CONS</strong> - Vert count
</li></ul>
<p />
<h2><a name="Processing Examples"></a> Processing Examples </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
        As a test  I took an iron girder mesh and processed it 3 different ways to demonstrate which was most useful to my purpose. There is no right way, its helpful to understand this as soon as we can.
<p />
<img src="rsrc/Three/NormalMapProcessing/GirderHI.jpg" alt="GirderHI.jpg.jpg" width="720" height="191" />
<p />
<p />
        Initially I tried using one smoothing group in the hopes of having a lot of pop in the normal map and to compensate for the fact that the design would be pretty flat and boring. I got the result you see below
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/Normals_SingleSmooth.jpg" alt="Normals_SingleSmooth.jpg.jpg" width="720" height="191" />
<p />
<p />
        Even on the normal map view only it was clear there were problems, you can see that the bolts on the side, in the middle are projected flat, but the bolts at the middle side are stretched toward the edge and can be seen at an angle. It's also clear that the normals are bending across the whole object so are not truly representative of the shape of the girder.
<p />
<img src="rsrc/Three/NormalMapProcessing/SingleSmoothINGAME.jpg" alt="SingleSmoothINGAME.jpg.jpg" width="720" height="325" />
<p />
<p />
        In-game you can see that the normals are too pillowed when seen from certain angles and when I tried to create a corner variant through the Symmetry modifier it created noticeable seams at the mirroring point that betrays how processed it and make it seam fake.
	Next I tried using Multiple Smoothing Groups to control the process and make it cleaner.
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/NormalsMultiSmooth.jpg" alt="NormalsMultiSmooth.jpg.jpg" width="720" height="191" />
<p />
<p />
        This almost works but the side sections still bend vertically a little on the bolts and the bolts at the edges still stretch a bit horizontally next to the end cap which also has the skewed bolt problem. This method should actually work but its a weakness of 3DS Max's cage method, it handles breaks in smoothing groups or end caps to a rectangle shaped model poorly as the cage doesnt project flat, it bends slightly.
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/MultiSmoothINGAME.jpg" alt="MultiSmoothINGAME.jpg.jpg" width="720" height="325" />
<p />
<p />
        Ingame its clear that the end cap processed in correctly because of the Cage bending, it didn't project flat so it missed some of the information resulting in the bevels on the cap not meeting neatly with the bevels on the side. You can also see there are slight seams on some angles on the corner variant I made.
        We are almost there though, it's just fine tuning thats required at this point and we can fix these last 2 issues with the Detached smoothing group trick.
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/NormalsDetachedSmooth.jpg" alt="NormalsDetachedSmooth.jpg.jpg" width="720" height="191" />
<p />
<p />
        So with using the Detached Smoothing group method, you can see how it allows the cage to interpret the smoothing groups correctly, the flat plane on the top projects straight up, the sides project straight outwards. I am also fixing the issues I was having with the bolts at the edges distorting by extending the lowpoly mesh past the ends of the hipoly design. This works because the smoothing groups are then relative to how they would be if I were tiling the design multiple times rather than relative to one section. We are tricking the cage into ignoring the ends of the smoothing group so it imitates how a tiling BSP texture works.
		The areas of the  low-poly I extend to the side have no hi-poly information to grab so I just move those UV's off to the side of the area that has information to process. This is a fiddly thing that doesn't make a lot of sense at first but what we are trying to do is process relative to how the object will be used in-game instead of processing relative simply to the UV's and one hi-poly configuration.
		Often this is the key factor in choosing what method of processing to use, it's based more on how we know the asset will be used ingame. We are planning in this case on stacking a number of these girders side by side at the capped ends and merging them into longer versions that I processed.
<p />
<p />
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/DetachSmoothINGAME.jpg" alt="DetachSmoothINGAME.jpg.jpg" width="720" height="325" />
<p />
<p />
        We can see now that ingame this mesh looks perfect, all the bolts are projected flat, theres zero distortion and it support the corner variant without seams alo because the normals are so flat and relative to the smoothing groups.
		This is what allows our texture to support multiple modular variants in-game, below you can see how many extra pieces I was able to make with these pieces, the girder was part of a railing set in the Bridge set in Gears3.
<p />
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/LotsofGirders.jpg" alt="LotsofGirders.jpg.jpg" width="720" height="419" />
<p />
<p />
        Due to the normal maps being so flat they were able to support other unplanned designs because they were easy to unwrap to more mechanical shapes.
<p />
<p />
<p />
<img src="rsrc/Three/NormalMapProcessing/LotsofGirders2.jpg" alt="LotsofGirders2.jpg.jpg" width="720" height="419" />
<p />
<p />
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
