<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | DevelopmentKitGemsRenderingOccludedActors    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">DevelopmentKitGemsRenderingOccludedActors  </b></div>
<div id="tooltext">
<a href="DevelopmentKitGemsRenderingOccludedActorsJP.html" class="twikiLink">日本語訳</a><br><a href="DevelopmentKitGemsRenderingOccludedActorsCH.html" class="twikiLink">中国翻译</a><br><a href="DevelopmentKitGemsRenderingOccludedActorsKR.html" class="twikiLink">한국어</a><br>

<!-- Three/DevelopmentKitGemsRenderingOccludedActors -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="DevelopmentKitGems.html" class="twikiLink">Unreal Development Kit Gems</a></b> &gt; Rendering Occluded Actors <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="MaterialsAndTexturesHome.html" class="twikiLink">Materials &amp; Textures</a></b> &gt; Rendering Occluded Actors
</div>
<hr size="1" noshade="noshade">
<h1><a name="Rendering Occluded Actors"></a> Rendering Occluded Actors </h1>
<hr size="1" noshade="noshade">
<p />
<strong><em>Last tested against UDK Mar, 2011</em></strong>
<br>
<strong><em>PC compatible</em></strong>
<p />
<div class="twikiToc"> <ul>
<li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Rendering Occluded Actors"> Rendering Occluded Actors</a> <ul>
<li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Overview"> Overview</a>
</li> <li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Material"> Material</a> <ul>
<li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Material properties"> Material properties</a>
</li> <li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Example"> Example</a> <ul>
<li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Related topics"> Related topics</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Limitations"> Limitations</a>
</li> <li> <a href="DevelopmentKitGemsRenderingOccludedActors.html#Downloads"> Downloads</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
In third person games, sometimes it can visually appealing to block the player's view with something interesting. However, this can lead to problems when the player actually needs to be able to view through the blocking pixels. This gem demonstrates a simple, performance friendly method to render occluded actors.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRenderingOccludedActors/OccludedPawnScreenshot.jpg" alt="OccludedPawnScreenshot.jpg" width='700' height='523' />
<p />
<h2><a name="Material"></a> Material </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This method uses depth checking to alter the opacity of the foreground rendered mesh. To clarify here is the list of steps that the rendering pipeline does.
<p /> <ol>
<li> Render the actor's mesh as per normal
</li> <li> Render an occluded version of the actor's mesh on top; for each pixel <ol>
<li> Check the new pixel depth against the existing pixel depth
</li> <li> If the difference in depth is above a value, then continue to render the occluded pixel
</li> <li> Otherwise do not render the pixel
</li></ol>
</li></ol>
<p />
<a href="rsrc/Three/DevelopmentKitGemsRenderingOccludedActors/OccludedPawnMaterialNodeSetup.jpg" target="_top"><img src="rsrc/Three/DevelopmentKitGemsRenderingOccludedActors/OccludedPawnMaterialNodeSetup.jpg" alt="OccludedPawnMaterialNodeSetup.jpg" width='800' height='350' /></a>
<p />
<h3><a name="Material properties"></a> Material properties </h3>
In order to have access to the Scene Depth node in the material, the material must be Translucent. Set the material to Unlit to help with performance.
<p />
<img src="rsrc/Three/DevelopmentKitGemsRenderingOccludedActors/OccludedPawnMaterialProperties.jpg" alt="OccludedPawnMaterialProperties.jpg" width='488' height='291' />
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="MaterialsTutorial.html" class="twikiLink">Materials Tutorial</a>
</li> <li> <a href="MaterialsCompendium.html" class="twikiLink">Materials Compendium</a>
</li> <li> <a href="MaterialBasics.html" class="twikiLink">Material Basics</a>
</li> <li> <a href="PostProcessMaterials.html" class="twikiLink">Post Process Materials</a>
</li> <li> <a href="MaterialInstanceConstant.html" class="twikiLink">Material Instance Constant</a>
</li> <li> <a href="MaterialExamples.html" class="twikiLink">Material Examples</a>
</li></ul>
<p />
<h2><a name="Example"></a> Example </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
This is an example of how to add the occlusion effect to a pawn. This can of course be used for other actors such as Static mesh actors. The only condition is that the occluded mesh must match the normally visible mesh in terms of location, rotation and scale.
<p />
<div class="codetitlebar">
OccludedPawn.uc
</div>
<div class="codesnippet">
<pre>
class OccludedPawn extends UTPawn;

var(Pawn) const SkeletalMeshComponent OccludedMesh;

simulated function SetMeshVisibility(bool bVisible)
{
  Super.SetMeshVisibility(bVisible);

  if (OccludedMesh !&#61; None)
  {
    OccludedMesh.SetOwnerNoSee(!bVisible);
  }
}

simulated function SetCharacterMeshInfo(SkeletalMesh SkelMesh, MaterialInterface HeadMaterial, MaterialInterface BodyMaterial)
{
  Super.SetCharacterMeshInfo(SkelMesh, HeadMaterial, BodyMaterial);

  if (OccludedMesh !&#61; None)
  {
    OccludedMesh.SetSkeletalMesh(SkelMesh);
  }
}

defaultproperties
{
  Begin Object Class&#61;SkeletalMeshComponent Name&#61;OPawnSkeletalMeshComponent
    Materials(0)&#61;Material&#39;OccludedPawnContent.OccludedMaterial&#39;
    Materials(1)&#61;Material&#39;OccludedPawnContent.OccludedMaterial&#39;
    DepthPriorityGroup&#61;SDPG&#95;Foreground // Render the occluded skeletal mesh in the foreground layer
    ShadowParent&#61;WPawnSkeletalMeshComponent
    ParentAnimComponent&#61;WPawnSkeletalMeshComponent
    bCacheAnimSequenceNodes&#61;false
    AlwaysLoadOnClient&#61;true
    AlwaysLoadOnServer&#61;true
    bOwnerNoSee&#61;true
    CastShadow&#61;false // Casting shadows is not required
    BlockRigidBody&#61;true
    bUpdateSkelWhenNotRendered&#61;false
    bIgnoreControllersWhenNotRendered&#61;true
    bUpdateKinematicBonesFromAnimation&#61;true
    bCastDynamicShadow&#61;false // Casting shadows is not required
    RBChannel&#61;RBCC&#95;Untitled3
    RBCollideWithChannels&#61;(Untitled3&#61;true)
    LightEnvironment&#61;MyLightEnvironment
    bOverrideAttachmentOwnerVisibility&#61;true
    bAcceptsDynamicDecals&#61;false
    bHasPhysicsAssetInstance&#61;true
    TickGroup&#61;TG&#95;PreAsyncWork
    MinDistFactorForKinematicUpdate&#61;0.2f
    bChartDistanceFactor&#61;true
    RBDominanceGroup&#61;20
    MotionBlurScale&#61;0.f
    bUseOnePassLightingOnTranslucency&#61;true
    bPerBoneMotionBlur&#61;true
  End Object
  OccludedMesh&#61;OPawnSkeletalMeshComponent
  Components.Add(OPawnSkeletalMeshComponent)

  CamOffset&#61;(X&#61;16.0,Y&#61;64.0,Z&#61;-52.0)
}
</pre>
</div>
<p />
This game info subclass is only required to spawn in the OccludedPawn class that was created above.
<div class="codetitlebar">
OccludedGameInfo.uc
</div>
<div class="codesnippet">
<pre>
class OccludedGameInfo extends UTDeathmatch;

defaultproperties
{
  DefaultPawnClass&#61;class&#39;OccludedPawn&#39;
}
</pre>
</div>
<p />
<h3><a name="Related topics"></a> Related topics </h3> <ul>
<li> <a href="DevelopmentKitFirstScriptProject.html" class="twikiLink">First Script Project</a>
</li> <li> <a href="GettingStartedGameplay.html" class="twikiLink">Getting Started Gameplay</a>
</li></ul>
<p />
<h2><a name="Limitations"></a> Limitations </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
A limitation of this method is the way it checks for occlusion. By simply comparing the depth differences and not checking what rendered the pixel, this method can often perform a lot of occlusions incorrectly.
<p />
The best way to over come this limitation is to alter the level geometry to ensure that there is a large depth difference potential.
<p />
<h2><a name="Downloads"></a> Downloads </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div> <ul>
<li> <a href="rsrc/Three/DevelopmentKitGemsRenderingOccludedActors/OccludedPawn.zip" target="_top">Download</a> the source and content used in this gem. (OccludedPawn.zip)
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
