<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | Foliage    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">Foliage  </b></div>
<div id="tooltext">
<a href="FoliageJP.html" class="twikiLink">日本語訳</a><br><a href="FoliageCH.html" class="twikiLink">中国翻译</a><br><a href="FoliageKR.html" class="twikiLink">한국어</a><br>

<!-- Three/Foliage -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; Foliage
</div>
<hr size="1" noshade="noshade">
<h1><a name="Foliage"></a> Foliage </h1>
<hr size="1" noshade="noshade">
<p />
<div class="header_img">
<img src="rsrc/Three/Foliage/Foliage_Scene.jpg" alt="Foliage_Scene.jpg" />
</div>
<p />
This document describes the new Instanced Foliage System and Edit Mode, which was first made available in the June 2011 QA Build and is currently under development.
<p />
<div class="twikiToc"> <ul>
<li> <a href="Foliage.html#Foliage"> Foliage</a> <ul>
<li> <a href="Foliage.html#Overview"> Overview</a>
</li> <li> <a href="Foliage.html#Foliage Edit Mode"> Foliage Edit Mode</a>
</li> <li> <a href="Foliage.html#Mesh List"> Mesh List</a>
</li> <li> <a href="Foliage.html#Foliage Tools"> Foliage Tools</a> <ul>
<li> <a href="Foliage.html#Paint Tool"> Paint Tool</a> <ul>
<li> <a href="Foliage.html#Selected Meshes in the Mesh List"> Selected Meshes in the Mesh List</a>
</li> <li> <a href="Foliage.html#Brush Settings"> Brush Settings</a>
</li> <li> <a href="Foliage.html#Paint Settings"> Paint Settings</a>
</li></ul>
</li> <li> <a href="Foliage.html#Reapply Tool"> Reapply Tool</a>
</li> <li> <a href="Foliage.html#Selection Tool"> Selection Tool</a>
</li> <li> <a href="Foliage.html#Paint Selection Tool"> Paint Selection Tool</a>
</li></ul>
</li> <li> <a href="Foliage.html#Instance Settings Mode"> Instance Settings Mode</a>
</li> <li> <a href="Foliage.html#Culling"> Culling</a>
</li> <li> <a href="Foliage.html#Materials and Vertex Animation"> Materials and Vertex Animation</a>
</li> <li> <a href="Foliage.html#Static Mesh Settings"> Static Mesh Settings</a> <ul>
<li> <a href="Foliage.html#LOD"> LOD</a>
</li> <li> <a href="Foliage.html#Lighting"> Lighting</a>
</li> <li> <a href="Foliage.html#Settings for Instancing on Consoles"> Settings for Instancing on Consoles</a>
</li></ul>
</li></ul>
</li></ul>
</div>
<p />
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
In the past, Unreal Engine 3 has had several legacy foliage systems including foliage volumes and terrain decorations, but they were quite inflexible, did not perform particularly well and did not interact well with Unreal Lightmass.
<p />
The new Foliage system allows you to quickly paint or and erase sets of meshes on Landscape, StaticMeshes and legacy terrain. These meshes are automatically grouped together into batches that are rendered using hardware instancing, meaning many instances can be rendered with only a single draw call.
<p />
<h2><a name="Foliage Edit Mode"></a> Foliage Edit Mode </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Foliage Edit Mode is activated by pressing the foliage button in the Modes toolbar in the top-left corner of UnrealEd.
<p />
<img src="rsrc/Three/Foliage/FoliageMode.png" alt="FoliageMode.png" width="78" height="172" />
<p />
Activating the mode will show the Foliage edit mode window.
<p />
<img src="rsrc/Three/Foliage/FoliageWindowInitial.png" alt="FoliageWindowInitial.png" width="283" height="241" />
<p />
<h2><a name="Mesh List"></a> Mesh List </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Initially there will be no foliage meshes listed. Before you can paint foliage, you need to drag a Static Mesh from the content browser into the Foliage edit mode window Mesh List area.
<p />
<img src="rsrc/Three/Foliage/FoliageWindowDrag.png" alt="FoliageWindowDrag.png" width="1003" height="354" />
<p />
After dragging, the mesh icon will appear and a number of parameters are shown. You can drag multiple Static Meshes into the Mesh List.
<p />
<img src="rsrc/Three/Foliage/FoliageWindowAfterDrag.png" alt="FoliageWindowAfterDrag.png" width="284" height="571" />
<p />
Each mesh in the mesh list has three modes, accessible by the button to the left of the mesh name. <img src="rsrc/Three/Foliage/MeshListMode.png" alt="(mesh list mode)" width="52" height="20" /> The first mode is a collapsed view which shows only the mesh name and icon. The second mode is the Paint Settings mode and has parameters that control the way instances will be placed in the level. The third mode is the Instance Settings mode which controls the behavior of instances already placed in the level. These are described in detail in detail in following sections of this document.
<p />
When in either the Paint Settings or Instance Settings mode, three buttons also appear above the mesh icon.
<p />
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/Foliage_ReplaceMesh.png" alt="&lt;-" width="12" height="12" /> </td><td bgcolor="#eaeaea"> This button replaces all instances of the mesh already placed in the current level with the Static Mesh that is currently selected in the content browser. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/Foliage_DeleteMesh.png" alt="X" width="12" height="12" /> </td><td bgcolor="#ffffff"> This button removes the mesh from the mesh list as well as <strong>all instances of this mesh already placed in the current level</strong>. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/Foliage_SyncCB.png" alt="magnifying glass" width="12" height="12" /> </td><td bgcolor="#eaeaea"> This button locates the Static Mesh in the Content Browser. </td></tr>
</table>
<p />
<h2><a name="Foliage Tools"></a> Foliage Tools </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
There are four tools available by selecting the appropriate button at the top of the foliage window.
<p />
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/ToolPaint.png" alt="Paint Tool" width="61" height="61" /> </td><td bgcolor="#eaeaea"> Paint tool, used for adding and removing foliage instances from the world. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/ToolReapply.png" alt="Reapply Tool" width="61" height="61" /> </td><td bgcolor="#ffffff"> Reapply tool, used to change the parameters of instances already painted in the world. First available in the October 2011 build. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/ToolSelect.png" alt="Select Tool" width="61" height="61" /> </td><td bgcolor="#eaeaea"> Selection tool, used to select individual instances, for moving, deleting etc. First available in the September 2011 build. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <img src="rsrc/Three/Foliage/ToolPaintSelect.png" alt="Paint Select Tool" width="61" height="61" /> </td><td bgcolor="#ffffff"> Paint Select tool, used to select many instances using the paint brush. First available in the September 2011 build. </td></tr>
</table>
<p />
<h3><a name="Paint Tool"></a> Paint Tool </h3>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<img src="rsrc/Three/Foliage/ToolPaint.png" alt="Paint Tool" width="61" height="61" />
<p />
When Foliage Mode is active, a transparent sphere brush is drawn in the level indicating where the foliage brush will operate. Pressing Ctrl and pressing the mouse button will add foliage in the brush area, and pressing Ctrl+Shift will erase foliage.
<p />
When painting meshes, the engine performs a number of line traces inside the sphere parallel to your viewing direction, meaning any surface you can see inside the sphere will be a potential target for foliage instances.
<p />
When erasing, candidate instances to erase are randomly chosen from all those inside the sphere.
<p />
<h4><a name="Selected Meshes in the Mesh List"></a> Selected Meshes in the Mesh List </h4>
<p />
Meshes can be selected and deselected by clicking on them in the Mesh List (orange is selected). When painting in the editor viewport, only the selected meshes will be affected. Foliage instances of other static meshes already in the level will not be affected in any way, and no instances of the deselected Mesh List items will be added to the level.
<p />
Below is an example of two meshes selected. The SBananaPlant_01 mesh will not be painted or erased from the level as it is not selected.
<p />
<img src="rsrc/Three/Foliage/FoliageWindowTwoSelected.png" alt="FoliageWindowTwoSelected.png" width="284" height="434" />
<p />
<h4><a name="Brush Settings"></a> Brush Settings </h4>
<p /> <ul>
<li> <strong>Brush Size</strong> is the size of the brush in Unreal units.
</li> <li> <strong>Paint Density</strong> is the target density at which you will add instances when using Ctrl. <ul>
<li> This is a value from 0 to 1 where 1 paints mesh instances at the maximum density listed in the Mesh Properties for each mesh (see below).
</li> <li> If the density of meshes in the brush is already greater than this, no meshes will be added.
</li></ul>
</li> <li> <strong>Erase Density</strong> is the target density you would like to achieve when you erase instances using Ctrl+Shift. <ul>
<li> This is a value from 0 to 1 where 0 represents no meshes. If there are fewer meshes than this desired erase density, no more meshes will be erased.
</li> <li> This allows you to thin out meshes already painted without completely removing all instances.
</li></ul>
</li> <li> <strong>Filter</strong> allows you to control what kinds of objects you want to place instances on.  <ul>
<li> Note the foliage sphere brush will disappear when it is not over an object that matches the filter type.
</li> <li> Also note that you can only paint on objects that are in the active streaming level.
</li></ul>
</li></ul>
<p />
Tablet pressure sensitivity is also supported. The pen pressure will modulate the number of foliage mesh instances added or removed, after all other parameters are considered.
<p />
<h4><a name="Paint Settings"></a> Paint Settings </h4>
<p />
Each mesh in the Mesh List has a number of properties that control how instances are placed for this mesh when painting. The properties are accessible by pressing the middle paint brush icon.
<p />
<img src="rsrc/Three/Foliage/PaintSettingsMode.png" alt="Paint Settings Mode" width="284" height="270" />
<p />
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><th bgcolor="#dadada" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=3;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Property</font></a> </th><th bgcolor="#dadada"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=3;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Description</font></a> </th></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Density / 1Kuu&sup2; </td><td bgcolor="#ffffff"> The number of instances that will be placed for this mesh, for each 1000x1000 unreal unit area </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Radius </td><td bgcolor="#eaeaea"> Minimum distance between instances of this mesh. (This setting did not function correctly before the October 2011 build) </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Align to Normal </td><td bgcolor="#ffffff"> Whether or not the foliage mesh should be oriented vertically or follow the direction of the surface it's placed upon </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Max Angle </td><td bgcolor="#eaeaea"> If non-zero, this specifies the maximum angle to follow when aligning to the normal. For example, if ground is 30&deg; slope, and you set the Max Angle to 10&deg;, the foliage will try to follow the direction of the ground but it placed at 10&deg; to the vertical.  If you place an instance on 5&deg; surface, the angle is less than 10&deg; so the foliage will be oriented to match the 5&deg; slope. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Uniform Scale </td><td bgcolor="#ffffff"> Whether or not you wish to scale instances' X,Y and Z scales independently. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Scale Min/Max </td><td bgcolor="#eaeaea"> Instances will be randomly scaled between the minimum and maximum scale range. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Random Pitch &plusmn; </td><td bgcolor="#ffffff"> Adds variation up to &plusmn; the angle you specify, so the instances aren't all pointing exactly the same direction. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Ground Slope </td><td bgcolor="#eaeaea"> If non-zero, if the surface you are painting on is steeper than this angle, no foliage instances will be placed. A negative value will place foliage instances only on surfaces steeper than the angle specified. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Height Min/Max </td><td bgcolor="#ffffff"> If specified, if the World space Z (height) value is outside this range, no instances will be applied. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Landscape Layer </td><td bgcolor="#eaeaea"> if entered, foliage instances will be painted proportional in density to the Landscape layer specified, after all the other parameters have been applied. </td></tr>
</table>
<p />
<p />
<h3><a name="Reapply Tool"></a> Reapply Tool </h3>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<img src="rsrc/Three/Foliage/ToolReapply.png" alt="Reapply Tool" width="61" height="61" />
<p />
The reapply tool allows you to selectively change parameters for instances already placed in the world.
<p />
<img src="rsrc/Three/Foliage/ReapplySettings.png" alt="Reapply Settings" width="435" height="441" />
<p />
The settings available are very similar to those of the Paint tool, but there is an extra checkbox to the left, to choose which parameters to reapply:
<p />
<img src="rsrc/Three/Foliage/ReapplyCheckboxes.png" alt="Reapply Checkboxes" width="283" height="259" />
<p />
If a checkbox is set, the corresponding parameter will be reapplied when painting the brush over existing instances. Most settings are the same as when using the Paint Tool, however there are a few differences:
<p />
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Density Adjust </td><td bgcolor="#eaeaea"> This is a density multiplier for existing instances. If you set the slider to 2.0, the number of instances in a particular area will be doubled. A value of 0.5 will leave only 50% of the instances remaining after painting. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Ground Slope </td><td bgcolor="#ffffff"> This will remove instances that do not meet the ground slope criteria. No new instances will be added. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Height Min/Max </td><td bgcolor="#eaeaea"> This will remove instances that do not meet the height range criteria. No new instances will be added. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Landscape Layer </td><td bgcolor="#ffffff"> This will remove instances in proportion to the specified layer density. No new instances will be added. </td></tr>
</table>
<p />
<h3><a name="Selection Tool"></a> Selection Tool </h3>
<img src="rsrc/Three/Foliage/ToolSelect.png" alt="Select Tool" width="61" height="61" />
<p />
When the selection tool is active, individual instances can be selected by clicking on them. Control-Click will multi-select. Once instances are selected, a number of actions are available:
<p />
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><th bgcolor="#dadada" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=5;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Action</font></a> </th><th bgcolor="#dadada"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=5;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Result</font></a> </th></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Drag a widget axis </td><td bgcolor="#ffffff"> The selected instances will move following the widget, be rotated or scaled depending on the widget mode. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Alt + Drag a widget axis </td><td bgcolor="#eaeaea"> The selected instances will be first duplicated and then will move following the widget </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Delete key </td><td bgcolor="#ffffff"> The selected instances will be deleted </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> End key </td><td bgcolor="#eaeaea"> The selected instances will attempt to snap to the floor. They will be aligned to the normal if originally placed with this setting enabled. </td></tr>
</table>
<p />
<img src="rsrc/Three/Foliage/Selection.png" alt="Selection Tool" width="345" height="359" />
<p />
<h3><a name="Paint Selection Tool"></a> Paint Selection Tool </h3>
<img src="rsrc/Three/Foliage/ToolPaintSelect.png" alt="Paint Select Tool" width="61" height="61" />
<p />
The Paint Selection tool allows you to select a number of instances simultaneously by using the sphere brush that is also used with the Paint tool. The mesh list selection and filter settings apply, just as they do for regular mesh painting. Holding down Shift while painting deselects instances. Once you have a selection, you can switch to the regular Selection tool and perform some of the the actions listed above.
<p />
<img src="rsrc/Three/Foliage/PaintSelection.png" alt="Paint Select Tool" width="327" height="361" />
<p />
<h2><a name="Instance Settings Mode"></a> Instance Settings Mode </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Note: this mode was added in the JULY 2011 QA Build.
<p />
<img src="rsrc/Three/Foliage/PlacedInstancesMode.png" alt="Instance Settings Mode" width="285" height="172" />
<p />
<table cellspacing="1" cellpadding="1" class="twikiTable" border="0"><tr><th bgcolor="#dadada" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=6;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Property</font></a> </th><th bgcolor="#dadada"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=6;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#000000">Description</font></a> </th></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Instance Count </td><td bgcolor="#ffffff"> This shows the number of instances of this mesh currently placed in the current streaming level </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Cluster Count </td><td bgcolor="#eaeaea"> This shows the number of clusters used to render instances of this mesh in the current streaming level. Groups of instances are rendered together in a single draw call, called a cluster, to improve rendering efficiency. The cluster allocation is determined automatically based on the number of instances already in the cluster and the radius of the cluster in world space. The following two parameters can adjust this. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Instances Per Cluster </td><td bgcolor="#ffffff"> This sets the maximum number of instances per cluster. Remember that all the instances in a single cluster are always rendered in a single draw call with the total number of triangles equal to the polygons per mesh multiplied by the instances per cluster. The ideal number depends on the polygon count of the mesh. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Cluster Radius </td><td bgcolor="#eaeaea"> This is the maximum size a cluster can grow before instances are allocated to a new cluster. Reducing this number increases the number of clusters but improves occlusion as the cluster has a smaller bounding box. </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> Cull Distance Start </td><td bgcolor="#ffffff"> This is the distance in world units at which the instances will begin to fade out. Note that this needs to be set up in the material. See the Culling section below. </td></tr>
<tr><td bgcolor="#eaeaea" class="twikiFirstCol"> Cull Distance End </td><td bgcolor="#eaeaea"> This is the distance in world units at which the instances will be completely culled. If the material is not set up to fade individual instances, entire clusters will disappear and reappear together. See the Culling section below. </td></tr>
</table>
<p />
<h2><a name="Culling"></a> Culling </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Note: This feature was added in the AUGUST 2011 QA Build.
<p />
Because foliage instances are rendered as clusters in a single draw call, each cluster is either rendered or not rendered based on occlusion. If you set a value in the <strong>Cull Distance End</strong> parameter, the clusters will also be culled beyond that distance. However this will cause groups of meshes to disappear abruptly as the entire cluster goes out of range.
<p />
This can be reduced by adding a <strong>Cull Distance Start</strong> parameter and then setting up the material appropriately. In the vertex shader, a per-instance fading factor is calculated, which goes from 1.0 at the start distance to 0.0 at the end distance. This is passed to the material in the alpha channel of the the Vertex Color material node. If you connect that to an opacity or masking value, you can use it to fade instances over a distance before they reach the Cull Distance End and are removed from rendering.
<p />
The example material below multiplies the material mask by the fading factor to thin out the foliage mesh's leaves until they completely disappear.
<p />
<img src="rsrc/Three/Foliage/CullingMaterial.png" alt="Culling Material Example" width="752" height="378" />
<p />
<h2><a name="Materials and Vertex Animation"></a> Materials and Vertex Animation </h2>
<p />
Vertex animation for simulating effects such as wind can be achieved with an appropriate material such as the method described in the <a href="InteractiveFoliageActor.html" class="twikiLink">InteractiveFoliageActor</a> document, but you need to make a small modification to your material to work correctly for instanced foliage. The <a href="MaterialsCompendium.html#ObjectWorldPosition" class="twikiAnchorLink">Object World Position</a> material node gives you the location of the InstancedFoliageActor in your level rather than the location of the individual instance. Instead of using Object World Position, use a <a href="MaterialsCompendium.html#TransformPosition" class="twikiAnchorLink">Transform Position</a> node transforming the constant 4-vector (0,0,0,1) from Local to World space. This will give the location of the individual instance in world coordinates.
<p />
<h2><a name="Static Mesh Settings"></a> Static Mesh Settings </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
There are a few Static Mesh Editor settings for that need attention for static meshes to be used for foliage. Firstly, the static mesh's
<strong>bUsedForInstancing</strong> flag should be enabled. You should also ensure your static mesh has only one entry in the Elements array (visible under LODInfo).
<p />
<h3><a name="LOD"></a> LOD </h3>
<p />
Static Mesh LOD is supported on foliage, beginning with the October 2011 build. There are a few caveats:
<p /> <ul>
<li> It is recommended you enable Screen Door Fading on your material.
</li> <li> Note that light and shadowmaps are shared between all LOD levels, so all LODs need to use the same unwrapping.
</li> <li> Currently the entire cluster of instances change LODs simultaneously. We may add support for distance-based fading per instance in the future.
</li></ul>
<p />
<h3><a name="Lighting"></a> Lighting </h3>
<p />
Each individual mesh instance has its own shadow and/or light map generated by Lightmass, and these are tiled together for each precomputed batch batch can support precomputed. There are several settings on the StaticMesh that should be checked for precomputed lighting to operate well with instanced foliage. Lightmass is less forgiving when generating shadow maps for instanced meshes, and incorrect settings could lead to black meshes after rebuilding lighting.
<p /> <ul>
<li> Light Map Coordinate Index - must be set to a valid UV channel that has a unique UV unwrapping. The Static Mesh Editor's "Generate Unique UVs" feature can quickly generate a unique unwrapping.
</li> <li> Lightmap Resolution - this must be a small enough number so that all the shadow map for instances in a single cluster (by default 100) can be tiled together without exceeding the maximum texture resolution (4094x4096).
</li></ul>
<p />
There were some bugs in the shadowmap and lightmap allocation for foliage in engine versions before April 2012, which caused some fully-shadowed instances to be lit and some unshadowed instances to be shadowed incorrectly. These bugs have been fixed for the April 2012 version, and also a warning has been added to alert the user if the maximum lightmap resolution is exceeded.
<p />
<!--  -->
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
