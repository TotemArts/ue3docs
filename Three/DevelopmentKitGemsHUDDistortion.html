<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | DevelopmentKitGemsHUDDistortion    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">DevelopmentKitGemsHUDDistortion  </b></div>
<div id="tooltext">
<a href="DevelopmentKitGemsHUDDistortionJP.html" class="twikiLink">日本語訳</a><br><a href="DevelopmentKitGemsHUDDistortionCH.html" class="twikiLink">中国翻译</a><br><a href="DevelopmentKitGemsHUDDistortionKR.html" class="twikiLink">한국어</a><br>

<!-- Three/DevelopmentKitGemsHUDDistortion -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="DevelopmentKitGems.html" class="twikiLink">Unreal Development Kit Gems</a></b> &gt; Adding HUD Distortion <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="PostProcessEffectsHome.html" class="twikiLink">Post Process Effects</a></b> &gt; Adding HUD Distortion <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="MaterialsAndTexturesHome.html" class="twikiLink">Materials &amp; Textures</a></b> &gt; Adding HUD Distortion
</div>
<hr size="1" noshade="noshade">
<p />
<h1><a name="Adding HUD Distortion"></a> Adding HUD Distortion </h1>
<hr size="1" noshade="noshade">
<p />
<strong><em>Last tested against UDK June, 2011</em></strong>
<br>
<strong><em>PC compatible</em></strong>
<p />
<div class="twikiToc"> <ul>
<li> <a href="DevelopmentKitGemsHUDDistortion.html#Adding HUD Distortion"> Adding HUD Distortion</a> <ul>
<li> <a href="DevelopmentKitGemsHUDDistortion.html#Overview"> Overview</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Post Processing"> Post Processing</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Setting up the material"> Setting up the material</a> <ul>
<li> <a href="DevelopmentKitGemsHUDDistortion.html#Textures"> Textures</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Sniper scope texture coordinates"> Sniper scope texture coordinates</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Sniper scope distortion"> Sniper scope distortion</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Sniper scope colorizing"> Sniper scope colorizing</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Completed material"> Completed material</a>
</li></ul>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Creating a simple Post Process Chain"> Creating a simple Post Process Chain</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Modifying the material parameters in Unrealscript"> Modifying the material parameters in Unrealscript</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Downloads"> Downloads</a>
</li> <li> <a href="DevelopmentKitGemsHUDDistortion.html#Related Topics"> Related Topics</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<hr size="1" noshade="noshade">
Adding distortion to the screen is often a really handy effect for providing feedback to the player. It may mean the player has been hit by a certain kind of weapon, is currently under water or viewing through a sniper scope. In this development kit gem the sniper scope will be used as the example.
<p />
<h2><a name="Post Processing"></a> Post Processing </h2>
<hr size="1" noshade="noshade">
Unreal Engine 3 stores its screen output in a render target which allows you to modify it using post processing. As it is stored in a render target, the Material system is used to modify the render target. Please refer to <a href="PostProcessEffectsHome.html" class="twikiLink">Post Process Effects</a>, more specifically <a href="PostProcessMaterials.html" class="twikiLink">Post Process Materials</a>.
<p />
<h2><a name="Setting up the material"></a> Setting up the material </h2>
<hr size="1" noshade="noshade">
<p />
<h3><a name="Textures"></a> Textures </h3>
To start off, some textures are needed. Textures are stored in the UI LOD Group and have the Address X and Address Y set to Clamp.
<p />
A normal map for distortion.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_0.jpg" alt="UDN_SniperScope_0.jpg" width='256' height='256' />
<p />
An alpha map for opacity.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_1.jpg" alt="UDN_SniperScope_1.jpg" width='256' height='256' />
<p />
<h3><a name="Sniper scope texture coordinates"></a> Sniper scope texture coordinates </h3>
For a sniper scope, it isn't desirable to have the texture stretched out over the entire screen. Ideally, you would want the sniper scope to be in the middle of the screen and constrained to a 1:1 aspect ratio. This can be achieved in the material by adjusting the texture coordinates.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_TextureOffsetAndScale_3.jpg" alt="UDN_SniperScope_TextureOffsetAndScale_3.jpg" width='754' height='503' />
<p /> <ul>
<li> Multiplying texture coordinates adjusts the scale of the texture as a percentage. For example, 0.5 is 50% of the texture and 2.0 is 200% of the texture.
</li> <li> Adding to the texture coordinates adjusts the position of the texture as a percentage. This isn't the same as the position of the texture on the screen, but rather where to start looking within the texture when first using the texture. Normally this would just be 0, but adjusting this allows you to pan across the texture to select a different pixel to start drawing at. In our case, since the texture has its Address X and Address Y clamped, it will shift the texture across the screen and produce black parts on the edges which is ideal for a sniper scope.
</li></ul>
<p />
For different screen resolutions, it will be required to set these parameters within Unrealscript.
<p />
<h3><a name="Sniper scope distortion"></a> Sniper scope distortion </h3>
For a sense of 'immersion' producing a small amount of distortion to hint at the curvature of the sniper scope's lens is desirable. The way to do this is to adjust the texture look up coordinates on the Scene Texture Sample. By multiplying the normal map, it is also possible to adjust the strength of the distortion as well.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_Distortion_4.jpg" alt="UDN_SniperScope_Distortion_4.jpg" width='852' height='470' />
<p /> <ul>
<li> Multiplying the normal map with a scalar parameter allows you to adjust the strength of the distortion easily.
</li></ul>
<p />
<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> Because you are adjusting the look up coordinates, be aware that you may also need to adjust the overall texture coordinates as the image may be shifted so that it doesn't represent the players view any more. You may need to offset it.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_AddingSceneOffset_13.jpg" alt="UDN_SniperScope_AddingSceneOffset_13.jpg" width='800' height='418' />
<p />
<h3><a name="Sniper scope colorizing"></a> Sniper scope colorizing </h3>
With the texture offset and the distortion complete, it is time to bring everything together. By linear interpolating between two versions of the Scene Texture Sample, using the opacity map, it is easy to create the sniper scope pattern on the screen.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_Colorizing_5.jpg" alt="UDN_SniperScope_Colorizing_5.jpg" width='780' height='546' />
<p /> <ul>
<li> Change the color of the sniper scope overlay by adjusting ScopeColor's RGB values.
</li> <li> Change the strength of the sniper scope overlay by adjusting ScopeColor's alpha value.
</li></ul>
<p />
<h3><a name="Completed material"></a> Completed material </h3>
<p />
<a href="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_Material_2.jpg"><img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_Material_2_Thumbnail.jpg" alt="UDN_SniperScope_Material_2_Thumbnail.jpg" width='800' height='410' /></a>
<p />
<h2><a name="Creating a simple Post Process Chain"></a> Creating a simple Post Process Chain </h2>
<hr size="1" noshade="noshade">
Post process chains is what Unreal Engine 3 uses to handle post processing effects. Using a node like tree to chain effects one after the other, allows designers to create new post processing effects by combining other post processing effect modules easily. For more information on this system please refer to <a href="PostProcessEditorUserGuide.html" class="twikiLink">Post Process Editor User Guide</a> and <a href="PostProcessEffectReference.html" class="twikiLink">Post Process Effect Reference</a>.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_NewMaterialEffect_7.jpg" alt="UDN_SniperScope_NewMaterialEffect_7.jpg" width='800' height='600' />
<p />
To test this material effect, create a new Post Process Chain by left clicking the New button within the Content Browser.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_TweakMaterialEffect_8.jpg" alt="UDN_SniperScope_TweakMaterialEffect_8.jpg" width='800' height='600' />
<p />
Once the post process chain has been created, double click on its icon with the Content Browser to open the Post Process Editor. Right click within the empty space, and select Material Effect from the context menu that appears. This will create a new Material Effect post process node.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_WorldProperties_9.jpg" alt="UDN_SniperScope_WorldProperties_9.jpg" width='398' height='212' />
<p />
Select on the Material Effect post process node, and set the Material field to the Sniper Scope material created above.
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_SetWorldProperties_10.jpg" alt="UDN_SniperScope_SetWorldProperties_10.jpg" width='671' height='696' />
<p />
<h2><a name="Modifying the material parameters in Unrealscript"></a> Modifying the material parameters in Unrealscript </h2>
<hr size="1" noshade="noshade">
As stated in the material creation section of this development kit gem, there are some variables that you need to adjust. To be able to find and reference the Material Effect node within the post process chain you will need to give the Material Effect node a name. This is done within the Post Process Editor like so:
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_TweakMaterialEffect_12.jpg" alt="UDN_SniperScope_TweakMaterialEffect_12.jpg" width='645' height='618' />
<p />
<div class="codetitlebar">
<strong><em>YourPlayerController.uc</em></strong>
</div>
<div class="codesnippet">
<pre>
var MaterialInstanceConstant SniperPostProcessMaterialInstanceConstant;

function PlayerTick(float DeltaTime)
{
  local MaterialEffect SniperPostProcessEffect;
  local LocalPlayer LocalPlayer;
  local LinearColor LC;

  Super.PlayerTick(DeltaTime);

  if (SniperPostProcessMaterialInstanceConstant &#61;&#61; None)
  {
    Super.PlayerTick(DeltaTime);

    // Get the local player, which stores the post process chain
    LocalPlayer &#61; LocalPlayer(Player);
    if (LocalPlayer !&#61; None &#38;&#38; LocalPlayer.PlayerPostProcess !&#61; None)
    {
      // Get the post process chain material effect
      SniperPostProcessEffect &#61; MaterialEffect(LocalPlayer.PlayerPostProcess.FindPostProcessEffect(&#39;SniperScope&#39;));
      if (SniperPostProcessEffect !&#61; None)
      {
        // Create a new material instance constant
        SniperPostProcessMaterialInstanceConstant &#61; new () class&#39;MaterialInstanceConstant&#39;;
        if (SniperPostProcessMaterialInstanceConstant !&#61; None)
        {
          // Assign the parent of the material instance constant to the one stored in the material effect
          SniperPostProcessMaterialInstanceConstant.SetParent(SniperPostProcessEffect.Material);
          // Set the material effect to use the newly created material instance constant
          SniperPostProcessEffect.Material &#61; SniperPostProcessMaterialInstanceConstant;

          // Adjust the scope color
          LC.R &#61; 1.f;
          LC.G &#61; 0.f;
          LC.B &#61; 0.f;
          LC.A &#61; 1.f;
          SniperPostProcessMaterialInstanceConstant.SetVectorParameterValue(&#39;ScopeColor&#39;, LC);
        }
      }
    }
  }
}
</pre>
</div>
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_RunTimeChange_12.jpg" alt="UDN_SniperScope_RunTimeChange_12.jpg" width='800' height='412' />
<p />
<h2><a name="Downloads"></a> Downloads </h2>
<hr size="1" noshade="noshade">
<p />
<img src="rsrc/Three/DevelopmentKitGemsHUDDistortion/UDN_SniperScope_Finished_11.jpg" alt="UDN_SniperScope_Finished_11.jpg" width='800' height='402' />
<p /> <ul>
<li> <a href="rsrc/Three/DevelopmentKitGemsHUDDistortion/SniperScope.zip" target="_top">Download</a> the content used in this development kit gem.
</li></ul>
<p />
<h2><a name="Related Topics"></a> Related Topics </h2>
<hr size="1" noshade="noshade"> <ul>
<li> <a href="MaterialsAndTexturesHome.html" class="twikiLink">Materials and Textures Home</a>
</li> <li> <a href="MaterialEditorUserGuide.html" class="twikiLink">Material Editor User Guide</a>
</li> <li> <a href="MaterialsCompendium.html" class="twikiLink">Materials Compendium</a>
</li> <li> <a href="PostProcessEffectsHome.html" class="twikiLink">Post Process Effects Home</a>
</li> <li> <a href="PostProcessMaterials.html" class="twikiLink">Post Process Materials</a>
</li> <li> <a href="PostProcessEditorUserGuide.html" class="twikiLink">Post Process Editor User Guide</a>
</li> <li> <a href="PostProcessEffectReference.html" class="twikiLink">Post Process Effect Reference</a>
</li></ul>
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
