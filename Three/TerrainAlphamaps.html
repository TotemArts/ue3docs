<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | TerrainAlphamaps    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">TerrainAlphamaps  </b></div>
<div id="tooltext">
<a href="TerrainAlphamapsJP.html" class="twikiLink">日本語訳</a><br><a href="TerrainAlphamapsCH.html" class="twikiLink">中国翻译</a><br><a href="TerrainAlphamapsKR.html" class="twikiLink">한국어</a><br>

<!-- Three/TerrainAlphamaps -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="TerrainHome.html" class="twikiLink">Terrain System</a></b> &gt; Terrain Alphamaps: Using externally-created texture layer alphamaps
</div>
<hr size="1" noshade="noshade">
<h1><a name="Terrain Alphamaps: Using externally-created texture layer alphamaps"></a> Terrain Alphamaps: Using externally-created texture layer alphamaps </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="TerrainAlphamaps.html#Terrain Alphamaps: Using externally-created texture layer alphamaps"> Terrain Alphamaps: Using externally-created texture layer alphamaps</a> <ul>
<li> <a href="TerrainAlphamaps.html#Overview"> Overview</a>
</li> <li> <a href="TerrainAlphamaps.html#Alphamap Overview"> Alphamap Overview</a>
</li> <li> <a href="TerrainAlphamaps.html#Terrain Layer Setup"> Terrain Layer Setup</a>
</li> <li> <a href="TerrainAlphamaps.html#Creating External Alphamaps"> Creating External Alphamaps</a>
</li> <li> <a href="TerrainAlphamaps.html#External Alphamap Format"> External Alphamap Format</a>
</li> <li> <a href="TerrainAlphamaps.html#An Example Terrain with External Alphamap"> An Example Terrain with External Alphamap</a>
</li> <li> <a href="TerrainAlphamaps.html#Creating the Example Terrain with External Alphamap"> Creating the Example Terrain with External Alphamap</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
A Terrain is essentially a 3D planar mesh object that is x*y vertices in size.  The actual number of quad faces that are rendered is x-1 * y-1.  So a 256x256 terrain requires a heightmap that is 257x257 in dimensional size.  The Terrain Properties dialog specifies the terrain size in patches or quad faces (NumPatchesX and NumPatchesY), which is equivalent to the vertex count -1.
<p />
<p />
<h2><a name="Alphamap Overview"></a> Alphamap Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
To support the layering of multiple textures on the terrain, such as dirt, grass and rock, each layer uses an <em>alphamap</em> that determines where the texture is blended onto the terrain.  This alphamap is also sometimes referred to as a <em>weight map</em> since it defines the weight of each texture blended.  This alphamap is essentially a grayscale mask that is similar to an image alphachannel.
<p />
Each terrain layer alphamap is the same dimensional size as the underlying terrain heightmap, or mesh, with one pixel of alphamap being equivalent to one vertex of terrain, so the blending between texture layers is limited to the distance between the terrain mesh vertices.  A 128x128 terrain therefore supports a fixed blend 129x129 pixel alphamap.  The Terrain's DrawScale3D.X/.Y values determine the size of each blend area, so a DrawScale3D.X/.Y of 256 results in a terrain texture layer blend size of 256 Unreal Units.  In other words, a single pixel of the alphamap is DrawScale3D.X/.Y in size on the terrain.
<p />
<img alt="TerrainAlphamap.gif" src="rsrc/Three/TerrainAlphamaps/TerrainAlphamap.gif" />
<p />
Each alphamap pixel value determines the percentage of opacity blending for the texture that will be applied to the equivalent vertex on the terrain.  For this reason, the alphamap must be the same resolution as the heightmap, to provide a 1-to-1 corresponding blend value.
So as the engine renders the terrain triangles, it reads across the layer alphamap rows and columns to obtain the blend value for each texture at each heightmap vertex.
An alphamap value of 0 (black) results in no texture blend at that vertex, a value of 127 (gray) results in a 50% texture blend at that vertex, and a value of 255 (white) results in a 100% texture blend at that vertex.
<p />
<img alt="VertexAlphaBlend.gif" src="rsrc/Three/TerrainAlphamaps/VertexAlphaBlend.gif" />
<p />
The texture blending that occurs between terrain mesh vertices is a linear gradient and not a sharp change.  In other words, the texture layer is smoothly blended over the texture beneath it from vertex to vertex.  As shown in this example image of a single terrain triangle pair (a quad), the top-left terrain vertex has a corresponding full white alphamap value (255), while the other two triangle vertices have corresponding full black alphamap values (0).  The texture layer will then be smoothly blended across the surface of the terrain triangle as a gradient from vertex to vertex.  In this example, the underlying texture is blue and the layered texture is yellow, so a white alphamap value renders 100% yellow and a black alphamap value renders 100% blue.  The surface of the triangle always shows a smooth gradient from the yellow to blue.
<p />
<img alt="TriangleVertexBlend.gif" src="rsrc/Three/TerrainAlphamaps/TriangleVertexBlend.gif" />
<p />
In Unreal Engine 3's terrain system, neither the heightmap or the alphamaps are visible in the Generic Browser<sup>?</sup>.  This differs from previous engine versions.
<p />
<p />
<h2><a name="Terrain Layer Setup"></a> Terrain Layer Setup </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Unreal Engine 3's terrain system supports the basic requirements for the most common styles of terrain texture layering, by using the Height and Slope properties in the TerrainLayerSetup object.  These are called <em>procedural layer setups</em>.
<p />
As shown in this example TerrainLayerSetup, this terrain layering consists of two layers with the lower layer [1] as the solid base layer, and the upper layer [0] constrained to slopes of 0 to 45 degrees (MaxSlope.Enabled = true and MaxSlope.Base = 0.5, where 0.5 = 45 degrees), resembling flatland texturing, where you might normally find grass.
<p />
<img alt="UE3TLSetup.gif" src="rsrc/Three/TerrainAlphamaps/UE3TLSetup.gif" />
<p />
Note that when multiple entries exist in a TerrainLayerSetup, they are layered in an upward direction, with the texture layers rendering from the bottom (highest entry number) to the top (entry number [0]).  In the example TerrainLayerSetup above, entry [0] is rendered on top of entry [1].
<p />
While the procedural TerrainLayerSetup can easily supply your terrain with layering styles for flatlands (by height), cliff faces (by slope), and snow-crested mountain tops (by height), it cannot create the more complex geological texture layering such as mountain ridges or fluvial cuts.  Neither can it produce texture layers for winding rivers or roads, where the height and slope of the geological system may vary across its entirety.  For these types of more complex texture layers, your choices are to either hand-paint the layer in UnrealEd or use an externally created alphamap file.
<p />
<strong>Note that to hand-paint a texture layer, or to import an external alphamap into a layer, the TerrainLayerSetup must be a single layer style, it cannot be a procedural multiple layer style.</strong>
<p />
Mountain ridges (technically Dendritic ridges and Stratigraphic ridges) are the uneroded hard rock that is exposed from weathering.  Fluvial cuts are caused by water flow erosion such as a river flowing down a mountain.  The example terrain alphamap we will be using in this tutorial will show a ridge geological type of texturing.
<p />
<p />
<h2><a name="Creating External Alphamaps"></a> Creating External Alphamaps </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
External alphamaps can be created either with third-party terrain heightmap software or by a good artist using paint software.
<p />
There are numerous third-party terrain heightmap software applications, such as HMES, Leveller, Terragen, World Machine, and others.  Their ability to algorithmically generate different styles of heightmaps or alphamaps varies.  No one specific package is being recommended here, and it may be up to the studio art lead as to what the company may be using to develop terrains in-house.
<p />
For the artists, the most common software application for hand-painting alphamaps is most likely Adobe PhotoShop, followed by other paint software such as Corel PhotoPaint, PaintShopPro, etc.
<p />
If you are hand-painting an alphamap, you would be brushing white onto a black background in the same fashion as creating an alphachannel mask, where white would be the displayed terrain texture layer.  The advantage of using algorithmically generated alphamaps are that they can usually be created along with the actual terrain heightmap, saving considerable time and producing a complex design that may be difficult for an artist to duplicate by hand.
<p />
This tutorial won't cover every method of external alphamap creation, since it varies by the current studio art pipeline, and whether the art department or level designer is creating the heightmap and alphamap by hand or with third-party software. The example terrain heightmap and alphamap created for this tutorial were developed algorithmically through one application.
<p />
<p />
<h2><a name="External Alphamap Format"></a> External Alphamap Format </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The external alphamap file is simply an 8-bit grayscale image, similar to a mask or alphachannel, where black is 100% transparent, white is 100% opaque, and the levels of gray in between are varying degrees of transparency.  The actual file format required by UnrealEd for importing alphamaps is the G16 .bmp format, similar to the external heightmap file format.  It is possible to create the external alphamap using heightmap or paint software as an 8-bit grayscale bitmap, however, before importing the alphamap into UnrealEd it must be converted to a G16 format file.  The 8-bits of data must be simply multiplied to 16-bits (*256 or &lt;&lt;8).  The 16-bit data in the G16 alphamap is automatically converted back down to 8-bits when it is imported into UnrealEd.  If the alphamap is being created in software that supports 16-bit formats such as Raw-16, then that file can be used directly without multiplying the data, it only requires conversion to a G16.
<p />
An external alphamap file must always be the terrain dimensions Terrain.NumPatchesX +1 by Terrain.NumPatchesY +1 in size.  So a 128x128 terrain requires a 129x129 alphamap, a 256x256 terrain requires a 257x257 alphamap.  When attempting to import an alphamap that is not of the proper size, an error will occur.
<p />
If the alphamap is being algorithmically generated by a software application that only supports power-of-two sizes, it will be required to edit the alphamap image and adjust it to the correct resolution by adding additional rows and columns of pixels to the edges.  Alphamaps are top-left justified in UnrealEd for UE3, so it would be common to add one row and one column to the right and bottom sides of an alphamap so that it contains the same number of rows and columns as the terrain mesh.
<p />
Depending on the file format that the alphamap is created with, it must be multiplied to 16-bits and/or converted to G16.  There are a number of third-party tools that support G16 conversion, including G16Ed and HMCS.
<p />
<p />
<h2><a name="An Example Terrain with External Alphamap"></a> An Example Terrain with External Alphamap </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Using a combination of software applications, the following heightmap was created for use as an UnrealEd terrain.  The heightmap was saved as Raw-16 and converted to G16.
<p />
<img alt="HMCSHeightmap.gif" src="rsrc/Three/TerrainAlphamaps/HMCSHeightmap.gif" />
<p />
The custom "ridge" alphamap was algorithmically created along with the heightmap, saved as Raw-16 and converted to a 16-bit grayscale TIF to allow modification in paint software.  This is the original Raw-16 alphamap:
<p />
<img alt="HMCSAlphamap.gif" src="rsrc/Three/TerrainAlphamaps/HMCSAlphamap.gif" />
<p />
The TIF-16 alphamap was modified in paint software to increase the curve level of brightness using a combination of Intensity and Contrast in multiple passes, then it was saved back out as a TIF-16, then converted once again to a G16 for importing into UnrealEd.  UnrealEd for UE3 requires a higher contrast to the alphamap than previous Unreal Engine versions, so the alphamap will usually have to be more intense than those created for Unreal Engine 2 and 2.5.
The final TIF-16 looks like this:
<p />
<img alt="AlphamapFinal.gif" src="rsrc/Three/TerrainAlphamaps/AlphamapFinal.gif" />
<p />
<p />
<h2><a name="Creating the Example Terrain with External Alphamap"></a> Creating the Example Terrain with External Alphamap </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
These are the steps for creating a new terrain with a custom external alphamap.
<p />
For additional information on UE3 Terrain setup and importing algorithmic terrains see the UDN <a href="https://udn.epicgames.com/Three/TerrainTopics" class="restricted" class="restricted" class="twikiLink">Terrain Topics</a>.
<p />
1. Insert a Terrain actor into a new map.  Set its Terrain.NumPatchesX and Terrain.NumPatchesY to the size of the custom heightmap G16 file -1, and Import the heightmap.
<p />
2. Insert a DirectionalLight to simulate sunlight.  Change the Movement.Rotation.Pitch to -45 degrees.
<p />
3. Create a new TerrainMaterial for the base grass.  Assign an appropriate texture.
<p />
4. Create a new TerrainMaterial for the ridge rock.  Assign an appropriate texture.
<p />
5. Create a new TerrainLayerSetup for the base grass texture layer.  Note that this can also be a multi-layer procedural setup if desired, such as a dirt base and a grass flatland from 0 to 30 degrees.
<p />
6. Create a new TerrainLayerSetup for the ridge rock texture layer.  Note that this must be a separate single layer setup since multi-layer procedural setups do not support importing external alphamaps.
<p />
7. Add the two TerrainLayerSetups to the Terrain actor's Terrain.Layers array.  Note that the layers are rendered upward from [0] in this dialog array list, so the layer [0] will be the base layer and all layers with higher numbers are rendered on top of that.
<p />
<img alt="UE3TerrainProperties.gif" src="rsrc/Three/TerrainAlphamaps/UE3TerrainProperties.gif" />
<p />
8. Go into Terrain Edit mode to display the <a href="TerrainEditorUserGuide.html" class="twikiLink">Terrain Edit</a> dialog.  In the Import/Export group, check the "Height Map Only" and "Into Current" checkboxes so that it imports into the layer selection, select "G16BMPT3D" in the Class drop-down-combobox since this is a G16 .bmp we are importing, select the TerrainLayerSetup for the ridges that is to receive the custom alphamap (as noted by the yellow selection color on the dialog), then choose the Import button.  Locate the external G16 alphamap file in the file dialog and open it.  If there are no issues with the alphamap file, such as an incorrect file format or file dimensions, the alphamap should be loaded into the Terrain setup and applied to the selected layer.  You may need to click on the "Recache Terrain Materials" button to update the terrain in the viewport.  Note that the <em>Base</em> TerrainLayerSetup in this example is a multi-layer procedural setup of dirt and grass, as noted by the large "P" on its icon, and the <em>Ridges</em> TerrainLayerSetup that the alphamap was imported into is located below that.
<p />
<img alt="UE3TerrainEditImport.gif" src="rsrc/Three/TerrainAlphamaps/UE3TerrainEditImport.gif" />
<p />
After a Build All in UnrealEd, the final terrain looks like this.  Note the rocky terrain ridges.
<p />
<img alt="UE3TerrainFinal.jpg" src="rsrc/Three/TerrainAlphamaps/UE3TerrainFinal.jpg" />
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
