<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | MotionBlurSoftEdge    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">MotionBlurSoftEdge  </b></div>
<div id="tooltext">
<a href="MotionBlurSoftEdgeJP.html" class="twikiLink">日本語訳</a><br><a href="MotionBlurSoftEdgeCH.html" class="twikiLink">中国翻译</a><br><a href="MotionBlurSoftEdgeKR.html" class="twikiLink">한국어</a><br>

<!-- Three/MotionBlurSoftEdge -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="PostProcessEffectsHome.html" class="twikiLink">Post Process Effects</a></b> &gt; MotionBlur SoftEdge Post Process Feature <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="CinematicArtistHome.html" class="twikiLink">Cinematic Artist</a></b> &gt; MotionBlur SoftEdge Post Process Feature
</div>
<hr size="1" noshade="noshade">
<h1><a name="MotionBlur _SoftEdge Post Process Feature"></a> MotionBlur SoftEdge Post Process Feature </h1>
<hr size="1" noshade="noshade">
<p />
<table cellspacing="0" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/MotionBlurSoftEdge/SoftEdgeFan.jpg" alt="SoftEdgeFan.jpg" width='744' height='312' /> </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <SMALL>SoftEdge allows motion blur to appear outside of the moving object.</SMALL> </td></tr>
</table>
<br>
<p />
<div class="twikiToc"> <ul>
<li> <a href="MotionBlurSoftEdge.html#MotionBlur _SoftEdge Post Process Feature"> MotionBlur SoftEdge Post Process Feature</a> <ul>
<li> <a href="MotionBlurSoftEdge.html#Overview"> Overview</a>
</li> <li> <a href="MotionBlurSoftEdge.html#Activating _SoftEdge and setting the right parameter"> Activating SoftEdge and setting the right parameter</a>
</li> <li> <a href="MotionBlurSoftEdge.html#Results"> Results</a>
</li> <li> <a href="MotionBlurSoftEdge.html#Changing the values at run time"> Changing the values at run time</a>
</li> <li> <a href="MotionBlurSoftEdge.html#Implementation"> Implementation</a>
</li> <li> <a href="MotionBlurSoftEdge.html#Performance"> Performance </a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Recommended read: MotionBlur
<p />
Using the SoftEdge feature further improves the quality of the motion blur to become a more film like effect. In film cameras the so called shutter remains open for a period of time to capture more light. Moving objects appear blurred along their movement direction. Our motion blur is based on a post processing effect that blurs the image content by averaging multiple texture samples. Blurring outside of the object as seen in film images is possible but requires extra effort. We call our solution for the problem the motion blur SoftEdge feature.
<p />
Knowing about the technical properties of the feature allows to tweak the look and performance depending on the application needs.
<p />
<h2><a name="Activating _SoftEdge and setting the right parameter"></a> Activating SoftEdge and setting the right parameter </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The SoftEdge feature can be activated in the postprocessing chain in the uber post process node:
<p />
<table cellspacing="0" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/MotionBlurSoftEdge/EditorSetting.jpg" alt="EditorSetting.jpg" width='379' height='216' /> </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <SMALL>0 keeps the SoftEdge feature deactivated (fast), bigger values specify the radius (1..10 is a good range) </SMALL> </td></tr>
</table>
<br>
<p />
When using the SoftEdge feature you can increase the max velocity as stronger motion blur looks better with the feature enabled.
<p />
<h2><a name="Results"></a> Results </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<table cellspacing="0" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/MotionBlurSoftEdge/MotionBlurSoftEdgeNumbers.jpg" alt="MotionBlurSoftEdgeNumbers.jpg" width='489' height='221' /> </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <SMALL>Left: The blurring is only happening within the object<br>Middle: Using the feature blurs outside the object<br>Right: Using a bigger radius fully extends the effect.</SMALL> </td></tr>
</table>
<p />
Using the feature costs some performance. A bigger radius costs a bit more (more samples during the blurring needed). A bigger value also can distort the motion of multiple differently moving objects if they are too near to each other. As the middle image shows the value also can be too small and then the moving object appears cut. Our experience showed even small values give good results (e.g. 1). For stronger motion a value of 5 or 10 might be needed. We could compute the value based on the max velocity but we prefer to have the control to pick a smaller value to control performance and look.
<p />
<h2><a name="Changing the values at run time"></a> Changing the values at run time </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The console command <strong>MotionBlurSoftEdge</strong> allows to override the strength that is specified in the post processing chain. Use the command without parameter to get the help text. The command is best used in some frozen state (e.g. when using the <strong>freezeframe</strong> command or some game pause). Note that MotionBlurSkinning cannot be frozen as the current implementation is updated each frame and if some objects are frozen in time the per bone information is lost.
<p />
<table cellspacing="0" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/MotionBlurSoftEdge/console.jpg" alt="console.jpg" width='379' height='160' /> </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <SMALL>The help of the console command is shown.</SMALL> </td></tr>
</table>
<p />
After some experimentation you should be able to find a good value and use the setting in the post processing chain.
<p />
<h2><a name="Implementation"></a> Implementation </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Our motion blur implementation is done in a post process where the scene is blurred in the direction of the motion. The motion direction comes from the velocity texture (screen space 2D motion vector is encoded as a color) and from the camera motion. This is explained in MotionBlur. Graphics hardware is much fast in gather (regular texture mapping) methods than in scatter (distribute data to multiple destinations) methods. For motion blur we need to know for the current pixel from which neighbor pixels it receives content.
<p />
<strong>Without</strong> the SoftEdge feature we just assume the motion at the current pixel is the same for the neighbors as well. In order to avoid color leaking we reject pixels that have no or a different motion direction. The solution looks clean but doesn't blur outside of the object borders.
<p />
<strong>With</strong> the SoftEdge feature we blur the intermediate velocity texture with a simple Gaussian blur. Blurring a motion vector would result in a loss in length for the motion vector. To compensate that we also blur another channel (0 for no object motion, 1 for object motion). We can compensate for the motion strength loss by dividing by this channel.
<p />
The following image shows how the internal buffers look like (colors are different because the motion vectors are encoded differently):
<p />
<table cellspacing="0" cellpadding="1" class="twikiTable" border="0"><tr><td bgcolor="#eaeaea" class="twikiFirstCol"> <img src="rsrc/Three/MotionBlurSoftEdge/MotionBlurSoftBlurredVelocity.jpg" alt="MotionBlurSoftBlurredVelocity.jpg" width='372' height='246' /> </td></tr>
<tr><td bgcolor="#ffffff" class="twikiFirstCol"> <SMALL>Left: Velocity texture<br>Middle: Blurred velocity texture (small radius)<br>Right: Blurred velocity texture (big radius)</SMALL> </td></tr>
</table>
<p />
Note that the blurred image is much lower in resolution. The loss in detail is not visible in motion and further hidden by bilinear filtering the texture.
<p />
During post processing we use the blurred velocity vector to get the object direction we use for sampling. We also sample in the camera motion direction and combine the result.
<p />
<h2><a name="Performance"></a> Performance </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
We don't consider the current implementation final but it seems to be fast enough to be usable. With strong motion it might get a bit worse as the texture cache can affect this number a lot. We are looking into optimizing that.
<p />

<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
