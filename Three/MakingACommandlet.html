<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | MakingACommandlet    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">MakingACommandlet  </b></div>
<div id="tooltext">
<a href="MakingACommandletJP.html" class="twikiLink">日本語訳</a><br><a href="MakingACommandletCH.html" class="twikiLink">中国翻译</a><br><a href="MakingACommandletKR.html" class="twikiLink">한국어</a><br>

<!-- Three/MakingACommandlet -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<!--  -->
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="CommandletHome.html" class="twikiLink">Commandlets</a></b> &gt; How To Make a Commandlet
</div>
<hr size="1" noshade="noshade">
<h1><a name="How To Make a Commandlet"></a> How To Make a Commandlet </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="MakingACommandlet.html#How To Make a Commandlet"> How To Make a Commandlet</a> <ul>
<li> <a href="MakingACommandlet.html#Overview"> Overview</a>
</li> <li> <a href="MakingACommandlet.html#How To Make a Commandlet in Script"> How To Make a Commandlet in Script</a>
</li> <li> <a href="MakingACommandlet.html#How To Make a Commandlet in Native Code"> How To Make a Commandlet in Native Code</a>
</li> <li> <a href="MakingACommandlet.html#Giving Users Some Help"> Giving Users Some Help</a>
</li> <li> <a href="MakingACommandlet.html#How To Use a Commandlet"> How To Use a Commandlet</a>
</li> <li> <a href="MakingACommandlet.html#Common Commandlet Tasks"> Common Commandlet Tasks</a>
</li> <li> <a href="MakingACommandlet.html#Commandlet Listing"> Commandlet Listing</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Commandlets are command line programs that run inside of the Unreal Engine environment. They are most often used to make bulk changes to content, iterate over content to get information about it, or as a unit testing mechanism.
<p />
They are basically little applets that have the engine initialized but are mostly just confined to Windows console output. For example, <code>game.exe make</code> executes the <code>make</code> commandlet that compiles UnrealScript classes.
<p />
The engine automatically tries to see whether a command you passed on the commandline is a commandlet, and if it matches, executes the associated code.
<p />
Check out UContentCommandlets.cpp and UnPackageUtilities for some examples on commandlets.
<p />
<p />
<h2><a name="How To Make a Commandlet in Script"></a> How To Make a Commandlet in Script </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Create a script class for your commandlet as seen below:
<p />
<pre>
class HelloWorldCommandlet extends Commandlet;

event int Main( string Params )
{
   log( &#34; hello world &#34; );

   return 0;
}
</pre>
<p />
Or for a native commandlet:
<p />
<pre>
class HelloWorldCommandlet extends Commandlet
native;

cpptext
{
INT Main(const FString&#38; CmdLine)
{
   warnf(TEXT(&#34;hello world&#34;));
   return 0;
}
}

native event int Main( string Params );
</pre>
<p />
The Main() function is the entry point for your commandlet. The commandlet is passed a string containing all of the parameters for a given run. Note that for
<p />
<pre>
gamename.exe helloworld param1 param2 param3
</pre>
<p />
Your commandlet would see the string <code>param1 param2 param3</code> as the command line parameters.
<p />
<p />
<h2><a name="How To Make a Commandlet in Native Code"></a> How To Make a Commandlet in Native Code </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Most commandlets are implemented as intrinsic classes in native code. The procedure for creating a commandlet in this way is quite different. You'll find most commandlet declarations in <code>EditorCommandlets.h</code>.
<p />
First, declare your class in a header file like <code>EditorCommandlets.h</code>:
<pre>
BEGIN&#95;COMMANDLET(Name,Package)
  // declare additional methods here.
END&#95;COMMANDLET
</pre>
The commandlet will have a classname of "UNameCommandlet" and will be placed in the package you specify (like Editor).
<p />
Then, in a .cpp file (like <code>UContentCommandlets.cpp</code>), implement your commandlet's <code>Main()</code> function. If necessary, you can also override the <code>virtual CreateCustomEngine()</code> function. See the UCommandlet source for more details.
<pre>
INT UNameCommandlet::Main(const FString&#38; Params)
{
    // do yer stuff here...
    return 0;
}
</pre>
<p />
But you're not done yet! Since this is an intrinsic class, you must inform the script system of its presence. To do this you'll have to manually edit the <code>UnrealEdClasses.h</code> file, specifically the AUTO_INITIALIZE_REGISTRANTS_UNREALED #define. In that list, add a call to the <code>StaticClass()</code> function for your commandlet:
<pre>
#define AUTO&#95;INITIALIZE&#95;REGISTRANTS&#95;UNREALED \
   UNameCommandlet::StaticClass(); \
</pre>
<p />
The next time you rebuild script the compiler will overwrite this file with your Commandlet class in this list in alphabetical order.
<p />
<p />
<h2><a name="Giving Users Some Help"></a> Giving Users Some Help </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Built into a commandlet is the ability to show help information about it, so that users can discover what it is and what options it supports. To make help information available for your commandlet, you need to add entries into the localized text file that your commandlet resides in. If you package is in Core, then you need to modify Core.int for your help information to show up. Below is a sample setting for the "hello world" commandlet residing in Core.
<p />
<pre>
&#91;HelloWorldCommandlet]
HelpDescription&#61;&#34;This commandlet displays hello world&#34; HelpUsage&#61;&#34;gamename.exe helloworld&#34;
HelpWebLink&#61;&#34;https://udn.epicgames.com/bin/view/Three/MakingACommandlet&#34;
HelpParamNames&#91;0]&#61;&#34;param1&#34;
HelpParamDescriptions&#91;0]&#61;&#34;Ignored since helloworld doesn&#39;t need params&#34;
</pre>
<p />
Notice that the section name must include the <em>commandlet</em> as part of the class name. Without this, the commandlet wouldn't be found. To see how this information is used, run the following commands:
<p />
<pre>
game.exe help help
game.exe help list
game.exe help webhelp help
</pre>
<p />
<p />
<h2><a name="How To Use a Commandlet"></a> How To Use a Commandlet </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
To execute a commandlet run your game with the commandlet name that you wish to run. For instance:
<p />
<pre>
examplegame make -full
</pre>
<p />
launches the make commandlet inside of ExampleGame. Note that you do not have to specify the package name for native commandlets. If the make commandlet was a script-only commandlet, then it would be invoked using:
<p />
<pre>
examplegame editor.make -full
</pre>
<p />
since it wouldn't be loaded at startup. Also notice that the <em>commandlet</em> portion of the name isn't needed. The startup code automatically appends _commandlet= when trying to find the specified commandlet.
<p />
<p />
<h2><a name="Common Commandlet Tasks"></a> Common Commandlet Tasks </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
A common thing to do is iterate over packages and perform some data processing on them. The following code (which can also be found as a comment at the top of <code>UContentCommandlets.cpp</code>) can get you started:
<p />
<pre>
// Below is a template commandlet than can be used when you want to perform an operation on all packages.
INT UPerformAnOperationOnEveryPackage::Main(const FString&#38; Params)
{
   // Parse command line args.
   TArray&#60;FString&#62; Tokens;
   TArray&#60;FString&#62; Switches;

   const TCHAR&#42; Parms &#61; &#42;Params;
   ParseCommandLine(Parms, Tokens, Switches);

   // Build package file list.
   const TArray&#60;FString&#62; FilesInPath( GPackageFileCache-&#62;GetPackageFileList() );
   if( FilesInPath.Num() &#61;&#61; 0 )
   {
      warnf( NAME&#95;Warning, TEXT(&#34;No packages found&#34;) );
      return 1;
   }

   // Iterate over all files doing stuff.
   for( INT FileIndex &#61; 0 ; FileIndex &#60; FilesInPath.Num() ; ++FileIndex )
   {
      const FFilename&#38; Filename &#61; FilesInPath(FileIndex);
      warnf( NAME&#95;Log, TEXT(&#34;Loading &#37;s&#34;), &#42;Filename );

      UPackage&#42; Package &#61; UObject::LoadPackage( NULL, &#42;Filename, LOAD&#95;None );
      if( Package &#61;&#61; NULL )
      {
         warnf( NAME&#95;Error, TEXT(&#34;Error loading &#37;s!&#34;), &#42;Filename );
      }

      /////////////////
      //
      // Do your thing here
      //
      /////////////////

      TObjectIterator&#60;UStaticMesh&#62; It;...

      UStaticMesh&#42; StaticMesh &#61; &#42;It;
      if( StaticMesh-&#62;IsIn( Package )




      UObject::CollectGarbage( RF&#95;Native );
   }

   return 0;
}
</pre>
<p />
You might also want to look at <code>NormalizePackageNames()</code> in <code>PackageHelperFunctions.h</code> (which appeared in QA_APPROVED_BUILD_JUNE_2007). This function can create a filtered list of packages to iterate over, with a few more niceties beyond just iterating over <code>GPackageFileCache</code> (see the code for details).
<p />
<p />
<h2><a name="Commandlet Listing"></a> Commandlet Listing </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Please refer to the <a href="CommandletList.html" class="twikiLink">Commandlet List</a> page.
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
