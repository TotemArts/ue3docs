<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | PackagesAndNetworking    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">PackagesAndNetworking  </b></div>
<div id="tooltext">
<a href="PackagesAndNetworkingJP.html" class="twikiLink">日本語訳</a><br><a href="PackagesAndNetworkingCH.html" class="twikiLink">中国翻译</a><br><a href="PackagesAndNetworkingKR.html" class="twikiLink">한국어</a><br>

<!-- Three/PackagesAndNetworking -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<style type="text/css" media="all">@import "rsrc/UDNCSS_test.css";</style>
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="ReplicationHome.html" class="twikiLink">Networking &amp; Replication</a></b> &gt; High-Level Breakdown of Packages and Networking
</div>
<hr size="1" noshade="noshade">
<p />
<h1><a name="High-Level Breakdown of Packages and Networking"></a> High-Level Breakdown of Packages and Networking </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="PackagesAndNetworking.html#High-Level Breakdown of Packages and Networking"> High-Level Breakdown of Packages and Networking</a> <ul>
<li> <a href="PackagesAndNetworking.html#Overview"> Overview</a>
</li> <li> <a href="PackagesAndNetworking.html#ServerPackages"> ServerPackages</a>
</li> <li> <a href="PackagesAndNetworking.html#GUIDs"> GUIDs</a>
</li> <li> <a href="PackagesAndNetworking.html#Connecting to a Server"> Connecting to a Server</a>
</li> <li> <a href="PackagesAndNetworking.html#Conformed Packages"> Conformed Packages</a>
</li> <li> <a href="PackagesAndNetworking.html#Package-flags warning"> Package-flags warning</a>
</li> <li> <a href="PackagesAndNetworking.html#Package Mismatch Errors"> Package Mismatch Errors</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<hr size="1" noshade="noshade">
If you've done any editing of the Unreal Engine, you'll know what a package is. All game content is stored in packages: textures, maps, code, etc. A package, is nothing more than a collection of "stuff". A package can contain a map, textures, code, sounds, music, or any combination thereof. The directory structure of Unreal is just for our feeble human minds to organize things into separate places for textures, music, and maps. So a mapper can include textures and code in his map, removing the need for including .u files along with the map. In general, however, it's best to stay with the example set by the Unreal Engine, for sanity's sake. Put maps in .umap (or your own specific map extension), code in .u and the rest in .upk in organized directories. One thing you might want to do to improve Unrealscript compilation performance is to split up the package. Don't include game textures and models in your code packages. Instead, compile these into packages that contain a dummy class. This allows your art data to be compiled once beforehand, and your code recompilation merely references those packages (though the <strong>#obj load exec</strong> line). Another advantage is that any patches can be distributed as the smaller code file, avoiding a re-download of the entire package that includes models and textures.
<p />
<p />
<h2><a name="ServerPackages"></a> ServerPackages </h2>
<hr size="1" noshade="noshade">
When the server starts up, it loads all the packages it needs for the game. It loads the map, its associated textures, sounds, and music packs. It loads the game, as defined in <strong>?Game=XX</strong> in the ServerTravel command. It loads the severpackages mentioned in the <em>gamename</em>.ini (ExampleGame.ini). Once these packages and classes are loaded, no further packages are added to this list of packages stored in the server. This list, which we will call the ServerPackages list, is sent to every client that joins the server. The client then loads these packages on their own, so that any actors sent to the client will be able to be loaded without any hassle. No code executes until after all these packages have been loaded. If this is a server, it will not accept any clients until these packages have been loaded. This explains the long non-responsive delay when you load levels or servers in Unreal. Additional packages can be loaded through the use of <strong>DynamicLoadObject()</strong> (<img src="rsrc/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" /> Note that <strong>DynamicLoadObject()</strong> does not work on all platforms!), but these packages are loaded on the local machine only. Unreal does not tell any connecting machines to load these packages as well. All packages required for a level to load are automatically added to the package map.
<p />
This explains a few strange phenomenon that people experience. Mutators are one such example, and it's useful to read this even if you have no interest in mutators, since the problems can manifest themselves in other areas as well. Mutators are loaded by UnrealScript using <strong>DynamicLoadObject()</strong>, specifically in <strong>GameInfo::InitGame()</strong>. This happens after the list of packages have been loaded, so mutator packages are not loaded into the ServerPackages at this point. The mutators included with Unreal do not have this problem because they are included in the game code itself. Any mutators which operate server-side only are fine, since they don't require sending any actors to the client in that package. If however, a mutator has actors defined which it sends to the client, then its actors will be invisible on the client. Because the package was never added to the ServerPackages list, the client never loaded the package, and so the client has no idea of the actors defaultproperties, and it is invisible. The way to solve the problem is to explicitly put the problematic mutator into the ServerPackages array in the GameName.ini file, under <strong>[Engine.GameEngine]</strong>. This causes the mutator package to get loaded before the game begins, and then when the GameInfo loads it, it is already in the ServerPackages and so will work fine on the client.
<p />
The same applies to skins packages. The user's skin is specified in the joining commandline options, and it is not loaded until the <strong>Login()</strong> in <strong>GameInfo</strong>. Again, this is after all ServerPackages have been loaded. So every client will get this texture replicated to them, but when they go to display it, the texture package is not in the client's local memory (since it was not in the ServerPackages), and so you see the infamous green skin problem.
<p />
<p />
<h2><a name="GUIDs"></a> GUIDs </h2>
<hr size="1" noshade="noshade">
Every package has a GUID associated with it, which stands for Globally Unique Identifier. Every package has a GUID generated for it when it is saved. This GUID can then serve to identify different version of the same package, or to differentiate between packages. The GUID takes into account the time and other information in generating a 128-bit ID, so you can be sure that no two GUID's will ever be alike through pure chance. There are 2<sup>128</sup> = 2.4 x 10<sup>38</sup> possible GUIDs. I'm sure that's enough to justify not having to worry about the problem.
<p />
In the process of conforming a package, the new package is given the same GUID as the original package, among other interesting details. They are deemed to be alike for all intents and purposes. We'll see why this in a later section.
<p />
<p />
<h2><a name="Connecting to a Server"></a> Connecting to a Server </h2>
<hr size="1" noshade="noshade">
When you connect to a server, the process roughly goes like this:
<p /> <ol>
<li> The server sends ServerPackage list, along with GUIDs for each package. <!--  -->
</li> <li> The client checks the list in order, trying each download manager until it finds one that it actually has on the client. <!--  -->
</li> <li> The server checks to see if it this method is allowed, and if so, how. If the user requests <strong>Engine.ChannelDownload</strong>: <!--  --> <ol>
<li> The server checks to see if the <strong>[IpDrv.TcpNetDriver]'s AllowDownloads</strong> boolean is <strong>true</strong>, and doesn't send if it is.
</li> <li> The server sends the file to the client. This may cause lag for other clients as the bandwidth is spent sending a file to that particular client. The maximum speed at which the file is sent is determined by <strong>[IpDrv.TcpNetDriver] -&gt; MaxClientRate</strong>.
</li></ol>
</li> <li> If the client cannot download, because the server will not allow the client to download packages, then the client gives up, and fails to connect to the server.
</li></ol>
<p />
<p />
<h2><a name="Conformed Packages"></a> Conformed Packages </h2>
<hr size="1" noshade="noshade">
A conformed package is intended to provide network-compatibility between two versions of a package. The way it works is this: Say I release version 1 of my product, and now want to release version 2. If I don't want this new version to prevent unpatched users from playing on patched servers, nor do I want it to prevent upgraded users from playing unpatched servers, then I have to use version conforming. Version conforming lets Unreal pretend the two versions are the same, and allows users of the original package to play with users of the upgraded version. Package conforming requires the original version you wish to conform against, obviously, so it knows how to tell the new version to 'make-believe' that it is the old one. There are two ways to conform a package:
<p /> <ul>
<li> Put a copy of the original in a <strong>guires</strong> directory in your game directory. It should be next to your Binaries directory. Any versions compiled with 'ucc make' will be automatically conformed against the version in <strong>guires</strong>.
</li> <li> Compile a copy of the new version of your package. Then use the conform commandlet to conform the package.
</li></ul>
<p />
When you compile a package, it includes an array in the package called <strong>Generations</strong>, that stores a history of the conformity of the package. <!--  --> So when a server with version 2 sees a client of version 1, it looks up version 1 in the <strong>Generations</strong> array and knows how to communicate properly with that client.
<p />
This has implications for conforming as well. When you want to conform version 3 of your package, in order for it to conform to both version 1 and version 2, you must conform version 3 against version 2, <strong>not</strong> version 1. Version 2 contains information on how to communicate with version 1 and version 2. Since version 3 needs this information to be compatible with all of them, it must be conformed against version 2. So whenever you release a public version of your code that will be outside of your control and possibly publicly released, it's best to put that version in your <strong>guires</strong> directory to ensure that the next version you compile internally (and eventually release publicly) will be compatible with all versions out there. Each version of your package must be compiled against the <strong>previous</strong> one, <strong>not</strong> the first one.  So when a client of version 4 sees a server of version 2, it will know how to be backwards-compatible and communicate with the unpatched server. <!--  -->
<p />
The conforming process actually consists of keeping the name tables in synchronization. When version 2 is conformed against version 1, it saves the name table, keeping all names that appeared in version 1 in the same position. Any additional names that appear in version 2 show up after this list. When the server and client send information about functions or variables, they actually send the index into the name table. So by ensuring that the name table used to communicate is identical even if the client is version 2 and the server is version 1, it allows communication to occur flawlessly. When storing the generations array to disk, it stores the number of names and number of exports. This lets Unreal know that a version 2 package can communicate with a version 1 package using the first X entries (which are exactly the same as version 1) of the name table.
<p />
When conforming Localized packages, you want to conform them in a chain so that each language with work with every other language.  For example, if you had 'int', 'fra', 'esn' and 'deu' localized versions of a package, you would want to conform 'int' to 'fra', then 'fra' to 'esn', then 'esn' to 'deu', etc.  The order of the languages does not matter.  <!--  -->
<p />
<p />
<h2><a name="Package-flags warning"></a> Package-flags warning </h2>
<hr size="1" noshade="noshade">
There are a few package flags that you will find interesting and necessary. If you want to use your package in net play and allow it to be downloaded to the client, then you must turn on the <strong>AllowDownload</strong> flag for the package.
<p />
<p />
<h2><a name="Package Mismatch Errors"></a> Package Mismatch Errors </h2>
<hr size="1" noshade="noshade">
Downloading a package with the same name but a different GUID will result in a package mismatch error. This can be resolved by conforming the package with the previous version of that package (and thus creating a new generation). However, the anticheat protection will kick in if the checksum of both packages isn't know to the server.
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
