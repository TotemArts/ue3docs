<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | CharacterEncoding    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">CharacterEncoding  </b></div>
<div id="tooltext">
<a href="CharacterEncodingJP.html" class="twikiLink">日本語訳</a><br><a href="CharacterEncodingCH.html" class="twikiLink">中国翻译</a><br><a href="CharacterEncodingKR.html" class="twikiLink">한국어</a><br>

<!-- Three/CharacterEncoding -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="https://udn.epicgames.com/Three/EngineProgrammingHome" class="restricted" class="restricted" class="twikiLink">Engine Programming</a></b> &gt; Character Encoding
</div>
<hr size="1" noshade="noshade">
<h1><a name="Character Encoding"></a> Character Encoding </h1>
<hr size="1" noshade="noshade">
<p />
<div class="twikiToc"> <ul>
<li> <a href="CharacterEncoding.html#Character Encoding"> Character Encoding</a> <ul>
<li> <a href="CharacterEncoding.html#Overview"> Overview</a>
</li> <li> <a href="CharacterEncoding.html#Text Formats"> Text Formats</a> <ul>
<li> <a href="CharacterEncoding.html#The case for Binary"> The case for Binary</a>
</li> <li> <a href="CharacterEncoding.html#The case for Text"> The case for Text</a>
</li> <li> <a href="CharacterEncoding.html#The case for UTF-8"> The case for UTF-8</a>
</li> <li> <a href="CharacterEncoding.html#The case for UTF-16"> The case for UTF-16</a>
</li></ul>
</li> <li> <a href="CharacterEncoding.html#UE3 Internal String Representation"> UE3 Internal String Representation</a>
</li> <li> <a href="CharacterEncoding.html#Text files loaded by UE3"> Text files loaded by UE3</a>
</li> <li> <a href="CharacterEncoding.html#Text files saved by Unreal"> Text files saved by Unreal</a>
</li> <li> <a href="CharacterEncoding.html#Recommended encoding for text files used by Unreal"> Recommended encoding for text files used by Unreal</a> <ul>
<li> <a href="CharacterEncoding.html#INT and INI files"> INT and INI files</a>
</li> <li> <a href="CharacterEncoding.html#Source code"> Source code</a> <ul>
<li> <a href="CharacterEncoding.html#UnrealScript source code"> UnrealScript source code</a>
</li> <li> <a href="CharacterEncoding.html#C++ Source"> C++ Source</a>
</li></ul>
</li></ul>
</li> <li> <a href="CharacterEncoding.html#Storing UTF-16 text files in Perforce"> Storing UTF-16 text files in Perforce</a>
</li> <li> <a href="CharacterEncoding.html#Conversion routines"> Conversion routines</a>
</li> <li> <a href="CharacterEncoding.html#ToUpper() and _ToLower() Non-Trivial in Unicode"> ToUpper() and ToLower() Non-Trivial in Unicode</a>
</li> <li> <a href="CharacterEncoding.html#Notes about C++ source code specific to East Asian encodings"> Notes about C++ source code specific to East Asian encodings</a>
</li> <li> <a href="CharacterEncoding.html#See Also"> See Also</a>
</li></ul>
</li></ul>
</div>
<p />
<style type="text/css" media="all">@import "rsrc/Three/CharacterEncoding/extraCSS.css";</style>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
This document provides an overview of character encodings used by Unreal.
<p />
Assumed knowledge: <a href="http://www.joelonsoftware.com/articles/Unicode.html" target="_top">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a>
<p />
<h2><a name="Text Formats"></a> Text Formats </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
There are several formats that can be used to represent text and strings. Understanding these formats and their inherent pros and cons can help in making decisions on what formats to use in your projects.
<p />
These are not the the technical definitions of formats, but rather simplified versions suitable for this page.
<p /> <dl>
<dt> <strong>ASCII</strong>  </dt><dd> characters between 32 and 126 inclusive, and 0, 9, 10 and 13. (P4 type text) (This is validated with a P4 trigger on checkin)
</dd> <dt> <strong>ANSI</strong>  </dt><dd> ASCII and the current codepage (e.g. Western European high ASCII) (needs to stored as binary on the P4 server)
</dd> <dt> <strong>UTF-8</strong>  </dt><dd> a string made up of single bytes which can use special character sequences to get non ANSI characters (a superset of ASCII) (P4 type Unicode)
</dd> <dt> <strong>UTF-16</strong>  </dt><dd> a string made up of 2 bytes per character with a <a href="http://en.wikipedia.org/wiki/Byte-order_mark">BOM</a> (although can go to 4 bytes with astral characters) (P4 type UTF-16) (This is validated with a P4 trigger on checkin)
</dd></dl>
<p />
<h3><a name="The case for Binary"></a> The case for Binary </h3>
<p />
<table width="900" cellspacing="1" id="comparetable" cellpadding="5" class="twikiTable" border="0"><tr><th width="50%" bgcolor="#404040" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=1;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Pros</font></a> </th><th width="50%" bgcolor="#404040"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=1;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Cons</font></a> </th></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Internal format is not defined; each file can be loaded no matter what format it is. </td><td width="50%" bgcolor="#ffffff"> Non mergable. Requires all files of this type to be exclusive checkout. </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> &nbsp; </td><td width="50%" bgcolor="#eaeaea"> Internal format is not defined; each file could be in a different format. </td></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> &nbsp; </td><td width="50%" bgcolor="#ffffff"> P4 stores the entirety of each version, which can unnecessarily bloat the depot size. </td></tr>
</table>
<p />
<h3><a name="The case for Text"></a> The case for Text </h3>
<p />
<table width="900" cellspacing="1" id="comparetable" cellpadding="5" class="twikiTable" border="0"><tr><th width="50%" bgcolor="#404040" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=2;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Pros</font></a> </th><th width="50%" bgcolor="#404040"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=2;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Cons</font></a> </th></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Mergable. Exclusive checkout is not required. </td><td width="50%" bgcolor="#ffffff"> Very limiting; only ASCII characters allowed. </td></tr>
</table>
<p />
<h3><a name="The case for UTF-8"></a> The case for UTF-8 </h3>
<p />
<table width="900" cellspacing="1" id="comparetable" cellpadding="5" class="twikiTable" border="0"><tr><th width="50%" bgcolor="#404040" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=3;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Pros</font></a> </th><th width="50%" bgcolor="#404040"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=3;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Cons</font></a> </th></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Simple access to all characters we will ever need. </td><td width="50%" bgcolor="#ffffff"> Has a different memory profile for Asian languages </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> Uses less memory </td><td width="50%" bgcolor="#eaeaea"> P4 type Unicode is not enabled on our Perforce server </td></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Is a superset of ASCII; a plain ASCII string is a perfectly valid UTF-8 string </td><td width="50%" bgcolor="#ffffff"> String operations more complicated; have to parse the string to do something as simple as a length calculation. </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> Still works when the game detects the string is ASCII and outputs it as such </td><td width="50%" bgcolor="#eaeaea"> MSDev doesn't handle anything other than ASCII very well in Asian regions. This is why we validate text as ASCII during checkin. </td></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> If we did have a Unicode enabled server, the files would be mergable and exclusive checkout would not be required. </td><td width="50%" bgcolor="#ffffff"> &nbsp; </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> Can detect whether a string is UTF-8 by parsing it (with or without a BOM) </td><td width="50%" bgcolor="#eaeaea"> &nbsp; </td></tr>
</table>
<p />
<h3><a name="The case for UTF-16"></a> The case for UTF-16 </h3>
<p />
<table width="900" cellspacing="1" id="comparetable" cellpadding="5" class="twikiTable" border="0"><tr><th width="50%" bgcolor="#404040" class="twikiFirstCol"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=0;table=4;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Pros</font></a> </th><th width="50%" bgcolor="#404040"> <a rel="nofollow" href="https://udn.epicgames.com/bin/publish/WebHome?webs=Main%2CTwo%2CThree%2CPowered&amp;amp;inclusions=%2A&amp;amp;exclusions=&amp;amp;filter=&amp;amp;inclfilter=%5C%25META%5C%3AFIELD%5C%7Bname%5C%3D%5C%22Documentavailability%5C%22.%2Avalue%5C%3D%5C%22General%20public%5C%22&amp;amp;filterbymeta=yes&amp;amp;skin=static_udn3&amp;amp;restrictedclass=restricted&amp;amp;format=&amp;amp;sortcol=1;table=4;up=0#sorted_table" class="restricted" title="Sort by this column"><font color="#FFFFFF">Cons</font></a> </th></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Simple access to all characters we will ever need. </td><td width="50%" bgcolor="#ffffff"> Uses more memory. </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> Simple. Memory usage is twice the number of characters (for characters we use, which are all in the <a href="http://en.wikipedia.org/wiki/Mapping_of_Unicode_character_planes">Basic Multilingual Plane</a>) </td><td width="50%" bgcolor="#eaeaea"> Difficult to detect this format if it doesn't have a BOM. </td></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Simple. String operations can split/combine without having to parse the strings. </td><td width="50%" bgcolor="#ffffff"> Does not work when the game detects the string is ASCII and outputs it as such (this is now detected on checkin with the UTF-16 validator) </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> Same as the format used in game, no translation, parsing or memory operations required. </td><td width="50%" bgcolor="#eaeaea"> MSDev doesn't handle anything other than ASCII very well in Asian regions. This is why we validate text as ASCII during checkin. </td></tr>
<tr><td width="50%" bgcolor="#ffffff" class="twikiFirstCol"> Mergable. Exclusive checkout is not required. </td><td width="50%" bgcolor="#ffffff"> &nbsp; </td></tr>
<tr><td width="50%" bgcolor="#eaeaea" class="twikiFirstCol"> C# uses UTF-16 internally. </td><td width="50%" bgcolor="#eaeaea"> &nbsp; </td></tr>
</table>
<p />
<h2><a name="UE3 Internal String Representation"></a> UE3 Internal String Representation </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
All strings in Unreal Engine 3 are stored in memory in <a href="http://en.wikipedia.org/wiki/UTF-16/UCS-2" target="_top">UTF-16</a> format as FStrings or TCHAR arrays. Most code assumes 2 bytes is one codepoint so only the Basic Multilingual Plane (BMP) is supported so Unreal's internal encoding is more correctly described as UCS-2. Strings are stored in the endian-ness appropriate for the current platform.
<p />
When serializing to packages to/from disk or during networking, strings with all TCHAR characters &lt; 0xff are stored as a series of 8-bit bytes, and otherwise as 2-byte UTF-16 strings. The serialization code can deal with any endian conversion as necessary.
<p />
<h2><a name="Text files loaded by UE3"></a> Text files loaded by UE3 </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
When Unreal loads an external text file (for example reading a .INT file at runtime or the UnrealScript compiler loading UnrealScript .uc source file) it is almost always done with the appLoadFileToString() function found in UnMisc.cpp. The main work occurs in the appBufferToString() function.
<p />
This function recognizes the Unicode byte-order-mark (BOM) in a UTF-16 file and if present will load the file as UTF-16 in either endian-ness.
<p />
What happens when the BOM is not present depends on the platform.
<p />
On Windows it will attempt to convert the text to UTF-16 using the default Windows MBCS encoding (eg <a href="http://en.wikipedia.org/wiki/Windows-1252" target="_top">Windows-1252</a> for US English and Western Europe, CP949 for Korean and CP932 for Japanese) and uses MultiByteToWideChar(CP_ACP, MB_ERR_INVALID_CHARS...). This was added around the July 2009 QA build.
<p />
If this conversion fails or on platforms other than Windows, it will just reads each byte and pad it to 16-bits to make an array of TCHARs.
<p />
Note that there is no code to detect or decode UTF-8 encoded texture files loaded with appLoadFileToString().
<p />
<h2><a name="Text files saved by Unreal"></a> Text files saved by Unreal </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Most text files generated by the engine will be saved using appSaveStringToFile().
<p />
Strings with all TCHAR characters representable by a single byte will be stored as a series of 8-bit bytes, and otherwise as UTF-16 unless the bAlwaysSaveAsAnsi flag is passed in as TRUE, in which case it will be converted to the default Windows encoding first. This is currently only done on shader files, to work around an issue a shader compiler had with UTF-16 files.
<p />
<h2><a name="Recommended encoding for text files used by Unreal"></a> Recommended encoding for text files used by Unreal </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<h3><a name="INT and INI files"></a> INT and INI files </h3>
<p />
UTF-16 in either endian. While the default MBCS encoding for an Asian language (eg CP932) will work on Windows, these files need to be loaded on PS3 and Xbox360 and the conversion code only runs on Windows.
<p />
<h3><a name="Source code"></a> Source code </h3>
In general we don't recommend string literals inside C++ or UnrealScript source code and we recommend this data goes in INT files.
<p />
<h4><a name="UnrealScript source code"></a> UnrealScript source code </h4>
<p />
UTF-16 or default Windows encoding. In either case, Japanese and Korean string literals and comments should work correctly because the compiler runs on Windows and generates Unreal packages that will store the text in UTF-16 internally. If you use the default Windows encoding, you must be aware that these .uc files will not work on machines with a different locale.
<p />
<h4><a name="C++ Source"></a> C++ Source </h4>
<p />
UTF-8 or default Windows encoding. MSVC, the Xbox360 compiler and gcc should all be happy with with UTF-8 encoded source files. Latin-1 encoded files with characters with the high bit set, for example copyright, trademark or degree symbols should be avoided in source code where possible because the encoding will break on systems with different locales. Some instances of this in 3rd party software are unavoidable (eg copyright notices) so for MSVC we disable warning 4819, which would otherwise occur when compiling on Asian Windows.
<p />
<h2><a name="Storing UTF-16 text files in Perforce"></a> Storing UTF-16 text files in Perforce </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p /> <ul>
<li> Do <strong>not</strong> use 'Text' <ul>
<li> If a UTF-x file is checked in and stored as text, it will be corrupted after syncing.
</li></ul>
</li> <li> If you use 'Binary', mark the files as exclusive checkout <ul>
<li> People can check in ASCII, UTF-8, UTF-16 and it will work in engine.
</li> <li> However, binary files cannot be merged, so if the files are not marked as exclusive checkout, changes will be stomped upon.
</li></ul>
</li> <li> If you use 'UTF-16', make sure no one checks in a file that isn't UTF-16 <ul>
<li> We have a Perforce trigger that disallows checking in a non UTF-16 as UTF-16 <ul>
<li> //depot/UnrealEngine3/Development/Tools/P4Utils/CheckUTF16/
</li></ul>
</li></ul>
</li> <li> The 'Unicode' type is UTF-8, and of no use to us here.
</li></ul>
<p />
<h2><a name="Conversion routines"></a> Conversion routines </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
We have a number of macros to convert strings to and from various encodings. These macros use a class instance declared in local scope and allocate space on the stack, so it is very important you do not retain pointers to them! They are intended only for passing strings to function calls.
<p /> <ul>
<li> TCHAR_TO_ANSI(str)
</li> <li> TCHAR_TO_OEM(str)
</li> <li> ANSI_TO_TCHAR(str)
</li> <li> TCHAR_TO_UTF8(str)
</li> <li> UTF8_TO_TCHAR(str)
</li></ul>
<p />
These use the following helper classes from UnStringConv.h:
<p /> <ul>
<li> typedef TStringConversion&lt;TCHAR,ANSICHAR,FANSIToTCHAR_Convert&gt; FANSIToTCHAR;
</li> <li> typedef TStringConversion&lt;ANSICHAR,TCHAR,FTCHARToANSI_Convert&gt; FTCHARToANSI;
</li> <li> typedef TStringConversion&lt;ANSICHAR,TCHAR,FTCHARToOEM_Convert&gt; FTCHARToOEM;
</li> <li> typedef TStringConversion&lt;ANSICHAR,TCHAR,FTCHARToUTF8_Convert&gt; FTCHARToUTF8;
</li> <li> typedef TStringConversion&lt;TCHAR,ANSICHAR,FUTF8ToTCHAR_Convert&gt; FUTF8ToTCHAR;
</li></ul>
<p />
It is also critical that when using TCHAR_TO_ANSI you do not assume the number of bytes will be the same as the TCHAR string length. Multiple byte character sets could require multiple bytes per TCHAR character. If you need to know the length of the resulting string in bytes, you can use the helper class instead of the macros. For example:
<p />
<pre>
FString String;
...
FTCHARToANSI Convert(&#42;String);
Ar-&#62;Serialize((ANSICHAR&#42;)Convert, Convert.Length());  // FTCHARToANSI::Length() returns the number of bytes for the encoded string, excluding the null terminator.
</pre>
<p />
<h2><a name="ToUpper() and _ToLower() Non-Trivial in Unicode"></a> ToUpper() and ToLower() Non-Trivial in Unicode </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
UE3 currently only handles ANSI (ASCII | code page 1252 | | Western European)
<p />
The least worst method to do this for all languages seems to be mentioned here <a href="http://en.wikipedia.org/wiki/ISO/IEC_8859" target="_top">http://en.wikipedia.org/wiki/ISO/IEC_8859</a>
<p /> <ul>
<li> ISO/IEC 8859-1 for English, French, German, Italian, Portuguese and both Spanishes
</li> <li> ISO/IEC 8859-2 for Polish, Czech and Hungarian
</li> <li> ISO/IEC 8859-5 for Russian
</li></ul>
<p />
The mappings from <a href="ftp://ftp.unicode.org/Public/MAPPINGS/ISO8859/" target="_top">ftp://ftp.unicode.org/Public/MAPPINGS/ISO8859/</a> contain the conversion rules for the above mentioned languages. 'CAPITAL LETTER' and 'SMALL LETTER' info would be cross referenced with the appropriate unicode character to get the desired result.
<p />
<h2><a name="Notes about C++ source code specific to East Asian encodings"></a> Notes about C++ source code specific to East Asian encodings </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Both of UTF-8 and the default Windows encodings can cause problems with the C++ compiler, as follows:
<p />
<strong><em>Default Windows encoding</em></strong>
<br />
Take care when compiling C++ source code on Windows with running with a single byte character code page (e.g. CP437 United States), if the source code has an East Asian double byte character encoding such as CP932 (Japanese), CP936 (Simplified Chinese) or CP950 (Traditional Chinese).
<p />
These East Asian character encoding systems uses 0x81-0xFE for first byte, and 0x40-0xFE for second byte. A value of 0x5C in the second byte will be interpreted as backslash in ASCII/latin-1, and that has a special meaning for C++. (Escape sequence inside a string literal, and line continuation if used at the end of a line). <br />
When compiling that source code on single-byte code page Windows, the compiler doesn't care about the East Asian double byte character encoding, and this could cause either a compile error or worse, create a bug in the EXE.
<p />
Single-line comments:<br />
These can cause difficult-to-find bugs or errors caused by a missing line, if in the end of East Asian comment has 0x5c.
<pre>
    // EastAsianCharacterCommentThatContains0x5cInTheEndOfComment0x5c&#39;\&#39;
    important&#95;function(); /&#42; this line would be connected to above line as part of comment &#42;/
</pre>
<p />
Inside a string literal:<br />
This can cause a broken string or an error with an recognized 0x5c escape sequence.
<pre>
    printf(&#34;EastAsianCharacterThatContains0x5c&#39;\&#39;AndIfContains0x5cInTheEndOfString0x5c&#39;\&#39;&#34;);
    function();
    printf(&#34;Compiler recognizes left double quotation mark in this line as the end of string literal that continued from first line, and expected this message is C++ code.&#34;);
</pre>
If the character following 0x5c does specify a escape sequence, compiler converts escape sequence character set to single specified character.<br />
(If doesn't specify, the result is implementation defined, but MSVC removes 0x5c, and warns "unrecognized character escape sequence".)<br />
In the above case, the end of string has a 0x5c backslash and next character is a double quote, so the escape sequence \" is converted to a double quote in the string data, and compiler continues to make string data before next double quote or end of file, and causes an error.
<p />
Examples of dangerous characters:<br />
CP932 (Japanese Shift-JIS) "?" is 0x955C, and so many CP932 characters have 0x5C.<br />
CP936 (Simplified Chinese GBK) "?" is 0x815C, and so many CP936 characters have 0x5C.<br />
CP950 (Traditional Chinese Big5) "?" is 0xA55C, and so many CP950 characters have 0x5C.<br />
CP949 (Korean, EUC-KR) is OK, because EUC-KR doesn't use 0x5C for the second byte.
<p />
<strong><em>UTF-8 without BOM</em></strong> (Some text editors describe BOM as signature)
<br />
Take care for compiling C++ source code on East Asian code page CP949 (Korean), CP932 (Japanese), CP936 (Simplified Chinese) or CP950 (Traditional Chinese) Windows, if that source code has an East Asian character stored as UTF-8.
<p />
UTF-8 character encoding uses three bytes for East Asian characters: 0xE0-0xEF for the first byte, 0x80-0xBF for the second byte and 0x80-0xBF for the third byte. Without the BOM, East Asian Windows' default encoding recognizes the three UTF-8 encoded bytes and the following byte as two 2-byte East Asian encoded characters, pairing of first and second bytes for one first East Asian character, and the third byte and folowing byte paired to form tge second East Asian character.<br />
Problems can occur if the character following the UTF-8 encoded three bytes has special meaning in the string literals or comments.
<p />
Eg In in-line comment:<br />
Causes hard-to-find bugs or errors with missing code, if the comment text contains an odd number of East Asian characters, and next character marks the end of the comment.
<pre>
    /&#42;OddNumberOfEastAsianCharacterComment&#42;/
    important&#95;function();
    /&#42;normal comment&#42;/
</pre>
The compiler on East Asian code page Windows recognizes the last byte of the UTF-8 decoded East Asian character comment and asterisk '*' as a single East Asian character, and next characters is treated as still part of the comment. In above case, compiler removes important_function() as it seems to be part of the comment.<br />
This behavior is very dangerous and it is difficult to find the missing code.
<p />
In single-line comment:<br />
Using backslash '\' at the end of of an East Asian comment causes hard-to-find bugs or errors without missing lines.
<pre>
    // OddNumberOfEastAsianCharacterComment\
    description(); /&#42; coder intended this line as comment, by using backslash at the end of above line &#42;/
</pre>
This is a very rare case, because programmers shouldn't intentionally write backslashes '\' at the end of comments.
<p />
Inside string literals:<br />
This causes broken strings, errors or warnings when an odd number of UTF-8 encoded East Asian characters are inside a string literal and the following character has special meaning.
<pre>
    printf(&#34;OddNumberOfEastAsiaCharacterString&#34;);
    printf(&#34;OddNumberOfEastAsiaCharacterString&#37;d&#34;,0);
    printf(&#34;OddNumberOfEastAsiaCharacterString\n&#34;);
</pre>
The C++ compiler on East Asian code page Windows interprets the last byte of the UTF-8 decoded East Asian character string and next character as a single East Asian character. If you are lucky, compiler warning "C4819" (if not disabled) or an error will alert you to the problem. If unlucky, the string would be broken.
<p />
<strong><em>Conclusion</em></strong>
<br />
You can use UTF-8 or default Windows encoding for C++ source code, but please be aware of these problem. Again, we don't recommend string literals inside C++ or UnrealScript source. Please make sure to use East Asian as your default code page if you have to use East Asian character encoding in C++ source code.<br />
Another good way is to use UTF-8 with BOM (some text editors describes the BOM as a Unicode signature).
<p />
<strong><em>Note</em></strong>
<br />
We tested a few compilers with UTF-8 and UTF-16 on 18 Feb 2010.<br />
<p />
MSVC for PC and Xbox 360, and gcc or slc for PS3 are able to compile UTF-8-encoded source code (with and without BOM).
But UTF-16 (little-endian/big-endian) is supported only by MSVC.<br />
<p />
Perforce is able to work with both UTF-16 and UTF-8, but p4 diff displays the BOM in UTF-8 files as a visible character.
<p />
External reference: <a href="http://msdn.microsoft.com/en-us/goglobal/bb964654.aspx" target="_top">Code Pages Supported by Windows</a>
<p />
<h2><a name="See Also"></a> See Also </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p /> <ul>
<li> <a href="https://udn.epicgames.com/Three/UnrealLoc" class="restricted" class="restricted" class="twikiLink">UnrealLoc</a>
</li> <li> <a href="LocalizationReference.html" class="twikiLink">LocalizationReference</a>
</li> <li> <a href="LocalizedTextFiles.html" class="twikiLink">LocalizedTextFiles</a>
</li></ul>
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
