<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | ImageBasedReflections    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">ImageBasedReflections  </b></div>
<div id="tooltext">
<a href="ImageBasedReflectionsJP.html" class="twikiLink">日本語訳</a><br><a href="ImageBasedReflectionsCH.html" class="twikiLink">中国翻译</a><br><a href="ImageBasedReflectionsKR.html" class="twikiLink">한국어</a><br>

<!-- Three/ImageBasedReflections -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="DirectX11Rendering.html" class="twikiLink">DirectX 11 in Unreal Engine 3</a></b> &gt; Image Based Reflections <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="MaterialsAndTexturesHome.html" class="twikiLink">Materials &amp; Textures</a></b> &gt; Image Based Reflections
</div>
<hr size="1" noshade="noshade">
<h1><a name="Image Based Reflections"></a> Image Based Reflections </h1>
<hr size="1" noshade="noshade">
<p />
<em>Document Changelog: Created by <a href="https://udn.epicgames.com/Main/DanielWright" class="restricted" class="restricted" class="twikiLink">Daniel Wright</a>.</em>
<p />
<div class="twikiToc"> <ul>
<li> <a href="ImageBasedReflections.html#Image Based Reflections"> Image Based Reflections</a> <ul>
<li> <a href="ImageBasedReflections.html#Overview"> Overview</a>
</li> <li> <a href="ImageBasedReflections.html#Enabling Image-Based Reflections"> Enabling Image-Based Reflections</a>
</li> <li> <a href="ImageBasedReflections.html#Quick start from empty level"> Quick start from empty level</a>
</li> <li> <a href="ImageBasedReflections.html#Features"> Features</a>
</li> <li> <a href="ImageBasedReflections.html#Material Properties"> Material Properties</a>
</li> <li> <a href="ImageBasedReflections.html#ImageReflectionActors"> ImageReflectionActors</a> <ul>
<li> <a href="ImageBasedReflections.html#ReflectionTexture Restrictions"> ReflectionTexture Restrictions</a>
</li> <li> <a href="ImageBasedReflections.html#ImageReflectionSceneCapture"> ImageReflectionSceneCapture</a>
</li></ul>
</li> <li> <a href="ImageBasedReflections.html#Environment Texture"> Environment Texture</a>
</li> <li> <a href="ImageBasedReflections.html#Light Reflections"> Light Reflections</a>
</li> <li> <a href="ImageBasedReflections.html#Static Shadowing"> Static Shadowing</a>
</li> <li> <a href="ImageBasedReflections.html#Dynamic Shadowing"> Dynamic Shadowing</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Image based reflections is a feature of the DirectX 11 rendering pipeline in Unreal Engine 3. This technique is used to render realtime whole scene HDR reflections in the GDC 2011 Samaritan demo.  The technique works by reflecting an approximate version of the scene at each pixel, which makes it more efficient than previous reflection techniques, such as scene captures.  The approximate version of the scene is made up of 4 main components:
<p /> <ul>
<li> ImageReflectionActors (Textured quads)
</li> <li> Lights with bUseImageReflectionSpecular enabled
</li> <li> Coarse static shadowing from opaque surfaces
</li> <li> Dynamic shadowing from dynamic objects, reflected about a ImageReflectionShadowPlane
</li></ul>
<p />
A scene made up of all the components:
<p />
<img src="rsrc/Three/ImageBasedReflections/Reflections.jpg" alt="Reflections.jpg" width="900" height="494" />
<p />
<h2><a name="Enabling Image-Based Reflections"></a> Enabling Image-Based Reflections </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
AllowImageReflections and AllowImageReflectionShadowing must be set to True in your game's engine ini.  Then enable bUseImageBasedReflections on the materials you want to reflect, and place some ImageReflectionActors's so there is something being reflected.
<p />
<h2><a name="Quick start from empty level"></a> Quick start from empty level </h2>
<p /> <ul>
<li> Add some static meshes or BSP
</li> <li> Create a new material, connect a Constant node with a value of 1 to the Specular input, change bUseImageBasedReflections to enabled, assign this to your scene's meshes
</li> <li> Make sure the editor is in Lit mode, it will switch to Unlit automatically if there are no lights, and then the reflections won't show up
</li> <li> Drag and drop an ImageReflectionActor from the Actor Classes tab on top of the geometry you have placed
</li> <li> Align the camera so that you can see the reflection.  By default ImageReflectionActor's are one sided so you may have to rotate the camera around to the other side to see the reflection.
</li></ul>
<p />
Note: ImageReflectionActor's are translucent so you can only select them if you enable translucent selection, which is off by default.  The button that controls translucent selection is right next to the 'distance to far clipping plane' slider on the editor toolbar.
<p />
<h2><a name="Features"></a> Features </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Image based reflections have the following feature set:
<p /> <ul>
<li> HDR reflections
</li> <li> Any surface can reflect, not limited to a plane or point.
</li> <li> Varying glossiness across a surface is supported.  This is useful for things like a wet road where a puddle will have a mirror reflection, and the rest of the road will have a glossier reflection.
</li> <li> Anisotropic glossiness - reflections are streaked more in one direction
</li> <li> Dynamic components - all parts of the reflection except the static shadowing can be changed at runtime
</li></ul>
<p />
<h2><a name="Material Properties"></a> Material Properties </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
The following material properties affect image reflections:
<p /> <ul>
<li> <strong>bUseImageBasedReflections</strong> - enables or disables image reflections on this material
</li> <li> <strong>ImageReflectionNormalDampening</strong> - dampens the normal used by image reflections.  This is useful because wet surfaces tend to have a bumpier normal for bouncing diffuse lighting, and a smoother normal for specular reflections.  Larger values make the normal smoother (more like the underlying vertex normal) and a value of 1 means no dampening at all, use the supplied Normal directly for reflections.
</li> <li> <strong>SpecularColor</strong> - Scales the reflection contribution
</li> <li> <strong>SpecularPower</strong> - Controls material glossiness
</li></ul>
<p />
<h2><a name="ImageReflectionActors"></a> ImageReflectionActors </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
ImageReflectionActors are the most basic element of the scene that is reflected with image based reflections.  These define a textured quad with a few other properties:
<p /> <ul>
<li> <strong>bEnabled</strong> - whether the reflection is enabled or not.  This can be controlled through a Matinee toggle track.
</li> <li> <strong>bTwoSided</strong> - whether the reflection will be seen from both sides
</li> <li> <strong>ReflectionColor</strong> - RGB tints the ReflectionTexture values, A controls brightness.  This can be controlled through a Matinee LinearColor track.
</li> <li> <strong>ReflectionTexture</strong> - texture that will be applied to this quad in the reflection
</li></ul>
<p />
There can be at most 85 ImageReflectionActor's enabled in the world at one time.  If there are more than this, some of them will not be rendered.  The more ImageReflectionActor's that are enabled, the more the image reflections will cost to render, even when the ImageReflectionActor's are offscreen (because they can still be seen in a reflection when behind the viewer).
<p />
<h3><a name="ReflectionTexture Restrictions"></a> ReflectionTexture Restrictions </h3>
<p />
The ReflectionTexture property has some restrictions because it is used with a D3D 11 texture array.  The restrictions are: <ul>
<li> Size must be 1024 * 1024
</li> <li> Format must be DXT5
</li> <li> Texture group must be TEXTUREGROUP_ImageBasedReflection.  This texture group has special mip generation settings that blur the mip maps so that they do not appear blocky when magnified.
</li></ul>
<p />
The RGB of the ReflectionTexture will represent how emissive the card is, and the alpha is how opaque it is.
<p />
A single ImageReflectionActor on the left, showing how glossiness is dependent on distance from the reflection point.  On the right, the reflection is anisotropic and stretches out more vertically.
<p />
<img src="rsrc/Three/ImageBasedReflections/6NoAniso.jpg" alt="6NoAniso.jpg" width="450" height="415" />
<img src="rsrc/Three/ImageBasedReflections/6Aniso.jpg" alt="6Aniso.jpg" width="450" height="415" />
<p />
The following scene is showing that any surface can pick up image reflections, it doesn't have to be the ground plane.  Glossiness is affected by material Specular Power and distance to the reflector, which is why the reflection on the ground is glossier than the wall.
<p />
<img src="rsrc/Three/ImageBasedReflections/AnySurface.jpg" alt="AnySurface.jpg" width="900" height="633" />
<p />
<h3><a name="ImageReflectionSceneCapture"></a> ImageReflectionSceneCapture </h3>
<p />
ImageReflectionSceneCapture is basically just a ImageReflectionActor that captures a part of the scene into its texture instead of requiring the user to manually specify a reflection texture.  These are really useful for setting up a reflection for a whole building facade or something that you don't already have an emissive texture for.  The scene capture will update during a lighting build, or you can force it to update without building lighting by right clicking and choosing Update.
<p />
<strong>Properties</strong>
<p /> <ul>
<li> <strong>DepthRange</strong> - controls the world space depth range that will be captured into the texture.  When selected, a wireframe box shows how big the current range is.
</li> <li> <strong>ColorRange</strong> - used to pack HDR source values into the LDR generated texture.  The default is 4, meaning that the largest color value that can be represented in the captured texture is 4.
</li></ul>
<p />
A single ImageReflectionSceneCapture in a level, showing that it captured the building facade behind it.  The wireframe box indicates the depth range that will be captured.
<p />
<img src="rsrc/Three/ImageBasedReflections/SceneCapture.jpg" alt="SceneCapture.jpg" width="832" height="492" />
<p />
<h2><a name="Environment Texture"></a> Environment Texture </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
WorldInfo has some properties that allow specifying reflections coming from an infinitely distant hemisphere over the level.  This is useful for adding some ambient reflections that appear that they are coming from the distance, and to bring out the detail that the shadowing methods provide.
<p /> <ul>
<li> <strong>ImageReflectionEnvironmentTexture</strong> - Panoramic environment texture for image reflections.  The texture should be laid out so that the horizon is along the bottom (v = 0) and straight up in world space is along the top (v = 1).  The u direction of the texture then corresponds to rotation around the Z world axis.
</li> <li> <strong>ImageReflectionEnvironmentColor</strong> - Color to be multiplied against ImageReflectionEnvironmentTexture, alpha controls brightness.
</li> <li> <strong>ImageReflectionEnvironmentRotation</strong> - Angle to rotate the environment texture around the world Z axis, in degrees.
</li></ul>
<p />
An example environment texture.
<p />
<img src="rsrc/Three/ImageBasedReflections/EnvironmentTexture.jpg" alt="EnvironmentTexture.jpg" width="789" height="391" />
<p />
<h2><a name="Light Reflections"></a> Light Reflections </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Lights have a new property called bUseImageReflectionSpecular.  When enabled, their light will be reflected in a way that provides:
<p /> <ul>
<li> Long, streaky highlights like you typically see on a rainy night
</li> <li> Highlights that are not clamped to the influence radius of the light
</li> <li> Energy preserving specular (glossier areas have a dimmer reflection, mirror-like areas have a brighter reflection)
</li></ul>
<p />
There can be at most 85 lights with bUseImageReflectionSpecular enabled in the world at one time.  If there are more than this, some of them will not be rendered.  The light also has a property called ReflectionSpecularBrightness that provides control over the brightness of this light reflection.
<p />
A scene with bUseImageReflectionSpecular enabled on all the streetlights.  Notice that the distant lights have a dimmer reflection but it is still visible.  The highlights are affected by the road's specular power, and they get dimmer when the material is glossier (energy conserving).
<p />
<img src="rsrc/Three/ImageBasedReflections/Streaky.jpg" alt="Streaky.jpg" width="900" height="530" />
<p />
<h2><a name="Static Shadowing"></a> Static Shadowing </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Shadowing of the reflections is required to prevent light leaking.  The primary method for shadowing the reflections is a precomputed method from the scene's opaque, static surfaces, which is generated by Lightmass during a lighting build.  To use these shadows, enable bEnableImageReflectionShadowing in WorldInfo, make sure you have a lightmass importance volume surrounding the area that you want shadowing for, and build lighting.  You can exclude individual objects from shadowing the reflections by disabling bCastStaticShadow on the component.
<p />
Simple scene showing how static shadowing operates.  Shadow penumbra size is dependent on distance from the reflection point and material glossiness.
<p />
<img src="rsrc/Three/ImageBasedReflections/StaticShadowing.jpg" alt="StaticShadowing.jpg" width="730" height="445" />
<p />
<h2><a name="Dynamic Shadowing"></a> Dynamic Shadowing </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Movable actor types (InterpActor, SkeletalMeshActor, etc) won't be included in the static shadowing method, so they will appear to float above the ground.  The only dynamic shadowing supported for reflections is through a planar reflection, which you specify by placing and aligning a ImageReflectionShadowPlane actor.  The most common use case for this is to place the plane at the ground.
<p />
On the left, the scene without any dynamic object shadowing.  On the right, a ImageReflectionShadowPlane has been aligned with the road and the dynamic objects are now grounded.
<p />
<img src="rsrc/Three/ImageBasedReflections/3Unshadowed.jpg" alt="3Unshadowed.jpg" width="568" height="374" />
<img src="rsrc/Three/ImageBasedReflections/3Shadowed2.jpg" alt="3Shadowed2.jpg" width="568" height="374" />
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
