<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title> UDK | LightEnvironments    </title>

<style type="text/css" media="all">@import "rsrc/twiki_webs.css";</style>
<style type="text/css" media="all">@import "rsrc/udn_new.css";</style>
<link rel="icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="rsrc/Three/WebPreferences/favicon.ico" type="image/x-icon" />


<!-- view.static_udn3.tmpl  -->
<script language="JavaScript" type="text/javascript" src="rsrc/udn.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<p />
<body id="webbgThree">
<p />

<p />
<div id="webThree"><div id="head">
<!--
<div class="header">
 -->
<div style="background: url(/pub/webbg_udn.jpg); background-repeat: no-repeat; height:140px; width: 100%;" >
<!--
<div style="background: transparent url(/pub/udn_header_bg.jpg); background-repeat: repeat-x; height:140px; width: 100%; margin-left: 991px;">
 -->
<p />
<div id="nav">
<ul class="nav">
<font color=black>|</font>&nbsp;&nbsp;<li class=nav_Three><a href="../Main/WebHome.html" class="twikiLink">Main</a></li><font color=black>|</font><li class=nav_Three><a href="../Two/WebHome.html" class="twikiLink">UnrealEngine2</a></li><font color=black>|</font><li class=nav_Three><a href="WebHome.html" class="twikiLink">UnrealEngine3</a></li><font color=black>|</font><li class=nav_Three><a href="https://docs.unrealengine.com" class="twikiLink">UnrealEngine4</a></li><font color=black>|</font><li class=nav_Three><a href="../Main/BusinessAndLegal.html" class="twikiLink">Business &amp; Legal</a></li><font color=black>|</font>
</ul><br><br><br>
</div>
</div>
</div> <!-- end head -->
<div id="pagedefault">
<div id="maincol">
<div id="tool">
<div id="tooltop">UDN</div>
<div id="tooltext" style="padding: 10px 10px 10px 10px;">
Search public documentation: <br>
<form ACTION="/search/index.php" METHOD="GET" NAME="main" ID="main">
<input TYPE="TEXT" NAME="q" SIZE="15" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;">
<input TYPE="SUBMIT" VALUE="Search" STYLE="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: xx-small;"><br>
</form>
</div>
<div id="toolband">LightEnvironments  </b></div>
<div id="tooltext">
<a href="LightEnvironmentsJP.html" class="twikiLink">日本語訳</a><br><a href="LightEnvironmentsCH.html" class="twikiLink">中国翻译</a><br><a href="LightEnvironmentsKR.html" class="twikiLink">한국어</a><br>

<!-- Three/LightEnvironments -->
<hr size="1" noshade="noshade" />
Interested in the Unreal Engine? <br>
Visit the <a href="http://www.unrealtechnology.com" target="_top">Unreal Technology</a> site.<br>
<br>
Looking for jobs and company info? <br>
Check out the <a href="http://www.epicgames.com" target="_top">Epic games</a> site.<br>
<br>
Questions about support via UDN? <br>
Contact the <a href="../Main/ContactUDNStaff.html" class="twikiLink">UDN Staff</a> <br>
<br>
</div> <!-- end toolbox content -->
<div id="toolbottom"></div>
</div> <!-- end tool -->
<p />
<noautolink>
<p />
<div style="padding:0px 0px 0px 4px;font:10px Verdana;">
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="LightingAndShadowsHome.html" class="twikiLink">Lighting &amp; Shadows</a></b> &gt; Light Environments <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="LevelDesignerHome.html" class="twikiLink">Level Designer</a></b> &gt; Light Environments <br/>
<b><a href="WebHome.html" class="twikiLink">UE3 Home</a></b> &gt; <b><a href="LightingArtistHome.html" class="twikiLink">Lighting Artist</a></b> &gt; Light Environments
</div>
<hr size="1" noshade="noshade">
<h1><a name="Light Environments"></a> Light Environments </h1>
<hr size="1" noshade="noshade">
<p />
<em>Document Changelog: Created by <a href="https://udn.epicgames.com/Main/DanielWright" class="restricted" class="restricted" class="twikiLink">Daniel Wright</a>.</em>
<p />
<div class="twikiToc"> <ul>
<li> <a href="LightEnvironments.html#Light Environments"> Light Environments</a> <ul>
<li> <a href="LightEnvironments.html#Overview"> Overview</a>
</li> <li> <a href="LightEnvironments.html#Why Light Environments are Needed"> Why Light Environments are Needed</a>
</li> <li> <a href="LightEnvironments.html#How Light Environments Work"> How Light Environments Work</a>
</li> <li> <a href="LightEnvironments.html#Settings"> Settings</a> <ul>
<li> <a href="LightEnvironments.html#Light"> Light</a> <ul>
<li> <a href="LightEnvironments.html#b_CastCompositeShadow"> bCastCompositeShadow</a>
</li> <li> <a href="LightEnvironments.html#CompositeDynamic channel"> CompositeDynamic channel</a>
</li></ul>
</li> <li> <a href="LightEnvironments.html#Primitive's _LightEnvironment"> Primitive's LightEnvironment</a> <ul>
<li> <a href="LightEnvironments.html#DynamicLightEnvironmentComponent"> DynamicLightEnvironmentComponent</a>
</li> <li> <a href="LightEnvironments.html#LightEnvironmentComponent"> LightEnvironmentComponent</a>
</li></ul>
</li></ul>
</li> <li> <a href="LightEnvironments.html#Limitations"> Limitations</a> <ul>
<li> <a href="LightEnvironments.html#Shadow pointing down after enabling _LightEnvironmentComponent.bEnabled"> Shadow pointing down after enabling LightEnvironmentComponent.bEnabled</a>
</li></ul>
</li> <li> <a href="LightEnvironments.html#Relevant Discussion Threads"> Relevant Discussion Threads</a>
</li></ul>
</li></ul>
</div>
<p />
<h2><a name="Overview"></a> Overview </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Light environments provide Level Designers with an automated way of controlling dynamic lighting by approximating the effect of relevant static lights.  Together with modulated shadows, light environments were used on all characters and vehicles and most other dynamic objects in Gears of War and Unreal Tournament 3.
<p />
<p />
<h2><a name="Why Light Environments are Needed"></a> Why Light Environments are Needed </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
Without light environments, Level Designers are forced to maintain at least 2 sets of lights, static-only lights and lights affecting dynamic objects.  Overlapping between these is often not possible because too many lights affecting the dynamic objects incurs a performance hit, and only using some of the static lights on dynamic objects results in incorrect lighting on dynamic objects and reduces the flexibility of the lighting system.
<p />
<p />
<h2><a name="How Light Environments Work"></a> How Light Environments Work </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
A light environment gathers the static and dynamic lights that affect its subject, and reproduces those lights on the subject with a fixed rendering cost.  It approximates all the lights affecting the character with a spherical harmonic light and a directional light.
<p />
The environment culls lights that wouldn't affect the character due to shadowing by using a ray check from the light to a point in the subject's bounds.  By default, only one ray is used, but the DynamicLightEnvironmentComponent's NumVolumeVisibilitySamples can be used to specify that multiple rays should be checked to allow for fractional visibility.
<p />
For each light the environment finds that affects the character, it projects that light into a low order spherical harmonic basis.  The projection maintains the light intensity and color, but blurs the angle they are incident on the subject from.  The information lost in the blurring is essential to the spherical harmonic basis's ability to represent an unlimited number of lights in a fixed set of spherical harmonic coefficients.
<p />
Once the environment has projected all relevant lights into the spherical harmonic basis, it approximates the bounced lighting from those direct lights that would affect the subject.  The approximation is to simply take a fraction of the direct lighting, saturate it, reflect the angle it comes from, and add it with the direct lighting to get the total lighting.  The bounced lighting approximation is controlled by DynamicLightEnvironment's BouncedLightingIntensity and BouncedLightingDesaturation members.
<p />
The directional light is used to synthesize the lighting coming from the dominant lighting angle, where the dominant lighting angle is the angle that has the highest luminance in the spherical harmonic projection of the lighting incident on the subject.
<p />
The spherical harmonic light is used to synthesize all the light that the directional light doesn't account for.  Because of the angular blurring of the spherical harmonic basis used to represent the composite lighting, the SH light cannot accurately reproduce high frequency specular reflections, so specular reflections from the SH light are ignored entirely as an optimization.
<p />
Light environments also optionally cast a single modulated shadow from a composite of the subset of the lights affecting the environment that have bCastCompositeShadow=True.  The environment's spherical harmonic light isn't affected by the environment's modulated shadow, but the environment's directional light is.
<p />
<p />
<h2><a name="Settings"></a> Settings </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<h3><a name="Light"></a> Light </h3>
<p />
These are the relevant settings available to each light:<br><br>
<img alt="LightSettings.jpg" src="rsrc/Three/LightEnvironments/LightSettings.jpg" />
<p />
<h4><a name="b_CastCompositeShadow"></a> bCastCompositeShadow </h4>
<p />
For a light to affect the shadow direction it must have bCastCompositeShadow=True. The default is true for all light types; prior to Epic changelist 208754 it was false by default on point lights and spot lights. For lights with this set to false they will be used to affect the light environment's composite lighting but not its composite shadow.
<p />
bCastCompositeShadow also controls whether non-light-mapped lights are affected by modulated shadows; a dynamic light with bCastCompositeShadow=False won't be affected by modulated shadows from any light.  bCastCompositeShadow is ignored on light-mapped lights, since the light will be rendered as part of the composite light-map; all light-mapped lights are affected by modulated shadows.
<p />
<h4><a name="CompositeDynamic channel"></a> CompositeDynamic channel </h4>
<p />
All lights are in the CompositeDynamic channel by default, however you still need to have lights in the dynamic lighting channel if you have any primitives which don't use the composite light environment.  Note that the CompositeDynamic channel is a separate flag from the Dynamic lighting channel as an optimization. There will typically be many lights that are CompositeDynamic but not Dynamic, and lights in the Dynamic lighting channel need to be checked for relevance whenever a primitive is reattached to the scene.
<p />
<h3><a name="Primitive's _LightEnvironment"></a> Primitive's LightEnvironment </h3>
<p />
These are the settings available in the LightEnvironment, which can be set on SkeletalMeshActors for example.
<p />
<img alt="LightEnvironment_Properties.gif" src="rsrc/Three/LightEnvironments/LightEnvironment_Properties.gif" />
<p />
<h4><a name="DynamicLightEnvironmentComponent"></a> DynamicLightEnvironmentComponent </h4>
<p /> <ul>
<li> <strong>AmbientGlow</strong> - Ambient color added in addition to the level's lighting.
</li> <li> <strong>AmbientShadowColor</strong> - The color of the ambient shadow.
</li> <li> <strong>AmbientShadowSourceDirection</strong> - The direction of the ambient shadow source.
</li> <li> <strong>bCastShadows</strong> - Whether the light environment should cast shadows
</li> <li> <strong>bDynamic</strong> - Whether the light environment should be dynamically updated.
</li> <li> <strong>bFreeze</strong> - Whether the light environment state should be frozen. (This property is no longer editable in newer builds.)
</li> <li> <strong>BouncedLightingIntensity</strong> - The intensity of the simulated bounced light, as a fraction of the direct incident lighting.
</li> <li> <strong>BouncedLightingDesaturation</strong> - The desaturation blend to apply to the simulated bounced light.  Typically this will be negative to make the bounced lighting more saturated.
</li> <li> <strong>bSynthesizeDirectionalLight</strong> - Whether a directional light should be used to synthesize the dominant lighting in the environment.
</li> <li> <strong>bSynthesizeSHLight</strong> - Whether a spherical harmonic light should be used to synthesize all light not accounted for by the synthesized directional light.  If not, a sky light is used instead.
</li> <li> <strong>InvisibleUpdateTime</strong> - The number of seconds between light environment updates for actors which aren't visible.
</li> <li> <strong>LightDesaturation</strong> - Desaturation percentage of level lighting, which can be used to help team colored characters stand out better under colored lighting.
</li> <li> <strong>LightDistance</strong> - The distance to create the light from the owner's origin, in radius units.
</li> <li> <strong>LightShadowMode</strong> - Type of shadowing to apply for the light.
</li> <li> <strong>MinTimeBetweenFullUpdates</strong> - Minimum amount of time that needs to pass between full environment updates.
</li> <li> <strong>ModShadowFadeoutExponent</strong> - Exponent that controls mod shadow fadeout curve.
</li> <li> <strong>ModShadowFadeoutTime</strong> - Time since the caster was last visible at which the mod shadow will fade out completely.
</li> <li> <strong>NumVolumeVisibilitySamples</strong> - The number of visibility samples to use within the primitive's bounding volume.
</li> <li> <strong>ShadowDistance</strong> - The distance for the shadow to project beyond the owner's origin, in radius units.
</li> <li> <strong>ShadowFilterQuality</strong> - Quality of shadow buffer filtering to use on the light environment
</li></ul>
<p />
<h4><a name="LightEnvironmentComponent"></a> LightEnvironmentComponent </h4>
<p /> <ul>
<li> <strong>bEnabled</strong> - Enables the LightEnvironmentComponent.  When the LightEnvironmentComponent is enabled, the DynamicLightEnvironment treats the primitives that are in the Dynamic lighting channel as being in the CompositeDynamic lighting channel instead.  The dynamic channel is unique in this regard, no other channels are reinterpreted by the DynamicLightEnvironmentComponent.
</li></ul>
<p />
<p />
<h2><a name="Limitations"></a> Limitations </h2>
<div style="margin-top:-10px;"><hr size="1" noshade="noshade"></div>
<p />
<h3><a name="Shadow pointing down after enabling _LightEnvironmentComponent.bEnabled"></a> Shadow pointing down after enabling LightEnvironmentComponent.bEnabled </h3>
<p />
If no lights affecting the environment's subject have bCastCompositeShadows=True, the object's shadow will point straight down (or whatever direction is specified by the environment's AmbientShadowDirection property).
<p />
<!--  -->
<p />
</noautolink>
<p />
<p />
<p />
<p />
<p />
<p />


<!-- BEGIN UE4 NOTICE -->



<div id="version_message" style="display:none;">

    <div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;opacity:0.5;">

    </div>

    <div style="position:fixed;top:50%;left:50%;margin:-70px 0px 0px -240px;background:#FFF;border-radius:6px;width:480px;box-shadow:0px 5px 30px -5px rgba(0,0,0,0.9);">

        <div style="font-size:16px;font-weight:bold;background: url(rsrc/Three/warning.png) no-repeat scroll 5px 5px;padding:4px 10px 5px 25px;height:21px;width:440px;">

            Important!

        </div>

        <div style="font-size:11px;padding:5px 10px 10px;width:460px;">

            <p>You are viewing documentation for the <strong>Unreal Development Kit (UDK)</strong>.</p>



            <p>If you are looking for the Unreal Engine 4 documentation, please visit the <a style="color:#000;" href="https://docs.unrealengine.com">Unreal Engine 4 Documentation</a> site.</p>

        </div>

        <div style="height:20px;padding:4px;margin:6px;border-top:1px solid #a0a0a0;">

            <form onsubmit="return closeVersionMessage();">

                <input type="checkbox" id="dismiss" value="dismiss" />

                <label for="dsimiss">Don't show me this again</label>

                <input type="submit" value="Close" style="cursor:pointer;float:right;width:60px;color:#f0f0f0;font-weight:bold;background:#882222;height:24px;padding:2px 3px 3px;text-align:center;border:1px outset #000;" />

            </form>

        </div>

    </div>

</div>



<script type="text/javascript">

    window.onload = function () {

        LoadVersionMessage();

    }



    function LoadVersionMessage()

    {

        var showMessage = "false";
        if(showMessage != "false")

        {

            showVersionMessage();

        }

    }



    function showVersionMessage()

    {

        var message = document.getElementById("version_message");

        if(message)

        {

            message.style.display = "block";

        }

    }



    function closeVersionMessage() {

        var dismiss = document.getElementById("dismiss");

        var message = document.getElementById("version_message");

        if (message) {

            message.style.display = "none";

        }

        if (dismiss.checked) {

            eraseCookie("doc_version_message");

            createCookie("doc_version_message", "false", 365);

            dismiss.checked = false;

        }

        return false;

    }



    function createCookie(name, value, days) {

        if (days) {

            var date = new Date();

            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));

            var expires = "; expires=" + date.toGMTString();

        }

        else var expires = "";

        document.cookie = name + "=" + value + expires + "; path=/";

    }



    function readCookie(name) {

        var nameEQ = name + "=";

        var ca = document.cookie.split(';');

        for (var i = 0; i < ca.length; i++) {

            var c = ca[i];

            while (c.charAt(0) == ' ') c = c.substring(1, c.length);

            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);

        }

        return null;

    }



    function eraseCookie(name) {

        createCookie(name, "", -1);

    }

</script>



<!-- END UE4 NOTICE -->



</div></div><div id="footer"><div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;"><div>&nbsp;</div><div style="float: left; text-align: left; vertical-align: bottom; width: 50%;"><a href="http://www.videogamevoters.org"><img src="rsrc/vgvn.jpg" border="0" width="234" height="60" alt="Video Game Voters Network" /></a></div><div style="float: right; text-align: right; vertical-align: bottom; width: 50%;">Copyright &copy; 2001-2012 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a><br /><a href="../Main/TermsAndConditions.html" class="twikiLink">Terms and Conditions</a><br /><a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a></div></div></div></div>
<p />
</html></body>
